import{S as le,i as se,s as ie,P as Ge,Q as Pe,R as oe,T as Ae,U as He,r as _,t as y,w as me,g as j,x as pe,y as g,V as xe,o as De,W as te,X as $e,j as T,Y as ze,Z as Fe,$ as We,a0 as qe,a1 as et,z as _e,k as I,B as P,q as x,u as M,n as L,a2 as ve,v as K,I as V,a3 as Me,J as Re,L as tt,d as D,e as z,h as F,M as nt,A as Ze,C as Ve,D as Se,_ as ot,E as lt,H as st,F as it,K as Le,N as Ke,O as je,a4 as ce}from"./Settings-7de68ec9.js";function ft(l,n,e){let t;const i=Ge();let{layer:s=void 0}=n;const{map:r}=Pe();oe(l,r,c=>e(2,t=c));function o(c){i(c.type,{...c,map:r})}const f=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],m=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Ae(()=>{if(t)if(s)for(const c of f)t.off(c,s,o);else for(const c of m)t.off(c,o)}),l.$$set=c=>{"layer"in c&&e(1,s=c.layer)},l.$$.update=()=>{if(l.$$.dirty&6&&t)if(s)for(const c of f)t.on(c,s,o);else for(const c of m)t.on(c,o)},[r,s,t]}class rt extends le{constructor(n){super(),se(this,n,ft,null,ie,{layer:1})}}const ut=l=>({features:l[0]&16,data:l[0]&16,map:l[0]&4,close:l[0]&1}),Ne=l=>{var n;return{features:l[4],data:((n=l[4])==null?void 0:n[0])??null,map:l[2],close:l[31]}};function Te(l){var i;let n,e,t=(((i=l[4])==null?void 0:i.length)||l[3]instanceof te.Marker)&&Ee(l);return{c(){n=T("div"),t&&t.c()},m(s,r){_(s,n,r),t&&t.m(n,null),l[32](n),e=!0},p(s,r){var o;(o=s[4])!=null&&o.length||s[3]instanceof te.Marker?t?(t.p(s,r),r[0]&24&&y(t,1)):(t=Ee(s),t.c(),y(t,1),t.m(n,null)):t&&(me(),j(t,1,1,()=>{t=null}),pe())},i(s){e||(y(t),e=!0)},o(s){j(t),e=!1},d(s){s&&g(n),t&&t.d(),l[32](null)}}}function Ee(l){let n;const e=l[30].default,t=ze(e,l,l[29],Ne);return{c(){t&&t.c()},m(i,s){t&&t.m(i,s),n=!0},p(i,s){t&&t.p&&(!n||s[0]&536870933)&&Fe(t,e,i,i[29],n?qe(e,i[29],s,ut):We(i[29]),Ne)},i(i){n||(y(t,i),n=!0)},o(i){j(t,i),n=!1},d(i){t&&t.d(i)}}}function at(l){let n,e,t=l[9].default&&Te(l);return{c(){t&&t.c(),n=He()},m(i,s){t&&t.m(i,s),_(i,n,s),e=!0},p(i,s){i[9].default?t?(t.p(i,s),s[0]&512&&y(t,1)):(t=Te(i),t.c(),y(t,1),t.m(n.parentNode,n)):t&&(me(),j(t,1,1,()=>{t=null}),pe())},i(i){e||(y(t),e=!0)},o(i){j(t),e=!1},d(i){i&&g(n),t&&t.d(i)}}}function ct(l,n,e){let t,i,s,r,o,f,{$$slots:m={},$$scope:c}=n;const h=xe(m);let{closeButton:d=void 0}=n,{closeOnClickOutside:S=!0}=n,{closeOnClickInside:k=!1}=n,{closeOnMove:A=!1}=n,{openOn:C="click"}=n,{openIfTopMost:J=!0}=n,{focusAfterOpen:H=!0}=n,{anchor:O=void 0}=n,{offset:v=void 0}=n,{popupClass:B=void 0}=n,{maxWidth:R=void 0}=n,{lngLat:b=void 0}=n,{html:E=void 0}=n,{open:w=!1}=n;const W=Ge(),{map:q,popupTarget:$,layerEvent:Q,layer:fe,eventTopMost:re,markerClickManager:N}=Pe();oe(l,q,u=>e(2,s=u)),oe(l,$,u=>e(3,o=u)),oe(l,Q,u=>e(28,r=u)),oe(l,fe,u=>e(35,f=u));const p=["click","dblclick","contextmenu"];let a,U=!1,G;function Ue(){if(!a)return;let u=a.getElement();!u||u===G||(G=u,C==="hover"&&(G.style.pointerEvents="none"),G.addEventListener("mouseenter",()=>{e(24,U=!0)},{passive:!0}),G.addEventListener("mouseleave",()=>{e(24,U=!1)},{passive:!0}),G.addEventListener("click",()=>{k&&e(0,w=!1)},{passive:!0}))}De(()=>{if(s)return s.on("click",ue),s.on("contextmenu",ue),N.add(Ce),typeof o=="string"&&(s.on("click",o,Y),s.on("dblclick",o,Y),s.on("contextmenu",o,Y),s.on("mousemove",o,ye),s.on("mouseleave",o,Oe),s.on("touchstart",o,be),s.on("touchend",o,we)),()=>{s!=null&&s.loaded()&&(a==null||a.remove(),s.off("click",ue),s.off("contextmenu",ue),N.remove(Ce),o instanceof te.Marker?o.getPopup()===a&&o.setPopup(void 0):typeof o=="string"&&(s.off("click",o,Y),s.off("dblclick",o,Y),s.off("contextmenu",o,Y),s.off("mousemove",o,ye),s.off("mouseleave",o,Oe),s.off("touchstart",o,be),s.off("touchend",o,we)))}});function he(u){return J?!("marker"in u)&&!et(u)&&re(u)!==f:!1}let X=null,Z="normal";function ke(u){"layerType"in u&&u.layerType==="deckgl"?(e(10,b=u.coordinate),e(4,X=u.object?[u.object]:null)):(e(10,b=u.lngLat),e(4,X=u.features??[]))}function Y(u){u.type!==C||he(u)||(ke(u),setTimeout(()=>e(0,w=!0)))}let ee=null;function be(u){ee=u.point}function we(u){if(!ee||C!=="hover")return;let ge=ee.dist(u.point);ee=null,ge<3&&(e(10,b=u.lngLat),e(4,X=u.features??[]),a.isOpen()?e(25,Z="justOpened"):(e(25,Z="opening"),e(0,w=!0)))}function Oe(u){C!=="hover"||ee||Z!=="normal"||(e(0,w=!1),e(4,X=null))}function ye(u){if(!(C!=="hover"||ee||Z!=="normal")){if(he(u)){e(0,w=!1),e(4,X=null);return}e(0,w=!0),e(4,X=u.features??[]),e(10,b=u.lngLat)}}function ue(u){if(Z==="justOpened"){e(25,Z="normal");return}if(!S)return;let ge=[G,o instanceof te.Marker?o==null?void 0:o.getElement():null];w&&a.isOpen()&&!ge.some(de=>de==null?void 0:de.contains(u.originalEvent.target))&&(u.type==="contextmenu"&&C==="contextmenu"||u.type!=="contextmenu")&&e(0,w=!1)}function Ce(u){S&&w&&a.isOpen()&&u.marker!==o&&e(0,w=!1)}Ae(()=>{s&&(a!=null&&a.isOpen())&&a.remove()});let ne;const Xe=()=>e(0,w=!1);function Ye(u){_e[u?"unshift":"push"](()=>{ne=u,e(1,ne)})}return l.$$set=u=>{"closeButton"in u&&e(11,d=u.closeButton),"closeOnClickOutside"in u&&e(12,S=u.closeOnClickOutside),"closeOnClickInside"in u&&e(13,k=u.closeOnClickInside),"closeOnMove"in u&&e(14,A=u.closeOnMove),"openOn"in u&&e(15,C=u.openOn),"openIfTopMost"in u&&e(16,J=u.openIfTopMost),"focusAfterOpen"in u&&e(17,H=u.focusAfterOpen),"anchor"in u&&e(18,O=u.anchor),"offset"in u&&e(19,v=u.offset),"popupClass"in u&&e(20,B=u.popupClass),"maxWidth"in u&&e(21,R=u.maxWidth),"lngLat"in u&&e(10,b=u.lngLat),"html"in u&&e(22,E=u.html),"open"in u&&e(0,w=u.open),"$$scope"in u&&e(29,c=u.$$scope)},l.$$.update=()=>{if(l.$$.dirty[0]&14336&&e(27,t=d??(!S&&!k)),l.$$.dirty[0]&146685952&&(a||(e(23,a=new te.Popup({closeButton:t,closeOnClick:!1,closeOnMove:A,focusAfterOpen:H,maxWidth:R,className:B,anchor:O,offset:v})),G=a.getElement(),a.on("open",()=>{e(0,w=!0),Ue(),W("open",a)}),a.on("close",()=>{e(0,w=!1),W("close",a)}),a.on("hover",()=>{W("hover",a)}))),l.$$.dirty[0]&8421384&&a&&o instanceof te.Marker&&(C==="click"?o.setPopup(a):o.getPopup()===a&&o.setPopup(void 0)),l.$$.dirty[0]&268468224&&p.includes(C)&&(r==null?void 0:r.type)===C&&(Y(r),$e(Q,r=null,r)),l.$$.dirty[0]&268468224&&e(26,i=C==="hover"&&((r==null?void 0:r.type)==="mousemove"||(r==null?void 0:r.type)==="mouseenter")),l.$$.dirty[0]&352354304&&C==="hover"&&Q&&(i&&r&&ke(r),e(0,w=(i||U)??!1)),l.$$.dirty[0]&12582914&&(ne?a.setDOMContent(ne):E&&a.setHTML(E)),l.$$.dirty[0]&8389632&&b&&a.setLngLat(b),l.$$.dirty[0]&41943045&&s){let u=a.isOpen();w&&!u?(a.addTo(s),Z==="opening"&&e(25,Z="justOpened")):!w&&u&&a.remove()}},[w,ne,s,o,X,q,$,Q,fe,h,b,d,S,k,A,C,J,H,O,v,B,R,E,a,U,Z,i,t,r,c,m,Xe,Ye]}class Qe extends le{constructor(n){super(),se(this,n,ct,at,ie,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function mt(l){let n,e,t,i,s;const r=l[4].default,o=ze(r,l,l[3],null);return{c(){n=T("div"),e=T("div"),t=I(),i=T("div"),o&&o.c(),P(e,"position","absolute"),P(e,"width",`${100*l[0]/l[1]}%`),P(e,"height","100%"),P(e,"background-color",l[2]),P(i,"position","relative"),x(n,"class","row svelte-cq1cte")},m(f,m){_(f,n,m),M(n,e),M(n,t),M(n,i),o&&o.m(i,null),s=!0},p(f,[m]){m&3&&P(e,"width",`${100*f[0]/f[1]}%`),m&4&&P(e,"background-color",f[2]),o&&o.p&&(!s||m&8)&&Fe(o,r,f,f[3],s?qe(r,f[3],m,null):We(f[3]),null)},i(f){s||(y(o,f),s=!0)},o(f){j(o,f),s=!1},d(f){f&&g(n),o&&o.d(f)}}}function pt(l,n,e){let{$$slots:t={},$$scope:i}=n,{items:s}=n,{total:r}=n,{color:o}=n;return l.$$set=f=>{"items"in f&&e(0,s=f.items),"total"in f&&e(1,r=f.total),"color"in f&&e(2,o=f.color),"$$scope"in f&&e(3,i=f.$$scope)},[s,r,o,i,t]}class _t extends le{constructor(n){super(),se(this,n,pt,mt,ie,{items:0,total:1,color:2})}}function gt(l){let n,e,t,i,s=(l[3]||"unreviewed")+"",r,o,f,m,c,h,d,S,k,A,C,J,H;return{c(){n=T("p"),e=L("Target "),t=L(l[0]),i=L(": "),r=L(s),o=I(),f=T("button"),f.textContent="Mark unreviewed",m=I(),c=T("button"),c.textContent="Not sure",h=I(),d=T("button"),d.textContent="No matches",S=I(),k=T("input"),A=I(),C=T("button"),C.textContent="Matches these sources",x(k,"type","text")},m(O,v){_(O,n,v),M(n,e),M(n,t),M(n,i),M(n,r),_(O,o,v),_(O,f,v),_(O,m,v),_(O,c,v),_(O,h,v),_(O,d,v),_(O,S,v),_(O,k,v),ve(k,l[2]),_(O,A,v),_(O,C,v),J||(H=[K(f,"click",l[7]),K(c,"click",l[8]),K(d,"click",l[9]),K(k,"input",l[10]),K(C,"click",l[4])],J=!0)},p(O,[v]){v&1&&V(t,O[0]),v&4&&k.value!==O[2]&&ve(k,O[2])},i:Me,o:Me,d(O){O&&(g(n),g(o),g(f),g(m),g(c),g(h),g(d),g(S),g(k),g(A),g(C)),J=!1,Re(H)}}}function dt(l,n,e){let{clickedTarget:t}=n,{targetGj:i}=n,{matchingSourceIndices:s}=n,{onConfirm:r}=n,o=i.features[t].properties.reviewed,f=Array.isArray(o)?JSON.stringify(o):JSON.stringify(s);function m(){try{let k=JSON.parse(f);if(!Array.isArray(k))throw new Error("Not an array");r(k)}catch{window.alert("Not a list of source IDs")}}const c=()=>r(""),h=()=>r("not sure"),d=()=>r([]);function S(){f=this.value,e(2,f)}return l.$$set=k=>{"clickedTarget"in k&&e(0,t=k.clickedTarget),"targetGj"in k&&e(5,i=k.targetGj),"matchingSourceIndices"in k&&e(6,s=k.matchingSourceIndices),"onConfirm"in k&&e(1,r=k.onConfirm)},[t,r,f,o,m,i,s,c,h,d,S]}class ht extends le{constructor(n){super(),se(this,n,dt,gt,ie,{clickedTarget:0,targetGj:5,matchingSourceIndices:6,onConfirm:1})}}function Ie(l){let n,e,t,i,s,r,o,f,m=l[4].features.length+"",c,h,d,S=l[0].features.length+"",k,A,C,J=l[2].filter(Be).length+"",H,O,v,B,R,b,E,w,W,q,$,Q;function fe(p){l[19](p)}let re={onChange:l[9],open:!1};l[5]!==void 0&&(re.options=l[5]),B=new st({props:re}),_e.push(()=>Ze(B,"options",fe)),E=new _t({props:{color:"blue",items:l[7],total:l[0].features.length,$$slots:{default:[kt]},$$scope:{ctx:l}}});let N=l[1]!=null&&Je(l);return{c(){n=T("div"),e=T("button"),e.textContent="Swap",t=I(),i=T("button"),i.textContent="Zoom to fit",s=I(),r=T("hr"),o=I(),f=T("p"),c=L(m),h=L(` sources and
        `),d=T("span"),k=L(S),A=L(" targets"),C=L(`
        , with `),H=L(J),O=L(` matching
        a source`),v=I(),D(B.$$.fragment),b=I(),D(E.$$.fragment),w=I(),N&&N.c(),W=He(),x(e,"class","secondary"),x(i,"class","secondary"),P(n,"display","flex"),P(n,"justify-content","space-between"),P(d,"color","red")},m(p,a){_(p,n,a),M(n,e),M(n,t),M(n,i),_(p,s,a),_(p,r,a),_(p,o,a),_(p,f,a),M(f,c),M(f,h),M(f,d),M(d,k),M(d,A),M(f,C),M(f,H),M(f,O),_(p,v,a),z(B,p,a),_(p,b,a),z(E,p,a),_(p,w,a),N&&N.m(p,a),_(p,W,a),q=!0,$||(Q=[K(e,"click",l[12]),K(i,"click",l[11])],$=!0)},p(p,a){(!q||a&16)&&m!==(m=p[4].features.length+"")&&V(c,m),(!q||a&1)&&S!==(S=p[0].features.length+"")&&V(k,S),(!q||a&4)&&J!==(J=p[2].filter(Be).length+"")&&V(H,J);const U={};!R&&a&32&&(R=!0,U.options=p[5],Ve(()=>R=!1)),B.$set(U);const G={};a&128&&(G.items=p[7]),a&1&&(G.total=p[0].features.length),a&2097281&&(G.$$scope={dirty:a,ctx:p}),E.$set(G),p[1]!=null?N?(N.p(p,a),a&2&&y(N,1)):(N=Je(p),N.c(),y(N,1),N.m(W.parentNode,W)):N&&(me(),j(N,1,1,()=>{N=null}),pe())},i(p){q||(y(B.$$.fragment,p),y(E.$$.fragment,p),y(N),q=!0)},o(p){j(B.$$.fragment,p),j(E.$$.fragment,p),j(N),q=!1},d(p){p&&(g(n),g(s),g(r),g(o),g(f),g(v),g(b),g(w),g(W)),F(B,p),F(E,p),N&&N.d(p),$=!1,Re(Q)}}}function kt(l){let n,e,t=l[0].features.length+"",i,s;return{c(){n=L(l[7]),e=L(" / "),i=L(t),s=L(" targets reviewed")},m(r,o){_(r,n,o),_(r,e,o),_(r,i,o),_(r,s,o)},p(r,o){o&128&&V(n,r[7]),o&1&&t!==(t=r[0].features.length+"")&&V(i,t)},d(r){r&&(g(n),g(e),g(i),g(s))}}}function Je(l){let n,e;return n=new ht({props:{clickedTarget:l[1],targetGj:l[0],matchingSourceIndices:l[8],onConfirm:l[13]}}),{c(){D(n.$$.fragment)},m(t,i){z(n,t,i),e=!0},p(t,i){const s={};i&2&&(s.clickedTarget=t[1]),i&1&&(s.targetGj=t[0]),i&256&&(s.matchingSourceIndices=t[8]),n.$set(s)},i(t){e||(y(n.$$.fragment,t),e=!0)},o(t){j(n.$$.fragment,t),e=!1},d(t){F(n,t)}}}function bt(l){let n,e,t,i,s,r,o,f,m,c,h=l[4].features.length>0&&Ie(l);return{c(){n=T("div"),e=T("h1"),e.textContent="Match LineStrings - review results to make test cases",t=I(),i=T("label"),s=L(`Load two .geojson files
      `),r=T("input"),o=I(),h&&h.c(),x(r,"type","file"),r.multiple=!0,x(n,"slot","left")},m(d,S){_(d,n,S),M(n,e),M(n,t),M(n,i),M(i,s),M(i,r),l[18](r),M(n,o),h&&h.m(n,null),f=!0,m||(c=K(r,"change",l[10]),m=!0)},p(d,S){d[4].features.length>0?h?(h.p(d,S),S&16&&y(h,1)):(h=Ie(d),h.c(),y(h,1),h.m(n,null)):h&&(me(),j(h,1,1,()=>{h=null}),pe())},i(d){f||(y(h),f=!0)},o(d){j(h),f=!1},d(d){d&&g(n),l[18](null),h&&h.d(),m=!1,c()}}}function wt(l){let n,e=ce(l[20]).id+"",t;return{c(){n=L("Source "),t=L(e)},m(i,s){_(i,n,s),_(i,t,s)},p(i,s){s&1048576&&e!==(e=ce(i[20]).id+"")&&V(t,e)},d(i){i&&(g(n),g(t))}}}function Ot(l){let n,e;return n=new Qe({props:{openOn:"hover",$$slots:{default:[wt,({data:t})=>({20:t}),({data:t})=>t?1048576:0]},$$scope:{ctx:l}}}),{c(){D(n.$$.fragment)},m(t,i){z(n,t,i),e=!0},p(t,i){const s={};i&3145728&&(s.$$scope={dirty:i,ctx:t}),n.$set(s)},i(t){e||(y(n.$$.fragment,t),e=!0)},o(t){j(n.$$.fragment,t),e=!1},d(t){F(n,t)}}}function yt(l){let n,e;return n=new Ke({props:{manageHoverState:!0,paint:{"line-width":["case",["in",["id"],["literal",l[8]]],8,5],"line-color":"black","line-opacity":je(.5,1)},$$slots:{default:[Ot]},$$scope:{ctx:l}}}),{c(){D(n.$$.fragment)},m(t,i){z(n,t,i),e=!0},p(t,i){const s={};i&256&&(s.paint={"line-width":["case",["in",["id"],["literal",t[8]]],8,5],"line-color":"black","line-opacity":je(.5,1)}),i&2097152&&(s.$$scope={dirty:i,ctx:t}),n.$set(s)},i(t){e||(y(n.$$.fragment,t),e=!0)},o(t){j(n.$$.fragment,t),e=!1},d(t){F(n,t)}}}function Ct(l){let n,e=ce(l[20]).id+"",t,i,s=JSON.stringify(l[8])+"",r;return{c(){n=L("Target "),t=L(e),i=L(" matches "),r=L(s)},m(o,f){_(o,n,f),_(o,t,f),_(o,i,f),_(o,r,f)},p(o,f){f&1048576&&e!==(e=ce(o[20]).id+"")&&V(t,e),f&256&&s!==(s=JSON.stringify(o[8])+"")&&V(r,s)},d(o){o&&(g(n),g(t),g(i),g(r))}}}function vt(l){let n,e;return n=new Qe({props:{openOn:"hover",$$slots:{default:[Ct,({data:t})=>({20:t}),({data:t})=>t?1048576:0]},$$scope:{ctx:l}}}),{c(){D(n.$$.fragment)},m(t,i){z(n,t,i),e=!0},p(t,i){const s={};i&3145984&&(s.$$scope={dirty:i,ctx:t}),n.$set(s)},i(t){e||(y(n.$$.fragment,t),e=!0)},o(t){j(n.$$.fragment,t),e=!1},d(t){F(n,t)}}}function Mt(l){let n,e;return n=new Ke({props:{manageHoverState:!0,paint:{"line-width":8,"line-color":["match",["get","reviewed"],"","red","blue"],"line-opacity":["case",["==",["id"],l[1]??-1],1,["boolean",["feature-state","hover"],!1],.6,["get","has_match"],.5,.2]},hoverCursor:"pointer",$$slots:{default:[vt]},$$scope:{ctx:l}}}),n.$on("click",l[15]),{c(){D(n.$$.fragment)},m(t,i){z(n,t,i),e=!0},p(t,i){const s={};i&2&&(s.paint={"line-width":8,"line-color":["match",["get","reviewed"],"","red","blue"],"line-opacity":["case",["==",["id"],t[1]??-1],1,["boolean",["feature-state","hover"],!1],.6,["get","has_match"],.5,.2]}),i&2097408&&(s.$$scope={dirty:i,ctx:t}),n.$set(s)},i(t){e||(y(n.$$.fragment,t),e=!0)},o(t){j(n.$$.fragment,t),e=!1},d(t){F(n,t)}}}function St(l){let n,e,t,i,s,r;return n=new rt({}),n.$on("click",l[14]),t=new Le({props:{data:l[4],$$slots:{default:[yt]},$$scope:{ctx:l}}}),s=new Le({props:{data:l[0],$$slots:{default:[Mt]},$$scope:{ctx:l}}}),{c(){D(n.$$.fragment),e=I(),D(t.$$.fragment),i=I(),D(s.$$.fragment)},m(o,f){z(n,o,f),_(o,e,f),z(t,o,f),_(o,i,f),z(s,o,f),r=!0},p(o,f){const m={};f&16&&(m.data=o[4]),f&2097408&&(m.$$scope={dirty:f,ctx:o}),t.$set(m);const c={};f&1&&(c.data=o[0]),f&2097410&&(c.$$scope={dirty:f,ctx:o}),s.$set(c)},i(o){r||(y(n.$$.fragment,o),y(t.$$.fragment,o),y(s.$$.fragment,o),r=!0)},o(o){j(n.$$.fragment,o),j(t.$$.fragment,o),j(s.$$.fragment,o),r=!1},d(o){o&&(g(e),g(i)),F(n,o),F(t,o),F(s,o)}}}function Lt(l){let n,e,t,i;function s(o){l[16](o)}let r={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[St]},$$scope:{ctx:l}};return l[3]!==void 0&&(r.map=l[3]),e=new nt({props:r}),_e.push(()=>Ze(e,"map",s)),e.$on("error",l[17]),{c(){n=T("div"),D(e.$$.fragment),x(n,"slot","main"),P(n,"position","relative"),P(n,"width","100%"),P(n,"height","100vh")},m(o,f){_(o,n,f),z(e,n,null),i=!0},p(o,f){const m={};f&2097427&&(m.$$scope={dirty:f,ctx:o}),!t&&f&8&&(t=!0,m.map=o[3],Ve(()=>t=!1)),e.$set(m)},i(o){i||(y(e.$$.fragment,o),i=!0)},o(o){j(e.$$.fragment,o),i=!1},d(o){o&&g(n),F(e)}}}function jt(l){let n,e;return n=new tt({props:{$$slots:{main:[Lt],left:[bt]},$$scope:{ctx:l}}}),{c(){D(n.$$.fragment)},m(t,i){z(n,t,i),e=!0},p(t,[i]){const s={};i&2097663&&(s.$$scope={dirty:i,ctx:t}),n.$set(s)},i(t){e||(y(n.$$.fragment,t),e=!0)},o(t){j(n.$$.fragment,t),e=!1},d(t){F(n,t)}}}function ae(l){let n=0;for(let e of l.features)e.id=n++,e.properties??(e.properties={});return l}const Be=l=>l.matching_sources.length>0;function Nt(l,n,e){let t,i,s,r=Se(),o=Se(),f=null,m={buffer_meters:20,angle_diff_threshold:10,length_ratio_threshold:1.1,midpt_dist_threshold:15},c=[];De(async()=>{await ot(),e(4,r=ae(await(await fetch("/sources.geojson")).json())),e(0,o=ae(await(await fetch("/targets.geojson")).json())),k(),e(1,f=null),h()});function h(){var b;try{e(2,c=JSON.parse(lt(JSON.stringify(r),JSON.stringify(o),m)))}catch(E){window.alert(`Bug: ${E}`);return}for(let[E,w]of o.features.entries())w.properties.has_match=c[E].matching_sources.length>0,(b=w.properties).reviewed??(b.reviewed="");e(0,o)}let d;async function S(b){if(!d.files)return;if(d.files.length!=2){window.alert("Select two GeoJSON files");return}try{let w=await d.files[0].text(),W=await d.files[1].text();e(4,r=ae(JSON.parse(w))),e(0,o=ae(JSON.parse(W))),k(),e(1,f=null),h()}catch(w){window.alert(`Bad input file: ${w}`)}}function k(){let b={type:"FeatureCollection",features:[...r.features,...o.features]};s==null||s.fitBounds(it(b),{animate:!1,padding:10})}function A(){e(4,[r,o]=[o,r],r,e(0,o)),h()}function C(b){if(f==null)throw new Error("impossible");e(0,o.features[f].properties.reviewed=b,o),e(0,o),e(1,f=null)}function J(b){e(1,f=null)}const H=b=>e(1,f=b.detail.features[0].id);function O(b){s=b,e(3,s)}const v=b=>{console.log(b.detail.error)};function B(b){_e[b?"unshift":"push"](()=>{d=b,e(6,d)})}function R(b){m=b,e(5,m)}return l.$$.update=()=>{l.$$.dirty&6&&e(8,t=f==null?[]:c[f].matching_sources),l.$$.dirty&1&&e(7,i=o.features.filter(b=>b.properties.reviewed!="").length)},[o,f,c,s,r,m,d,i,t,h,S,k,A,C,J,H,O,v,B,R]}class Tt extends le{constructor(n){super(),se(this,n,Nt,jt,ie,{})}}new Tt({target:document.getElementById("app")});
