import{S as Ee,i as Te,s as Ie,P as Ae,r as C,t as k,w as ae,g as M,x as ce,y as L,Q as Fe,R as qe,T as ze,U as oe,o as Ne,V as K,W as Re,X as Ze,j as E,Y as Ke,Z as Qe,$ as Ue,a0 as Ve,a1 as Xe,z as ee,L as Ye,d as P,e as H,h as D,k as R,n as v,q as $,u as w,v as ie,M as xe,A as pe,B as Q,C as me,D as we,_ as $e,E as et,H as tt,I as U,J as nt,F as ot,K as Ce,N as Be,O as ue,a2 as se}from"./Settings-aed3d936.js";const lt=l=>({features:l[0]&16,data:l[0]&16,map:l[0]&4,close:l[0]&1}),Le=l=>{var n;return{features:l[4],data:((n=l[4])==null?void 0:n[0])??null,map:l[2],close:l[31]}};function Me(l){var s;let n,e,t=(((s=l[4])==null?void 0:s.length)||l[3]instanceof K.Marker)&&Se(l);return{c(){n=E("div"),t&&t.c()},m(o,i){C(o,n,i),t&&t.m(n,null),l[32](n),e=!0},p(o,i){var f;(f=o[4])!=null&&f.length||o[3]instanceof K.Marker?t?(t.p(o,i),i[0]&24&&k(t,1)):(t=Se(o),t.c(),k(t,1),t.m(n,null)):t&&(ae(),M(t,1,1,()=>{t=null}),ce())},i(o){e||(k(t),e=!0)},o(o){M(t),e=!1},d(o){o&&L(n),t&&t.d(),l[32](null)}}}function Se(l){let n;const e=l[30].default,t=Ke(e,l,l[29],Le);return{c(){t&&t.c()},m(s,o){t&&t.m(s,o),n=!0},p(s,o){t&&t.p&&(!n||o[0]&536870933)&&Qe(t,e,s,s[29],n?Ve(e,s[29],o,lt):Ue(s[29]),Le)},i(s){n||(k(t,s),n=!0)},o(s){M(t,s),n=!1},d(s){t&&t.d(s)}}}function st(l){let n,e,t=l[9].default&&Me(l);return{c(){t&&t.c(),n=Ae()},m(s,o){t&&t.m(s,o),C(s,n,o),e=!0},p(s,o){s[9].default?t?(t.p(s,o),o[0]&512&&k(t,1)):(t=Me(s),t.c(),k(t,1),t.m(n.parentNode,n)):t&&(ae(),M(t,1,1,()=>{t=null}),ce())},i(s){e||(k(t),e=!0)},o(s){M(t),e=!1},d(s){s&&L(n),t&&t.d(s)}}}function ft(l,n,e){let t,s,o,i,f,u,{$$slots:d={},$$scope:j}=n;const c=Fe(d);let{closeButton:_=void 0}=n,{closeOnClickOutside:h=!0}=n,{closeOnClickInside:I=!1}=n,{closeOnMove:G=!1}=n,{openOn:O="click"}=n,{openIfTopMost:N=!0}=n,{focusAfterOpen:B=!0}=n,{anchor:W=void 0}=n,{offset:p=void 0}=n,{popupClass:S=void 0}=n,{maxWidth:T=void 0}=n,{lngLat:b=void 0}=n,{html:A=void 0}=n,{open:g=!1}=n;const V=qe(),{map:X,popupTarget:m,layerEvent:y,layer:Y,eventTopMost:Pe,markerClickManager:_e}=ze();oe(l,X,r=>e(2,o=r)),oe(l,m,r=>e(3,f=r)),oe(l,y,r=>e(28,i=r)),oe(l,Y,r=>e(35,u=r));const He=["click","dblclick","contextmenu"];let a,te=!1,F;function De(){if(!a)return;let r=a.getElement();!r||r===F||(F=r,O==="hover"&&(F.style.pointerEvents="none"),F.addEventListener("mouseenter",()=>{e(24,te=!0)},{passive:!0}),F.addEventListener("mouseleave",()=>{e(24,te=!1)},{passive:!0}),F.addEventListener("click",()=>{I&&e(0,g=!1)},{passive:!0}))}Ne(()=>{if(o)return o.on("click",ne),o.on("contextmenu",ne),_e.add(ye),typeof f=="string"&&(o.on("click",f,z),o.on("dblclick",f,z),o.on("contextmenu",f,z),o.on("mousemove",f,be),o.on("mouseleave",f,Oe),o.on("touchstart",f,he),o.on("touchend",f,ke)),()=>{o!=null&&o.loaded()&&(a==null||a.remove(),o.off("click",ne),o.off("contextmenu",ne),_e.remove(ye),f instanceof K.Marker?f.getPopup()===a&&f.setPopup(void 0):typeof f=="string"&&(o.off("click",f,z),o.off("dblclick",f,z),o.off("contextmenu",f,z),o.off("mousemove",f,be),o.off("mouseleave",f,Oe),o.off("touchstart",f,he),o.off("touchend",f,ke)))}});function ge(r){return N?!("marker"in r)&&!Xe(r)&&Pe(r)!==u:!1}let q=null,J="normal";function de(r){"layerType"in r&&r.layerType==="deckgl"?(e(10,b=r.coordinate),e(4,q=r.object?[r.object]:null)):(e(10,b=r.lngLat),e(4,q=r.features??[]))}function z(r){r.type!==O||ge(r)||(de(r),setTimeout(()=>e(0,g=!0)))}let Z=null;function he(r){Z=r.point}function ke(r){if(!Z||O!=="hover")return;let fe=Z.dist(r.point);Z=null,fe<3&&(e(10,b=r.lngLat),e(4,q=r.features??[]),a.isOpen()?e(25,J="justOpened"):(e(25,J="opening"),e(0,g=!0)))}function Oe(r){O!=="hover"||Z||J!=="normal"||(e(0,g=!1),e(4,q=null))}function be(r){if(!(O!=="hover"||Z||J!=="normal")){if(ge(r)){e(0,g=!1),e(4,q=null);return}e(0,g=!0),e(4,q=r.features??[]),e(10,b=r.lngLat)}}function ne(r){if(J==="justOpened"){e(25,J="normal");return}if(!h)return;let fe=[F,f instanceof K.Marker?f==null?void 0:f.getElement():null];g&&a.isOpen()&&!fe.some(re=>re==null?void 0:re.contains(r.originalEvent.target))&&(r.type==="contextmenu"&&O==="contextmenu"||r.type!=="contextmenu")&&e(0,g=!1)}function ye(r){h&&g&&a.isOpen()&&r.marker!==f&&e(0,g=!1)}Re(()=>{o&&(a!=null&&a.isOpen())&&a.remove()});let x;const Ge=()=>e(0,g=!1);function We(r){ee[r?"unshift":"push"](()=>{x=r,e(1,x)})}return l.$$set=r=>{"closeButton"in r&&e(11,_=r.closeButton),"closeOnClickOutside"in r&&e(12,h=r.closeOnClickOutside),"closeOnClickInside"in r&&e(13,I=r.closeOnClickInside),"closeOnMove"in r&&e(14,G=r.closeOnMove),"openOn"in r&&e(15,O=r.openOn),"openIfTopMost"in r&&e(16,N=r.openIfTopMost),"focusAfterOpen"in r&&e(17,B=r.focusAfterOpen),"anchor"in r&&e(18,W=r.anchor),"offset"in r&&e(19,p=r.offset),"popupClass"in r&&e(20,S=r.popupClass),"maxWidth"in r&&e(21,T=r.maxWidth),"lngLat"in r&&e(10,b=r.lngLat),"html"in r&&e(22,A=r.html),"open"in r&&e(0,g=r.open),"$$scope"in r&&e(29,j=r.$$scope)},l.$$.update=()=>{if(l.$$.dirty[0]&14336&&e(27,t=_??(!h&&!I)),l.$$.dirty[0]&146685952&&(a||(e(23,a=new K.Popup({closeButton:t,closeOnClick:!1,closeOnMove:G,focusAfterOpen:B,maxWidth:T,className:S,anchor:W,offset:p})),F=a.getElement(),a.on("open",()=>{e(0,g=!0),De(),V("open",a)}),a.on("close",()=>{e(0,g=!1),V("close",a)}),a.on("hover",()=>{V("hover",a)}))),l.$$.dirty[0]&8421384&&a&&f instanceof K.Marker&&(O==="click"?f.setPopup(a):f.getPopup()===a&&f.setPopup(void 0)),l.$$.dirty[0]&268468224&&He.includes(O)&&(i==null?void 0:i.type)===O&&(z(i),Ze(y,i=null,i)),l.$$.dirty[0]&268468224&&e(26,s=O==="hover"&&((i==null?void 0:i.type)==="mousemove"||(i==null?void 0:i.type)==="mouseenter")),l.$$.dirty[0]&352354304&&O==="hover"&&y&&(s&&i&&de(i),e(0,g=(s||te)??!1)),l.$$.dirty[0]&12582914&&(x?a.setDOMContent(x):A&&a.setHTML(A)),l.$$.dirty[0]&8389632&&b&&a.setLngLat(b),l.$$.dirty[0]&41943045&&o){let r=a.isOpen();g&&!r?(a.addTo(o),J==="opening"&&e(25,J="justOpened")):!g&&r&&a.remove()}},[g,x,o,f,q,X,m,y,Y,c,b,_,h,I,G,O,N,B,W,p,S,T,A,a,te,J,s,t,i,j,d,Ge,We]}class Je extends Ee{constructor(n){super(),Te(this,n,ft,st,Ie,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function je(l){let n,e,t,s,o,i,f,u,d=l[3].features.length+"",j,c,_,h=l[4].features.length+"",I,G,O,N=l[1].filter(ve).length+"",B,W,p,S,T,b,A,g;function V(m){l[16](m)}let X={onChange:l[8],open:!1};return l[5]!==void 0&&(X.options=l[5]),S=new tt({props:X}),ee.push(()=>pe(S,"options",V)),{c(){n=E("div"),e=E("button"),e.textContent="Swap",t=R(),s=E("button"),s.textContent="Zoom to fit",o=R(),i=E("hr"),f=R(),u=E("p"),j=v(d),c=v(` sources and
        `),_=E("span"),I=v(h),G=v(" targets"),O=v(`
        , with `),B=v(N),W=v(` matching
        a source`),p=R(),P(S.$$.fragment),$(e,"class","secondary"),$(s,"class","secondary"),Q(n,"display","flex"),Q(n,"justify-content","space-between"),Q(_,"color","red")},m(m,y){C(m,n,y),w(n,e),w(n,t),w(n,s),C(m,o,y),C(m,i,y),C(m,f,y),C(m,u,y),w(u,j),w(u,c),w(u,_),w(_,I),w(_,G),w(u,O),w(u,B),w(u,W),C(m,p,y),H(S,m,y),b=!0,A||(g=[ie(e,"click",l[11]),ie(s,"click",l[10])],A=!0)},p(m,y){(!b||y&8)&&d!==(d=m[3].features.length+"")&&U(j,d),(!b||y&16)&&h!==(h=m[4].features.length+"")&&U(I,h),(!b||y&2)&&N!==(N=m[1].filter(ve).length+"")&&U(B,N);const Y={};!T&&y&32&&(T=!0,Y.options=m[5],me(()=>T=!1)),S.$set(Y)},i(m){b||(k(S.$$.fragment,m),b=!0)},o(m){M(S.$$.fragment,m),b=!1},d(m){m&&(L(n),L(o),L(i),L(f),L(u),L(p)),D(S,m),A=!1,nt(g)}}}function rt(l){let n,e,t,s,o,i,f,u,d,j,c=l[3].features.length>0&&je(l);return{c(){n=E("div"),e=E("h1"),e.textContent="Match LineStrings - review results to make test cases",t=R(),s=E("label"),o=v(`Load two .geojson files
      `),i=E("input"),f=R(),c&&c.c(),$(i,"type","file"),i.multiple=!0,$(n,"slot","left")},m(_,h){C(_,n,h),w(n,e),w(n,t),w(n,s),w(s,o),w(s,i),l[15](i),w(n,f),c&&c.m(n,null),u=!0,d||(j=ie(i,"change",l[9]),d=!0)},p(_,h){_[3].features.length>0?c?(c.p(_,h),h&8&&k(c,1)):(c=je(_),c.c(),k(c,1),c.m(n,null)):c&&(ae(),M(c,1,1,()=>{c=null}),ce())},i(_){u||(k(c),u=!0)},o(_){M(c),u=!1},d(_){_&&L(n),l[15](null),c&&c.d(),d=!1,j()}}}function it(l){let n,e=se(l[17]).id+"",t;return{c(){n=v("Source "),t=v(e)},m(s,o){C(s,n,o),C(s,t,o)},p(s,o){o&131072&&e!==(e=se(s[17]).id+"")&&U(t,e)},d(s){s&&(L(n),L(t))}}}function ut(l){let n,e;return n=new Je({props:{openOn:"hover",$$slots:{default:[it,({data:t})=>({17:t}),({data:t})=>t?131072:0]},$$scope:{ctx:l}}}),{c(){P(n.$$.fragment)},m(t,s){H(n,t,s),e=!0},p(t,s){const o={};s&393216&&(o.$$scope={dirty:s,ctx:t}),n.$set(o)},i(t){e||(k(n.$$.fragment,t),e=!0)},o(t){M(n.$$.fragment,t),e=!1},d(t){D(n,t)}}}function at(l){let n,e;return n=new Be({props:{manageHoverState:!0,paint:{"line-width":["case",["in",["id"],["literal",l[7]]],8,5],"line-color":"black","line-opacity":ue(.5,1)},$$slots:{default:[ut]},$$scope:{ctx:l}}}),{c(){P(n.$$.fragment)},m(t,s){H(n,t,s),e=!0},p(t,s){const o={};s&128&&(o.paint={"line-width":["case",["in",["id"],["literal",t[7]]],8,5],"line-color":"black","line-opacity":ue(.5,1)}),s&262144&&(o.$$scope={dirty:s,ctx:t}),n.$set(o)},i(t){e||(k(n.$$.fragment,t),e=!0)},o(t){M(n.$$.fragment,t),e=!1},d(t){D(n,t)}}}function ct(l){let n,e=se(l[17]).id+"",t,s,o=JSON.stringify(l[7])+"",i;return{c(){n=v("Target "),t=v(e),s=v(" matches "),i=v(o)},m(f,u){C(f,n,u),C(f,t,u),C(f,s,u),C(f,i,u)},p(f,u){u&131072&&e!==(e=se(f[17]).id+"")&&U(t,e),u&128&&o!==(o=JSON.stringify(f[7])+"")&&U(i,o)},d(f){f&&(L(n),L(t),L(s),L(i))}}}function pt(l){let n,e;return n=new Je({props:{openOn:"hover",$$slots:{default:[ct,({data:t})=>({17:t}),({data:t})=>t?131072:0]},$$scope:{ctx:l}}}),{c(){P(n.$$.fragment)},m(t,s){H(n,t,s),e=!0},p(t,s){const o={};s&393344&&(o.$$scope={dirty:s,ctx:t}),n.$set(o)},i(t){e||(k(n.$$.fragment,t),e=!0)},o(t){M(n.$$.fragment,t),e=!1},d(t){D(n,t)}}}function mt(l){let n,e,t;function s(i){l[12](i)}let o={manageHoverState:!0,paint:{"line-width":8,"line-color":"red","line-opacity":ue(["case",["get","has_match"],.5,.2],1)},$$slots:{default:[pt]},$$scope:{ctx:l}};return l[0]!==void 0&&(o.hovered=l[0]),n=new Be({props:o}),ee.push(()=>pe(n,"hovered",s)),{c(){P(n.$$.fragment)},m(i,f){H(n,i,f),t=!0},p(i,f){const u={};f&262272&&(u.$$scope={dirty:f,ctx:i}),!e&&f&1&&(e=!0,u.hovered=i[0],me(()=>e=!1)),n.$set(u)},i(i){t||(k(n.$$.fragment,i),t=!0)},o(i){M(n.$$.fragment,i),t=!1},d(i){D(n,i)}}}function _t(l){let n,e,t,s;return n=new Ce({props:{data:l[3],$$slots:{default:[at]},$$scope:{ctx:l}}}),t=new Ce({props:{data:l[4],$$slots:{default:[mt]},$$scope:{ctx:l}}}),{c(){P(n.$$.fragment),e=R(),P(t.$$.fragment)},m(o,i){H(n,o,i),C(o,e,i),H(t,o,i),s=!0},p(o,i){const f={};i&8&&(f.data=o[3]),i&262272&&(f.$$scope={dirty:i,ctx:o}),n.$set(f);const u={};i&16&&(u.data=o[4]),i&262273&&(u.$$scope={dirty:i,ctx:o}),t.$set(u)},i(o){s||(k(n.$$.fragment,o),k(t.$$.fragment,o),s=!0)},o(o){M(n.$$.fragment,o),M(t.$$.fragment,o),s=!1},d(o){o&&L(e),D(n,o),D(t,o)}}}function gt(l){let n,e,t,s;function o(f){l[13](f)}let i={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[_t]},$$scope:{ctx:l}};return l[2]!==void 0&&(i.map=l[2]),e=new xe({props:i}),ee.push(()=>pe(e,"map",o)),e.$on("error",l[14]),{c(){n=E("div"),P(e.$$.fragment),$(n,"slot","main"),Q(n,"position","relative"),Q(n,"width","100%"),Q(n,"height","100vh")},m(f,u){C(f,n,u),H(e,n,null),s=!0},p(f,u){const d={};u&262297&&(d.$$scope={dirty:u,ctx:f}),!t&&u&4&&(t=!0,d.map=f[2],me(()=>t=!1)),e.$set(d)},i(f){s||(k(e.$$.fragment,f),s=!0)},o(f){M(e.$$.fragment,f),s=!1},d(f){f&&L(n),D(e)}}}function dt(l){let n,e;return n=new Ye({props:{$$slots:{main:[gt],left:[rt]},$$scope:{ctx:l}}}),{c(){P(n.$$.fragment)},m(t,s){H(n,t,s),e=!0},p(t,[s]){const o={};s&262399&&(o.$$scope={dirty:s,ctx:t}),n.$set(o)},i(t){e||(k(n.$$.fragment,t),e=!0)},o(t){M(n.$$.fragment,t),e=!1},d(t){D(n,t)}}}function le(l){let n=0;for(let e of l.features)e.id=n++,e.properties??(e.properties={});return l}const ve=l=>l.matching_sources.length>0;function ht(l,n,e){let t,s,o=we(),i=we(),f=null,u={buffer_meters:20,angle_diff_threshold:10,length_ratio_threshold:1.1,midpt_dist_threshold:15},d=[];Ne(async()=>{await $e(),e(3,o=le(await(await fetch("/sources.geojson")).json())),e(4,i=le(await(await fetch("/targets.geojson")).json())),h(),e(0,f=null),j()});function j(){try{e(1,d=JSON.parse(et(JSON.stringify(o),JSON.stringify(i),u)))}catch(p){window.alert(`Bug: ${p}`);return}for(let[p,S]of i.features.entries())S.properties.has_match=d[p].matching_sources.length>0;e(4,i)}let c;async function _(p){if(!c.files)return;if(c.files.length!=2){window.alert("Select two GeoJSON files");return}try{let T=await c.files[0].text(),b=await c.files[1].text();e(3,o=le(JSON.parse(T))),e(4,i=le(JSON.parse(b))),h(),e(0,f=null),j()}catch(T){window.alert(`Bad input file: ${T}`)}}function h(){let p={type:"FeatureCollection",features:[...o.features,...i.features]};s==null||s.fitBounds(ot(p),{animate:!1,padding:10})}function I(){e(3,[o,i]=[i,o],o,e(4,i)),j()}function G(p){f=p,e(0,f)}function O(p){s=p,e(2,s)}const N=p=>{console.log(p.detail.error)};function B(p){ee[p?"unshift":"push"](()=>{c=p,e(6,c)})}function W(p){u=p,e(5,u)}return l.$$.update=()=>{l.$$.dirty&3&&e(7,t=f==null?[]:d[f.id].matching_sources)},[f,d,s,o,i,u,c,t,j,_,h,I,G,O,N,B,W]}class kt extends Ee{constructor(n){super(),Te(this,n,ht,dt,Ie,{})}}new kt({target:document.getElementById("app")});
