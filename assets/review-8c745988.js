import{S as se,i as ie,s as re,P as Be,Q as Fe,R as ne,T as Pe,U as ze,r as y,t as M,w as x,g as G,x as $,y as v,V as Qe,o as Ae,W as Y,X as Xe,j as C,Y as Ye,Z as xe,$ as $e,a0 as et,a1 as tt,z as Z,n as E,k as I,q as z,B as R,u as b,a2 as Ce,v as J,I as V,a3 as Q,J as pe,a4 as Re,H as nt,A as oe,d as B,e as F,C as le,h as P,E as ot,L as lt,M as st,D as ae,_ as it,G as rt,F as Me,K as Se,N as We,O as Ge,a5 as Le}from"./Settings-51e448bf.js";function ut(l,n,e){let t;const s=Be();let{layer:o=void 0}=n;const{map:f}=Fe();ne(l,f,u=>e(2,t=u));function i(u){s(u.type,{...u,map:f})}const c=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],r=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Pe(()=>{if(t)if(o)for(const u of c)t.off(u,o,i);else for(const u of r)t.off(u,i)}),l.$$set=u=>{"layer"in u&&e(1,o=u.layer)},l.$$.update=()=>{if(l.$$.dirty&6&&t)if(o)for(const u of c)t.on(u,o,i);else for(const u of r)t.on(u,i)},[f,o,t]}class ft extends se{constructor(n){super(),ie(this,n,ut,null,re,{layer:1})}}const ct=l=>({features:l[0]&16,data:l[0]&16,map:l[0]&4,close:l[0]&1}),Te=l=>{var n;return{features:l[4],data:((n=l[4])==null?void 0:n[0])??null,map:l[2],close:l[31]}};function Ne(l){var s;let n,e,t=(((s=l[4])==null?void 0:s.length)||l[3]instanceof Y.Marker)&&De(l);return{c(){n=C("div"),t&&t.c()},m(o,f){y(o,n,f),t&&t.m(n,null),l[32](n),e=!0},p(o,f){var i;(i=o[4])!=null&&i.length||o[3]instanceof Y.Marker?t?(t.p(o,f),f[0]&24&&M(t,1)):(t=De(o),t.c(),M(t,1),t.m(n,null)):t&&(x(),G(t,1,1,()=>{t=null}),$())},i(o){e||(M(t),e=!0)},o(o){G(t),e=!1},d(o){o&&v(n),t&&t.d(),l[32](null)}}}function De(l){let n;const e=l[30].default,t=Ye(e,l,l[29],Te);return{c(){t&&t.c()},m(s,o){t&&t.m(s,o),n=!0},p(s,o){t&&t.p&&(!n||o[0]&536870933)&&xe(t,e,s,s[29],n?et(e,s[29],o,ct):$e(s[29]),Te)},i(s){n||(M(t,s),n=!0)},o(s){G(t,s),n=!1},d(s){t&&t.d(s)}}}function at(l){let n,e,t=l[9].default&&Ne(l);return{c(){t&&t.c(),n=ze()},m(s,o){t&&t.m(s,o),y(s,n,o),e=!0},p(s,o){s[9].default?t?(t.p(s,o),o[0]&512&&M(t,1)):(t=Ne(s),t.c(),M(t,1),t.m(n.parentNode,n)):t&&(x(),G(t,1,1,()=>{t=null}),$())},i(s){e||(M(t),e=!0)},o(s){G(t),e=!1},d(s){s&&v(n),t&&t.d(s)}}}function mt(l,n,e){let t,s,o,f,i,c,{$$slots:r={},$$scope:u}=n;const d=Qe(r);let{closeButton:g=void 0}=n,{closeOnClickOutside:L=!0}=n,{closeOnClickInside:S=!1}=n,{closeOnMove:m=!1}=n,{openOn:_="click"}=n,{openIfTopMost:T=!0}=n,{focusAfterOpen:j=!0}=n,{anchor:N=void 0}=n,{offset:D=void 0}=n,{popupClass:h=void 0}=n,{maxWidth:O=void 0}=n,{lngLat:k=void 0}=n,{html:U=void 0}=n,{open:p=!1}=n;const H=Be(),{map:ee,popupTarget:_e,layerEvent:ue,layer:ge,eventTopMost:Ue,markerClickManager:he}=Fe();ne(l,ee,a=>e(2,o=a)),ne(l,_e,a=>e(3,i=a)),ne(l,ue,a=>e(28,f=a)),ne(l,ge,a=>e(35,c=a));const qe=["click","dblclick","contextmenu"];let w,fe=!1,W;function Ke(){if(!w)return;let a=w.getElement();!a||a===W||(W=a,_==="hover"&&(W.style.pointerEvents="none"),W.addEventListener("mouseenter",()=>{e(24,fe=!0)},{passive:!0}),W.addEventListener("mouseleave",()=>{e(24,fe=!1)},{passive:!0}),W.addEventListener("click",()=>{S&&e(0,p=!1)},{passive:!0}))}Ae(()=>{if(o)return o.on("click",ce),o.on("contextmenu",ce),he.add(je),typeof i=="string"&&(o.on("click",i,K),o.on("dblclick",i,K),o.on("contextmenu",i,K),o.on("mousemove",i,Oe),o.on("mouseleave",i,ve),o.on("touchstart",i,we),o.on("touchend",i,ye)),()=>{o!=null&&o.loaded()&&(w==null||w.remove(),o.off("click",ce),o.off("contextmenu",ce),he.remove(je),i instanceof Y.Marker?i.getPopup()===w&&i.setPopup(void 0):typeof i=="string"&&(o.off("click",i,K),o.off("dblclick",i,K),o.off("contextmenu",i,K),o.off("mousemove",i,Oe),o.off("mouseleave",i,ve),o.off("touchstart",i,we),o.off("touchend",i,ye)))}});function ke(a){return T?!("marker"in a)&&!tt(a)&&Ue(a)!==c:!1}let q=null,A="normal";function be(a){"layerType"in a&&a.layerType==="deckgl"?(e(10,k=a.coordinate),e(4,q=a.object?[a.object]:null)):(e(10,k=a.lngLat),e(4,q=a.features??[]))}function K(a){a.type!==_||ke(a)||(be(a),setTimeout(()=>e(0,p=!0)))}let X=null;function we(a){X=a.point}function ye(a){if(!X||_!=="hover")return;let me=X.dist(a.point);X=null,me<3&&(e(10,k=a.lngLat),e(4,q=a.features??[]),w.isOpen()?e(25,A="justOpened"):(e(25,A="opening"),e(0,p=!0)))}function ve(a){_!=="hover"||X||A!=="normal"||(e(0,p=!1),e(4,q=null))}function Oe(a){if(!(_!=="hover"||X||A!=="normal")){if(ke(a)){e(0,p=!1),e(4,q=null);return}e(0,p=!0),e(4,q=a.features??[]),e(10,k=a.lngLat)}}function ce(a){if(A==="justOpened"){e(25,A="normal");return}if(!L)return;let me=[W,i instanceof Y.Marker?i==null?void 0:i.getElement():null];p&&w.isOpen()&&!me.some(de=>de==null?void 0:de.contains(a.originalEvent.target))&&(a.type==="contextmenu"&&_==="contextmenu"||a.type!=="contextmenu")&&e(0,p=!1)}function je(a){L&&p&&w.isOpen()&&a.marker!==i&&e(0,p=!1)}Pe(()=>{o&&(w!=null&&w.isOpen())&&w.remove()});let te;const Ze=()=>e(0,p=!1);function Ve(a){Z[a?"unshift":"push"](()=>{te=a,e(1,te)})}return l.$$set=a=>{"closeButton"in a&&e(11,g=a.closeButton),"closeOnClickOutside"in a&&e(12,L=a.closeOnClickOutside),"closeOnClickInside"in a&&e(13,S=a.closeOnClickInside),"closeOnMove"in a&&e(14,m=a.closeOnMove),"openOn"in a&&e(15,_=a.openOn),"openIfTopMost"in a&&e(16,T=a.openIfTopMost),"focusAfterOpen"in a&&e(17,j=a.focusAfterOpen),"anchor"in a&&e(18,N=a.anchor),"offset"in a&&e(19,D=a.offset),"popupClass"in a&&e(20,h=a.popupClass),"maxWidth"in a&&e(21,O=a.maxWidth),"lngLat"in a&&e(10,k=a.lngLat),"html"in a&&e(22,U=a.html),"open"in a&&e(0,p=a.open),"$$scope"in a&&e(29,u=a.$$scope)},l.$$.update=()=>{if(l.$$.dirty[0]&14336&&e(27,t=g??(!L&&!S)),l.$$.dirty[0]&146685952&&(w||(e(23,w=new Y.Popup({closeButton:t,closeOnClick:!1,closeOnMove:m,focusAfterOpen:j,maxWidth:O,className:h,anchor:N,offset:D})),W=w.getElement(),w.on("open",()=>{e(0,p=!0),Ke(),H("open",w)}),w.on("close",()=>{e(0,p=!1),H("close",w)}),w.on("hover",()=>{H("hover",w)}))),l.$$.dirty[0]&8421384&&w&&i instanceof Y.Marker&&(_==="click"?i.setPopup(w):i.getPopup()===w&&i.setPopup(void 0)),l.$$.dirty[0]&268468224&&qe.includes(_)&&(f==null?void 0:f.type)===_&&(K(f),Xe(ue,f=null,f)),l.$$.dirty[0]&268468224&&e(26,s=_==="hover"&&((f==null?void 0:f.type)==="mousemove"||(f==null?void 0:f.type)==="mouseenter")),l.$$.dirty[0]&352354304&&_==="hover"&&ue&&(s&&f&&be(f),e(0,p=(s||fe)??!1)),l.$$.dirty[0]&12582914&&(te?w.setDOMContent(te):U&&w.setHTML(U)),l.$$.dirty[0]&8389632&&k&&w.setLngLat(k),l.$$.dirty[0]&41943045&&o){let a=w.isOpen();p&&!a?(w.addTo(o),A==="opening"&&e(25,A="justOpened")):!p&&a&&w.remove()}},[p,te,o,i,q,ee,_e,ue,ge,d,k,g,L,S,m,_,T,j,N,D,h,O,U,w,fe,A,s,t,f,u,r,Ze,Ve]}class dt extends se{constructor(n){super(),ie(this,n,mt,at,re,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}const{window:pt}=Re;function _t(l){let n,e,t,s,o,f,i,c,r,u,d,g,L,S,m,_,T,j,N,D;return{c(){n=C("h3"),e=E("Target "),t=E(l[0]),s=E(": "),o=E(l[3]),f=I(),i=C("div"),c=C("button"),c.innerHTML=`<kbd>1</kbd>
    - Unreviewed`,r=I(),u=C("button"),u.innerHTML=`<kbd>2</kbd>
    - Not sure`,d=I(),g=C("button"),g.innerHTML=`<kbd>3</kbd>
    - No matches`,L=I(),S=C("div"),m=C("div"),_=C("button"),_.innerHTML=`<kbd>4</kbd>
        - These sources`,T=I(),j=C("input"),z(j,"type","text"),R(j,"width","50%"),R(i,"display","flex"),R(i,"justify-content","space-between")},m(h,O){y(h,n,O),b(n,e),b(n,t),b(n,s),b(n,o),y(h,f,O),y(h,i,O),b(i,c),b(i,r),b(i,u),b(i,d),b(i,g),b(i,L),b(i,S),b(S,m),b(m,_),b(S,T),b(S,j),Ce(j,l[2]),N||(D=[J(pt,"keydown",l[5]),J(c,"click",l[8]),J(u,"click",l[9]),J(g,"click",l[10]),J(_,"click",l[4]),J(j,"input",l[11])],N=!0)},p(h,[O]){O&1&&V(t,h[0]),O&4&&j.value!==h[2]&&Ce(j,h[2])},i:Q,o:Q,d(h){h&&(v(n),v(f),v(i)),N=!1,pe(D)}}}function gt(l,n,e){let{clickedTarget:t}=n,{targetGj:s}=n,{matchingSourceIndices:o}=n,{onConfirm:f}=n,i=s.features[t].properties.reviewed,c=Array.isArray(i)?JSON.stringify(i):JSON.stringify(o);function r(){try{let m=JSON.parse(c);if(!Array.isArray(m))throw new Error("Not an array");f(m)}catch{window.alert("Not a list of source IDs")}}function u(m){m.target.tagName!="INPUT"&&(m.key=="1"?f("unreviewed"):m.key=="2"?f("not sure"):m.key=="3"?f([]):m.key=="4"&&r())}const d=()=>f("unreviewed"),g=()=>f("not sure"),L=()=>f([]);function S(){c=this.value,e(2,c)}return l.$$set=m=>{"clickedTarget"in m&&e(0,t=m.clickedTarget),"targetGj"in m&&e(6,s=m.targetGj),"matchingSourceIndices"in m&&e(7,o=m.matchingSourceIndices),"onConfirm"in m&&e(1,f=m.onConfirm)},[t,f,c,i,r,u,s,o,d,g,L,S]}class ht extends se{constructor(n){super(),ie(this,n,gt,_t,re,{clickedTarget:0,targetGj:6,matchingSourceIndices:7,onConfirm:1})}}function Ee(l){let n,e,t,s=l[0].features.length+"",o,f,i,c=l[1].features.length+"",r,u,d,g=l[1].features.filter(He).length+"",L,S,m,_,T,j,N,D,h,O;function k(p){l[10](p)}let U={onChange:l[5]};return l[3]!==void 0&&(U.options=l[3]),_=new nt({props:U}),Z.push(()=>oe(_,"options",k)),{c(){n=C("button"),n.textContent="Swap",e=I(),t=C("p"),o=E(s),f=E(` sources and
    `),i=C("span"),r=E(c),u=E(" targets"),d=E(`
    , with `),L=E(g),S=E(" matching a source"),m=I(),B(_.$$.fragment),j=I(),N=C("button"),N.textContent="Start review",z(n,"class","secondary"),R(i,"color","red")},m(p,H){y(p,n,H),y(p,e,H),y(p,t,H),b(t,o),b(t,f),b(t,i),b(i,r),b(i,u),b(t,d),b(t,L),b(t,S),y(p,m,H),F(_,p,H),y(p,j,H),y(p,N,H),D=!0,h||(O=[J(n,"click",l[7]),J(N,"click",l[11])],h=!0)},p(p,H){(!D||H&1)&&s!==(s=p[0].features.length+"")&&V(o,s),(!D||H&2)&&c!==(c=p[1].features.length+"")&&V(r,c),(!D||H&2)&&g!==(g=p[1].features.filter(He).length+"")&&V(L,g);const ee={};!T&&H&8&&(T=!0,ee.options=p[3],le(()=>T=!1)),_.$set(ee)},i(p){D||(M(_.$$.fragment,p),D=!0)},o(p){G(_.$$.fragment,p),D=!1},d(p){p&&(v(n),v(e),v(t),v(m),v(j),v(N)),P(_,p),h=!1,pe(O)}}}function kt(l){let n,e,t,s,o,f,i,c,r=l[0].features.length>0&&Ee(l);return{c(){n=C("label"),e=E(`Load two .geojson files
  `),t=C("input"),s=I(),r&&r.c(),o=ze(),z(t,"type","file"),t.multiple=!0},m(u,d){y(u,n,d),b(n,e),b(n,t),l[9](t),y(u,s,d),r&&r.m(u,d),y(u,o,d),f=!0,i||(c=J(t,"change",l[6]),i=!0)},p(u,[d]){u[0].features.length>0?r?(r.p(u,d),d&1&&M(r,1)):(r=Ee(u),r.c(),M(r,1),r.m(o.parentNode,o)):r&&(x(),G(r,1,1,()=>{r=null}),$())},i(u){f||(M(r),f=!0)},o(u){G(r),f=!1},d(u){u&&(v(n),v(s),v(o)),l[9](null),r&&r.d(u),i=!1,c()}}}function Ie(l){let n=0;for(let e of l.features)e.id=n++,e.properties??(e.properties={});return l}const He=l=>l.properties.matching_sources.length>0;function bt(l,n,e){let{sourceGj:t}=n,{targetGj:s}=n,{setupDone:o}=n,{zoomFit:f}=n,i={buffer_meters:20,angle_diff_threshold:10,length_ratio_threshold:1.1,midpt_dist_threshold:15};function c(){var m;try{let _=JSON.parse(ot(JSON.stringify(t),JSON.stringify(s),i));for(let[T,j]of s.features.entries())j.properties.matching_sources=_[T].matching_sources,(m=j.properties).reviewed??(m.reviewed="unreviewed");e(1,s)}catch(_){window.alert(`Bug: ${_}`)}}let r;async function u(m){if(!r.files)return;if(r.files.length!=2){window.alert("Select two GeoJSON files");return}try{let T=await r.files[0].text(),j=await r.files[1].text();e(0,t=Ie(JSON.parse(T))),e(1,s=Ie(JSON.parse(j))),f(),c()}catch(T){window.alert(`Bad input file: ${T}`)}}function d(){e(0,[t,s]=[s,t],t,e(1,s)),c()}function g(m){Z[m?"unshift":"push"](()=>{r=m,e(4,r)})}function L(m){i=m,e(3,i)}const S=()=>e(2,o=!0);return l.$$set=m=>{"sourceGj"in m&&e(0,t=m.sourceGj),"targetGj"in m&&e(1,s=m.targetGj),"setupDone"in m&&e(2,o=m.setupDone),"zoomFit"in m&&e(8,f=m.zoomFit)},[t,s,o,i,r,c,u,d,f,g,L,S]}class wt extends se{constructor(n){super(),ie(this,n,bt,kt,re,{sourceGj:0,targetGj:1,setupDone:2,zoomFit:8})}}const{window:yt}=Re;function vt(l){let n,e,t,s,o,f,i,c,r,u,d,g,L,S=l[0].features.length+"",m,_,T,j,N,D;return{c(){n=C("div"),e=C("button"),e.textContent="Start over",t=I(),s=C("button"),s.textContent="Zoom to fit",o=I(),f=C("br"),i=I(),c=C("progress"),u=I(),d=C("p"),g=E(l[5]),L=E(" / "),m=E(S),_=E(" targets reviewed"),T=I(),j=C("button"),j.textContent="Download reviews",z(e,"class","secondary"),z(s,"class","secondary"),R(n,"display","flex"),R(n,"justify-content","space-between"),c.value=l[5],z(c,"max",r=l[0].features.length)},m(h,O){y(h,n,O),b(n,e),b(n,t),b(n,s),y(h,o,O),y(h,f,O),y(h,i,O),y(h,c,O),y(h,u,O),y(h,d,O),b(d,g),b(d,L),b(d,m),b(d,_),y(h,T,O),y(h,j,O),N||(D=[J(e,"click",l[13]),J(s,"click",l[7]),J(j,"click",l[12])],N=!0)},p(h,O){O&32&&(c.value=h[5]),O&1&&r!==(r=h[0].features.length)&&z(c,"max",r),O&32&&V(g,h[5]),O&1&&S!==(S=h[0].features.length+"")&&V(m,S)},i:Q,o:Q,d(h){h&&(v(n),v(o),v(f),v(i),v(c),v(u),v(d),v(T),v(j)),N=!1,pe(D)}}}function Ot(l){let n,e,t,s,o;function f(u){l[17](u)}function i(u){l[18](u)}function c(u){l[19](u)}let r={zoomFit:l[7]};return l[3]!==void 0&&(r.sourceGj=l[3]),l[0]!==void 0&&(r.targetGj=l[0]),l[4]!==void 0&&(r.setupDone=l[4]),n=new wt({props:r}),Z.push(()=>oe(n,"sourceGj",f)),Z.push(()=>oe(n,"targetGj",i)),Z.push(()=>oe(n,"setupDone",c)),{c(){B(n.$$.fragment)},m(u,d){F(n,u,d),o=!0},p(u,d){const g={};!e&&d&8&&(e=!0,g.sourceGj=u[3],le(()=>e=!1)),!t&&d&1&&(t=!0,g.targetGj=u[0],le(()=>t=!1)),!s&&d&16&&(s=!0,g.setupDone=u[4],le(()=>s=!1)),n.$set(g)},i(u){o||(M(n.$$.fragment,u),o=!0)},o(u){G(n.$$.fragment,u),o=!1},d(u){P(n,u)}}}function jt(l){let n,e,t,s,o,f;const i=[Ot,vt],c=[];function r(u,d){return u[4]?1:0}return s=r(l),o=c[s]=i[s](l),{c(){n=C("div"),e=C("h1"),e.textContent="Match LineStrings - review results to make test cases",t=I(),o.c(),z(n,"slot","left")},m(u,d){y(u,n,d),b(n,e),b(n,t),c[s].m(n,null),f=!0},p(u,d){let g=s;s=r(u),s===g?c[s].p(u,d):(x(),G(c[g],1,1,()=>{c[g]=null}),$(),o=c[s],o?o.p(u,d):(o=c[s]=i[s](u),o.c()),M(o,1),o.m(n,null))},i(u){f||(M(o),f=!0)},o(u){G(o),f=!1},d(u){u&&v(n),c[s].d()}}}function Je(l){let n,e,t,s;const o=[Mt,Ct],f=[];function i(c,r){return c[1]==null?0:1}return e=i(l),t=f[e]=o[e](l),{c(){n=C("div"),t.c(),z(n,"class","map-panel svelte-1lu903l")},m(c,r){y(c,n,r),f[e].m(n,null),s=!0},p(c,r){let u=e;e=i(c),e===u?f[e].p(c,r):(x(),G(f[u],1,1,()=>{f[u]=null}),$(),t=f[e],t?t.p(c,r):(t=f[e]=o[e](c),t.c()),M(t,1),t.m(n,null))},i(c){s||(M(t),s=!0)},o(c){G(t),s=!1},d(c){c&&v(n),f[e].d()}}}function Ct(l){let n,e;return n=new ht({props:{clickedTarget:l[1],targetGj:l[0],matchingSourceIndices:l[6],onConfirm:l[8]}}),{c(){B(n.$$.fragment)},m(t,s){F(n,t,s),e=!0},p(t,s){const o={};s&2&&(o.clickedTarget=t[1]),s&1&&(o.targetGj=t[0]),s&64&&(o.matchingSourceIndices=t[6]),n.$set(o)},i(t){e||(M(n.$$.fragment,t),e=!0)},o(t){G(n.$$.fragment,t),e=!1},d(t){P(n,t)}}}function Mt(l){let n,e,t;return{c(){n=C("button"),n.innerHTML=`Goto <kbd>n</kbd>
              ext unreviewed`},m(s,o){y(s,n,o),e||(t=J(n,"click",l[10]),e=!0)},p:Q,i:Q,o:Q,d(s){s&&v(n),e=!1,t()}}}function St(l){let n,e=Le(l[20]).id+"",t;return{c(){n=E("Source "),t=E(e)},m(s,o){y(s,n,o),y(s,t,o)},p(s,o){o&1048576&&e!==(e=Le(s[20]).id+"")&&V(t,e)},d(s){s&&(v(n),v(t))}}}function Gt(l){let n,e;return n=new dt({props:{openOn:"hover",$$slots:{default:[St,({data:t})=>({20:t}),({data:t})=>t?1048576:0]},$$scope:{ctx:l}}}),{c(){B(n.$$.fragment)},m(t,s){F(n,t,s),e=!0},p(t,s){const o={};s&3145728&&(o.$$scope={dirty:s,ctx:t}),n.$set(o)},i(t){e||(M(n.$$.fragment,t),e=!0)},o(t){G(n.$$.fragment,t),e=!1},d(t){P(n,t)}}}function Lt(l){let n,e;return n=new We({props:{manageHoverState:!0,paint:{"line-width":["case",["in",["id"],["literal",l[6]]],8,5],"line-color":"black","line-opacity":Ge(.5,1)},$$slots:{default:[Gt]},$$scope:{ctx:l}}}),{c(){B(n.$$.fragment)},m(t,s){F(n,t,s),e=!0},p(t,s){const o={};s&64&&(o.paint={"line-width":["case",["in",["id"],["literal",t[6]]],8,5],"line-color":"black","line-opacity":Ge(.5,1)}),s&2097152&&(o.$$scope={dirty:s,ctx:t}),n.$set(o)},i(t){e||(M(n.$$.fragment,t),e=!0)},o(t){G(n.$$.fragment,t),e=!1},d(t){P(n,t)}}}function Tt(l){let n,e;return n=new We({props:{manageHoverState:!0,paint:{"line-width":8,"line-color":["match",["get","reviewed"],"unreviewed","red","blue"],"line-opacity":["case",["==",["id"],l[1]??-1],1,["boolean",["feature-state","hover"],!1],.6,[">",["length",["get","matching_sources"]],0],.5,.2]},hoverCursor:"pointer"}}),n.$on("click",l[14]),{c(){B(n.$$.fragment)},m(t,s){F(n,t,s),e=!0},p(t,s){const o={};s&2&&(o.paint={"line-width":8,"line-color":["match",["get","reviewed"],"unreviewed","red","blue"],"line-opacity":["case",["==",["id"],t[1]??-1],1,["boolean",["feature-state","hover"],!1],.6,[">",["length",["get","matching_sources"]],0],.5,.2]}),n.$set(o)},i(t){e||(M(n.$$.fragment,t),e=!0)},o(t){G(n.$$.fragment,t),e=!1},d(t){P(n,t)}}}function Nt(l){let n,e,t,s,o,f,i;n=new ft({}),n.$on("click",l[9]);let c=l[4]&&Je(l);return s=new Se({props:{data:l[3],$$slots:{default:[Lt]},$$scope:{ctx:l}}}),f=new Se({props:{data:l[0],$$slots:{default:[Tt]},$$scope:{ctx:l}}}),{c(){B(n.$$.fragment),e=I(),c&&c.c(),t=I(),B(s.$$.fragment),o=I(),B(f.$$.fragment)},m(r,u){F(n,r,u),y(r,e,u),c&&c.m(r,u),y(r,t,u),F(s,r,u),y(r,o,u),F(f,r,u),i=!0},p(r,u){r[4]?c?(c.p(r,u),u&16&&M(c,1)):(c=Je(r),c.c(),M(c,1),c.m(t.parentNode,t)):c&&(x(),G(c,1,1,()=>{c=null}),$());const d={};u&8&&(d.data=r[3]),u&2097216&&(d.$$scope={dirty:u,ctx:r}),s.$set(d);const g={};u&1&&(g.data=r[0]),u&2097154&&(g.$$scope={dirty:u,ctx:r}),f.$set(g)},i(r){i||(M(n.$$.fragment,r),M(c),M(s.$$.fragment,r),M(f.$$.fragment,r),i=!0)},o(r){G(n.$$.fragment,r),G(c),G(s.$$.fragment,r),G(f.$$.fragment,r),i=!1},d(r){r&&(v(e),v(t),v(o)),P(n,r),c&&c.d(r),P(s,r),P(f,r)}}}function Dt(l){let n,e,t,s;function o(i){l[15](i)}let f={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Nt]},$$scope:{ctx:l}};return l[2]!==void 0&&(f.map=l[2]),e=new st({props:f}),Z.push(()=>oe(e,"map",o)),e.$on("error",l[16]),{c(){n=C("div"),B(e.$$.fragment),z(n,"slot","main"),R(n,"position","relative"),R(n,"width","100%"),R(n,"height","100vh")},m(i,c){y(i,n,c),F(e,n,null),s=!0},p(i,c){const r={};c&2097243&&(r.$$scope={dirty:c,ctx:i}),!t&&c&4&&(t=!0,r.map=i[2],le(()=>t=!1)),e.$set(r)},i(i){s||(M(e.$$.fragment,i),s=!0)},o(i){G(e.$$.fragment,i),s=!1},d(i){i&&v(n),P(e)}}}function Et(l){let n,e,t,s;return n=new lt({props:{$$slots:{main:[Dt],left:[jt]},$$scope:{ctx:l}}}),{c(){B(n.$$.fragment)},m(o,f){F(n,o,f),e=!0,t||(s=J(yt,"keydown",l[11]),t=!0)},p(o,[f]){const i={};f&2097279&&(i.$$scope={dirty:f,ctx:o}),n.$set(i)},i(o){e||(M(n.$$.fragment,o),e=!0)},o(o){G(n.$$.fragment,o),e=!1},d(o){P(n,o),t=!1,s()}}}function It(l,n,e){let t,s,o,f=ae(),i=ae(),c=!1,r=null;Ae(async()=>{await it()});function u(){let k={type:"FeatureCollection",features:[...f.features,...i.features]};o==null||o.fitBounds(Me(k),{animate:!1,padding:10})}function d(k){if(r==null)throw new Error("impossible");e(0,i.features[r].properties.reviewed=k,i),e(0,i),e(1,r=null)}function g(k){e(1,r=null)}function L(){for(let k of i.features)if(k.properties.reviewed=="unreviewed"){o==null||o.fitBounds(Me(k),{duration:600,padding:200}),e(1,r=k.id);return}}function S(k){k.target.tagName=="INPUT"||!c||k.key=="n"&&L()}function m(){rt("reviewed_targets.geojson",JSON.stringify(i))}function _(){window.confirm("Do you want to discard this review and start over?")&&(e(3,f=ae()),e(0,i=ae()),e(4,c=!1),e(1,r=null))}function T(k){c&&e(1,r=k.detail.features[0].id)}function j(k){o=k,e(2,o)}const N=k=>{console.log(k.detail.error)};function D(k){f=k,e(3,f)}function h(k){i=k,e(0,i)}function O(k){c=k,e(4,c)}return l.$$.update=()=>{l.$$.dirty&3&&e(6,t=r==null?[]:i.features[r].properties.matching_sources),l.$$.dirty&1&&e(5,s=i.features.filter(k=>k.properties.reviewed!="unreviewed").length)},[i,r,o,f,c,s,t,u,d,g,L,S,m,_,T,j,N,D,h,O]}class Ht extends se{constructor(n){super(),ie(this,n,It,Et,re,{})}}new Ht({target:document.getElementById("app")});
