import{S as se,i as ie,s as re,P as Be,Q as Fe,R as le,T as Pe,U as ze,r as w,t as S,w as ee,g as G,x as te,y,V as Qe,o as Ae,W as Y,X as Xe,j as M,Y as Ye,Z as xe,$ as $e,a0 as et,a1 as tt,z as q,n as E,k as I,q as z,B as W,u as k,a2 as Ce,v as J,I as V,a3 as Q,J as pe,a4 as Re,H as nt,A as x,d as B,e as F,C as $,h as P,E as ot,L as lt,M as st,D as ae,_ as it,G as rt,F as Me,K as Se,N as We,O as Ge,a5 as Le}from"./Settings-51e448bf.js";function ut(o,t,e){let n;const s=Be();let{layer:l=void 0}=t;const{map:u}=Fe();le(o,u,r=>e(2,n=r));function i(r){s(r.type,{...r,map:u})}const c=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],f=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Pe(()=>{if(n)if(l)for(const r of c)n.off(r,l,i);else for(const r of f)n.off(r,i)}),o.$$set=r=>{"layer"in r&&e(1,l=r.layer)},o.$$.update=()=>{if(o.$$.dirty&6&&n)if(l)for(const r of c)n.on(r,l,i);else for(const r of f)n.on(r,i)},[u,l,n]}class ft extends se{constructor(t){super(),ie(this,t,ut,null,re,{layer:1})}}const ct=o=>({features:o[0]&16,data:o[0]&16,map:o[0]&4,close:o[0]&1}),Ne=o=>{var t;return{features:o[4],data:((t=o[4])==null?void 0:t[0])??null,map:o[2],close:o[31]}};function Te(o){var s;let t,e,n=(((s=o[4])==null?void 0:s.length)||o[3]instanceof Y.Marker)&&De(o);return{c(){t=M("div"),n&&n.c()},m(l,u){w(l,t,u),n&&n.m(t,null),o[32](t),e=!0},p(l,u){var i;(i=l[4])!=null&&i.length||l[3]instanceof Y.Marker?n?(n.p(l,u),u[0]&24&&S(n,1)):(n=De(l),n.c(),S(n,1),n.m(t,null)):n&&(ee(),G(n,1,1,()=>{n=null}),te())},i(l){e||(S(n),e=!0)},o(l){G(n),e=!1},d(l){l&&y(t),n&&n.d(),o[32](null)}}}function De(o){let t;const e=o[30].default,n=Ye(e,o,o[29],Ne);return{c(){n&&n.c()},m(s,l){n&&n.m(s,l),t=!0},p(s,l){n&&n.p&&(!t||l[0]&536870933)&&xe(n,e,s,s[29],t?et(e,s[29],l,ct):$e(s[29]),Ne)},i(s){t||(S(n,s),t=!0)},o(s){G(n,s),t=!1},d(s){n&&n.d(s)}}}function at(o){let t,e,n=o[9].default&&Te(o);return{c(){n&&n.c(),t=ze()},m(s,l){n&&n.m(s,l),w(s,t,l),e=!0},p(s,l){s[9].default?n?(n.p(s,l),l[0]&512&&S(n,1)):(n=Te(s),n.c(),S(n,1),n.m(t.parentNode,t)):n&&(ee(),G(n,1,1,()=>{n=null}),te())},i(s){e||(S(n),e=!0)},o(s){G(n),e=!1},d(s){s&&y(t),n&&n.d(s)}}}function mt(o,t,e){let n,s,l,u,i,c,{$$slots:f={},$$scope:r}=t;const _=Qe(f);let{closeButton:d=void 0}=t,{closeOnClickOutside:C=!0}=t,{closeOnClickInside:v=!1}=t,{closeOnMove:g=!1}=t,{openOn:p="click"}=t,{openIfTopMost:L=!0}=t,{focusAfterOpen:O=!0}=t,{anchor:N=void 0}=t,{offset:T=void 0}=t,{popupClass:h=void 0}=t,{maxWidth:j=void 0}=t,{lngLat:H=void 0}=t,{html:A=void 0}=t,{open:m=!1}=t;const D=Be(),{map:ne,popupTarget:_e,layerEvent:ue,layer:ge,eventTopMost:Ue,markerClickManager:he}=Fe();le(o,ne,a=>e(2,l=a)),le(o,_e,a=>e(3,i=a)),le(o,ue,a=>e(28,u=a)),le(o,ge,a=>e(35,c=a));const qe=["click","dblclick","contextmenu"];let b,fe=!1,U;function Ke(){if(!b)return;let a=b.getElement();!a||a===U||(U=a,p==="hover"&&(U.style.pointerEvents="none"),U.addEventListener("mouseenter",()=>{e(24,fe=!0)},{passive:!0}),U.addEventListener("mouseleave",()=>{e(24,fe=!1)},{passive:!0}),U.addEventListener("click",()=>{v&&e(0,m=!1)},{passive:!0}))}Ae(()=>{if(l)return l.on("click",ce),l.on("contextmenu",ce),he.add(je),typeof i=="string"&&(l.on("click",i,Z),l.on("dblclick",i,Z),l.on("contextmenu",i,Z),l.on("mousemove",i,Oe),l.on("mouseleave",i,ve),l.on("touchstart",i,we),l.on("touchend",i,ye)),()=>{l!=null&&l.loaded()&&(b==null||b.remove(),l.off("click",ce),l.off("contextmenu",ce),he.remove(je),i instanceof Y.Marker?i.getPopup()===b&&i.setPopup(void 0):typeof i=="string"&&(l.off("click",i,Z),l.off("dblclick",i,Z),l.off("contextmenu",i,Z),l.off("mousemove",i,Oe),l.off("mouseleave",i,ve),l.off("touchstart",i,we),l.off("touchend",i,ye)))}});function ke(a){return L?!("marker"in a)&&!tt(a)&&Ue(a)!==c:!1}let K=null,R="normal";function be(a){"layerType"in a&&a.layerType==="deckgl"?(e(10,H=a.coordinate),e(4,K=a.object?[a.object]:null)):(e(10,H=a.lngLat),e(4,K=a.features??[]))}function Z(a){a.type!==p||ke(a)||(be(a),setTimeout(()=>e(0,m=!0)))}let X=null;function we(a){X=a.point}function ye(a){if(!X||p!=="hover")return;let me=X.dist(a.point);X=null,me<3&&(e(10,H=a.lngLat),e(4,K=a.features??[]),b.isOpen()?e(25,R="justOpened"):(e(25,R="opening"),e(0,m=!0)))}function ve(a){p!=="hover"||X||R!=="normal"||(e(0,m=!1),e(4,K=null))}function Oe(a){if(!(p!=="hover"||X||R!=="normal")){if(ke(a)){e(0,m=!1),e(4,K=null);return}e(0,m=!0),e(4,K=a.features??[]),e(10,H=a.lngLat)}}function ce(a){if(R==="justOpened"){e(25,R="normal");return}if(!C)return;let me=[U,i instanceof Y.Marker?i==null?void 0:i.getElement():null];m&&b.isOpen()&&!me.some(de=>de==null?void 0:de.contains(a.originalEvent.target))&&(a.type==="contextmenu"&&p==="contextmenu"||a.type!=="contextmenu")&&e(0,m=!1)}function je(a){C&&m&&b.isOpen()&&a.marker!==i&&e(0,m=!1)}Pe(()=>{l&&(b!=null&&b.isOpen())&&b.remove()});let oe;const Ze=()=>e(0,m=!1);function Ve(a){q[a?"unshift":"push"](()=>{oe=a,e(1,oe)})}return o.$$set=a=>{"closeButton"in a&&e(11,d=a.closeButton),"closeOnClickOutside"in a&&e(12,C=a.closeOnClickOutside),"closeOnClickInside"in a&&e(13,v=a.closeOnClickInside),"closeOnMove"in a&&e(14,g=a.closeOnMove),"openOn"in a&&e(15,p=a.openOn),"openIfTopMost"in a&&e(16,L=a.openIfTopMost),"focusAfterOpen"in a&&e(17,O=a.focusAfterOpen),"anchor"in a&&e(18,N=a.anchor),"offset"in a&&e(19,T=a.offset),"popupClass"in a&&e(20,h=a.popupClass),"maxWidth"in a&&e(21,j=a.maxWidth),"lngLat"in a&&e(10,H=a.lngLat),"html"in a&&e(22,A=a.html),"open"in a&&e(0,m=a.open),"$$scope"in a&&e(29,r=a.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&14336&&e(27,n=d??(!C&&!v)),o.$$.dirty[0]&146685952&&(b||(e(23,b=new Y.Popup({closeButton:n,closeOnClick:!1,closeOnMove:g,focusAfterOpen:O,maxWidth:j,className:h,anchor:N,offset:T})),U=b.getElement(),b.on("open",()=>{e(0,m=!0),Ke(),D("open",b)}),b.on("close",()=>{e(0,m=!1),D("close",b)}),b.on("hover",()=>{D("hover",b)}))),o.$$.dirty[0]&8421384&&b&&i instanceof Y.Marker&&(p==="click"?i.setPopup(b):i.getPopup()===b&&i.setPopup(void 0)),o.$$.dirty[0]&268468224&&qe.includes(p)&&(u==null?void 0:u.type)===p&&(Z(u),Xe(ue,u=null,u)),o.$$.dirty[0]&268468224&&e(26,s=p==="hover"&&((u==null?void 0:u.type)==="mousemove"||(u==null?void 0:u.type)==="mouseenter")),o.$$.dirty[0]&352354304&&p==="hover"&&ue&&(s&&u&&be(u),e(0,m=(s||fe)??!1)),o.$$.dirty[0]&12582914&&(oe?b.setDOMContent(oe):A&&b.setHTML(A)),o.$$.dirty[0]&8389632&&H&&b.setLngLat(H),o.$$.dirty[0]&41943045&&l){let a=b.isOpen();m&&!a?(b.addTo(l),R==="opening"&&e(25,R="justOpened")):!m&&a&&b.remove()}},[m,oe,l,i,K,ne,_e,ue,ge,_,H,d,C,v,g,p,L,O,N,T,h,j,A,b,fe,R,s,n,u,r,f,Ze,Ve]}class dt extends se{constructor(t){super(),ie(this,t,mt,at,re,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}const{window:pt}=Re;function _t(o){let t,e,n,s,l,u,i,c,f,r,_,d,C,v,g,p,L,O,N,T;return{c(){t=M("h3"),e=E("Target "),n=E(o[0]),s=E(": "),l=E(o[3]),u=I(),i=M("div"),c=M("button"),c.innerHTML=`<kbd>1</kbd>
    - Unreviewed`,f=I(),r=M("button"),r.innerHTML=`<kbd>2</kbd>
    - Not sure`,_=I(),d=M("button"),d.innerHTML=`<kbd>3</kbd>
    - No matches`,C=I(),v=M("div"),g=M("div"),p=M("button"),p.innerHTML=`<kbd>4</kbd>
        - These sources`,L=I(),O=M("input"),z(O,"type","text"),W(O,"width","50%"),W(i,"display","flex"),W(i,"justify-content","space-between")},m(h,j){w(h,t,j),k(t,e),k(t,n),k(t,s),k(t,l),w(h,u,j),w(h,i,j),k(i,c),k(i,f),k(i,r),k(i,_),k(i,d),k(i,C),k(i,v),k(v,g),k(g,p),k(v,L),k(v,O),Ce(O,o[2]),N||(T=[J(pt,"keydown",o[5]),J(c,"click",o[8]),J(r,"click",o[9]),J(d,"click",o[10]),J(p,"click",o[4]),J(O,"input",o[11])],N=!0)},p(h,[j]){j&1&&V(n,h[0]),j&4&&O.value!==h[2]&&Ce(O,h[2])},i:Q,o:Q,d(h){h&&(y(t),y(u),y(i)),N=!1,pe(T)}}}function gt(o,t,e){let{clickedTarget:n}=t,{targetGj:s}=t,{matchingSourceIndices:l}=t,{onConfirm:u}=t,i=s.features[n].properties.reviewed,c=Array.isArray(i)?JSON.stringify(i):JSON.stringify(l);function f(){try{let g=JSON.parse(c);if(!Array.isArray(g))throw new Error("Not an array");u(g)}catch{window.alert("Not a list of source IDs")}}function r(g){g.target.tagName!="INPUT"&&(g.key=="1"?u("unreviewed"):g.key=="2"?u("not sure"):g.key=="3"?u([]):g.key=="4"&&f())}const _=()=>u("unreviewed"),d=()=>u("not sure"),C=()=>u([]);function v(){c=this.value,e(2,c)}return o.$$set=g=>{"clickedTarget"in g&&e(0,n=g.clickedTarget),"targetGj"in g&&e(6,s=g.targetGj),"matchingSourceIndices"in g&&e(7,l=g.matchingSourceIndices),"onConfirm"in g&&e(1,u=g.onConfirm)},[n,u,c,i,f,r,s,l,_,d,C,v]}class ht extends se{constructor(t){super(),ie(this,t,gt,_t,re,{clickedTarget:0,targetGj:6,matchingSourceIndices:7,onConfirm:1})}}function Ee(o){let t,e,n,s=o[0].features.length+"",l,u,i,c=o[1].features.length+"",f,r,_,d=o[2].filter(Je).length+"",C,v,g,p,L,O,N,T,h,j;function H(m){o[11](m)}let A={onChange:o[6]};return o[4]!==void 0&&(A.options=o[4]),p=new nt({props:A}),q.push(()=>x(p,"options",H)),{c(){t=M("button"),t.textContent="Swap",e=I(),n=M("p"),l=E(s),u=E(` sources and
    `),i=M("span"),f=E(c),r=E(" targets"),_=E(`
    , with `),C=E(d),v=E(` matching
    a source`),g=I(),B(p.$$.fragment),O=I(),N=M("button"),N.textContent="Start review",z(t,"class","secondary"),W(i,"color","red")},m(m,D){w(m,t,D),w(m,e,D),w(m,n,D),k(n,l),k(n,u),k(n,i),k(i,f),k(i,r),k(n,_),k(n,C),k(n,v),w(m,g,D),F(p,m,D),w(m,O,D),w(m,N,D),T=!0,h||(j=[J(t,"click",o[8]),J(N,"click",o[12])],h=!0)},p(m,D){(!T||D&1)&&s!==(s=m[0].features.length+"")&&V(l,s),(!T||D&2)&&c!==(c=m[1].features.length+"")&&V(f,c),(!T||D&4)&&d!==(d=m[2].filter(Je).length+"")&&V(C,d);const ne={};!L&&D&16&&(L=!0,ne.options=m[4],$(()=>L=!1)),p.$set(ne)},i(m){T||(S(p.$$.fragment,m),T=!0)},o(m){G(p.$$.fragment,m),T=!1},d(m){m&&(y(t),y(e),y(n),y(g),y(O),y(N)),P(p,m),h=!1,pe(j)}}}function kt(o){let t,e,n,s,l,u,i,c,f=o[0].features.length>0&&Ee(o);return{c(){t=M("label"),e=E(`Load two .geojson files
  `),n=M("input"),s=I(),f&&f.c(),l=ze(),z(n,"type","file"),n.multiple=!0},m(r,_){w(r,t,_),k(t,e),k(t,n),o[10](n),w(r,s,_),f&&f.m(r,_),w(r,l,_),u=!0,i||(c=J(n,"change",o[7]),i=!0)},p(r,[_]){r[0].features.length>0?f?(f.p(r,_),_&1&&S(f,1)):(f=Ee(r),f.c(),S(f,1),f.m(l.parentNode,l)):f&&(ee(),G(f,1,1,()=>{f=null}),te())},i(r){u||(S(f),u=!0)},o(r){G(f),u=!1},d(r){r&&(y(t),y(s),y(l)),o[10](null),f&&f.d(r),i=!1,c()}}}function Ie(o){let t=0;for(let e of o.features)e.id=t++,e.properties??(e.properties={});return o}const Je=o=>o.matching_sources.length>0;function bt(o,t,e){let{sourceGj:n}=t,{targetGj:s}=t,{matches:l}=t,{setupDone:u}=t,{zoomFit:i}=t,c={buffer_meters:20,angle_diff_threshold:10,length_ratio_threshold:1.1,midpt_dist_threshold:15};function f(){var p;try{e(2,l=JSON.parse(ot(JSON.stringify(n),JSON.stringify(s),c)))}catch(L){window.alert(`Bug: ${L}`);return}for(let[L,O]of s.features.entries())O.properties.has_match=l[L].matching_sources.length>0,(p=O.properties).reviewed??(p.reviewed="unreviewed");e(1,s)}let r;async function _(p){if(!r.files)return;if(r.files.length!=2){window.alert("Select two GeoJSON files");return}try{let O=await r.files[0].text(),N=await r.files[1].text();e(0,n=Ie(JSON.parse(O))),e(1,s=Ie(JSON.parse(N))),i(),f()}catch(O){window.alert(`Bad input file: ${O}`)}}function d(){e(0,[n,s]=[s,n],n,e(1,s)),f()}function C(p){q[p?"unshift":"push"](()=>{r=p,e(5,r)})}function v(p){c=p,e(4,c)}const g=()=>e(3,u=!0);return o.$$set=p=>{"sourceGj"in p&&e(0,n=p.sourceGj),"targetGj"in p&&e(1,s=p.targetGj),"matches"in p&&e(2,l=p.matches),"setupDone"in p&&e(3,u=p.setupDone),"zoomFit"in p&&e(9,i=p.zoomFit)},[n,s,l,u,c,r,f,_,d,i,C,v,g]}class wt extends se{constructor(t){super(),ie(this,t,bt,kt,re,{sourceGj:0,targetGj:1,matches:2,setupDone:3,zoomFit:9})}}const{window:yt}=Re;function vt(o){let t,e,n,s,l,u,i,c,f,r,_,d,C,v=o[0].features.length+"",g,p,L,O,N,T;return{c(){t=M("div"),e=M("button"),e.textContent="Start over",n=I(),s=M("button"),s.textContent="Zoom to fit",l=I(),u=M("br"),i=I(),c=M("progress"),r=I(),_=M("p"),d=E(o[6]),C=E(" / "),g=E(v),p=E(" targets reviewed"),L=I(),O=M("button"),O.textContent="Download reviews",z(e,"class","secondary"),z(s,"class","secondary"),W(t,"display","flex"),W(t,"justify-content","space-between"),c.value=o[6],z(c,"max",f=o[0].features.length)},m(h,j){w(h,t,j),k(t,e),k(t,n),k(t,s),w(h,l,j),w(h,u,j),w(h,i,j),w(h,c,j),w(h,r,j),w(h,_,j),k(_,d),k(_,C),k(_,g),k(_,p),w(h,L,j),w(h,O,j),N||(T=[J(e,"click",o[14]),J(s,"click",o[8]),J(O,"click",o[13])],N=!0)},p(h,j){j&64&&(c.value=h[6]),j&1&&f!==(f=h[0].features.length)&&z(c,"max",f),j&64&&V(d,h[6]),j&1&&v!==(v=h[0].features.length+"")&&V(g,v)},i:Q,o:Q,d(h){h&&(y(t),y(l),y(u),y(i),y(c),y(r),y(_),y(L),y(O)),N=!1,pe(T)}}}function Ot(o){let t,e,n,s,l,u;function i(d){o[18](d)}function c(d){o[19](d)}function f(d){o[20](d)}function r(d){o[21](d)}let _={zoomFit:o[8]};return o[4]!==void 0&&(_.sourceGj=o[4]),o[0]!==void 0&&(_.targetGj=o[0]),o[1]!==void 0&&(_.matches=o[1]),o[5]!==void 0&&(_.setupDone=o[5]),t=new wt({props:_}),q.push(()=>x(t,"sourceGj",i)),q.push(()=>x(t,"targetGj",c)),q.push(()=>x(t,"matches",f)),q.push(()=>x(t,"setupDone",r)),{c(){B(t.$$.fragment)},m(d,C){F(t,d,C),u=!0},p(d,C){const v={};!e&&C&16&&(e=!0,v.sourceGj=d[4],$(()=>e=!1)),!n&&C&1&&(n=!0,v.targetGj=d[0],$(()=>n=!1)),!s&&C&2&&(s=!0,v.matches=d[1],$(()=>s=!1)),!l&&C&32&&(l=!0,v.setupDone=d[5],$(()=>l=!1)),t.$set(v)},i(d){u||(S(t.$$.fragment,d),u=!0)},o(d){G(t.$$.fragment,d),u=!1},d(d){P(t,d)}}}function jt(o){let t,e,n,s,l,u;const i=[Ot,vt],c=[];function f(r,_){return r[5]?1:0}return s=f(o),l=c[s]=i[s](o),{c(){t=M("div"),e=M("h1"),e.textContent="Match LineStrings - review results to make test cases",n=I(),l.c(),z(t,"slot","left")},m(r,_){w(r,t,_),k(t,e),k(t,n),c[s].m(t,null),u=!0},p(r,_){let d=s;s=f(r),s===d?c[s].p(r,_):(ee(),G(c[d],1,1,()=>{c[d]=null}),te(),l=c[s],l?l.p(r,_):(l=c[s]=i[s](r),l.c()),S(l,1),l.m(t,null))},i(r){u||(S(l),u=!0)},o(r){G(l),u=!1},d(r){r&&y(t),c[s].d()}}}function He(o){let t,e,n,s;const l=[Mt,Ct],u=[];function i(c,f){return c[2]==null?0:1}return e=i(o),n=u[e]=l[e](o),{c(){t=M("div"),n.c(),z(t,"class","map-panel svelte-1lu903l")},m(c,f){w(c,t,f),u[e].m(t,null),s=!0},p(c,f){let r=e;e=i(c),e===r?u[e].p(c,f):(ee(),G(u[r],1,1,()=>{u[r]=null}),te(),n=u[e],n?n.p(c,f):(n=u[e]=l[e](c),n.c()),S(n,1),n.m(t,null))},i(c){s||(S(n),s=!0)},o(c){G(n),s=!1},d(c){c&&y(t),u[e].d()}}}function Ct(o){let t,e;return t=new ht({props:{clickedTarget:o[2],targetGj:o[0],matchingSourceIndices:o[7],onConfirm:o[9]}}),{c(){B(t.$$.fragment)},m(n,s){F(t,n,s),e=!0},p(n,s){const l={};s&4&&(l.clickedTarget=n[2]),s&1&&(l.targetGj=n[0]),s&128&&(l.matchingSourceIndices=n[7]),t.$set(l)},i(n){e||(S(t.$$.fragment,n),e=!0)},o(n){G(t.$$.fragment,n),e=!1},d(n){P(t,n)}}}function Mt(o){let t,e,n;return{c(){t=M("button"),t.innerHTML=`Goto <kbd>n</kbd>
              ext unreviewed`},m(s,l){w(s,t,l),e||(n=J(t,"click",o[11]),e=!0)},p:Q,i:Q,o:Q,d(s){s&&y(t),e=!1,n()}}}function St(o){let t,e=Le(o[22]).id+"",n;return{c(){t=E("Source "),n=E(e)},m(s,l){w(s,t,l),w(s,n,l)},p(s,l){l&4194304&&e!==(e=Le(s[22]).id+"")&&V(n,e)},d(s){s&&(y(t),y(n))}}}function Gt(o){let t,e;return t=new dt({props:{openOn:"hover",$$slots:{default:[St,({data:n})=>({22:n}),({data:n})=>n?4194304:0]},$$scope:{ctx:o}}}),{c(){B(t.$$.fragment)},m(n,s){F(t,n,s),e=!0},p(n,s){const l={};s&12582912&&(l.$$scope={dirty:s,ctx:n}),t.$set(l)},i(n){e||(S(t.$$.fragment,n),e=!0)},o(n){G(t.$$.fragment,n),e=!1},d(n){P(t,n)}}}function Lt(o){let t,e;return t=new We({props:{manageHoverState:!0,paint:{"line-width":["case",["in",["id"],["literal",o[7]]],8,5],"line-color":"black","line-opacity":Ge(.5,1)},$$slots:{default:[Gt]},$$scope:{ctx:o}}}),{c(){B(t.$$.fragment)},m(n,s){F(t,n,s),e=!0},p(n,s){const l={};s&128&&(l.paint={"line-width":["case",["in",["id"],["literal",n[7]]],8,5],"line-color":"black","line-opacity":Ge(.5,1)}),s&8388608&&(l.$$scope={dirty:s,ctx:n}),t.$set(l)},i(n){e||(S(t.$$.fragment,n),e=!0)},o(n){G(t.$$.fragment,n),e=!1},d(n){P(t,n)}}}function Nt(o){let t,e;return t=new We({props:{manageHoverState:!0,paint:{"line-width":8,"line-color":["match",["get","reviewed"],"unreviewed","red","blue"],"line-opacity":["case",["==",["id"],o[2]??-1],1,["boolean",["feature-state","hover"],!1],.6,["get","has_match"],.5,.2]},hoverCursor:"pointer"}}),t.$on("click",o[15]),{c(){B(t.$$.fragment)},m(n,s){F(t,n,s),e=!0},p(n,s){const l={};s&4&&(l.paint={"line-width":8,"line-color":["match",["get","reviewed"],"unreviewed","red","blue"],"line-opacity":["case",["==",["id"],n[2]??-1],1,["boolean",["feature-state","hover"],!1],.6,["get","has_match"],.5,.2]}),t.$set(l)},i(n){e||(S(t.$$.fragment,n),e=!0)},o(n){G(t.$$.fragment,n),e=!1},d(n){P(t,n)}}}function Tt(o){let t,e,n,s,l,u,i;t=new ft({}),t.$on("click",o[10]);let c=o[5]&&He(o);return s=new Se({props:{data:o[4],$$slots:{default:[Lt]},$$scope:{ctx:o}}}),u=new Se({props:{data:o[0],$$slots:{default:[Nt]},$$scope:{ctx:o}}}),{c(){B(t.$$.fragment),e=I(),c&&c.c(),n=I(),B(s.$$.fragment),l=I(),B(u.$$.fragment)},m(f,r){F(t,f,r),w(f,e,r),c&&c.m(f,r),w(f,n,r),F(s,f,r),w(f,l,r),F(u,f,r),i=!0},p(f,r){f[5]?c?(c.p(f,r),r&32&&S(c,1)):(c=He(f),c.c(),S(c,1),c.m(n.parentNode,n)):c&&(ee(),G(c,1,1,()=>{c=null}),te());const _={};r&16&&(_.data=f[4]),r&8388736&&(_.$$scope={dirty:r,ctx:f}),s.$set(_);const d={};r&1&&(d.data=f[0]),r&8388612&&(d.$$scope={dirty:r,ctx:f}),u.$set(d)},i(f){i||(S(t.$$.fragment,f),S(c),S(s.$$.fragment,f),S(u.$$.fragment,f),i=!0)},o(f){G(t.$$.fragment,f),G(c),G(s.$$.fragment,f),G(u.$$.fragment,f),i=!1},d(f){f&&(y(e),y(n),y(l)),P(t,f),c&&c.d(f),P(s,f),P(u,f)}}}function Dt(o){let t,e,n,s;function l(i){o[16](i)}let u={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Tt]},$$scope:{ctx:o}};return o[3]!==void 0&&(u.map=o[3]),e=new st({props:u}),q.push(()=>x(e,"map",l)),e.$on("error",o[17]),{c(){t=M("div"),B(e.$$.fragment),z(t,"slot","main"),W(t,"position","relative"),W(t,"width","100%"),W(t,"height","100vh")},m(i,c){w(i,t,c),F(e,t,null),s=!0},p(i,c){const f={};c&8388789&&(f.$$scope={dirty:c,ctx:i}),!n&&c&8&&(n=!0,f.map=i[3],$(()=>n=!1)),e.$set(f)},i(i){s||(S(e.$$.fragment,i),s=!0)},o(i){G(e.$$.fragment,i),s=!1},d(i){i&&y(t),P(e)}}}function Et(o){let t,e,n,s;return t=new lt({props:{$$slots:{main:[Dt],left:[jt]},$$scope:{ctx:o}}}),{c(){B(t.$$.fragment)},m(l,u){F(t,l,u),e=!0,n||(s=J(yt,"keydown",o[12]),n=!0)},p(l,[u]){const i={};u&8388863&&(i.$$scope={dirty:u,ctx:l}),t.$set(i)},i(l){e||(S(t.$$.fragment,l),e=!0)},o(l){G(t.$$.fragment,l),e=!1},d(l){P(t,l),n=!1,s()}}}function It(o,t,e){let n,s,l,u=ae(),i=ae(),c=[],f=!1,r=null;Ae(async()=>{await it()});function _(){let m={type:"FeatureCollection",features:[...u.features,...i.features]};l==null||l.fitBounds(Me(m),{animate:!1,padding:10})}function d(m){if(r==null)throw new Error("impossible");e(0,i.features[r].properties.reviewed=m,i),e(0,i),e(2,r=null)}function C(m){e(2,r=null)}function v(){for(let m of i.features)if(m.properties.reviewed=="unreviewed"){l==null||l.fitBounds(Me(m),{duration:600,padding:200}),e(2,r=m.id);return}}function g(m){m.target.tagName=="INPUT"||!f||m.key=="n"&&v()}function p(){let m=JSON.parse(JSON.stringify(i));for(let D of m.features)delete D.properties.has_match;rt("targets.geojson",JSON.stringify(m))}function L(){window.confirm("Do you want to discard this review and start over?")&&(e(4,u=ae()),e(0,i=ae()),e(1,c=[]),e(5,f=!1),e(2,r=null))}function O(m){f&&e(2,r=m.detail.features[0].id)}function N(m){l=m,e(3,l)}const T=m=>{console.log(m.detail.error)};function h(m){u=m,e(4,u)}function j(m){i=m,e(0,i)}function H(m){c=m,e(1,c)}function A(m){f=m,e(5,f)}return o.$$.update=()=>{o.$$.dirty&6&&e(7,n=r==null?[]:c[r].matching_sources),o.$$.dirty&1&&e(6,s=i.features.filter(m=>m.properties.reviewed!="unreviewed").length)},[i,c,r,l,u,f,s,n,_,d,C,v,g,p,L,O,N,T,h,j,H,A]}class Jt extends se{constructor(t){super(),ie(this,t,It,Et,re,{})}}new Jt({target:document.getElementById("app")});
