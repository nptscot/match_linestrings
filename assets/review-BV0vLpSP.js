import{S as de,i as _e,s as ge,n as h,t as M,e as O,q as $,r as ee,u as k,U as ye,V as lt,W as ot,X as st,Y as he,o as Ze,Z as it,$ as me,a0 as rt,x as L,B as x,a1 as Ve,a2 as Xe,a3 as Ye,a4 as xe,a5 as ft,a6 as ut,C as oe,d as F,D as se,g as R,h as A,a7 as at,a8 as ae,a9 as Ne,aa as ie,ab as ct,E as J,A as I,K as X,v,y as D,z as H,J as Le,ac as ce,w as q,ad as mt,F as dt,I as _t,L as gt,k as ke,j as bt,M as pt,ae as ht,H as kt,N as wt,O as vt,P as yt,Q as De,R as $e,T as Ee,af as we,_ as Ct,G as He}from"./Settings-DNLyDdjl.js";const Ot=l=>({features:l[0]&16,data:l[0]&16,map:l[0]&4,close:l[0]&1}),Pe=l=>{var e;return{features:l[4],data:((e=l[4])==null?void 0:e[0])??null,map:l[2],close:l[31]}};function Be(l){var s;let e,t,n=(((s=l[4])==null?void 0:s.length)||l[3]instanceof me.Marker)&&Je(l);return{c(){e=L("div"),n&&n.c()},m(o,i){k(o,e,i),n&&n.m(e,null),l[32](e),t=!0},p(o,i){var r;(r=o[4])!=null&&r.length||o[3]instanceof me.Marker?n?(n.p(o,i),i[0]&24&&O(n,1)):(n=Je(o),n.c(),O(n,1),n.m(e,null)):n&&($(),M(n,1,1,()=>{n=null}),ee())},i(o){t||(O(n),t=!0)},o(o){M(n),t=!1},d(o){o&&h(e),n&&n.d(),l[32](null)}}}function Je(l){let e;const t=l[30].default,n=Ve(t,l,l[29],Pe);return{c(){n&&n.c()},m(s,o){n&&n.m(s,o),e=!0},p(s,o){n&&n.p&&(!e||o[0]&536870933)&&Xe(n,t,s,s[29],e?xe(t,s[29],o,Ot):Ye(s[29]),Pe)},i(s){e||(O(n,s),e=!0)},o(s){M(n,s),e=!1},d(s){n&&n.d(s)}}}function Lt(l){let e,t,n=l[9].default&&Be(l);return{c(){n&&n.c(),e=ye()},m(s,o){n&&n.m(s,o),k(s,e,o),t=!0},p(s,o){s[9].default?n?(n.p(s,o),o[0]&512&&O(n,1)):(n=Be(s),n.c(),O(n,1),n.m(e.parentNode,e)):n&&($(),M(n,1,1,()=>{n=null}),ee())},i(s){t||(O(n),t=!0)},o(s){M(n),t=!1},d(s){s&&h(e),n&&n.d(s)}}}function Tt(l,e,t){let n,s,o,i,r,f,{$$slots:a={},$$scope:m}=e;const g=lt(a);let{closeButton:_=void 0}=e,{closeOnClickOutside:z=!0}=e,{closeOnClickInside:G=!1}=e,{closeOnMove:C=!1}=e,{openOn:u="click"}=e,{openIfTopMost:p=!0}=e,{focusAfterOpen:S=!0}=e,{anchor:N=void 0}=e,{offset:P=void 0}=e,{popupClass:y=void 0}=e,{maxWidth:b=void 0}=e,{lngLat:w=void 0}=e,{html:Z=void 0}=e,{open:E=!1}=e;const K=ot(),{map:W,popupTarget:c,layerEvent:Q,layer:U,eventTopMost:re,markerClickManager:fe}=st();he(l,W,d=>t(2,o=d)),he(l,c,d=>t(3,r=d)),he(l,Q,d=>t(28,i=d)),he(l,U,d=>t(35,f=d));const V=["click","dblclick","contextmenu"];let T,te=!1,j;function B(){if(!T)return;let d=T.getElement();!d||d===j||(j=d,u==="hover"&&(j.style.pointerEvents="none"),j.addEventListener("mouseenter",()=>{t(24,te=!0)},{passive:!0}),j.addEventListener("mouseleave",()=>{t(24,te=!1)},{passive:!0}),j.addEventListener("click",()=>{G&&t(0,E=!1)},{passive:!0}))}Ze(()=>{if(o)return o.on("click",pe),o.on("contextmenu",pe),fe.add(ze),typeof r=="string"&&(o.on("click",r,le),o.on("dblclick",r,le),o.on("contextmenu",r,le),o.on("mousemove",r,Ie),o.on("mouseleave",r,Ge),o.on("touchstart",r,Se),o.on("touchend",r,Me)),()=>{o!=null&&o.loaded()&&(T==null||T.remove(),o.off("click",pe),o.off("contextmenu",pe),fe.remove(ze),r instanceof me.Marker?r.getPopup()===T&&r.setPopup(void 0):typeof r=="string"&&(o.off("click",r,le),o.off("dblclick",r,le),o.off("contextmenu",r,le),o.off("mousemove",r,Ie),o.off("mouseleave",r,Ge),o.off("touchstart",r,Se),o.off("touchend",r,Me)))}});function Te(d){return p?!("marker"in d)&&!ft(d)&&re(d)!==f:!1}let ne=null,Y="normal";function je(d){"layerType"in d&&d.layerType==="deckgl"?(t(10,w=d.coordinate),t(4,ne=d.object?[d.object]:null)):(t(10,w=d.lngLat),t(4,ne=d.features??[]))}function le(d){d.type!==u||Te(d)||(je(d),setTimeout(()=>t(0,E=!0)))}let ue=null;function Se(d){ue=d.point}function Me(d){if(!ue||u!=="hover")return;let Ce=ue.dist(d.point);ue=null,Ce<3&&(t(10,w=d.lngLat),t(4,ne=d.features??[]),T.isOpen()?t(25,Y="justOpened"):(t(25,Y="opening"),t(0,E=!0)))}function Ge(d){u!=="hover"||ue||Y!=="normal"||(t(0,E=!1),t(4,ne=null))}function Ie(d){if(!(u!=="hover"||ue||Y!=="normal")){if(Te(d)){t(0,E=!1),t(4,ne=null);return}t(0,E=!0),t(4,ne=d.features??[]),t(10,w=d.lngLat)}}function pe(d){if(Y==="justOpened"){t(25,Y="normal");return}if(!z)return;let Ce=[j,r instanceof me.Marker?r==null?void 0:r.getElement():null];E&&T.isOpen()&&!Ce.some(Oe=>Oe==null?void 0:Oe.contains(d.originalEvent.target))&&(d.type==="contextmenu"&&u==="contextmenu"||d.type!=="contextmenu")&&t(0,E=!1)}function ze(d){z&&E&&T.isOpen()&&d.marker!==r&&t(0,E=!1)}it(()=>{o&&(T!=null&&T.isOpen())&&T.remove()});let be;const tt=()=>t(0,E=!1);function nt(d){x[d?"unshift":"push"](()=>{be=d,t(1,be)})}return l.$$set=d=>{"closeButton"in d&&t(11,_=d.closeButton),"closeOnClickOutside"in d&&t(12,z=d.closeOnClickOutside),"closeOnClickInside"in d&&t(13,G=d.closeOnClickInside),"closeOnMove"in d&&t(14,C=d.closeOnMove),"openOn"in d&&t(15,u=d.openOn),"openIfTopMost"in d&&t(16,p=d.openIfTopMost),"focusAfterOpen"in d&&t(17,S=d.focusAfterOpen),"anchor"in d&&t(18,N=d.anchor),"offset"in d&&t(19,P=d.offset),"popupClass"in d&&t(20,y=d.popupClass),"maxWidth"in d&&t(21,b=d.maxWidth),"lngLat"in d&&t(10,w=d.lngLat),"html"in d&&t(22,Z=d.html),"open"in d&&t(0,E=d.open),"$$scope"in d&&t(29,m=d.$$scope)},l.$$.update=()=>{if(l.$$.dirty[0]&14336&&t(27,n=_??(!z&&!G)),l.$$.dirty[0]&146685952&&(T||(t(23,T=new me.Popup({closeButton:n,closeOnClick:!1,closeOnMove:C,focusAfterOpen:S,maxWidth:b,className:y,anchor:N,offset:P})),j=T.getElement(),T.on("open",()=>{t(0,E=!0),B(),K("open",T)}),T.on("close",()=>{t(0,E=!1),K("close",T)}),T.on("hover",()=>{K("hover",T)}))),l.$$.dirty[0]&8421384&&T&&r instanceof me.Marker&&(u==="click"?r.setPopup(T):r.getPopup()===T&&r.setPopup(void 0)),l.$$.dirty[0]&268468224&&V.includes(u)&&(i==null?void 0:i.type)===u&&(le(i),rt(Q,i=null,i)),l.$$.dirty[0]&268468224&&t(26,s=u==="hover"&&((i==null?void 0:i.type)==="mousemove"||(i==null?void 0:i.type)==="mouseenter")),l.$$.dirty[0]&352354304&&u==="hover"&&Q&&(s&&i&&je(i),t(0,E=(s||te)??!1)),l.$$.dirty[0]&12582914&&(be?T.setDOMContent(be):Z&&T.setHTML(Z)),l.$$.dirty[0]&8389632&&w&&T.setLngLat(w),l.$$.dirty[0]&41943045&&o){let d=T.isOpen();E&&!d?(T.addTo(o),Y==="opening"&&t(25,Y="justOpened")):!E&&d&&T.remove()}},[E,be,o,r,ne,W,c,Q,U,g,w,_,z,G,C,u,p,S,N,P,y,b,Z,T,te,Y,s,n,i,m,a,tt,nt]}class jt extends de{constructor(e){super(),_e(this,e,Tt,Lt,ge,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function St(l){let e;const t=l[16].default,n=Ve(t,l,l[24],null);return{c(){n&&n.c()},m(s,o){n&&n.m(s,o),e=!0},p(s,o){n&&n.p&&(!e||o&16777216)&&Xe(n,t,s,s[24],e?xe(t,s[24],o,null):Ye(s[24]),null)},i(s){e||(O(n,s),e=!0)},o(s){M(n,s),e=!1},d(s){n&&n.d(s)}}}function Mt(l){let e,t,n;function s(i){l[17](i)}let o={id:l[1],type:"symbol",source:l[2],sourceLayer:l[3],beforeId:l[4],beforeLayerType:l[5],paint:l[6],layout:l[7],filter:l[8],applyToClusters:l[9],minzoom:l[10],maxzoom:l[11],hoverCursor:l[12],manageHoverState:l[13],eventsIfTopMost:l[14],interactive:l[15],$$slots:{default:[St]},$$scope:{ctx:l}};return l[0]!==void 0&&(o.hovered=l[0]),e=new ut({props:o}),x.push(()=>oe(e,"hovered",s)),e.$on("click",l[18]),e.$on("dblclick",l[19]),e.$on("contextmenu",l[20]),e.$on("mouseenter",l[21]),e.$on("mousemove",l[22]),e.$on("mouseleave",l[23]),{c(){A(e.$$.fragment)},m(i,r){R(e,i,r),n=!0},p(i,[r]){const f={};r&2&&(f.id=i[1]),r&4&&(f.source=i[2]),r&8&&(f.sourceLayer=i[3]),r&16&&(f.beforeId=i[4]),r&32&&(f.beforeLayerType=i[5]),r&64&&(f.paint=i[6]),r&128&&(f.layout=i[7]),r&256&&(f.filter=i[8]),r&512&&(f.applyToClusters=i[9]),r&1024&&(f.minzoom=i[10]),r&2048&&(f.maxzoom=i[11]),r&4096&&(f.hoverCursor=i[12]),r&8192&&(f.manageHoverState=i[13]),r&16384&&(f.eventsIfTopMost=i[14]),r&32768&&(f.interactive=i[15]),r&16777216&&(f.$$scope={dirty:r,ctx:i}),!t&&r&1&&(t=!0,f.hovered=i[0],se(()=>t=!1)),e.$set(f)},i(i){n||(O(e.$$.fragment,i),n=!0)},o(i){M(e.$$.fragment,i),n=!1},d(i){F(e,i)}}}function Gt(l,e,t){let{$$slots:n={},$$scope:s}=e,{id:o=at("symbol")}=e,{source:i=void 0}=e,{sourceLayer:r=void 0}=e,{beforeId:f=void 0}=e,{beforeLayerType:a=void 0}=e,{paint:m=void 0}=e,{layout:g=void 0}=e,{filter:_=void 0}=e,{applyToClusters:z=void 0}=e,{minzoom:G=void 0}=e,{maxzoom:C=void 0}=e,{hoverCursor:u=void 0}=e,{manageHoverState:p=!1}=e,{hovered:S=null}=e,{eventsIfTopMost:N=!1}=e,{interactive:P=!0}=e;function y(c){S=c,t(0,S)}function b(c){ae.call(this,l,c)}function w(c){ae.call(this,l,c)}function Z(c){ae.call(this,l,c)}function E(c){ae.call(this,l,c)}function K(c){ae.call(this,l,c)}function W(c){ae.call(this,l,c)}return l.$$set=c=>{"id"in c&&t(1,o=c.id),"source"in c&&t(2,i=c.source),"sourceLayer"in c&&t(3,r=c.sourceLayer),"beforeId"in c&&t(4,f=c.beforeId),"beforeLayerType"in c&&t(5,a=c.beforeLayerType),"paint"in c&&t(6,m=c.paint),"layout"in c&&t(7,g=c.layout),"filter"in c&&t(8,_=c.filter),"applyToClusters"in c&&t(9,z=c.applyToClusters),"minzoom"in c&&t(10,G=c.minzoom),"maxzoom"in c&&t(11,C=c.maxzoom),"hoverCursor"in c&&t(12,u=c.hoverCursor),"manageHoverState"in c&&t(13,p=c.manageHoverState),"hovered"in c&&t(0,S=c.hovered),"eventsIfTopMost"in c&&t(14,N=c.eventsIfTopMost),"interactive"in c&&t(15,P=c.interactive),"$$scope"in c&&t(24,s=c.$$scope)},[S,o,i,r,f,a,m,g,_,z,G,C,u,p,N,P,n,y,b,w,Z,E,K,W,s]}class et extends de{constructor(e){super(),_e(this,e,Gt,Mt,ge,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function Fe(l,e,t){const n=l.slice();return n[4]=e[t][0],n[5]=e[t][1],n}function Re(l){let e,t,n,s,o=l[4]+"",i,r;return{c(){e=L("div"),t=L("span"),s=D(),i=H(o),r=D(),I(t,"class",n="color-swatch "+l[1]+" svelte-1enycr6"),J(t,"background",l[5]),J(e,"display","flex"),J(e,"align-items","center"),J(e,"gap","6px")},m(f,a){k(f,e,a),v(e,t),v(e,s),v(e,i),v(e,r)},p(f,a){a&2&&n!==(n="color-swatch "+f[1]+" svelte-1enycr6")&&I(t,"class",n),a&1&&J(t,"background",f[5]),a&1&&o!==(o=f[4]+"")&&X(i,o)},d(f){f&&h(e)}}}function It(l){let e,t=Ne(Object.entries(l[0])),n=[];for(let s=0;s<t.length;s+=1)n[s]=Re(Fe(l,t,s));return{c(){e=L("div");for(let s=0;s<n.length;s+=1)n[s].c();J(e,"display","grid"),J(e,"grid-template-columns","repeat(auto-fill, calc("+l[2]+" - 10px))"),J(e,"gap","10px")},m(s,o){k(s,e,o);for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(e,null)},p(s,[o]){if(o&3){t=Ne(Object.entries(s[0]));let i;for(i=0;i<t.length;i+=1){const r=Fe(s,t,i);n[i]?n[i].p(r,o):(n[i]=Re(r),n[i].c(),n[i].m(e,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}o&4&&J(e,"grid-template-columns","repeat(auto-fill, calc("+s[2]+" - 10px))")},i:ie,o:ie,d(s){s&&h(e),ct(n,s)}}}function zt(l,e,t){let n,{labelColors:s}=e,{swatchClass:o="rectangle"}=e,{itemsPerRow:i=2}=e;return l.$$set=r=>{"labelColors"in r&&t(0,s=r.labelColors),"swatchClass"in r&&t(1,o=r.swatchClass),"itemsPerRow"in r&&t(3,i=r.itemsPerRow)},l.$$.update=()=>{l.$$.dirty&8&&t(2,n=`${100/i}%`)},[s,o,n,i]}class Nt extends de{constructor(e){super(),_e(this,e,zt,It,ge,{labelColors:0,swatchClass:1,itemsPerRow:3})}}let ve="match-linestrings-review";function Dt(l){let e;return{c(){e=H("no matches (off-road)")},m(t,n){k(t,e,n)},p:ie,d(t){t&&h(e)}}}function Et(l){let e=JSON.stringify(l[3].matching_sources)+"",t;return{c(){t=H(e)},m(n,s){k(n,t,s)},p(n,s){s&8&&e!==(e=JSON.stringify(n[3].matching_sources)+"")&&X(t,e)},d(n){n&&h(t)}}}function Ht(l){let e,t,n,s,o,i,r,f,a,m,g,_,z,G,C,u,p,S;function N(b,w){return b[3].matching_sources.length>0?Et:Dt}let P=N(l),y=P(l);return{c(){e=L("div"),t=L("h3"),n=H("Target "),s=H(l[0]),o=H(`:
    `),y.c(),i=D(),r=L("button"),r.innerHTML=`<kbd>Escape</kbd>
    - Back`,f=D(),a=L("h6"),a.textContent="Click sources to add or remove",m=D(),g=L("div"),_=L("button"),_.innerHTML=`<kbd>1</kbd>
    - Unreviewed`,z=D(),G=L("button"),G.innerHTML=`<kbd>2</kbd>
    - Not sure`,C=D(),u=L("button"),u.innerHTML=`<kbd>3</kbd>
    - Confirm correct`,I(r,"class","btn btn-secondary"),J(e,"display","flex"),J(e,"justify-content","space-between"),I(_,"class","btn btn-danger svelte-1tzb8bs"),ce(_,"current",l[3].reviewed=="unreviewed"),I(G,"class","btn btn-warning svelte-1tzb8bs"),ce(G,"current",l[3].reviewed=="not sure"),I(u,"class","btn btn-success svelte-1tzb8bs"),ce(u,"current",l[3].reviewed=="confirmed"),J(g,"display","flex"),J(g,"justify-content","space-between")},m(b,w){k(b,e,w),v(e,t),v(t,n),v(t,s),v(t,o),y.m(t,null),v(e,i),v(e,r),k(b,f,w),k(b,a,w),k(b,m,w),k(b,g,w),v(g,_),v(g,z),v(g,G),v(g,C),v(g,u),p||(S=[q(window,"keydown",l[4]),q(r,"click",function(){mt(l[2])&&l[2].apply(this,arguments)}),q(_,"click",l[6]),q(G,"click",l[7]),q(u,"click",l[8])],p=!0)},p(b,[w]){l=b,w&1&&X(s,l[0]),P===(P=N(l))&&y?y.p(l,w):(y.d(1),y=P(l),y&&(y.c(),y.m(t,null))),w&8&&ce(_,"current",l[3].reviewed=="unreviewed"),w&8&&ce(G,"current",l[3].reviewed=="not sure"),w&8&&ce(u,"current",l[3].reviewed=="confirmed")},i:ie,o:ie,d(b){b&&(h(e),h(f),h(a),h(m),h(g)),y.d(),p=!1,Le(S)}}}function Pt(l,e,t){let n,{clickedTarget:s}=e,{targetGj:o}=e,{onConfirm:i}=e,{onCancel:r}=e;function f(_){_.target.tagName!="INPUT"&&(_.key=="1"?i("unreviewed"):_.key=="2"?i("not sure"):_.key=="3"?i("confirmed"):_.key=="Escape"&&r())}const a=()=>i("unreviewed"),m=()=>i("not sure"),g=()=>i("confirmed");return l.$$set=_=>{"clickedTarget"in _&&t(0,s=_.clickedTarget),"targetGj"in _&&t(5,o=_.targetGj),"onConfirm"in _&&t(1,i=_.onConfirm),"onCancel"in _&&t(2,r=_.onCancel)},l.$$.update=()=>{l.$$.dirty&33&&t(3,n=o.features[s].properties)},[s,i,r,n,f,o,a,m,g]}class Bt extends de{constructor(e){super(),_e(this,e,Pt,Ht,ge,{clickedTarget:0,targetGj:5,onConfirm:1,onCancel:2})}}function Ae(l){let e,t,n,s,o=l[0].features.length+"",i,r,f=l[1].features.length+"",a,m,g=l[1].features.filter(qe).length+"",_,z,G,C,u,p,S,N,P,y=!l[3]&&We(l);return{c(){e=L("button"),t=H("Swap"),n=D(),s=L("p"),i=H(o),r=H(` sources and
    `),a=H(f),m=H(" targets , with "),_=H(g),z=H(" matching a source"),G=D(),C=L("button"),C.textContent="Start review",u=D(),y&&y.c(),p=ye(),I(e,"class","btn btn-secondary"),e.disabled=l[3],I(C,"class","btn btn-primary mb-5")},m(b,w){k(b,e,w),v(e,t),k(b,n,w),k(b,s,w),v(s,i),v(s,r),v(s,a),v(s,m),v(s,_),v(s,z),k(b,G,w),k(b,C,w),k(b,u,w),y&&y.m(b,w),k(b,p,w),S=!0,N||(P=[q(e,"click",l[8]),q(C,"click",l[11])],N=!0)},p(b,w){(!S||w&8)&&(e.disabled=b[3]),(!S||w&1)&&o!==(o=b[0].features.length+"")&&X(i,o),(!S||w&2)&&f!==(f=b[1].features.length+"")&&X(a,f),(!S||w&2)&&g!==(g=b[1].features.filter(qe).length+"")&&X(_,g),b[3]?y&&($(),M(y,1,1,()=>{y=null}),ee()):y?(y.p(b,w),w&8&&O(y,1)):(y=We(b),y.c(),O(y,1),y.m(p.parentNode,p))},i(b){S||(O(y),S=!0)},o(b){M(y),S=!1},d(b){b&&(h(e),h(n),h(s),h(G),h(C),h(u),h(p)),y&&y.d(b),N=!1,Le(P)}}}function We(l){let e,t,n;function s(i){l[12](i)}let o={onChange:l[6]};return l[4]!==void 0&&(o.options=l[4]),e=new _t({props:o}),x.push(()=>oe(e,"options",s)),{c(){A(e.$$.fragment)},m(i,r){R(e,i,r),n=!0},p(i,r){const f={};!t&&r&16&&(t=!0,f.options=i[4],se(()=>t=!1)),e.$set(f)},i(i){n||(O(e.$$.fragment,i),n=!0)},o(i){M(e.$$.fragment,i),n=!1},d(i){F(e,i)}}}function Jt(l){let e,t,n,s,o,i,r,f,a=l[0].features.length>0&&Ae(l);return{c(){e=L("label"),t=H(`Load two .geojson files
  `),n=L("input"),s=D(),a&&a.c(),o=ye(),I(n,"class","form-control"),I(n,"type","file"),n.multiple=!0,I(e,"class","form-label")},m(m,g){k(m,e,g),v(e,t),v(e,n),l[10](n),k(m,s,g),a&&a.m(m,g),k(m,o,g),i=!0,r||(f=q(n,"change",l[7]),r=!0)},p(m,[g]){m[0].features.length>0?a?(a.p(m,g),g&1&&O(a,1)):(a=Ae(m),a.c(),O(a,1),a.m(o.parentNode,o)):a&&($(),M(a,1,1,()=>{a=null}),ee())},i(m){i||(O(a),i=!0)},o(m){M(a),i=!1},d(m){m&&(h(e),h(s),h(o)),l[10](null),a&&a.d(m),r=!1,f()}}}function Ue(l){let e=0;for(let t of l.features)t.id=e++,t.properties??(t.properties={});return l}const qe=l=>l.properties.matching_sources.length>0;function Ft(l,e,t){let{sourceGj:n}=e,{targetGj:s}=e,{setupDone:o}=e,{zoomFit:i}=e,r=!1,f={buffer_meters:20,angle_diff_threshold:10,length_ratio_threshold:1.1,midpt_dist_threshold:15};function a(){var u;if(!r)try{let p=JSON.parse(dt(JSON.stringify(n),JSON.stringify(s),f));for(let[S,N]of s.features.entries())N.properties.matching_sources=p[S].matching_sources,(u=N.properties).reviewed??(u.reviewed="unreviewed");t(1,s)}catch(p){window.alert(`Bug: ${p}`)}}let m;async function g(u){if(!m.files)return;if(m.files.length!=2){window.alert("Select two GeoJSON files");return}try{let S=await m.files[0].text(),N=await m.files[1].text();t(0,n=Ue(JSON.parse(S))),t(1,s=Ue(JSON.parse(N))),"matching_sources"in s.features[0].properties?t(3,r=!0):"matching_sources"in n.features[0].properties&&(t(3,r=!0),t(0,[n,s]=[s,n],n,t(1,s))),i(),a()}catch(S){window.alert(`Bad input file: ${S}`)}}function _(){t(0,[n,s]=[s,n],n,t(1,s)),a()}function z(u){x[u?"unshift":"push"](()=>{m=u,t(5,m)})}const G=()=>t(2,o=!0);function C(u){f=u,t(4,f)}return l.$$set=u=>{"sourceGj"in u&&t(0,n=u.sourceGj),"targetGj"in u&&t(1,s=u.targetGj),"setupDone"in u&&t(2,o=u.setupDone),"zoomFit"in u&&t(9,i=u.zoomFit)},[n,s,o,r,f,m,a,g,_,i,z,G,C]}class Rt extends de{constructor(e){super(),_e(this,e,Ft,Jt,ge,{sourceGj:0,targetGj:1,setupDone:2,zoomFit:9})}}const{window:At}=ht;function Wt(l){let e,t,n,s,o,i,r,f,a,m,g,_,z,G,C=l[1].features.length+"",u,p,S,N,P,y,b,w,Z,E,K,W,c,Q,U,re,fe,V,T,te;return U=new Nt({props:{itemsPerRow:1,labelColors:{Confirmed:"green","Not sure":"orange",Unreviewed:"red",Source:"grey"}}}),{c(){e=L("div"),t=L("button"),t.textContent="Start over",n=D(),s=L("button"),s.textContent="Zoom to fit",o=D(),i=L("br"),r=D(),f=L("div"),a=L("div"),g=D(),_=L("p"),z=H(l[4]),G=H(" / "),u=H(C),p=H(" targets reviewed"),S=D(),N=L("button"),N.textContent="Download reviews",P=D(),y=L("div"),b=L("label"),w=L("input"),Z=H(`
          Show labels for matches`),E=D(),K=L("div"),W=L("div"),c=L("h5"),c.textContent="Legend",Q=D(),A(U.$$.fragment),re=D(),fe=L("p"),fe.textContent="Thinner lines have a match, thicker are off-road",I(t,"class","btn btn-outline-danger"),I(s,"class","btn btn-outline-secondary"),J(e,"display","flex"),J(e,"justify-content","space-between"),I(a,"class","progress-bar"),J(a,"width",`${100*l[4]/l[1].features.length}%`),I(f,"class","progress"),I(f,"role","progressbar"),I(f,"aria-valuenow",l[4]),I(f,"aria-valuemin","0"),I(f,"aria-valuemax",m=l[1].features.length),I(N,"class","btn btn-outline-success"),I(w,"class","form-check-input"),I(w,"type","checkbox"),I(b,"class","form-check-label mt-5"),I(c,"class","card-title"),I(W,"class","card-body"),I(K,"class","card")},m(j,B){k(j,e,B),v(e,t),v(e,n),v(e,s),k(j,o,B),k(j,i,B),k(j,r,B),k(j,f,B),v(f,a),k(j,g,B),k(j,_,B),v(_,z),v(_,G),v(_,u),v(_,p),k(j,S,B),k(j,N,B),k(j,P,B),k(j,y,B),v(y,b),v(b,w),w.checked=l[7],v(b,Z),k(j,E,B),k(j,K,B),v(K,W),v(W,c),v(W,Q),R(U,W,null),v(W,re),v(W,fe),V=!0,T||(te=[q(t,"click",l[14]),q(s,"click",l[9]),q(N,"click",l[13]),q(w,"change",l[24])],T=!0)},p(j,B){B&18&&J(a,"width",`${100*j[4]/j[1].features.length}%`),(!V||B&16)&&I(f,"aria-valuenow",j[4]),(!V||B&2&&m!==(m=j[1].features.length))&&I(f,"aria-valuemax",m),(!V||B&16)&&X(z,j[4]),(!V||B&2)&&C!==(C=j[1].features.length+"")&&X(u,C),B&128&&(w.checked=j[7])},i(j){V||(O(U.$$.fragment,j),V=!0)},o(j){M(U.$$.fragment,j),V=!1},d(j){j&&(h(e),h(o),h(i),h(r),h(f),h(g),h(_),h(S),h(N),h(P),h(y),h(E),h(K)),F(U),T=!1,Le(te)}}}function Ut(l){let e,t,n,s,o;function i(m){l[21](m)}function r(m){l[22](m)}function f(m){l[23](m)}let a={zoomFit:l[9]};return l[0]!==void 0&&(a.sourceGj=l[0]),l[1]!==void 0&&(a.targetGj=l[1]),l[2]!==void 0&&(a.setupDone=l[2]),e=new Rt({props:a}),x.push(()=>oe(e,"sourceGj",i)),x.push(()=>oe(e,"targetGj",r)),x.push(()=>oe(e,"setupDone",f)),{c(){A(e.$$.fragment)},m(m,g){R(e,m,g),o=!0},p(m,g){const _={};!t&&g&1&&(t=!0,_.sourceGj=m[0],se(()=>t=!1)),!n&&g&2&&(n=!0,_.targetGj=m[1],se(()=>n=!1)),!s&&g&4&&(s=!0,_.setupDone=m[2],se(()=>s=!1)),e.$set(_)},i(m){o||(O(e.$$.fragment,m),o=!0)},o(m){M(e.$$.fragment,m),o=!1},d(m){F(e,m)}}}function qt(l){let e,t,n,s,o,i,r,f;const a=[Ut,Wt],m=[];function g(_,z){return _[2]?1:0}return i=g(l),r=m[i]=a[i](l),{c(){e=L("div"),t=L("h1"),t.textContent="Manually specify LineString matchings for test cases",n=D(),s=L("div"),s.innerHTML='<a class="icon-link mb-3" href="https://github.com/nptscot/match_linestrings/blob/main/tests/README.md" target="_blank">About <i class="fa-solid fa-arrow-up-right-from-square"></i></a>',o=D(),r.c(),I(e,"slot","left")},m(_,z){k(_,e,z),v(e,t),v(e,n),v(e,s),v(e,o),m[i].m(e,null),f=!0},p(_,z){let G=i;i=g(_),i===G?m[i].p(_,z):($(),M(m[G],1,1,()=>{m[G]=null}),ee(),r=m[i],r?r.p(_,z):(r=m[i]=a[i](_),r.c()),O(r,1),r.m(e,null))},i(_){f||(O(r),f=!0)},o(_){M(r),f=!1},d(_){_&&h(e),m[i].d()}}}function Ke(l){let e,t,n,s;const o=[Qt,Kt],i=[];function r(f,a){return f[3]==null?0:1}return t=r(l),n=i[t]=o[t](l),{c(){e=L("div"),n.c(),I(e,"class","map-panel svelte-hr6p1s")},m(f,a){k(f,e,a),i[t].m(e,null),s=!0},p(f,a){let m=t;t=r(f),t===m?i[t].p(f,a):($(),M(i[m],1,1,()=>{i[m]=null}),ee(),n=i[t],n?n.p(f,a):(n=i[t]=o[t](f),n.c()),O(n,1),n.m(e,null))},i(f){s||(O(n),s=!0)},o(f){M(n),s=!1},d(f){f&&h(e),i[t].d()}}}function Kt(l){let e,t;return e=new Bt({props:{clickedTarget:l[3],targetGj:l[1],onConfirm:l[10],onCancel:l[18]}}),{c(){A(e.$$.fragment)},m(n,s){R(e,n,s),t=!0},p(n,s){const o={};s&8&&(o.clickedTarget=n[3]),s&2&&(o.targetGj=n[1]),s&8&&(o.onCancel=n[18]),e.$set(o)},i(n){t||(O(e.$$.fragment,n),t=!0)},o(n){M(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Qt(l){let e,t,n,s,o,i,r;return{c(){e=L("button"),t=H("Goto "),n=L("kbd"),n.textContent="n",s=H(`
              ext unreviewed`),I(e,"class","btn btn-primary"),e.disabled=o=l[4]==l[1].features.length},m(f,a){k(f,e,a),v(e,t),v(e,n),v(e,s),i||(r=q(e,"click",l[11]),i=!0)},p(f,a){a&18&&o!==(o=f[4]==f[1].features.length)&&(e.disabled=o)},i:ie,o:ie,d(f){f&&h(e),i=!1,r()}}}function Qe(l){let e,t;return e=new jt({props:{openOn:"hover",$$slots:{default:[Zt,({data:n})=>({25:n}),({data:n})=>n?33554432:0]},$$scope:{ctx:l}}}),{c(){A(e.$$.fragment)},m(n,s){R(e,n,s),t=!0},p(n,s){const o={};s&100663552&&(o.$$scope={dirty:s,ctx:n}),e.$set(o)},i(n){t||(O(e.$$.fragment,n),t=!0)},o(n){M(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Zt(l){let e,t=we(l[25]).id+"",n,s,o=l[8].includes(we(l[25]).id)?"remove":"add",i;return{c(){e=H("Source "),n=H(t),s=H(" -- click to "),i=H(o)},m(r,f){k(r,e,f),k(r,n,f),k(r,s,f),k(r,i,f)},p(r,f){f&33554432&&t!==(t=we(r[25]).id+"")&&X(n,t),f&33554688&&o!==(o=r[8].includes(we(r[25]).id)?"remove":"add")&&X(i,o)},d(r){r&&(h(e),h(n),h(s),h(i))}}}function Vt(l){let e,t,n=l[3]!=null&&Qe(l);return{c(){n&&n.c(),e=ye()},m(s,o){n&&n.m(s,o),k(s,e,o),t=!0},p(s,o){s[3]!=null?n?(n.p(s,o),o&8&&O(n,1)):(n=Qe(s),n.c(),O(n,1),n.m(e.parentNode,e)):n&&($(),M(n,1,1,()=>{n=null}),ee())},i(s){t||(O(n),t=!0)},o(s){M(n),t=!1},d(s){s&&h(e),n&&n.d(s)}}}function Xt(l){let e,t,n,s;return e=new $e({props:{manageHoverState:!0,paint:{"line-color":["case",["in",["id"],["literal",l[8]]],"blue","black"],"line-width":8,"line-opacity":Ee(.5,1)},hoverCursor:l[3]==null?void 0:"pointer",$$slots:{default:[Vt]},$$scope:{ctx:l}}}),e.$on("click",l[16]),n=new et({props:{paint:{"text-color":"white","text-halo-color":"grey","text-halo-width":4},layout:{"text-field":["to-string",["id"]],"text-size":16,"symbol-placement":"line",visibility:l[7]?"visible":"none"}}}),{c(){A(e.$$.fragment),t=D(),A(n.$$.fragment)},m(o,i){R(e,o,i),k(o,t,i),R(n,o,i),s=!0},p(o,i){const r={};i&256&&(r.paint={"line-color":["case",["in",["id"],["literal",o[8]]],"blue","black"],"line-width":8,"line-opacity":Ee(.5,1)}),i&8&&(r.hoverCursor=o[3]==null?void 0:"pointer"),i&67109128&&(r.$$scope={dirty:i,ctx:o}),e.$set(r);const f={};i&128&&(f.layout={"text-field":["to-string",["id"]],"text-size":16,"symbol-placement":"line",visibility:o[7]?"visible":"none"}),n.$set(f)},i(o){s||(O(e.$$.fragment,o),O(n.$$.fragment,o),s=!0)},o(o){M(e.$$.fragment,o),M(n.$$.fragment,o),s=!1},d(o){o&&h(t),F(e,o),F(n,o)}}}function Yt(l){let e,t,n,s;return e=new $e({props:{manageHoverState:!0,paint:{"line-width":["case",[">",["length",["get","matching_sources"]],0],8,16],"line-color":["match",["get","reviewed"],"unreviewed","red","not sure","orange","green"],"line-opacity":["case",["==",["id"],l[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,.3]},hoverCursor:"pointer"}}),e.$on("click",l[15]),n=new et({props:{paint:{"text-color":"white","text-halo-color":["match",["get","reviewed"],"unreviewed","red","not sure","orange","green"],"text-halo-width":4},layout:{"text-field":["case",[">",["length",["get","matching_sources"]],0],["to-string",["get","matching_sources"]],"off-road"],"text-size":16,"symbol-placement":"line",visibility:l[7]?"visible":"none"}}}),{c(){A(e.$$.fragment),t=D(),A(n.$$.fragment)},m(o,i){R(e,o,i),k(o,t,i),R(n,o,i),s=!0},p(o,i){const r={};i&8&&(r.paint={"line-width":["case",[">",["length",["get","matching_sources"]],0],8,16],"line-color":["match",["get","reviewed"],"unreviewed","red","not sure","orange","green"],"line-opacity":["case",["==",["id"],o[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,.3]}),e.$set(r);const f={};i&128&&(f.layout={"text-field":["case",[">",["length",["get","matching_sources"]],0],["to-string",["get","matching_sources"]],"off-road"],"text-size":16,"symbol-placement":"line",visibility:o[7]?"visible":"none"}),n.$set(f)},i(o){s||(O(e.$$.fragment,o),O(n.$$.fragment,o),s=!0)},o(o){M(e.$$.fragment,o),M(n.$$.fragment,o),s=!1},d(o){o&&h(t),F(e,o),F(n,o)}}}function xt(l){let e,t,n,s,o,i,r,f,a,m,g,_;e=new wt({props:{map:l[5]}}),n=new vt({props:{map:l[5]}});function z(u){l[17](u)}let G={choice:"Maptiler Dataviz"};l[6]!==void 0&&(G.style=l[6]),o=new yt({props:G}),x.push(()=>oe(o,"style",z));let C=l[2]&&Ke(l);return a=new De({props:{data:l[0],$$slots:{default:[Xt]},$$scope:{ctx:l}}}),g=new De({props:{data:l[1],$$slots:{default:[Yt]},$$scope:{ctx:l}}}),{c(){A(e.$$.fragment),t=D(),A(n.$$.fragment),s=D(),A(o.$$.fragment),r=D(),C&&C.c(),f=D(),A(a.$$.fragment),m=D(),A(g.$$.fragment)},m(u,p){R(e,u,p),k(u,t,p),R(n,u,p),k(u,s,p),R(o,u,p),k(u,r,p),C&&C.m(u,p),k(u,f,p),R(a,u,p),k(u,m,p),R(g,u,p),_=!0},p(u,p){const S={};p&32&&(S.map=u[5]),e.$set(S);const N={};p&32&&(N.map=u[5]),n.$set(N);const P={};!i&&p&64&&(i=!0,P.style=u[6],se(()=>i=!1)),o.$set(P),u[2]?C?(C.p(u,p),p&4&&O(C,1)):(C=Ke(u),C.c(),O(C,1),C.m(f.parentNode,f)):C&&($(),M(C,1,1,()=>{C=null}),ee());const y={};p&1&&(y.data=u[0]),p&67109256&&(y.$$scope={dirty:p,ctx:u}),a.$set(y);const b={};p&2&&(b.data=u[1]),p&67109e3&&(b.$$scope={dirty:p,ctx:u}),g.$set(b)},i(u){_||(O(e.$$.fragment,u),O(n.$$.fragment,u),O(o.$$.fragment,u),O(C),O(a.$$.fragment,u),O(g.$$.fragment,u),_=!0)},o(u){M(e.$$.fragment,u),M(n.$$.fragment,u),M(o.$$.fragment,u),M(C),M(a.$$.fragment,u),M(g.$$.fragment,u),_=!1},d(u){u&&(h(t),h(s),h(r),h(f),h(m)),F(e,u),F(n,u),F(o,u),C&&C.d(u),F(a,u),F(g,u)}}}function $t(l){let e,t,n,s;function o(r){l[19](r)}let i={style:l[6],hash:!0,$$slots:{default:[xt]},$$scope:{ctx:l}};return l[5]!==void 0&&(i.map=l[5]),t=new pt({props:i}),x.push(()=>oe(t,"map",o)),t.$on("error",l[20]),{c(){e=L("div"),A(t.$$.fragment),I(e,"slot","main"),J(e,"position","relative"),J(e,"width","100%"),J(e,"height","100vh")},m(r,f){k(r,e,f),R(t,e,null),s=!0},p(r,f){const a={};f&64&&(a.style=r[6]),f&67109375&&(a.$$scope={dirty:f,ctx:r}),!n&&f&32&&(n=!0,a.map=r[5],se(()=>n=!1)),t.$set(a)},i(r){s||(O(t.$$.fragment,r),s=!0)},o(r){M(t.$$.fragment,r),s=!1},d(r){r&&h(e),F(t)}}}function en(l){let e,t,n,s;return e=new gt({props:{$$slots:{main:[$t],left:[qt]},$$scope:{ctx:l}}}),{c(){A(e.$$.fragment)},m(o,i){R(e,o,i),t=!0,n||(s=q(At,"keydown",l[12]),n=!0)},p(o,[i]){const r={};i&67109375&&(r.$$scope={dirty:i,ctx:o}),e.$set(r)},i(o){t||(O(e.$$.fragment,o),t=!0)},o(o){M(e.$$.fragment,o),t=!1},d(o){F(e,o),n=!1,s()}}}function tn(l,e,t){let n,s,o,i=bt["Maptiler Dataviz"],r=ke(),f=ke(),a=!1,m=!1,g=null;Ze(async()=>{await Ct();try{let c=window.localStorage.getItem(ve);if(c){let Q=JSON.parse(c);t(0,[r,f]=Q,r,t(1,f)),t(2,a=!0),console.log(`Restored data from local storage ${ve}`)}}catch(c){console.log(`Couldn't restore data from local storage: ${c}`)}});function _(){let c={type:"FeatureCollection",features:[...r.features,...f.features]};o==null||o.fitBounds(He(c),{animate:!1,padding:10})}function z(c){if(g==null)throw new Error("impossible");t(1,f.features[g].properties.reviewed=c,f),t(1,f),t(3,g=null)}function G(){for(let c of f.features)if(c.properties.reviewed=="unreviewed"){o==null||o.fitBounds(He(c),{duration:600,padding:200}),t(3,g=c.id);return}}function C(c){c.target.tagName=="INPUT"||!a||c.key=="n"&&G()}function u(){kt("reviewed_targets.geojson",JSON.stringify(f))}function p(){window.confirm("Do you want to discard this review and start over?")&&(t(0,r=ke()),t(1,f=ke()),t(2,a=!1),t(3,g=null),t(7,m=!1),window.localStorage.removeItem(ve))}function S(c){a&&t(3,g=c.detail.features[0].id)}function N(c){if(!a||g==null)return;let Q=c.detail.features[0].id,U=f.features[g].properties;U.matching_sources.includes(Q)?U.matching_sources=U.matching_sources.filter(re=>re!=Q):U.matching_sources.push(Q),t(1,f)}function P(c){i=c,t(6,i)}const y=()=>t(3,g=null);function b(c){o=c,t(5,o)}const w=c=>{console.log(c.detail.error)};function Z(c){r=c,t(0,r)}function E(c){f=c,t(1,f)}function K(c){a=c,t(2,a)}function W(){m=this.checked,t(7,m)}return l.$$.update=()=>{l.$$.dirty&10&&t(8,n=g==null?[]:f.features[g].properties.matching_sources),l.$$.dirty&2&&t(4,s=f.features.filter(c=>c.properties.reviewed!="unreviewed").length),l.$$.dirty&23&&a&&(console.log(`Autosaving with ${s} reviewed targets`),window.localStorage.setItem(ve,JSON.stringify([r,f])))},[r,f,a,g,s,o,i,m,n,_,z,G,C,u,p,S,N,P,y,b,w,Z,E,K,W]}class nn extends de{constructor(e){super(),_e(this,e,tn,en,ge,{})}}new nn({target:document.getElementById("app")});
