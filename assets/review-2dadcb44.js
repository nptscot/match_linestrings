import{S as me,i as de,s as pe,P as _e,r as h,t as y,w as U,g as S,x as Z,y as k,Q as Ve,R as Qe,T as Xe,U as ue,o as Ae,V as ee,W as Ye,X as xe,j as G,Y as $e,Z as et,$ as tt,a0 as nt,a1 as ot,z as X,n as E,k as H,q as N,a2 as $,B,u as j,v as F,I as W,a3 as Y,J as he,H as lt,A as ne,d as P,e as z,C as oe,h as A,E as st,L as rt,a4 as it,M as ut,D as fe,_ as ft,G as at,F as Le,K as Te,N as Re,O as Ne,a5 as ae}from"./Settings-77c9c1f0.js";const ct=o=>({features:o[0]&16,data:o[0]&16,map:o[0]&4,close:o[0]&1}),De=o=>{var t;return{features:o[4],data:((t=o[4])==null?void 0:t[0])??null,map:o[2],close:o[31]}};function Ee(o){var l;let t,e,n=(((l=o[4])==null?void 0:l.length)||o[3]instanceof ee.Marker)&&Ie(o);return{c(){t=G("div"),n&&n.c()},m(r,i){h(r,t,i),n&&n.m(t,null),o[32](t),e=!0},p(r,i){var s;(s=r[4])!=null&&s.length||r[3]instanceof ee.Marker?n?(n.p(r,i),i[0]&24&&y(n,1)):(n=Ie(r),n.c(),y(n,1),n.m(t,null)):n&&(U(),S(n,1,1,()=>{n=null}),Z())},i(r){e||(y(n),e=!0)},o(r){S(n),e=!1},d(r){r&&k(t),n&&n.d(),o[32](null)}}}function Ie(o){let t;const e=o[30].default,n=$e(e,o,o[29],De);return{c(){n&&n.c()},m(l,r){n&&n.m(l,r),t=!0},p(l,r){n&&n.p&&(!t||r[0]&536870933)&&et(n,e,l,l[29],t?nt(e,l[29],r,ct):tt(l[29]),De)},i(l){t||(y(n,l),t=!0)},o(l){S(n,l),t=!1},d(l){n&&n.d(l)}}}function mt(o){let t,e,n=o[9].default&&Ee(o);return{c(){n&&n.c(),t=_e()},m(l,r){n&&n.m(l,r),h(l,t,r),e=!0},p(l,r){l[9].default?n?(n.p(l,r),r[0]&512&&y(n,1)):(n=Ee(l),n.c(),y(n,1),n.m(t.parentNode,t)):n&&(U(),S(n,1,1,()=>{n=null}),Z())},i(l){e||(y(n),e=!0)},o(l){S(n),e=!1},d(l){l&&k(t),n&&n.d(l)}}}function dt(o,t,e){let n,l,r,i,s,u,{$$slots:c={},$$scope:f}=t;const b=Ve(c);let{closeButton:d=void 0}=t,{closeOnClickOutside:C=!0}=t,{closeOnClickInside:D=!1}=t,{closeOnMove:L=!1}=t,{openOn:p="click"}=t,{openIfTopMost:T=!0}=t,{focusAfterOpen:v=!0}=t,{anchor:w=void 0}=t,{offset:I=void 0}=t,{popupClass:J=void 0}=t,{maxWidth:M=void 0}=t,{lngLat:_=void 0}=t,{html:m=void 0}=t,{open:g=!1}=t;const q=Qe(),{map:le,popupTarget:ke,layerEvent:se,layer:we,eventTopMost:We,markerClickManager:ve}=Xe();ue(o,le,a=>e(2,r=a)),ue(o,ke,a=>e(3,s=a)),ue(o,se,a=>e(28,i=a)),ue(o,we,a=>e(35,u=a));const qe=["click","dblclick","contextmenu"];let O,re=!1,K;function Ke(){if(!O)return;let a=O.getElement();!a||a===K||(K=a,p==="hover"&&(K.style.pointerEvents="none"),K.addEventListener("mouseenter",()=>{e(24,re=!0)},{passive:!0}),K.addEventListener("mouseleave",()=>{e(24,re=!1)},{passive:!0}),K.addEventListener("click",()=>{D&&e(0,g=!1)},{passive:!0}))}Ae(()=>{if(r)return r.on("click",ie),r.on("contextmenu",ie),ve.add(Se),typeof s=="string"&&(r.on("click",s,Q),r.on("dblclick",s,Q),r.on("contextmenu",s,Q),r.on("mousemove",s,Ge),r.on("mouseleave",s,Me),r.on("touchstart",s,Oe),r.on("touchend",s,je)),()=>{r!=null&&r.loaded()&&(O==null||O.remove(),r.off("click",ie),r.off("contextmenu",ie),ve.remove(Se),s instanceof ee.Marker?s.getPopup()===O&&s.setPopup(void 0):typeof s=="string"&&(r.off("click",s,Q),r.off("dblclick",s,Q),r.off("contextmenu",s,Q),r.off("mousemove",s,Ge),r.off("mouseleave",s,Me),r.off("touchstart",s,Oe),r.off("touchend",s,je)))}});function ye(a){return T?!("marker"in a)&&!ot(a)&&We(a)!==u:!1}let V=null,R="normal";function Ce(a){"layerType"in a&&a.layerType==="deckgl"?(e(10,_=a.coordinate),e(4,V=a.object?[a.object]:null)):(e(10,_=a.lngLat),e(4,V=a.features??[]))}function Q(a){a.type!==p||ye(a)||(Ce(a),setTimeout(()=>e(0,g=!0)))}let x=null;function Oe(a){x=a.point}function je(a){if(!x||p!=="hover")return;let ge=x.dist(a.point);x=null,ge<3&&(e(10,_=a.lngLat),e(4,V=a.features??[]),O.isOpen()?e(25,R="justOpened"):(e(25,R="opening"),e(0,g=!0)))}function Me(a){p!=="hover"||x||R!=="normal"||(e(0,g=!1),e(4,V=null))}function Ge(a){if(!(p!=="hover"||x||R!=="normal")){if(ye(a)){e(0,g=!1),e(4,V=null);return}e(0,g=!0),e(4,V=a.features??[]),e(10,_=a.lngLat)}}function ie(a){if(R==="justOpened"){e(25,R="normal");return}if(!C)return;let ge=[K,s instanceof ee.Marker?s==null?void 0:s.getElement():null];g&&O.isOpen()&&!ge.some(be=>be==null?void 0:be.contains(a.originalEvent.target))&&(a.type==="contextmenu"&&p==="contextmenu"||a.type!=="contextmenu")&&e(0,g=!1)}function Se(a){C&&g&&O.isOpen()&&a.marker!==s&&e(0,g=!1)}Ye(()=>{r&&(O!=null&&O.isOpen())&&O.remove()});let te;const Ue=()=>e(0,g=!1);function Ze(a){X[a?"unshift":"push"](()=>{te=a,e(1,te)})}return o.$$set=a=>{"closeButton"in a&&e(11,d=a.closeButton),"closeOnClickOutside"in a&&e(12,C=a.closeOnClickOutside),"closeOnClickInside"in a&&e(13,D=a.closeOnClickInside),"closeOnMove"in a&&e(14,L=a.closeOnMove),"openOn"in a&&e(15,p=a.openOn),"openIfTopMost"in a&&e(16,T=a.openIfTopMost),"focusAfterOpen"in a&&e(17,v=a.focusAfterOpen),"anchor"in a&&e(18,w=a.anchor),"offset"in a&&e(19,I=a.offset),"popupClass"in a&&e(20,J=a.popupClass),"maxWidth"in a&&e(21,M=a.maxWidth),"lngLat"in a&&e(10,_=a.lngLat),"html"in a&&e(22,m=a.html),"open"in a&&e(0,g=a.open),"$$scope"in a&&e(29,f=a.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&14336&&e(27,n=d??(!C&&!D)),o.$$.dirty[0]&146685952&&(O||(e(23,O=new ee.Popup({closeButton:n,closeOnClick:!1,closeOnMove:L,focusAfterOpen:v,maxWidth:M,className:J,anchor:w,offset:I})),K=O.getElement(),O.on("open",()=>{e(0,g=!0),Ke(),q("open",O)}),O.on("close",()=>{e(0,g=!1),q("close",O)}),O.on("hover",()=>{q("hover",O)}))),o.$$.dirty[0]&8421384&&O&&s instanceof ee.Marker&&(p==="click"?s.setPopup(O):s.getPopup()===O&&s.setPopup(void 0)),o.$$.dirty[0]&268468224&&qe.includes(p)&&(i==null?void 0:i.type)===p&&(Q(i),xe(se,i=null,i)),o.$$.dirty[0]&268468224&&e(26,l=p==="hover"&&((i==null?void 0:i.type)==="mousemove"||(i==null?void 0:i.type)==="mouseenter")),o.$$.dirty[0]&352354304&&p==="hover"&&se&&(l&&i&&Ce(i),e(0,g=(l||re)??!1)),o.$$.dirty[0]&12582914&&(te?O.setDOMContent(te):m&&O.setHTML(m)),o.$$.dirty[0]&8389632&&_&&O.setLngLat(_),o.$$.dirty[0]&41943045&&r){let a=O.isOpen();g&&!a?(O.addTo(r),R==="opening"&&e(25,R="justOpened")):!g&&a&&O.remove()}},[g,te,r,s,V,le,ke,se,we,b,_,d,C,D,L,p,T,v,w,I,J,M,m,O,re,R,l,n,i,f,c,Ue,Ze]}class pt extends me{constructor(t){super(),de(this,t,dt,mt,pe,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}let ce="match-linestrings-review";function _t(o){let t,e,n,l,r=JSON.stringify(o[1].features[o[0]].properties.matching_sources)+"",i,s,u,c,f,b,d,C,D,L,p,T;return{c(){t=G("h3"),e=E("Target "),n=E(o[0]),l=E(": "),i=E(r),s=H(),u=G("h6"),u.textContent="Click sources to add or remove",c=H(),f=G("div"),b=G("button"),b.innerHTML=`<kbd>1</kbd>
    - Unreviewed`,d=H(),C=G("button"),C.innerHTML=`<kbd>2</kbd>
    - Not sure`,D=H(),L=G("button"),L.innerHTML=`<kbd>3</kbd>
    - Confirm correct`,N(b,"class","btn btn-danger svelte-1tzb8bs"),$(b,"current",o[3]=="unreviewed"),N(C,"class","btn btn-warning svelte-1tzb8bs"),$(C,"current",o[3]=="not sure"),N(L,"class","btn btn-success svelte-1tzb8bs"),$(L,"current",o[3]=="confirmed"),B(f,"display","flex"),B(f,"justify-content","space-between")},m(v,w){h(v,t,w),j(t,e),j(t,n),j(t,l),j(t,i),h(v,s,w),h(v,u,w),h(v,c,w),h(v,f,w),j(f,b),j(f,d),j(f,C),j(f,D),j(f,L),p||(T=[F(window,"keydown",o[4]),F(b,"click",o[6]),F(C,"click",o[7]),F(L,"click",o[8])],p=!0)},p(v,[w]){w&1&&W(n,v[0]),w&3&&r!==(r=JSON.stringify(v[1].features[v[0]].properties.matching_sources)+"")&&W(i,r),w&8&&$(b,"current",v[3]=="unreviewed"),w&8&&$(C,"current",v[3]=="not sure"),w&8&&$(L,"current",v[3]=="confirmed")},i:Y,o:Y,d(v){v&&(k(t),k(s),k(u),k(c),k(f)),p=!1,he(T)}}}function gt(o,t,e){let n,{clickedTarget:l}=t,{targetGj:r}=t,{onConfirm:i}=t,{onCancel:s}=t;function u(d){d.target.tagName!="INPUT"&&(d.key=="1"?i("unreviewed"):d.key=="2"?i("not sure"):d.key=="3"?i("confirmed"):d.key=="Escape"&&s())}const c=()=>i("unreviewed"),f=()=>i("not sure"),b=()=>i("confirmed");return o.$$set=d=>{"clickedTarget"in d&&e(0,l=d.clickedTarget),"targetGj"in d&&e(1,r=d.targetGj),"onConfirm"in d&&e(2,i=d.onConfirm),"onCancel"in d&&e(5,s=d.onCancel)},o.$$.update=()=>{o.$$.dirty&3&&e(3,n=r.features[l].properties.reviewed)},[l,r,i,n,u,s,c,f,b]}class bt extends me{constructor(t){super(),de(this,t,gt,_t,pe,{clickedTarget:0,targetGj:1,onConfirm:2,onCancel:5})}}function He(o){let t,e,n,l,r=o[0].features.length+"",i,s,u,c=o[1].features.length+"",f,b,d,C=o[1].features.filter(Be).length+"",D,L,p,T,v,w,I,J,M,_=!o[3]&&Je(o);return{c(){t=G("button"),e=E("Swap"),n=H(),l=G("p"),i=E(r),s=E(` sources and
    `),u=G("span"),f=E(c),b=E(" targets"),d=E(`
    , with `),D=E(C),L=E(" matching a source"),p=H(),T=G("button"),T.textContent="Start review",v=H(),_&&_.c(),w=_e(),N(t,"class","btn btn-secondary"),t.disabled=o[3],B(u,"color","red"),N(T,"class","btn btn-primary mb-5")},m(m,g){h(m,t,g),j(t,e),h(m,n,g),h(m,l,g),j(l,i),j(l,s),j(l,u),j(u,f),j(u,b),j(l,d),j(l,D),j(l,L),h(m,p,g),h(m,T,g),h(m,v,g),_&&_.m(m,g),h(m,w,g),I=!0,J||(M=[F(t,"click",o[8]),F(T,"click",o[11])],J=!0)},p(m,g){(!I||g&8)&&(t.disabled=m[3]),(!I||g&1)&&r!==(r=m[0].features.length+"")&&W(i,r),(!I||g&2)&&c!==(c=m[1].features.length+"")&&W(f,c),(!I||g&2)&&C!==(C=m[1].features.filter(Be).length+"")&&W(D,C),m[3]?_&&(U(),S(_,1,1,()=>{_=null}),Z()):_?(_.p(m,g),g&8&&y(_,1)):(_=Je(m),_.c(),y(_,1),_.m(w.parentNode,w))},i(m){I||(y(_),I=!0)},o(m){S(_),I=!1},d(m){m&&(k(t),k(n),k(l),k(p),k(T),k(v),k(w)),_&&_.d(m),J=!1,he(M)}}}function Je(o){let t,e,n;function l(i){o[12](i)}let r={onChange:o[6]};return o[4]!==void 0&&(r.options=o[4]),t=new lt({props:r}),X.push(()=>ne(t,"options",l)),{c(){P(t.$$.fragment)},m(i,s){z(t,i,s),n=!0},p(i,s){const u={};!e&&s&16&&(e=!0,u.options=i[4],oe(()=>e=!1)),t.$set(u)},i(i){n||(y(t.$$.fragment,i),n=!0)},o(i){S(t.$$.fragment,i),n=!1},d(i){A(t,i)}}}function ht(o){let t,e,n,l,r,i,s,u,c=o[0].features.length>0&&He(o);return{c(){t=G("label"),e=E(`Load two .geojson files
  `),n=G("input"),l=H(),c&&c.c(),r=_e(),N(n,"class","form-control"),N(n,"type","file"),n.multiple=!0,N(t,"class","form-label")},m(f,b){h(f,t,b),j(t,e),j(t,n),o[10](n),h(f,l,b),c&&c.m(f,b),h(f,r,b),i=!0,s||(u=F(n,"change",o[7]),s=!0)},p(f,[b]){f[0].features.length>0?c?(c.p(f,b),b&1&&y(c,1)):(c=He(f),c.c(),y(c,1),c.m(r.parentNode,r)):c&&(U(),S(c,1,1,()=>{c=null}),Z())},i(f){i||(y(c),i=!0)},o(f){S(c),i=!1},d(f){f&&(k(t),k(l),k(r)),o[10](null),c&&c.d(f),s=!1,u()}}}function Fe(o){let t=0;for(let e of o.features)e.id=t++,e.properties??(e.properties={});return o}const Be=o=>o.properties.matching_sources.length>0;function kt(o,t,e){let{sourceGj:n}=t,{targetGj:l}=t,{setupDone:r}=t,{zoomFit:i}=t,s=!1,u={buffer_meters:20,angle_diff_threshold:10,length_ratio_threshold:1.1,midpt_dist_threshold:15};function c(){var p;if(!s)try{let T=JSON.parse(st(JSON.stringify(n),JSON.stringify(l),u));for(let[v,w]of l.features.entries())w.properties.matching_sources=T[v].matching_sources,(p=w.properties).reviewed??(p.reviewed="unreviewed");e(1,l)}catch(T){window.alert(`Bug: ${T}`)}}let f;async function b(p){if(!f.files)return;if(f.files.length!=2){window.alert("Select two GeoJSON files");return}try{let v=await f.files[0].text(),w=await f.files[1].text();e(0,n=Fe(JSON.parse(v))),e(1,l=Fe(JSON.parse(w))),"matching_sources"in l.features[0].properties?e(3,s=!0):"matching_sources"in n.features[0].properties&&(e(3,s=!0),e(0,[n,l]=[l,n],n,e(1,l))),i(),c()}catch(v){window.alert(`Bad input file: ${v}`)}}function d(){e(0,[n,l]=[l,n],n,e(1,l)),c()}function C(p){X[p?"unshift":"push"](()=>{f=p,e(5,f)})}const D=()=>e(2,r=!0);function L(p){u=p,e(4,u)}return o.$$set=p=>{"sourceGj"in p&&e(0,n=p.sourceGj),"targetGj"in p&&e(1,l=p.targetGj),"setupDone"in p&&e(2,r=p.setupDone),"zoomFit"in p&&e(9,i=p.zoomFit)},[n,l,r,s,u,f,c,b,d,i,C,D,L]}class wt extends me{constructor(t){super(),de(this,t,kt,ht,pe,{sourceGj:0,targetGj:1,setupDone:2,zoomFit:9})}}const{window:vt}=it;function yt(o){let t,e,n,l,r,i,s,u,c,f,b,d,C,D,L=o[1].features.length+"",p,T,v,w,I,J;return{c(){t=G("div"),e=G("button"),e.textContent="Start over",n=H(),l=G("button"),l.textContent="Zoom to fit",r=H(),i=G("br"),s=H(),u=G("div"),c=G("div"),b=H(),d=G("p"),C=E(o[4]),D=E(" / "),p=E(L),T=E(" targets reviewed"),v=H(),w=G("button"),w.textContent="Download reviews",N(e,"class","btn btn-outline-danger"),N(l,"class","btn btn-outline-secondary"),B(t,"display","flex"),B(t,"justify-content","space-between"),N(c,"class","progress-bar"),B(c,"width",`${100*o[4]/o[1].features.length}%`),N(u,"class","progress"),N(u,"role","progressbar"),N(u,"aria-valuenow",o[4]),N(u,"aria-valuemin","0"),N(u,"aria-valuemax",f=o[1].features.length),N(w,"class","btn btn-outline-success")},m(M,_){h(M,t,_),j(t,e),j(t,n),j(t,l),h(M,r,_),h(M,i,_),h(M,s,_),h(M,u,_),j(u,c),h(M,b,_),h(M,d,_),j(d,C),j(d,D),j(d,p),j(d,T),h(M,v,_),h(M,w,_),I||(J=[F(e,"click",o[12]),F(l,"click",o[7]),F(w,"click",o[11])],I=!0)},p(M,_){_&18&&B(c,"width",`${100*M[4]/M[1].features.length}%`),_&16&&N(u,"aria-valuenow",M[4]),_&2&&f!==(f=M[1].features.length)&&N(u,"aria-valuemax",f),_&16&&W(C,M[4]),_&2&&L!==(L=M[1].features.length+"")&&W(p,L)},i:Y,o:Y,d(M){M&&(k(t),k(r),k(i),k(s),k(u),k(b),k(d),k(v),k(w)),I=!1,he(J)}}}function Ct(o){let t,e,n,l,r;function i(f){o[18](f)}function s(f){o[19](f)}function u(f){o[20](f)}let c={zoomFit:o[7]};return o[0]!==void 0&&(c.sourceGj=o[0]),o[1]!==void 0&&(c.targetGj=o[1]),o[2]!==void 0&&(c.setupDone=o[2]),t=new wt({props:c}),X.push(()=>ne(t,"sourceGj",i)),X.push(()=>ne(t,"targetGj",s)),X.push(()=>ne(t,"setupDone",u)),{c(){P(t.$$.fragment)},m(f,b){z(t,f,b),r=!0},p(f,b){const d={};!e&&b&1&&(e=!0,d.sourceGj=f[0],oe(()=>e=!1)),!n&&b&2&&(n=!0,d.targetGj=f[1],oe(()=>n=!1)),!l&&b&4&&(l=!0,d.setupDone=f[2],oe(()=>l=!1)),t.$set(d)},i(f){r||(y(t.$$.fragment,f),r=!0)},o(f){S(t.$$.fragment,f),r=!1},d(f){A(t,f)}}}function Ot(o){let t,e,n,l,r,i,s,u;const c=[Ct,yt],f=[];function b(d,C){return d[2]?1:0}return i=b(o),s=f[i]=c[i](o),{c(){t=G("div"),e=G("h1"),e.textContent="Manually specify LineString matchings for test cases",n=H(),l=G("div"),l.innerHTML='<a class="icon-link mb-3" href="https://github.com/nptscot/match_linestrings/blob/main/tests/README.md" target="_blank">About <i class="fa-solid fa-arrow-up-right-from-square"></i></a>',r=H(),s.c(),N(t,"slot","left")},m(d,C){h(d,t,C),j(t,e),j(t,n),j(t,l),j(t,r),f[i].m(t,null),u=!0},p(d,C){let D=i;i=b(d),i===D?f[i].p(d,C):(U(),S(f[D],1,1,()=>{f[D]=null}),Z(),s=f[i],s?s.p(d,C):(s=f[i]=c[i](d),s.c()),y(s,1),s.m(t,null))},i(d){u||(y(s),u=!0)},o(d){S(s),u=!1},d(d){d&&k(t),f[i].d()}}}function Pe(o){let t,e,n,l;const r=[Mt,jt],i=[];function s(u,c){return u[3]==null?0:1}return e=s(o),n=i[e]=r[e](o),{c(){t=G("div"),n.c(),N(t,"class","map-panel svelte-hr6p1s")},m(u,c){h(u,t,c),i[e].m(t,null),l=!0},p(u,c){let f=e;e=s(u),e===f?i[e].p(u,c):(U(),S(i[f],1,1,()=>{i[f]=null}),Z(),n=i[e],n?n.p(u,c):(n=i[e]=r[e](u),n.c()),y(n,1),n.m(t,null))},i(u){l||(y(n),l=!0)},o(u){S(n),l=!1},d(u){u&&k(t),i[e].d()}}}function jt(o){let t,e;return t=new bt({props:{clickedTarget:o[3],targetGj:o[1],onConfirm:o[8],onCancel:o[15]}}),{c(){P(t.$$.fragment)},m(n,l){z(t,n,l),e=!0},p(n,l){const r={};l&8&&(r.clickedTarget=n[3]),l&2&&(r.targetGj=n[1]),l&8&&(r.onCancel=n[15]),t.$set(r)},i(n){e||(y(t.$$.fragment,n),e=!0)},o(n){S(t.$$.fragment,n),e=!1},d(n){A(t,n)}}}function Mt(o){let t,e,n;return{c(){t=G("button"),t.innerHTML=`Goto <kbd>n</kbd>
              ext unreviewed`,N(t,"class","btn btn-primary")},m(l,r){h(l,t,r),e||(n=F(t,"click",o[9]),e=!0)},p:Y,i:Y,o:Y,d(l){l&&k(t),e=!1,n()}}}function ze(o){let t,e;return t=new pt({props:{openOn:"hover",$$slots:{default:[Gt,({data:n})=>({21:n}),({data:n})=>n?2097152:0]},$$scope:{ctx:o}}}),{c(){P(t.$$.fragment)},m(n,l){z(t,n,l),e=!0},p(n,l){const r={};l&6291520&&(r.$$scope={dirty:l,ctx:n}),t.$set(r)},i(n){e||(y(t.$$.fragment,n),e=!0)},o(n){S(t.$$.fragment,n),e=!1},d(n){A(t,n)}}}function Gt(o){let t,e=ae(o[21]).id+"",n,l,r=o[6].includes(ae(o[21]).id)?"remove":"add",i;return{c(){t=E("Source "),n=E(e),l=E(" -- click to "),i=E(r)},m(s,u){h(s,t,u),h(s,n,u),h(s,l,u),h(s,i,u)},p(s,u){u&2097152&&e!==(e=ae(s[21]).id+"")&&W(n,e),u&2097216&&r!==(r=s[6].includes(ae(s[21]).id)?"remove":"add")&&W(i,r)},d(s){s&&(k(t),k(n),k(l),k(i))}}}function St(o){let t,e,n=o[3]!=null&&ze(o);return{c(){n&&n.c(),t=_e()},m(l,r){n&&n.m(l,r),h(l,t,r),e=!0},p(l,r){l[3]!=null?n?(n.p(l,r),r&8&&y(n,1)):(n=ze(l),n.c(),y(n,1),n.m(t.parentNode,t)):n&&(U(),S(n,1,1,()=>{n=null}),Z())},i(l){e||(y(n),e=!0)},o(l){S(n),e=!1},d(l){l&&k(t),n&&n.d(l)}}}function Lt(o){let t,e;return t=new Re({props:{manageHoverState:!0,paint:{"line-color":["case",["in",["id"],["literal",o[6]]],"blue","black"],"line-width":8,"line-opacity":Ne(.5,1)},hoverCursor:o[3]==null?void 0:"pointer",$$slots:{default:[St]},$$scope:{ctx:o}}}),t.$on("click",o[14]),{c(){P(t.$$.fragment)},m(n,l){z(t,n,l),e=!0},p(n,l){const r={};l&64&&(r.paint={"line-color":["case",["in",["id"],["literal",n[6]]],"blue","black"],"line-width":8,"line-opacity":Ne(.5,1)}),l&8&&(r.hoverCursor=n[3]==null?void 0:"pointer"),l&4194376&&(r.$$scope={dirty:l,ctx:n}),t.$set(r)},i(n){e||(y(t.$$.fragment,n),e=!0)},o(n){S(t.$$.fragment,n),e=!1},d(n){A(t,n)}}}function Tt(o){let t,e;return t=new Re({props:{manageHoverState:!0,paint:{"line-width":8,"line-color":["match",["get","reviewed"],"unreviewed","red","not sure","orange","green"],"line-opacity":["case",["==",["id"],o[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,[">",["length",["get","matching_sources"]],0],.5,.2]},hoverCursor:"pointer"}}),t.$on("click",o[13]),{c(){P(t.$$.fragment)},m(n,l){z(t,n,l),e=!0},p(n,l){const r={};l&8&&(r.paint={"line-width":8,"line-color":["match",["get","reviewed"],"unreviewed","red","not sure","orange","green"],"line-opacity":["case",["==",["id"],n[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,[">",["length",["get","matching_sources"]],0],.5,.2]}),t.$set(r)},i(n){e||(y(t.$$.fragment,n),e=!0)},o(n){S(t.$$.fragment,n),e=!1},d(n){A(t,n)}}}function Nt(o){let t,e,n,l,r,i=o[2]&&Pe(o);return e=new Te({props:{data:o[0],$$slots:{default:[Lt]},$$scope:{ctx:o}}}),l=new Te({props:{data:o[1],$$slots:{default:[Tt]},$$scope:{ctx:o}}}),{c(){i&&i.c(),t=H(),P(e.$$.fragment),n=H(),P(l.$$.fragment)},m(s,u){i&&i.m(s,u),h(s,t,u),z(e,s,u),h(s,n,u),z(l,s,u),r=!0},p(s,u){s[2]?i?(i.p(s,u),u&4&&y(i,1)):(i=Pe(s),i.c(),y(i,1),i.m(t.parentNode,t)):i&&(U(),S(i,1,1,()=>{i=null}),Z());const c={};u&1&&(c.data=s[0]),u&4194376&&(c.$$scope={dirty:u,ctx:s}),e.$set(c);const f={};u&2&&(f.data=s[1]),u&4194312&&(f.$$scope={dirty:u,ctx:s}),l.$set(f)},i(s){r||(y(i),y(e.$$.fragment,s),y(l.$$.fragment,s),r=!0)},o(s){S(i),S(e.$$.fragment,s),S(l.$$.fragment,s),r=!1},d(s){s&&(k(t),k(n)),i&&i.d(s),A(e,s),A(l,s)}}}function Dt(o){let t,e,n,l;function r(s){o[16](s)}let i={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Nt]},$$scope:{ctx:o}};return o[5]!==void 0&&(i.map=o[5]),e=new ut({props:i}),X.push(()=>ne(e,"map",r)),e.$on("error",o[17]),{c(){t=G("div"),P(e.$$.fragment),N(t,"slot","main"),B(t,"position","relative"),B(t,"width","100%"),B(t,"height","100vh")},m(s,u){h(s,t,u),z(e,t,null),l=!0},p(s,u){const c={};u&4194383&&(c.$$scope={dirty:u,ctx:s}),!n&&u&32&&(n=!0,c.map=s[5],oe(()=>n=!1)),e.$set(c)},i(s){l||(y(e.$$.fragment,s),l=!0)},o(s){S(e.$$.fragment,s),l=!1},d(s){s&&k(t),A(e)}}}function Et(o){let t,e,n,l;return t=new rt({props:{$$slots:{main:[Dt],left:[Ot]},$$scope:{ctx:o}}}),{c(){P(t.$$.fragment)},m(r,i){z(t,r,i),e=!0,n||(l=F(vt,"keydown",o[10]),n=!0)},p(r,[i]){const s={};i&4194431&&(s.$$scope={dirty:i,ctx:r}),t.$set(s)},i(r){e||(y(t.$$.fragment,r),e=!0)},o(r){S(t.$$.fragment,r),e=!1},d(r){A(t,r),n=!1,l()}}}function It(o,t,e){let n,l,r,i=fe(),s=fe(),u=!1,c=null;Ae(async()=>{await ft();try{let m=window.localStorage.getItem(ce);if(m){let g=JSON.parse(m);e(0,[i,s]=g,i,e(1,s)),e(2,u=!0),console.log(`Restored data from local storage ${ce}`)}}catch(m){console.log(`Couldn't restore data from local storage: ${m}`)}});function f(){let m={type:"FeatureCollection",features:[...i.features,...s.features]};r==null||r.fitBounds(Le(m),{animate:!1,padding:10})}function b(m){if(c==null)throw new Error("impossible");e(1,s.features[c].properties.reviewed=m,s),e(1,s),e(3,c=null)}function d(){for(let m of s.features)if(m.properties.reviewed=="unreviewed"){r==null||r.fitBounds(Le(m),{duration:600,padding:200}),e(3,c=m.id);return}}function C(m){m.target.tagName=="INPUT"||!u||m.key=="n"&&d()}function D(){at("reviewed_targets.geojson",JSON.stringify(s))}function L(){window.confirm("Do you want to discard this review and start over?")&&(e(0,i=fe()),e(1,s=fe()),e(2,u=!1),e(3,c=null),window.localStorage.removeItem(ce))}function p(m){u&&e(3,c=m.detail.features[0].id)}function T(m){if(!u||c==null)return;let g=m.detail.features[0].id,q=s.features[c].properties;q.matching_sources.includes(g)?q.matching_sources=q.matching_sources.filter(le=>le!=g):q.matching_sources.push(g),e(1,s)}const v=()=>e(3,c=null);function w(m){r=m,e(5,r)}const I=m=>{console.log(m.detail.error)};function J(m){i=m,e(0,i)}function M(m){s=m,e(1,s)}function _(m){u=m,e(2,u)}return o.$$.update=()=>{o.$$.dirty&10&&e(6,n=c==null?[]:s.features[c].properties.matching_sources),o.$$.dirty&2&&e(4,l=s.features.filter(m=>m.properties.reviewed!="unreviewed").length),o.$$.dirty&23&&u&&(console.log(`Autosaving with ${l} reviewed targets`),window.localStorage.setItem(ce,JSON.stringify([i,s])))},[i,s,u,c,l,r,n,f,b,d,C,D,L,p,T,v,w,I,J,M,_]}class Ht extends me{constructor(t){super(),de(this,t,It,Et,pe,{})}}new Ht({target:document.getElementById("app")});
