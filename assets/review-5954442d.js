import{S as se,i as ie,s as re,P as Fe,Q as Pe,R as ne,T as ze,U as Ae,r as y,t as S,w as x,g as G,x as $,y as v,V as Xe,o as Re,W as Y,X as Ye,j as C,Y as xe,Z as $e,$ as et,a0 as tt,a1 as nt,z as Z,n as D,k as E,q as z,B as W,u as b,a2 as Se,v as H,I as V,a3 as Q,J as _e,a4 as We,H as ot,A as oe,d as B,e as F,C as le,h as P,E as lt,L as st,M as it,D as ae,_ as rt,G as ut,F as Me,K as Ge,N as Ke,O as Le,a5 as Ne}from"./Settings-51e448bf.js";function ft(l,n,e){let t;const s=Fe();let{layer:o=void 0}=n;const{map:f}=Pe();ne(l,f,u=>e(2,t=u));function i(u){s(u.type,{...u,map:f})}const c=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],r=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return ze(()=>{if(t)if(o)for(const u of c)t.off(u,o,i);else for(const u of r)t.off(u,i)}),l.$$set=u=>{"layer"in u&&e(1,o=u.layer)},l.$$.update=()=>{if(l.$$.dirty&6&&t)if(o)for(const u of c)t.on(u,o,i);else for(const u of r)t.on(u,i)},[f,o,t]}class ct extends se{constructor(n){super(),ie(this,n,ft,null,re,{layer:1})}}const at=l=>({features:l[0]&16,data:l[0]&16,map:l[0]&4,close:l[0]&1}),Te=l=>{var n;return{features:l[4],data:((n=l[4])==null?void 0:n[0])??null,map:l[2],close:l[31]}};function Ie(l){var s;let n,e,t=(((s=l[4])==null?void 0:s.length)||l[3]instanceof Y.Marker)&&De(l);return{c(){n=C("div"),t&&t.c()},m(o,f){y(o,n,f),t&&t.m(n,null),l[32](n),e=!0},p(o,f){var i;(i=o[4])!=null&&i.length||o[3]instanceof Y.Marker?t?(t.p(o,f),f[0]&24&&S(t,1)):(t=De(o),t.c(),S(t,1),t.m(n,null)):t&&(x(),G(t,1,1,()=>{t=null}),$())},i(o){e||(S(t),e=!0)},o(o){G(t),e=!1},d(o){o&&v(n),t&&t.d(),l[32](null)}}}function De(l){let n;const e=l[30].default,t=xe(e,l,l[29],Te);return{c(){t&&t.c()},m(s,o){t&&t.m(s,o),n=!0},p(s,o){t&&t.p&&(!n||o[0]&536870933)&&$e(t,e,s,s[29],n?tt(e,s[29],o,at):et(s[29]),Te)},i(s){n||(S(t,s),n=!0)},o(s){G(t,s),n=!1},d(s){t&&t.d(s)}}}function mt(l){let n,e,t=l[9].default&&Ie(l);return{c(){t&&t.c(),n=Ae()},m(s,o){t&&t.m(s,o),y(s,n,o),e=!0},p(s,o){s[9].default?t?(t.p(s,o),o[0]&512&&S(t,1)):(t=Ie(s),t.c(),S(t,1),t.m(n.parentNode,n)):t&&(x(),G(t,1,1,()=>{t=null}),$())},i(s){e||(S(t),e=!0)},o(s){G(t),e=!1},d(s){s&&v(n),t&&t.d(s)}}}function dt(l,n,e){let t,s,o,f,i,c,{$$slots:r={},$$scope:u}=n;const d=Xe(r);let{closeButton:h=void 0}=n,{closeOnClickOutside:L=!0}=n,{closeOnClickInside:M=!1}=n,{closeOnMove:m=!1}=n,{openOn:g="click"}=n,{openIfTopMost:N=!0}=n,{focusAfterOpen:j=!0}=n,{anchor:T=void 0}=n,{offset:I=void 0}=n,{popupClass:k=void 0}=n,{maxWidth:O=void 0}=n,{lngLat:p=void 0}=n,{html:A=void 0}=n,{open:_=!1}=n;const J=Fe(),{map:ee,popupTarget:ge,layerEvent:ue,layer:he,eventTopMost:Ue,markerClickManager:ke}=Pe();ne(l,ee,a=>e(2,o=a)),ne(l,ge,a=>e(3,i=a)),ne(l,ue,a=>e(28,f=a)),ne(l,he,a=>e(35,c=a));const qe=["click","dblclick","contextmenu"];let w,fe=!1,K;function Ze(){if(!w)return;let a=w.getElement();!a||a===K||(K=a,g==="hover"&&(K.style.pointerEvents="none"),K.addEventListener("mouseenter",()=>{e(24,fe=!0)},{passive:!0}),K.addEventListener("mouseleave",()=>{e(24,fe=!1)},{passive:!0}),K.addEventListener("click",()=>{M&&e(0,_=!1)},{passive:!0}))}Re(()=>{if(o)return o.on("click",ce),o.on("contextmenu",ce),ke.add(Ce),typeof i=="string"&&(o.on("click",i,q),o.on("dblclick",i,q),o.on("contextmenu",i,q),o.on("mousemove",i,je),o.on("mouseleave",i,Oe),o.on("touchstart",i,ye),o.on("touchend",i,ve)),()=>{o!=null&&o.loaded()&&(w==null||w.remove(),o.off("click",ce),o.off("contextmenu",ce),ke.remove(Ce),i instanceof Y.Marker?i.getPopup()===w&&i.setPopup(void 0):typeof i=="string"&&(o.off("click",i,q),o.off("dblclick",i,q),o.off("contextmenu",i,q),o.off("mousemove",i,je),o.off("mouseleave",i,Oe),o.off("touchstart",i,ye),o.off("touchend",i,ve)))}});function be(a){return N?!("marker"in a)&&!nt(a)&&Ue(a)!==c:!1}let U=null,R="normal";function we(a){"layerType"in a&&a.layerType==="deckgl"?(e(10,p=a.coordinate),e(4,U=a.object?[a.object]:null)):(e(10,p=a.lngLat),e(4,U=a.features??[]))}function q(a){a.type!==g||be(a)||(we(a),setTimeout(()=>e(0,_=!0)))}let X=null;function ye(a){X=a.point}function ve(a){if(!X||g!=="hover")return;let me=X.dist(a.point);X=null,me<3&&(e(10,p=a.lngLat),e(4,U=a.features??[]),w.isOpen()?e(25,R="justOpened"):(e(25,R="opening"),e(0,_=!0)))}function Oe(a){g!=="hover"||X||R!=="normal"||(e(0,_=!1),e(4,U=null))}function je(a){if(!(g!=="hover"||X||R!=="normal")){if(be(a)){e(0,_=!1),e(4,U=null);return}e(0,_=!0),e(4,U=a.features??[]),e(10,p=a.lngLat)}}function ce(a){if(R==="justOpened"){e(25,R="normal");return}if(!L)return;let me=[K,i instanceof Y.Marker?i==null?void 0:i.getElement():null];_&&w.isOpen()&&!me.some(de=>de==null?void 0:de.contains(a.originalEvent.target))&&(a.type==="contextmenu"&&g==="contextmenu"||a.type!=="contextmenu")&&e(0,_=!1)}function Ce(a){L&&_&&w.isOpen()&&a.marker!==i&&e(0,_=!1)}ze(()=>{o&&(w!=null&&w.isOpen())&&w.remove()});let te;const Ve=()=>e(0,_=!1);function Qe(a){Z[a?"unshift":"push"](()=>{te=a,e(1,te)})}return l.$$set=a=>{"closeButton"in a&&e(11,h=a.closeButton),"closeOnClickOutside"in a&&e(12,L=a.closeOnClickOutside),"closeOnClickInside"in a&&e(13,M=a.closeOnClickInside),"closeOnMove"in a&&e(14,m=a.closeOnMove),"openOn"in a&&e(15,g=a.openOn),"openIfTopMost"in a&&e(16,N=a.openIfTopMost),"focusAfterOpen"in a&&e(17,j=a.focusAfterOpen),"anchor"in a&&e(18,T=a.anchor),"offset"in a&&e(19,I=a.offset),"popupClass"in a&&e(20,k=a.popupClass),"maxWidth"in a&&e(21,O=a.maxWidth),"lngLat"in a&&e(10,p=a.lngLat),"html"in a&&e(22,A=a.html),"open"in a&&e(0,_=a.open),"$$scope"in a&&e(29,u=a.$$scope)},l.$$.update=()=>{if(l.$$.dirty[0]&14336&&e(27,t=h??(!L&&!M)),l.$$.dirty[0]&146685952&&(w||(e(23,w=new Y.Popup({closeButton:t,closeOnClick:!1,closeOnMove:m,focusAfterOpen:j,maxWidth:O,className:k,anchor:T,offset:I})),K=w.getElement(),w.on("open",()=>{e(0,_=!0),Ze(),J("open",w)}),w.on("close",()=>{e(0,_=!1),J("close",w)}),w.on("hover",()=>{J("hover",w)}))),l.$$.dirty[0]&8421384&&w&&i instanceof Y.Marker&&(g==="click"?i.setPopup(w):i.getPopup()===w&&i.setPopup(void 0)),l.$$.dirty[0]&268468224&&qe.includes(g)&&(f==null?void 0:f.type)===g&&(q(f),Ye(ue,f=null,f)),l.$$.dirty[0]&268468224&&e(26,s=g==="hover"&&((f==null?void 0:f.type)==="mousemove"||(f==null?void 0:f.type)==="mouseenter")),l.$$.dirty[0]&352354304&&g==="hover"&&ue&&(s&&f&&we(f),e(0,_=(s||fe)??!1)),l.$$.dirty[0]&12582914&&(te?w.setDOMContent(te):A&&w.setHTML(A)),l.$$.dirty[0]&8389632&&p&&w.setLngLat(p),l.$$.dirty[0]&41943045&&o){let a=w.isOpen();_&&!a?(w.addTo(o),R==="opening"&&e(25,R="justOpened")):!_&&a&&w.remove()}},[_,te,o,i,U,ee,ge,ue,he,d,p,h,L,M,m,g,N,j,T,I,k,O,A,w,fe,R,s,t,f,u,r,Ve,Qe]}class pt extends se{constructor(n){super(),ie(this,n,dt,mt,re,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}let pe="match-linestrings-review";const{window:_t}=We;function gt(l){let n,e,t,s,o,f,i,c,r,u,d,h,L,M,m,g,N,j,T,I;return{c(){n=C("h3"),e=D("Target "),t=D(l[0]),s=D(": "),o=D(l[3]),f=E(),i=C("div"),c=C("button"),c.innerHTML=`<kbd>1</kbd>
    - Unreviewed`,r=E(),u=C("button"),u.innerHTML=`<kbd>2</kbd>
    - Not sure`,d=E(),h=C("button"),h.innerHTML=`<kbd>3</kbd>
    - No matches`,L=E(),M=C("div"),m=C("div"),g=C("button"),g.innerHTML=`<kbd>4</kbd>
        - These sources`,N=E(),j=C("input"),z(j,"type","text"),W(j,"width","50%"),W(i,"display","flex"),W(i,"justify-content","space-between")},m(k,O){y(k,n,O),b(n,e),b(n,t),b(n,s),b(n,o),y(k,f,O),y(k,i,O),b(i,c),b(i,r),b(i,u),b(i,d),b(i,h),b(i,L),b(i,M),b(M,m),b(m,g),b(M,N),b(M,j),Se(j,l[2]),T||(I=[H(_t,"keydown",l[5]),H(c,"click",l[8]),H(u,"click",l[9]),H(h,"click",l[10]),H(g,"click",l[4]),H(j,"input",l[11])],T=!0)},p(k,[O]){O&1&&V(t,k[0]),O&4&&j.value!==k[2]&&Se(j,k[2])},i:Q,o:Q,d(k){k&&(v(n),v(f),v(i)),T=!1,_e(I)}}}function ht(l,n,e){let{clickedTarget:t}=n,{targetGj:s}=n,{matchingSourceIndices:o}=n,{onConfirm:f}=n,i=s.features[t].properties.reviewed,c=Array.isArray(i)?JSON.stringify(i):JSON.stringify(o);function r(){try{let m=JSON.parse(c);if(!Array.isArray(m))throw new Error("Not an array");f(m)}catch{window.alert("Not a list of source IDs")}}function u(m){m.target.tagName!="INPUT"&&(m.key=="1"?f("unreviewed"):m.key=="2"?f("not sure"):m.key=="3"?f([]):m.key=="4"&&r())}const d=()=>f("unreviewed"),h=()=>f("not sure"),L=()=>f([]);function M(){c=this.value,e(2,c)}return l.$$set=m=>{"clickedTarget"in m&&e(0,t=m.clickedTarget),"targetGj"in m&&e(6,s=m.targetGj),"matchingSourceIndices"in m&&e(7,o=m.matchingSourceIndices),"onConfirm"in m&&e(1,f=m.onConfirm)},[t,f,c,i,r,u,s,o,d,h,L,M]}class kt extends se{constructor(n){super(),ie(this,n,ht,gt,re,{clickedTarget:0,targetGj:6,matchingSourceIndices:7,onConfirm:1})}}function Ee(l){let n,e,t,s=l[0].features.length+"",o,f,i,c=l[1].features.length+"",r,u,d,h=l[1].features.filter(He).length+"",L,M,m,g,N,j,T,I,k,O;function p(_){l[10](_)}let A={onChange:l[5]};return l[3]!==void 0&&(A.options=l[3]),g=new ot({props:A}),Z.push(()=>oe(g,"options",p)),{c(){n=C("button"),n.textContent="Swap",e=E(),t=C("p"),o=D(s),f=D(` sources and
    `),i=C("span"),r=D(c),u=D(" targets"),d=D(`
    , with `),L=D(h),M=D(" matching a source"),m=E(),B(g.$$.fragment),j=E(),T=C("button"),T.textContent="Start review",z(n,"class","secondary"),W(i,"color","red")},m(_,J){y(_,n,J),y(_,e,J),y(_,t,J),b(t,o),b(t,f),b(t,i),b(i,r),b(i,u),b(t,d),b(t,L),b(t,M),y(_,m,J),F(g,_,J),y(_,j,J),y(_,T,J),I=!0,k||(O=[H(n,"click",l[7]),H(T,"click",l[11])],k=!0)},p(_,J){(!I||J&1)&&s!==(s=_[0].features.length+"")&&V(o,s),(!I||J&2)&&c!==(c=_[1].features.length+"")&&V(r,c),(!I||J&2)&&h!==(h=_[1].features.filter(He).length+"")&&V(L,h);const ee={};!N&&J&8&&(N=!0,ee.options=_[3],le(()=>N=!1)),g.$set(ee)},i(_){I||(S(g.$$.fragment,_),I=!0)},o(_){G(g.$$.fragment,_),I=!1},d(_){_&&(v(n),v(e),v(t),v(m),v(j),v(T)),P(g,_),k=!1,_e(O)}}}function bt(l){let n,e,t,s,o,f,i,c,r=l[0].features.length>0&&Ee(l);return{c(){n=C("label"),e=D(`Load two .geojson files
  `),t=C("input"),s=E(),r&&r.c(),o=Ae(),z(t,"type","file"),t.multiple=!0},m(u,d){y(u,n,d),b(n,e),b(n,t),l[9](t),y(u,s,d),r&&r.m(u,d),y(u,o,d),f=!0,i||(c=H(t,"change",l[6]),i=!0)},p(u,[d]){u[0].features.length>0?r?(r.p(u,d),d&1&&S(r,1)):(r=Ee(u),r.c(),S(r,1),r.m(o.parentNode,o)):r&&(x(),G(r,1,1,()=>{r=null}),$())},i(u){f||(S(r),f=!0)},o(u){G(r),f=!1},d(u){u&&(v(n),v(s),v(o)),l[9](null),r&&r.d(u),i=!1,c()}}}function Je(l){let n=0;for(let e of l.features)e.id=n++,e.properties??(e.properties={});return l}const He=l=>l.properties.matching_sources.length>0;function wt(l,n,e){let{sourceGj:t}=n,{targetGj:s}=n,{setupDone:o}=n,{zoomFit:f}=n,i={buffer_meters:20,angle_diff_threshold:10,length_ratio_threshold:1.1,midpt_dist_threshold:15};function c(){var m;try{let g=JSON.parse(lt(JSON.stringify(t),JSON.stringify(s),i));for(let[N,j]of s.features.entries())j.properties.matching_sources=g[N].matching_sources,(m=j.properties).reviewed??(m.reviewed="unreviewed");e(1,s)}catch(g){window.alert(`Bug: ${g}`)}}let r;async function u(m){if(!r.files)return;if(r.files.length!=2){window.alert("Select two GeoJSON files");return}try{let N=await r.files[0].text(),j=await r.files[1].text();e(0,t=Je(JSON.parse(N))),e(1,s=Je(JSON.parse(j))),f(),c()}catch(N){window.alert(`Bad input file: ${N}`)}}function d(){e(0,[t,s]=[s,t],t,e(1,s)),c()}function h(m){Z[m?"unshift":"push"](()=>{r=m,e(4,r)})}function L(m){i=m,e(3,i)}const M=()=>e(2,o=!0);return l.$$set=m=>{"sourceGj"in m&&e(0,t=m.sourceGj),"targetGj"in m&&e(1,s=m.targetGj),"setupDone"in m&&e(2,o=m.setupDone),"zoomFit"in m&&e(8,f=m.zoomFit)},[t,s,o,i,r,c,u,d,f,h,L,M]}class yt extends se{constructor(n){super(),ie(this,n,wt,bt,re,{sourceGj:0,targetGj:1,setupDone:2,zoomFit:8})}}const{window:vt}=We;function Ot(l){let n,e,t,s,o,f,i,c,r,u,d,h,L,M=l[1].features.length+"",m,g,N,j,T,I;return{c(){n=C("div"),e=C("button"),e.textContent="Start over",t=E(),s=C("button"),s.textContent="Zoom to fit",o=E(),f=C("br"),i=E(),c=C("progress"),u=E(),d=C("p"),h=D(l[4]),L=D(" / "),m=D(M),g=D(" targets reviewed"),N=E(),j=C("button"),j.textContent="Download reviews",z(e,"class","secondary"),z(s,"class","secondary"),W(n,"display","flex"),W(n,"justify-content","space-between"),c.value=l[4],z(c,"max",r=l[1].features.length)},m(k,O){y(k,n,O),b(n,e),b(n,t),b(n,s),y(k,o,O),y(k,f,O),y(k,i,O),y(k,c,O),y(k,u,O),y(k,d,O),b(d,h),b(d,L),b(d,m),b(d,g),y(k,N,O),y(k,j,O),T||(I=[H(e,"click",l[13]),H(s,"click",l[7]),H(j,"click",l[12])],T=!0)},p(k,O){O&16&&(c.value=k[4]),O&2&&r!==(r=k[1].features.length)&&z(c,"max",r),O&16&&V(h,k[4]),O&2&&M!==(M=k[1].features.length+"")&&V(m,M)},i:Q,o:Q,d(k){k&&(v(n),v(o),v(f),v(i),v(c),v(u),v(d),v(N),v(j)),T=!1,_e(I)}}}function jt(l){let n,e,t,s,o;function f(u){l[17](u)}function i(u){l[18](u)}function c(u){l[19](u)}let r={zoomFit:l[7]};return l[0]!==void 0&&(r.sourceGj=l[0]),l[1]!==void 0&&(r.targetGj=l[1]),l[2]!==void 0&&(r.setupDone=l[2]),n=new yt({props:r}),Z.push(()=>oe(n,"sourceGj",f)),Z.push(()=>oe(n,"targetGj",i)),Z.push(()=>oe(n,"setupDone",c)),{c(){B(n.$$.fragment)},m(u,d){F(n,u,d),o=!0},p(u,d){const h={};!e&&d&1&&(e=!0,h.sourceGj=u[0],le(()=>e=!1)),!t&&d&2&&(t=!0,h.targetGj=u[1],le(()=>t=!1)),!s&&d&4&&(s=!0,h.setupDone=u[2],le(()=>s=!1)),n.$set(h)},i(u){o||(S(n.$$.fragment,u),o=!0)},o(u){G(n.$$.fragment,u),o=!1},d(u){P(n,u)}}}function Ct(l){let n,e,t,s,o,f;const i=[jt,Ot],c=[];function r(u,d){return u[2]?1:0}return s=r(l),o=c[s]=i[s](l),{c(){n=C("div"),e=C("h1"),e.textContent="Match LineStrings - review results to make test cases",t=E(),o.c(),z(n,"slot","left")},m(u,d){y(u,n,d),b(n,e),b(n,t),c[s].m(n,null),f=!0},p(u,d){let h=s;s=r(u),s===h?c[s].p(u,d):(x(),G(c[h],1,1,()=>{c[h]=null}),$(),o=c[s],o?o.p(u,d):(o=c[s]=i[s](u),o.c()),S(o,1),o.m(n,null))},i(u){f||(S(o),f=!0)},o(u){G(o),f=!1},d(u){u&&v(n),c[s].d()}}}function Be(l){let n,e,t,s;const o=[Mt,St],f=[];function i(c,r){return c[3]==null?0:1}return e=i(l),t=f[e]=o[e](l),{c(){n=C("div"),t.c(),z(n,"class","map-panel svelte-1lu903l")},m(c,r){y(c,n,r),f[e].m(n,null),s=!0},p(c,r){let u=e;e=i(c),e===u?f[e].p(c,r):(x(),G(f[u],1,1,()=>{f[u]=null}),$(),t=f[e],t?t.p(c,r):(t=f[e]=o[e](c),t.c()),S(t,1),t.m(n,null))},i(c){s||(S(t),s=!0)},o(c){G(t),s=!1},d(c){c&&v(n),f[e].d()}}}function St(l){let n,e;return n=new kt({props:{clickedTarget:l[3],targetGj:l[1],matchingSourceIndices:l[6],onConfirm:l[8]}}),{c(){B(n.$$.fragment)},m(t,s){F(n,t,s),e=!0},p(t,s){const o={};s&8&&(o.clickedTarget=t[3]),s&2&&(o.targetGj=t[1]),s&64&&(o.matchingSourceIndices=t[6]),n.$set(o)},i(t){e||(S(n.$$.fragment,t),e=!0)},o(t){G(n.$$.fragment,t),e=!1},d(t){P(n,t)}}}function Mt(l){let n,e,t;return{c(){n=C("button"),n.innerHTML=`Goto <kbd>n</kbd>
              ext unreviewed`},m(s,o){y(s,n,o),e||(t=H(n,"click",l[10]),e=!0)},p:Q,i:Q,o:Q,d(s){s&&v(n),e=!1,t()}}}function Gt(l){let n,e=Ne(l[20]).id+"",t;return{c(){n=D("Source "),t=D(e)},m(s,o){y(s,n,o),y(s,t,o)},p(s,o){o&1048576&&e!==(e=Ne(s[20]).id+"")&&V(t,e)},d(s){s&&(v(n),v(t))}}}function Lt(l){let n,e;return n=new pt({props:{openOn:"hover",$$slots:{default:[Gt,({data:t})=>({20:t}),({data:t})=>t?1048576:0]},$$scope:{ctx:l}}}),{c(){B(n.$$.fragment)},m(t,s){F(n,t,s),e=!0},p(t,s){const o={};s&3145728&&(o.$$scope={dirty:s,ctx:t}),n.$set(o)},i(t){e||(S(n.$$.fragment,t),e=!0)},o(t){G(n.$$.fragment,t),e=!1},d(t){P(n,t)}}}function Nt(l){let n,e;return n=new Ke({props:{manageHoverState:!0,paint:{"line-width":["case",["in",["id"],["literal",l[6]]],8,5],"line-color":"black","line-opacity":Le(.5,1)},$$slots:{default:[Lt]},$$scope:{ctx:l}}}),{c(){B(n.$$.fragment)},m(t,s){F(n,t,s),e=!0},p(t,s){const o={};s&64&&(o.paint={"line-width":["case",["in",["id"],["literal",t[6]]],8,5],"line-color":"black","line-opacity":Le(.5,1)}),s&2097152&&(o.$$scope={dirty:s,ctx:t}),n.$set(o)},i(t){e||(S(n.$$.fragment,t),e=!0)},o(t){G(n.$$.fragment,t),e=!1},d(t){P(n,t)}}}function Tt(l){let n,e;return n=new Ke({props:{manageHoverState:!0,paint:{"line-width":8,"line-color":["match",["get","reviewed"],"unreviewed","red","blue"],"line-opacity":["case",["==",["id"],l[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,[">",["length",["get","matching_sources"]],0],.5,.2]},hoverCursor:"pointer"}}),n.$on("click",l[14]),{c(){B(n.$$.fragment)},m(t,s){F(n,t,s),e=!0},p(t,s){const o={};s&8&&(o.paint={"line-width":8,"line-color":["match",["get","reviewed"],"unreviewed","red","blue"],"line-opacity":["case",["==",["id"],t[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,[">",["length",["get","matching_sources"]],0],.5,.2]}),n.$set(o)},i(t){e||(S(n.$$.fragment,t),e=!0)},o(t){G(n.$$.fragment,t),e=!1},d(t){P(n,t)}}}function It(l){let n,e,t,s,o,f,i;n=new ct({}),n.$on("click",l[9]);let c=l[2]&&Be(l);return s=new Ge({props:{data:l[0],$$slots:{default:[Nt]},$$scope:{ctx:l}}}),f=new Ge({props:{data:l[1],$$slots:{default:[Tt]},$$scope:{ctx:l}}}),{c(){B(n.$$.fragment),e=E(),c&&c.c(),t=E(),B(s.$$.fragment),o=E(),B(f.$$.fragment)},m(r,u){F(n,r,u),y(r,e,u),c&&c.m(r,u),y(r,t,u),F(s,r,u),y(r,o,u),F(f,r,u),i=!0},p(r,u){r[2]?c?(c.p(r,u),u&4&&S(c,1)):(c=Be(r),c.c(),S(c,1),c.m(t.parentNode,t)):c&&(x(),G(c,1,1,()=>{c=null}),$());const d={};u&1&&(d.data=r[0]),u&2097216&&(d.$$scope={dirty:u,ctx:r}),s.$set(d);const h={};u&2&&(h.data=r[1]),u&2097160&&(h.$$scope={dirty:u,ctx:r}),f.$set(h)},i(r){i||(S(n.$$.fragment,r),S(c),S(s.$$.fragment,r),S(f.$$.fragment,r),i=!0)},o(r){G(n.$$.fragment,r),G(c),G(s.$$.fragment,r),G(f.$$.fragment,r),i=!1},d(r){r&&(v(e),v(t),v(o)),P(n,r),c&&c.d(r),P(s,r),P(f,r)}}}function Dt(l){let n,e,t,s;function o(i){l[15](i)}let f={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[It]},$$scope:{ctx:l}};return l[5]!==void 0&&(f.map=l[5]),e=new it({props:f}),Z.push(()=>oe(e,"map",o)),e.$on("error",l[16]),{c(){n=C("div"),B(e.$$.fragment),z(n,"slot","main"),W(n,"position","relative"),W(n,"width","100%"),W(n,"height","100vh")},m(i,c){y(i,n,c),F(e,n,null),s=!0},p(i,c){const r={};c&2097231&&(r.$$scope={dirty:c,ctx:i}),!t&&c&32&&(t=!0,r.map=i[5],le(()=>t=!1)),e.$set(r)},i(i){s||(S(e.$$.fragment,i),s=!0)},o(i){G(e.$$.fragment,i),s=!1},d(i){i&&v(n),P(e)}}}function Et(l){let n,e,t,s;return n=new st({props:{$$slots:{main:[Dt],left:[Ct]},$$scope:{ctx:l}}}),{c(){B(n.$$.fragment)},m(o,f){F(n,o,f),e=!0,t||(s=H(vt,"keydown",l[11]),t=!0)},p(o,[f]){const i={};f&2097279&&(i.$$scope={dirty:f,ctx:o}),n.$set(i)},i(o){e||(S(n.$$.fragment,o),e=!0)},o(o){G(n.$$.fragment,o),e=!1},d(o){P(n,o),t=!1,s()}}}function Jt(l,n,e){let t,s,o,f=ae(),i=ae(),c=!1,r=null;Re(async()=>{await rt();try{let p=window.localStorage.getItem(pe);if(p){let A=JSON.parse(p);e(0,[f,i]=A,f,e(1,i)),e(2,c=!0),console.log(`Restored data from local storage ${pe}`)}}catch(p){console.log(`Couldn't restore data from local storage: ${p}`)}});function u(){let p={type:"FeatureCollection",features:[...f.features,...i.features]};o==null||o.fitBounds(Me(p),{animate:!1,padding:10})}function d(p){if(r==null)throw new Error("impossible");e(1,i.features[r].properties.reviewed=p,i),e(1,i),e(3,r=null)}function h(p){e(3,r=null)}function L(){for(let p of i.features)if(p.properties.reviewed=="unreviewed"){o==null||o.fitBounds(Me(p),{duration:600,padding:200}),e(3,r=p.id);return}}function M(p){p.target.tagName=="INPUT"||!c||p.key=="n"&&L()}function m(){ut("reviewed_targets.geojson",JSON.stringify(i))}function g(){window.confirm("Do you want to discard this review and start over?")&&(e(0,f=ae()),e(1,i=ae()),e(2,c=!1),e(3,r=null))}function N(p){c&&e(3,r=p.detail.features[0].id)}function j(p){o=p,e(5,o)}const T=p=>{console.log(p.detail.error)};function I(p){f=p,e(0,f)}function k(p){i=p,e(1,i)}function O(p){c=p,e(2,c)}return l.$$.update=()=>{l.$$.dirty&10&&e(6,t=r==null?[]:i.features[r].properties.matching_sources),l.$$.dirty&2&&e(4,s=i.features.filter(p=>p.properties.reviewed!="unreviewed").length),l.$$.dirty&23&&c&&(console.log(`Autosaving with ${s} reviewed targets`),window.localStorage.setItem(pe,JSON.stringify([f,i])))},[f,i,c,r,s,o,t,u,d,h,L,M,m,g,N,j,T,I,k,O]}class Ht extends se{constructor(n){super(),ie(this,n,Jt,Et,re,{})}}new Ht({target:document.getElementById("app")});
