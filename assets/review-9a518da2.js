import{S as ce,i as me,s as de,P as ge,r as g,t as O,w as X,g as S,x as Y,y as b,Q as Ue,R as Ze,T as Qe,U as re,o as Pe,V as $,W as Ve,X as Xe,j as M,Y as Ye,Z as xe,$ as $e,a0 as et,a1 as tt,z as Q,n as D,k as J,q as L,B as P,u as v,v as F,I as q,a2 as V,J as be,H as nt,A as ne,d as z,e as A,C as oe,h as R,E as ot,L as lt,a3 as st,M as it,D as ue,_ as rt,G as ut,F as Se,K as Le,N as ze,O as Te,a4 as fe}from"./Settings-26083545.js";const ft=l=>({features:l[0]&16,data:l[0]&16,map:l[0]&4,close:l[0]&1}),Ne=l=>{var n;return{features:l[4],data:((n=l[4])==null?void 0:n[0])??null,map:l[2],close:l[31]}};function De(l){var i;let n,e,t=(((i=l[4])==null?void 0:i.length)||l[3]instanceof $.Marker)&&Ee(l);return{c(){n=M("div"),t&&t.c()},m(o,r){g(o,n,r),t&&t.m(n,null),l[32](n),e=!0},p(o,r){var s;(s=o[4])!=null&&s.length||o[3]instanceof $.Marker?t?(t.p(o,r),r[0]&24&&O(t,1)):(t=Ee(o),t.c(),O(t,1),t.m(n,null)):t&&(X(),S(t,1,1,()=>{t=null}),Y())},i(o){e||(O(t),e=!0)},o(o){S(t),e=!1},d(o){o&&b(n),t&&t.d(),l[32](null)}}}function Ee(l){let n;const e=l[30].default,t=Ye(e,l,l[29],Ne);return{c(){t&&t.c()},m(i,o){t&&t.m(i,o),n=!0},p(i,o){t&&t.p&&(!n||o[0]&536870933)&&xe(t,e,i,i[29],n?et(e,i[29],o,ft):$e(i[29]),Ne)},i(i){n||(O(t,i),n=!0)},o(i){S(t,i),n=!1},d(i){t&&t.d(i)}}}function at(l){let n,e,t=l[9].default&&De(l);return{c(){t&&t.c(),n=ge()},m(i,o){t&&t.m(i,o),g(i,n,o),e=!0},p(i,o){i[9].default?t?(t.p(i,o),o[0]&512&&O(t,1)):(t=De(i),t.c(),O(t,1),t.m(n.parentNode,n)):t&&(X(),S(t,1,1,()=>{t=null}),Y())},i(i){e||(O(t),e=!0)},o(i){S(t),e=!1},d(i){i&&b(n),t&&t.d(i)}}}function ct(l,n,e){let t,i,o,r,s,u,{$$slots:c={},$$scope:f}=n;const h=Ue(c);let{closeButton:p=void 0}=n,{closeOnClickOutside:C=!0}=n,{closeOnClickInside:T=!1}=n,{closeOnMove:_=!1}=n,{openOn:k="click"}=n,{openIfTopMost:N=!0}=n,{focusAfterOpen:w=!0}=n,{anchor:G=void 0}=n,{offset:I=void 0}=n,{popupClass:B=void 0}=n,{maxWidth:j=void 0}=n,{lngLat:m=void 0}=n,{html:H=void 0}=n,{open:d=!1}=n;const E=Ze(),{map:ee,popupTarget:he,layerEvent:le,layer:ke,eventTopMost:Ae,markerClickManager:we}=Qe();re(l,ee,a=>e(2,o=a)),re(l,he,a=>e(3,s=a)),re(l,le,a=>e(28,r=a)),re(l,ke,a=>e(35,u=a));const Re=["click","dblclick","contextmenu"];let y,se=!1,K;function We(){if(!y)return;let a=y.getElement();!a||a===K||(K=a,k==="hover"&&(K.style.pointerEvents="none"),K.addEventListener("mouseenter",()=>{e(24,se=!0)},{passive:!0}),K.addEventListener("mouseleave",()=>{e(24,se=!1)},{passive:!0}),K.addEventListener("click",()=>{T&&e(0,d=!1)},{passive:!0}))}Pe(()=>{if(o)return o.on("click",ie),o.on("contextmenu",ie),we.add(Ge),typeof s=="string"&&(o.on("click",s,Z),o.on("dblclick",s,Z),o.on("contextmenu",s,Z),o.on("mousemove",s,Me),o.on("mouseleave",s,je),o.on("touchstart",s,Oe),o.on("touchend",s,Ce)),()=>{o!=null&&o.loaded()&&(y==null||y.remove(),o.off("click",ie),o.off("contextmenu",ie),we.remove(Ge),s instanceof $.Marker?s.getPopup()===y&&s.setPopup(void 0):typeof s=="string"&&(o.off("click",s,Z),o.off("dblclick",s,Z),o.off("contextmenu",s,Z),o.off("mousemove",s,Me),o.off("mouseleave",s,je),o.off("touchstart",s,Oe),o.off("touchend",s,Ce)))}});function ye(a){return N?!("marker"in a)&&!tt(a)&&Ae(a)!==u:!1}let U=null,W="normal";function ve(a){"layerType"in a&&a.layerType==="deckgl"?(e(10,m=a.coordinate),e(4,U=a.object?[a.object]:null)):(e(10,m=a.lngLat),e(4,U=a.features??[]))}function Z(a){a.type!==k||ye(a)||(ve(a),setTimeout(()=>e(0,d=!0)))}let x=null;function Oe(a){x=a.point}function Ce(a){if(!x||k!=="hover")return;let pe=x.dist(a.point);x=null,pe<3&&(e(10,m=a.lngLat),e(4,U=a.features??[]),y.isOpen()?e(25,W="justOpened"):(e(25,W="opening"),e(0,d=!0)))}function je(a){k!=="hover"||x||W!=="normal"||(e(0,d=!1),e(4,U=null))}function Me(a){if(!(k!=="hover"||x||W!=="normal")){if(ye(a)){e(0,d=!1),e(4,U=null);return}e(0,d=!0),e(4,U=a.features??[]),e(10,m=a.lngLat)}}function ie(a){if(W==="justOpened"){e(25,W="normal");return}if(!C)return;let pe=[K,s instanceof $.Marker?s==null?void 0:s.getElement():null];d&&y.isOpen()&&!pe.some(_e=>_e==null?void 0:_e.contains(a.originalEvent.target))&&(a.type==="contextmenu"&&k==="contextmenu"||a.type!=="contextmenu")&&e(0,d=!1)}function Ge(a){C&&d&&y.isOpen()&&a.marker!==s&&e(0,d=!1)}Ve(()=>{o&&(y!=null&&y.isOpen())&&y.remove()});let te;const qe=()=>e(0,d=!1);function Ke(a){Q[a?"unshift":"push"](()=>{te=a,e(1,te)})}return l.$$set=a=>{"closeButton"in a&&e(11,p=a.closeButton),"closeOnClickOutside"in a&&e(12,C=a.closeOnClickOutside),"closeOnClickInside"in a&&e(13,T=a.closeOnClickInside),"closeOnMove"in a&&e(14,_=a.closeOnMove),"openOn"in a&&e(15,k=a.openOn),"openIfTopMost"in a&&e(16,N=a.openIfTopMost),"focusAfterOpen"in a&&e(17,w=a.focusAfterOpen),"anchor"in a&&e(18,G=a.anchor),"offset"in a&&e(19,I=a.offset),"popupClass"in a&&e(20,B=a.popupClass),"maxWidth"in a&&e(21,j=a.maxWidth),"lngLat"in a&&e(10,m=a.lngLat),"html"in a&&e(22,H=a.html),"open"in a&&e(0,d=a.open),"$$scope"in a&&e(29,f=a.$$scope)},l.$$.update=()=>{if(l.$$.dirty[0]&14336&&e(27,t=p??(!C&&!T)),l.$$.dirty[0]&146685952&&(y||(e(23,y=new $.Popup({closeButton:t,closeOnClick:!1,closeOnMove:_,focusAfterOpen:w,maxWidth:j,className:B,anchor:G,offset:I})),K=y.getElement(),y.on("open",()=>{e(0,d=!0),We(),E("open",y)}),y.on("close",()=>{e(0,d=!1),E("close",y)}),y.on("hover",()=>{E("hover",y)}))),l.$$.dirty[0]&8421384&&y&&s instanceof $.Marker&&(k==="click"?s.setPopup(y):s.getPopup()===y&&s.setPopup(void 0)),l.$$.dirty[0]&268468224&&Re.includes(k)&&(r==null?void 0:r.type)===k&&(Z(r),Xe(le,r=null,r)),l.$$.dirty[0]&268468224&&e(26,i=k==="hover"&&((r==null?void 0:r.type)==="mousemove"||(r==null?void 0:r.type)==="mouseenter")),l.$$.dirty[0]&352354304&&k==="hover"&&le&&(i&&r&&ve(r),e(0,d=(i||se)??!1)),l.$$.dirty[0]&12582914&&(te?y.setDOMContent(te):H&&y.setHTML(H)),l.$$.dirty[0]&8389632&&m&&y.setLngLat(m),l.$$.dirty[0]&41943045&&o){let a=y.isOpen();d&&!a?(y.addTo(o),W==="opening"&&e(25,W="justOpened")):!d&&a&&y.remove()}},[d,te,o,s,U,ee,he,le,ke,h,m,p,C,T,_,k,N,w,G,I,B,j,H,y,se,W,i,t,r,f,c,qe,Ke]}class mt extends ce{constructor(n){super(),me(this,n,ct,at,de,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}let ae="match-linestrings-review";function dt(l){let n,e,t,i,o=JSON.stringify(l[1].features[l[0]].properties.matching_sources)+"",r,s,u,c,f,h,p,C,T,_,k,N;return{c(){n=M("h3"),e=D("Target "),t=D(l[0]),i=D(": "),r=D(o),s=J(),u=M("h6"),u.textContent="Click sources to add or remove",c=J(),f=M("div"),h=M("button"),h.innerHTML=`<kbd>1</kbd>
    - Unreviewed`,p=J(),C=M("button"),C.innerHTML=`<kbd>2</kbd>
    - Not sure`,T=J(),_=M("button"),_.innerHTML=`<kbd>3</kbd>
    - Confirm correct`,L(h,"class","btn btn-secondary"),L(C,"class","btn btn-warning"),L(_,"class","btn btn-success"),P(f,"display","flex"),P(f,"justify-content","space-between")},m(w,G){g(w,n,G),v(n,e),v(n,t),v(n,i),v(n,r),g(w,s,G),g(w,u,G),g(w,c,G),g(w,f,G),v(f,h),v(f,p),v(f,C),v(f,T),v(f,_),k||(N=[F(window,"keydown",l[3]),F(h,"click",l[4]),F(C,"click",l[5]),F(_,"click",l[6])],k=!0)},p(w,[G]){G&1&&q(t,w[0]),G&3&&o!==(o=JSON.stringify(w[1].features[w[0]].properties.matching_sources)+"")&&q(r,o)},i:V,o:V,d(w){w&&(b(n),b(s),b(u),b(c),b(f)),k=!1,be(N)}}}function pt(l,n,e){let{clickedTarget:t}=n,{targetGj:i}=n,{onConfirm:o}=n;function r(f){f.target.tagName!="INPUT"&&(f.key=="1"?o("unreviewed"):f.key=="2"?o("not sure"):f.key=="3"&&o("confirmed"))}const s=()=>o("unreviewed"),u=()=>o("not sure"),c=()=>o("confirmed");return l.$$set=f=>{"clickedTarget"in f&&e(0,t=f.clickedTarget),"targetGj"in f&&e(1,i=f.targetGj),"onConfirm"in f&&e(2,o=f.onConfirm)},[t,i,o,r,s,u,c]}class _t extends ce{constructor(n){super(),me(this,n,pt,dt,de,{clickedTarget:0,targetGj:1,onConfirm:2})}}function Ie(l){let n,e,t,i=l[0].features.length+"",o,r,s,u=l[1].features.length+"",c,f,h,p=l[1].features.filter(He).length+"",C,T,_,k,N,w,G,I,B,j;function m(d){l[11](d)}let H={onChange:l[5]};return l[3]!==void 0&&(H.options=l[3]),w=new nt({props:H}),Q.push(()=>ne(w,"options",m)),{c(){n=M("button"),n.textContent="Swap",e=J(),t=M("p"),o=D(i),r=D(` sources and
    `),s=M("span"),c=D(u),f=D(" targets"),h=D(`
    , with `),C=D(p),T=D(" matching a source"),_=J(),k=M("button"),k.textContent="Start review",N=J(),z(w.$$.fragment),L(n,"class","btn btn-secondary"),P(s,"color","red"),L(k,"class","btn btn-primary mb-5")},m(d,E){g(d,n,E),g(d,e,E),g(d,t,E),v(t,o),v(t,r),v(t,s),v(s,c),v(s,f),v(t,h),v(t,C),v(t,T),g(d,_,E),g(d,k,E),g(d,N,E),A(w,d,E),I=!0,B||(j=[F(n,"click",l[7]),F(k,"click",l[10])],B=!0)},p(d,E){(!I||E&1)&&i!==(i=d[0].features.length+"")&&q(o,i),(!I||E&2)&&u!==(u=d[1].features.length+"")&&q(c,u),(!I||E&2)&&p!==(p=d[1].features.filter(He).length+"")&&q(C,p);const ee={};!G&&E&8&&(G=!0,ee.options=d[3],oe(()=>G=!1)),w.$set(ee)},i(d){I||(O(w.$$.fragment,d),I=!0)},o(d){S(w.$$.fragment,d),I=!1},d(d){d&&(b(n),b(e),b(t),b(_),b(k),b(N)),R(w,d),B=!1,be(j)}}}function gt(l){let n,e,t,i,o,r,s,u,c=l[0].features.length>0&&Ie(l);return{c(){n=M("label"),e=D(`Load two .geojson files
  `),t=M("input"),i=J(),c&&c.c(),o=ge(),L(t,"class","form-control"),L(t,"type","file"),t.multiple=!0,L(n,"class","form-label")},m(f,h){g(f,n,h),v(n,e),v(n,t),l[9](t),g(f,i,h),c&&c.m(f,h),g(f,o,h),r=!0,s||(u=F(t,"change",l[6]),s=!0)},p(f,[h]){f[0].features.length>0?c?(c.p(f,h),h&1&&O(c,1)):(c=Ie(f),c.c(),O(c,1),c.m(o.parentNode,o)):c&&(X(),S(c,1,1,()=>{c=null}),Y())},i(f){r||(O(c),r=!0)},o(f){S(c),r=!1},d(f){f&&(b(n),b(i),b(o)),l[9](null),c&&c.d(f),s=!1,u()}}}function Je(l){let n=0;for(let e of l.features)e.id=n++,e.properties??(e.properties={});return l}const He=l=>l.properties.matching_sources.length>0;function bt(l,n,e){let{sourceGj:t}=n,{targetGj:i}=n,{setupDone:o}=n,{zoomFit:r}=n,s={buffer_meters:20,angle_diff_threshold:10,length_ratio_threshold:1.1,midpt_dist_threshold:15};function u(){var _;try{let k=JSON.parse(ot(JSON.stringify(t),JSON.stringify(i),s));for(let[N,w]of i.features.entries())w.properties.matching_sources=k[N].matching_sources,(_=w.properties).reviewed??(_.reviewed="unreviewed");e(1,i)}catch(k){window.alert(`Bug: ${k}`)}}let c;async function f(_){if(!c.files)return;if(c.files.length!=2){window.alert("Select two GeoJSON files");return}try{let N=await c.files[0].text(),w=await c.files[1].text();e(0,t=Je(JSON.parse(N))),e(1,i=Je(JSON.parse(w))),r(),u()}catch(N){window.alert(`Bad input file: ${N}`)}}function h(){e(0,[t,i]=[i,t],t,e(1,i)),u()}function p(_){Q[_?"unshift":"push"](()=>{c=_,e(4,c)})}const C=()=>e(2,o=!0);function T(_){s=_,e(3,s)}return l.$$set=_=>{"sourceGj"in _&&e(0,t=_.sourceGj),"targetGj"in _&&e(1,i=_.targetGj),"setupDone"in _&&e(2,o=_.setupDone),"zoomFit"in _&&e(8,r=_.zoomFit)},[t,i,o,s,c,u,f,h,r,p,C,T]}class ht extends ce{constructor(n){super(),me(this,n,bt,gt,de,{sourceGj:0,targetGj:1,setupDone:2,zoomFit:8})}}const{window:kt}=st;function wt(l){let n,e,t,i,o,r,s,u,c,f,h,p,C,T,_=l[1].features.length+"",k,N,w,G,I,B;return{c(){n=M("div"),e=M("button"),e.textContent="Start over",t=J(),i=M("button"),i.textContent="Zoom to fit",o=J(),r=M("br"),s=J(),u=M("div"),c=M("div"),h=J(),p=M("p"),C=D(l[4]),T=D(" / "),k=D(_),N=D(" targets reviewed"),w=J(),G=M("button"),G.textContent="Download reviews",L(e,"class","btn btn-danger"),L(i,"class","btn btn-secondary"),P(n,"display","flex"),P(n,"justify-content","space-between"),L(c,"class","progress-bar"),P(c,"width",`${100*l[4]/l[1].features.length}%`),L(u,"class","progress"),L(u,"role","progressbar"),L(u,"aria-valuenow",l[4]),L(u,"aria-valuemin","0"),L(u,"aria-valuemax",f=l[1].features.length),L(G,"class","btn btn-success")},m(j,m){g(j,n,m),v(n,e),v(n,t),v(n,i),g(j,o,m),g(j,r,m),g(j,s,m),g(j,u,m),v(u,c),g(j,h,m),g(j,p,m),v(p,C),v(p,T),v(p,k),v(p,N),g(j,w,m),g(j,G,m),I||(B=[F(e,"click",l[12]),F(i,"click",l[7]),F(G,"click",l[11])],I=!0)},p(j,m){m&18&&P(c,"width",`${100*j[4]/j[1].features.length}%`),m&16&&L(u,"aria-valuenow",j[4]),m&2&&f!==(f=j[1].features.length)&&L(u,"aria-valuemax",f),m&16&&q(C,j[4]),m&2&&_!==(_=j[1].features.length+"")&&q(k,_)},i:V,o:V,d(j){j&&(b(n),b(o),b(r),b(s),b(u),b(h),b(p),b(w),b(G)),I=!1,be(B)}}}function yt(l){let n,e,t,i,o;function r(f){l[17](f)}function s(f){l[18](f)}function u(f){l[19](f)}let c={zoomFit:l[7]};return l[0]!==void 0&&(c.sourceGj=l[0]),l[1]!==void 0&&(c.targetGj=l[1]),l[2]!==void 0&&(c.setupDone=l[2]),n=new ht({props:c}),Q.push(()=>ne(n,"sourceGj",r)),Q.push(()=>ne(n,"targetGj",s)),Q.push(()=>ne(n,"setupDone",u)),{c(){z(n.$$.fragment)},m(f,h){A(n,f,h),o=!0},p(f,h){const p={};!e&&h&1&&(e=!0,p.sourceGj=f[0],oe(()=>e=!1)),!t&&h&2&&(t=!0,p.targetGj=f[1],oe(()=>t=!1)),!i&&h&4&&(i=!0,p.setupDone=f[2],oe(()=>i=!1)),n.$set(p)},i(f){o||(O(n.$$.fragment,f),o=!0)},o(f){S(n.$$.fragment,f),o=!1},d(f){R(n,f)}}}function vt(l){let n,e,t,i,o,r,s,u;const c=[yt,wt],f=[];function h(p,C){return p[2]?1:0}return r=h(l),s=f[r]=c[r](l),{c(){n=M("div"),e=M("h1"),e.textContent="Manually specify LineString matchings for test cases",t=J(),i=M("div"),i.innerHTML='<a class="icon-link mb-3" href="https://github.com/nptscot/match_linestrings/blob/main/tests/README.md" target="_blank">About <i class="fa-solid fa-arrow-up-right-from-square"></i></a>',o=J(),s.c(),L(n,"slot","left")},m(p,C){g(p,n,C),v(n,e),v(n,t),v(n,i),v(n,o),f[r].m(n,null),u=!0},p(p,C){let T=r;r=h(p),r===T?f[r].p(p,C):(X(),S(f[T],1,1,()=>{f[T]=null}),Y(),s=f[r],s?s.p(p,C):(s=f[r]=c[r](p),s.c()),O(s,1),s.m(n,null))},i(p){u||(O(s),u=!0)},o(p){S(s),u=!1},d(p){p&&b(n),f[r].d()}}}function Be(l){let n,e,t,i;const o=[Ct,Ot],r=[];function s(u,c){return u[3]==null?0:1}return e=s(l),t=r[e]=o[e](l),{c(){n=M("div"),t.c(),L(n,"class","map-panel svelte-hr6p1s")},m(u,c){g(u,n,c),r[e].m(n,null),i=!0},p(u,c){let f=e;e=s(u),e===f?r[e].p(u,c):(X(),S(r[f],1,1,()=>{r[f]=null}),Y(),t=r[e],t?t.p(u,c):(t=r[e]=o[e](u),t.c()),O(t,1),t.m(n,null))},i(u){i||(O(t),i=!0)},o(u){S(t),i=!1},d(u){u&&b(n),r[e].d()}}}function Ot(l){let n,e;return n=new _t({props:{clickedTarget:l[3],targetGj:l[1],onConfirm:l[8]}}),{c(){z(n.$$.fragment)},m(t,i){A(n,t,i),e=!0},p(t,i){const o={};i&8&&(o.clickedTarget=t[3]),i&2&&(o.targetGj=t[1]),n.$set(o)},i(t){e||(O(n.$$.fragment,t),e=!0)},o(t){S(n.$$.fragment,t),e=!1},d(t){R(n,t)}}}function Ct(l){let n,e,t;return{c(){n=M("button"),n.innerHTML=`Goto <kbd>n</kbd>
              ext unreviewed`,L(n,"class","btn btn-primary")},m(i,o){g(i,n,o),e||(t=F(n,"click",l[9]),e=!0)},p:V,i:V,o:V,d(i){i&&b(n),e=!1,t()}}}function Fe(l){let n,e;return n=new mt({props:{openOn:"hover",$$slots:{default:[jt,({data:t})=>({20:t}),({data:t})=>t?1048576:0]},$$scope:{ctx:l}}}),{c(){z(n.$$.fragment)},m(t,i){A(n,t,i),e=!0},p(t,i){const o={};i&3145792&&(o.$$scope={dirty:i,ctx:t}),n.$set(o)},i(t){e||(O(n.$$.fragment,t),e=!0)},o(t){S(n.$$.fragment,t),e=!1},d(t){R(n,t)}}}function jt(l){let n,e=fe(l[20]).id+"",t,i,o=l[6].includes(fe(l[20]).id)?"remove":"add",r;return{c(){n=D("Source "),t=D(e),i=D(" -- click to "),r=D(o)},m(s,u){g(s,n,u),g(s,t,u),g(s,i,u),g(s,r,u)},p(s,u){u&1048576&&e!==(e=fe(s[20]).id+"")&&q(t,e),u&1048640&&o!==(o=s[6].includes(fe(s[20]).id)?"remove":"add")&&q(r,o)},d(s){s&&(b(n),b(t),b(i),b(r))}}}function Mt(l){let n,e,t=l[3]!=null&&Fe(l);return{c(){t&&t.c(),n=ge()},m(i,o){t&&t.m(i,o),g(i,n,o),e=!0},p(i,o){i[3]!=null?t?(t.p(i,o),o&8&&O(t,1)):(t=Fe(i),t.c(),O(t,1),t.m(n.parentNode,n)):t&&(X(),S(t,1,1,()=>{t=null}),Y())},i(i){e||(O(t),e=!0)},o(i){S(t),e=!1},d(i){i&&b(n),t&&t.d(i)}}}function Gt(l){let n,e;return n=new ze({props:{manageHoverState:!0,paint:{"line-color":["case",["in",["id"],["literal",l[6]]],"blue","black"],"line-width":8,"line-opacity":Te(.5,1)},hoverCursor:l[3]==null?void 0:"pointer",$$slots:{default:[Mt]},$$scope:{ctx:l}}}),n.$on("click",l[14]),{c(){z(n.$$.fragment)},m(t,i){A(n,t,i),e=!0},p(t,i){const o={};i&64&&(o.paint={"line-color":["case",["in",["id"],["literal",t[6]]],"blue","black"],"line-width":8,"line-opacity":Te(.5,1)}),i&8&&(o.hoverCursor=t[3]==null?void 0:"pointer"),i&2097224&&(o.$$scope={dirty:i,ctx:t}),n.$set(o)},i(t){e||(O(n.$$.fragment,t),e=!0)},o(t){S(n.$$.fragment,t),e=!1},d(t){R(n,t)}}}function St(l){let n,e;return n=new ze({props:{manageHoverState:!0,paint:{"line-width":8,"line-color":["match",["get","reviewed"],"unreviewed","red","green"],"line-opacity":["case",["==",["id"],l[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,[">",["length",["get","matching_sources"]],0],.5,.2]},hoverCursor:"pointer"}}),n.$on("click",l[13]),{c(){z(n.$$.fragment)},m(t,i){A(n,t,i),e=!0},p(t,i){const o={};i&8&&(o.paint={"line-width":8,"line-color":["match",["get","reviewed"],"unreviewed","red","green"],"line-opacity":["case",["==",["id"],t[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,[">",["length",["get","matching_sources"]],0],.5,.2]}),n.$set(o)},i(t){e||(O(n.$$.fragment,t),e=!0)},o(t){S(n.$$.fragment,t),e=!1},d(t){R(n,t)}}}function Lt(l){let n,e,t,i,o,r=l[2]&&Be(l);return e=new Le({props:{data:l[0],$$slots:{default:[Gt]},$$scope:{ctx:l}}}),i=new Le({props:{data:l[1],$$slots:{default:[St]},$$scope:{ctx:l}}}),{c(){r&&r.c(),n=J(),z(e.$$.fragment),t=J(),z(i.$$.fragment)},m(s,u){r&&r.m(s,u),g(s,n,u),A(e,s,u),g(s,t,u),A(i,s,u),o=!0},p(s,u){s[2]?r?(r.p(s,u),u&4&&O(r,1)):(r=Be(s),r.c(),O(r,1),r.m(n.parentNode,n)):r&&(X(),S(r,1,1,()=>{r=null}),Y());const c={};u&1&&(c.data=s[0]),u&2097224&&(c.$$scope={dirty:u,ctx:s}),e.$set(c);const f={};u&2&&(f.data=s[1]),u&2097160&&(f.$$scope={dirty:u,ctx:s}),i.$set(f)},i(s){o||(O(r),O(e.$$.fragment,s),O(i.$$.fragment,s),o=!0)},o(s){S(r),S(e.$$.fragment,s),S(i.$$.fragment,s),o=!1},d(s){s&&(b(n),b(t)),r&&r.d(s),R(e,s),R(i,s)}}}function Tt(l){let n,e,t,i;function o(s){l[15](s)}let r={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Lt]},$$scope:{ctx:l}};return l[5]!==void 0&&(r.map=l[5]),e=new it({props:r}),Q.push(()=>ne(e,"map",o)),e.$on("error",l[16]),{c(){n=M("div"),z(e.$$.fragment),L(n,"slot","main"),P(n,"position","relative"),P(n,"width","100%"),P(n,"height","100vh")},m(s,u){g(s,n,u),A(e,n,null),i=!0},p(s,u){const c={};u&2097231&&(c.$$scope={dirty:u,ctx:s}),!t&&u&32&&(t=!0,c.map=s[5],oe(()=>t=!1)),e.$set(c)},i(s){i||(O(e.$$.fragment,s),i=!0)},o(s){S(e.$$.fragment,s),i=!1},d(s){s&&b(n),R(e)}}}function Nt(l){let n,e,t,i;return n=new lt({props:{$$slots:{main:[Tt],left:[vt]},$$scope:{ctx:l}}}),{c(){z(n.$$.fragment)},m(o,r){A(n,o,r),e=!0,t||(i=F(kt,"keydown",l[10]),t=!0)},p(o,[r]){const s={};r&2097279&&(s.$$scope={dirty:r,ctx:o}),n.$set(s)},i(o){e||(O(n.$$.fragment,o),e=!0)},o(o){S(n.$$.fragment,o),e=!1},d(o){R(n,o),t=!1,i()}}}function Dt(l,n,e){let t,i,o,r=ue(),s=ue(),u=!1,c=null;Pe(async()=>{await rt();try{let m=window.localStorage.getItem(ae);if(m){let H=JSON.parse(m);e(0,[r,s]=H,r,e(1,s)),e(2,u=!0),console.log(`Restored data from local storage ${ae}`)}}catch(m){console.log(`Couldn't restore data from local storage: ${m}`)}});function f(){let m={type:"FeatureCollection",features:[...r.features,...s.features]};o==null||o.fitBounds(Se(m),{animate:!1,padding:10})}function h(m){if(c==null)throw new Error("impossible");e(1,s.features[c].properties.reviewed=m,s),e(1,s),e(3,c=null)}function p(){for(let m of s.features)if(m.properties.reviewed=="unreviewed"){o==null||o.fitBounds(Se(m),{duration:600,padding:200}),e(3,c=m.id);return}}function C(m){m.target.tagName=="INPUT"||!u||m.key=="n"&&p()}function T(){ut("reviewed_targets.geojson",JSON.stringify(s))}function _(){window.confirm("Do you want to discard this review and start over?")&&(e(0,r=ue()),e(1,s=ue()),e(2,u=!1),e(3,c=null),window.localStorage.removeItem(ae))}function k(m){u&&e(3,c=m.detail.features[0].id)}function N(m){if(!u||c==null)return;let H=m.detail.features[0].id,d=s.features[c].properties;d.matching_sources.includes(H)?d.matching_sources=d.matching_sources.filter(E=>E!=H):d.matching_sources.push(H),e(1,s)}function w(m){o=m,e(5,o)}const G=m=>{console.log(m.detail.error)};function I(m){r=m,e(0,r)}function B(m){s=m,e(1,s)}function j(m){u=m,e(2,u)}return l.$$.update=()=>{l.$$.dirty&10&&e(6,t=c==null?[]:s.features[c].properties.matching_sources),l.$$.dirty&2&&e(4,i=s.features.filter(m=>m.properties.reviewed!="unreviewed").length),l.$$.dirty&23&&u&&(console.log(`Autosaving with ${i} reviewed targets`),window.localStorage.setItem(ae,JSON.stringify([r,s])))},[r,s,u,c,i,o,t,f,h,p,C,T,_,k,N,w,G,I,B,j]}class Et extends ce{constructor(n){super(),me(this,n,Dt,Nt,de,{})}}new Et({target:document.getElementById("app")});
