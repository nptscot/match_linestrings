import{S as re,i as fe,s as ue,P as Pe,Q as Ae,R as se,T as He,U as De,r as _,t as C,w as ge,g as E,x as he,y as d,V as xe,o as ze,W as oe,X as $e,j as T,Y as Fe,Z as We,$ as qe,a0 as Re,a1 as et,z as ke,k as B,B as z,q as $,u as M,n as N,a2 as Se,v as U,I as X,a3 as ie,J as Ze,L as tt,d as W,e as q,h as R,M as nt,A as Ve,C as Ke,D as Le,_ as ot,E as lt,H as st,F as je,K as Ne,N as Qe,O as Te,a4 as de}from"./Settings-7de68ec9.js";function it(l,n,e){let t;const i=Pe();let{layer:s=void 0}=n;const{map:f}=Ae();se(l,f,m=>e(2,t=m));function o(m){i(m.type,{...m,map:f})}const r=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],c=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return He(()=>{if(t)if(s)for(const m of r)t.off(m,s,o);else for(const m of c)t.off(m,o)}),l.$$set=m=>{"layer"in m&&e(1,s=m.layer)},l.$$.update=()=>{if(l.$$.dirty&6&&t)if(s)for(const m of r)t.on(m,s,o);else for(const m of c)t.on(m,o)},[f,s,t]}class rt extends re{constructor(n){super(),fe(this,n,it,null,ue,{layer:1})}}const ft=l=>({features:l[0]&16,data:l[0]&16,map:l[0]&4,close:l[0]&1}),Ee=l=>{var n;return{features:l[4],data:((n=l[4])==null?void 0:n[0])??null,map:l[2],close:l[31]}};function Ie(l){var i;let n,e,t=(((i=l[4])==null?void 0:i.length)||l[3]instanceof oe.Marker)&&Be(l);return{c(){n=T("div"),t&&t.c()},m(s,f){_(s,n,f),t&&t.m(n,null),l[32](n),e=!0},p(s,f){var o;(o=s[4])!=null&&o.length||s[3]instanceof oe.Marker?t?(t.p(s,f),f[0]&24&&C(t,1)):(t=Be(s),t.c(),C(t,1),t.m(n,null)):t&&(ge(),E(t,1,1,()=>{t=null}),he())},i(s){e||(C(t),e=!0)},o(s){E(t),e=!1},d(s){s&&d(n),t&&t.d(),l[32](null)}}}function Be(l){let n;const e=l[30].default,t=Fe(e,l,l[29],Ee);return{c(){t&&t.c()},m(i,s){t&&t.m(i,s),n=!0},p(i,s){t&&t.p&&(!n||s[0]&536870933)&&We(t,e,i,i[29],n?Re(e,i[29],s,ft):qe(i[29]),Ee)},i(i){n||(C(t,i),n=!0)},o(i){E(t,i),n=!1},d(i){t&&t.d(i)}}}function ut(l){let n,e,t=l[9].default&&Ie(l);return{c(){t&&t.c(),n=De()},m(i,s){t&&t.m(i,s),_(i,n,s),e=!0},p(i,s){i[9].default?t?(t.p(i,s),s[0]&512&&C(t,1)):(t=Ie(i),t.c(),C(t,1),t.m(n.parentNode,n)):t&&(ge(),E(t,1,1,()=>{t=null}),he())},i(i){e||(C(t),e=!0)},o(i){E(t),e=!1},d(i){i&&d(n),t&&t.d(i)}}}function ct(l,n,e){let t,i,s,f,o,r,{$$slots:c={},$$scope:m}=n;const g=xe(c);let{closeButton:k=void 0}=n,{closeOnClickOutside:w=!0}=n,{closeOnClickInside:b=!1}=n,{closeOnMove:J=!1}=n,{openOn:j="click"}=n,{openIfTopMost:H=!0}=n,{focusAfterOpen:O=!0}=n,{anchor:S=void 0}=n,{offset:K=void 0}=n,{popupClass:G=void 0}=n,{maxWidth:Q=void 0}=n,{lngLat:P=void 0}=n,{html:p=void 0}=n,{open:y=!1}=n;const L=Pe(),{map:I,popupTarget:Y,layerEvent:F,layer:ee,eventTopMost:ce,markerClickManager:ae}=Ae();se(l,I,u=>e(2,s=u)),se(l,Y,u=>e(3,o=u)),se(l,F,u=>e(28,f=u)),se(l,ee,u=>e(35,r=u));const me=["click","dblclick","contextmenu"];let h,D=!1,Z;function a(){if(!h)return;let u=h.getElement();!u||u===Z||(Z=u,j==="hover"&&(Z.style.pointerEvents="none"),Z.addEventListener("mouseenter",()=>{e(24,D=!0)},{passive:!0}),Z.addEventListener("mouseleave",()=>{e(24,D=!1)},{passive:!0}),Z.addEventListener("click",()=>{b&&e(0,y=!1)},{passive:!0}))}ze(()=>{if(s)return s.on("click",pe),s.on("contextmenu",pe),ae.add(Me),typeof o=="string"&&(s.on("click",o,x),s.on("dblclick",o,x),s.on("contextmenu",o,x),s.on("mousemove",o,Ce),s.on("mouseleave",o,ve),s.on("touchstart",o,Oe),s.on("touchend",o,ye)),()=>{s!=null&&s.loaded()&&(h==null||h.remove(),s.off("click",pe),s.off("contextmenu",pe),ae.remove(Me),o instanceof oe.Marker?o.getPopup()===h&&o.setPopup(void 0):typeof o=="string"&&(s.off("click",o,x),s.off("dblclick",o,x),s.off("contextmenu",o,x),s.off("mousemove",o,Ce),s.off("mouseleave",o,ve),s.off("touchstart",o,Oe),s.off("touchend",o,ye)))}});function v(u){return H?!("marker"in u)&&!et(u)&&ce(u)!==r:!1}let V=null,A="normal";function te(u){"layerType"in u&&u.layerType==="deckgl"?(e(10,P=u.coordinate),e(4,V=u.object?[u.object]:null)):(e(10,P=u.lngLat),e(4,V=u.features??[]))}function x(u){u.type!==j||v(u)||(te(u),setTimeout(()=>e(0,y=!0)))}let ne=null;function Oe(u){ne=u.point}function ye(u){if(!ne||j!=="hover")return;let be=ne.dist(u.point);ne=null,be<3&&(e(10,P=u.lngLat),e(4,V=u.features??[]),h.isOpen()?e(25,A="justOpened"):(e(25,A="opening"),e(0,y=!0)))}function ve(u){j!=="hover"||ne||A!=="normal"||(e(0,y=!1),e(4,V=null))}function Ce(u){if(!(j!=="hover"||ne||A!=="normal")){if(v(u)){e(0,y=!1),e(4,V=null);return}e(0,y=!0),e(4,V=u.features??[]),e(10,P=u.lngLat)}}function pe(u){if(A==="justOpened"){e(25,A="normal");return}if(!w)return;let be=[Z,o instanceof oe.Marker?o==null?void 0:o.getElement():null];y&&h.isOpen()&&!be.some(we=>we==null?void 0:we.contains(u.originalEvent.target))&&(u.type==="contextmenu"&&j==="contextmenu"||u.type!=="contextmenu")&&e(0,y=!1)}function Me(u){w&&y&&h.isOpen()&&u.marker!==o&&e(0,y=!1)}He(()=>{s&&(h!=null&&h.isOpen())&&h.remove()});let le;const Xe=()=>e(0,y=!1);function Ye(u){ke[u?"unshift":"push"](()=>{le=u,e(1,le)})}return l.$$set=u=>{"closeButton"in u&&e(11,k=u.closeButton),"closeOnClickOutside"in u&&e(12,w=u.closeOnClickOutside),"closeOnClickInside"in u&&e(13,b=u.closeOnClickInside),"closeOnMove"in u&&e(14,J=u.closeOnMove),"openOn"in u&&e(15,j=u.openOn),"openIfTopMost"in u&&e(16,H=u.openIfTopMost),"focusAfterOpen"in u&&e(17,O=u.focusAfterOpen),"anchor"in u&&e(18,S=u.anchor),"offset"in u&&e(19,K=u.offset),"popupClass"in u&&e(20,G=u.popupClass),"maxWidth"in u&&e(21,Q=u.maxWidth),"lngLat"in u&&e(10,P=u.lngLat),"html"in u&&e(22,p=u.html),"open"in u&&e(0,y=u.open),"$$scope"in u&&e(29,m=u.$$scope)},l.$$.update=()=>{if(l.$$.dirty[0]&14336&&e(27,t=k??(!w&&!b)),l.$$.dirty[0]&146685952&&(h||(e(23,h=new oe.Popup({closeButton:t,closeOnClick:!1,closeOnMove:J,focusAfterOpen:O,maxWidth:Q,className:G,anchor:S,offset:K})),Z=h.getElement(),h.on("open",()=>{e(0,y=!0),a(),L("open",h)}),h.on("close",()=>{e(0,y=!1),L("close",h)}),h.on("hover",()=>{L("hover",h)}))),l.$$.dirty[0]&8421384&&h&&o instanceof oe.Marker&&(j==="click"?o.setPopup(h):o.getPopup()===h&&o.setPopup(void 0)),l.$$.dirty[0]&268468224&&me.includes(j)&&(f==null?void 0:f.type)===j&&(x(f),$e(F,f=null,f)),l.$$.dirty[0]&268468224&&e(26,i=j==="hover"&&((f==null?void 0:f.type)==="mousemove"||(f==null?void 0:f.type)==="mouseenter")),l.$$.dirty[0]&352354304&&j==="hover"&&F&&(i&&f&&te(f),e(0,y=(i||D)??!1)),l.$$.dirty[0]&12582914&&(le?h.setDOMContent(le):p&&h.setHTML(p)),l.$$.dirty[0]&8389632&&P&&h.setLngLat(P),l.$$.dirty[0]&41943045&&s){let u=h.isOpen();y&&!u?(h.addTo(s),A==="opening"&&e(25,A="justOpened")):!y&&u&&h.remove()}},[y,le,s,o,V,I,Y,F,ee,g,P,k,w,b,J,j,H,O,S,K,G,Q,p,h,D,A,i,t,f,m,c,Xe,Ye]}class Ue extends re{constructor(n){super(),fe(this,n,ct,ut,ue,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function at(l){let n,e,t,i,s;const f=l[4].default,o=Fe(f,l,l[3],null);return{c(){n=T("div"),e=T("div"),t=B(),i=T("div"),o&&o.c(),z(e,"position","absolute"),z(e,"width",`${100*l[0]/l[1]}%`),z(e,"height","100%"),z(e,"background-color",l[2]),z(i,"position","relative"),$(n,"class","row svelte-cq1cte")},m(r,c){_(r,n,c),M(n,e),M(n,t),M(n,i),o&&o.m(i,null),s=!0},p(r,[c]){c&3&&z(e,"width",`${100*r[0]/r[1]}%`),c&4&&z(e,"background-color",r[2]),o&&o.p&&(!s||c&8)&&We(o,f,r,r[3],s?Re(f,r[3],c,null):qe(r[3]),null)},i(r){s||(C(o,r),s=!0)},o(r){E(o,r),s=!1},d(r){r&&d(n),o&&o.d(r)}}}function mt(l,n,e){let{$$slots:t={},$$scope:i}=n,{items:s}=n,{total:f}=n,{color:o}=n;return l.$$set=r=>{"items"in r&&e(0,s=r.items),"total"in r&&e(1,f=r.total),"color"in r&&e(2,o=r.color),"$$scope"in r&&e(3,i=r.$$scope)},[s,f,o,i,t]}class pt extends re{constructor(n){super(),fe(this,n,mt,at,ue,{items:0,total:1,color:2})}}function _t(l){let n,e,t,i,s,f,o,r,c,m,g,k,w,b,J,j,H;return{c(){n=T("p"),e=N("Target "),t=N(l[0]),i=N(": "),s=N(l[3]),f=B(),o=T("button"),o.textContent="Mark unreviewed",r=B(),c=T("button"),c.textContent="Not sure",m=B(),g=T("button"),g.textContent="No matches",k=B(),w=T("input"),b=B(),J=T("button"),J.textContent="Matches these sources",$(w,"type","text")},m(O,S){_(O,n,S),M(n,e),M(n,t),M(n,i),M(n,s),_(O,f,S),_(O,o,S),_(O,r,S),_(O,c,S),_(O,m,S),_(O,g,S),_(O,k,S),_(O,w,S),Se(w,l[2]),_(O,b,S),_(O,J,S),j||(H=[U(o,"click",l[7]),U(c,"click",l[8]),U(g,"click",l[9]),U(w,"input",l[10]),U(J,"click",l[4])],j=!0)},p(O,[S]){S&1&&X(t,O[0]),S&4&&w.value!==O[2]&&Se(w,O[2])},i:ie,o:ie,d(O){O&&(d(n),d(f),d(o),d(r),d(c),d(m),d(g),d(k),d(w),d(b),d(J)),j=!1,Ze(H)}}}function dt(l,n,e){let{clickedTarget:t}=n,{targetGj:i}=n,{matchingSourceIndices:s}=n,{onConfirm:f}=n,o=i.features[t].properties.reviewed,r=Array.isArray(o)?JSON.stringify(o):JSON.stringify(s);function c(){try{let b=JSON.parse(r);if(!Array.isArray(b))throw new Error("Not an array");f(b)}catch{window.alert("Not a list of source IDs")}}const m=()=>f("unreviewed"),g=()=>f("not sure"),k=()=>f([]);function w(){r=this.value,e(2,r)}return l.$$set=b=>{"clickedTarget"in b&&e(0,t=b.clickedTarget),"targetGj"in b&&e(5,i=b.targetGj),"matchingSourceIndices"in b&&e(6,s=b.matchingSourceIndices),"onConfirm"in b&&e(1,f=b.onConfirm)},[t,f,r,o,c,i,s,m,g,k,w]}class gt extends re{constructor(n){super(),fe(this,n,dt,_t,ue,{clickedTarget:0,targetGj:5,matchingSourceIndices:6,onConfirm:1})}}function Je(l){let n,e,t,i,s,f,o,r,c=l[4].features.length+"",m,g,k,w=l[0].features.length+"",b,J,j,H=l[2].filter(Ge).length+"",O,S,K,G,Q,P,p,y,L,I,Y,F,ee,ce;function ae(a){l[20](a)}let me={onChange:l[9],open:!1};l[5]!==void 0&&(me.options=l[5]),G=new st({props:me}),ke.push(()=>Ve(G,"options",ae)),p=new pt({props:{color:"blue",items:l[7],total:l[0].features.length,$$slots:{default:[ht]},$$scope:{ctx:l}}});const h=[bt,kt],D=[];function Z(a,v){return a[1]==null?0:1}return L=Z(l),I=D[L]=h[L](l),{c(){n=T("div"),e=T("button"),e.textContent="Swap",t=B(),i=T("button"),i.textContent="Zoom to fit",s=B(),f=T("hr"),o=B(),r=T("p"),m=N(c),g=N(` sources and
        `),k=T("span"),b=N(w),J=N(" targets"),j=N(`
        , with `),O=N(H),S=N(` matching
        a source`),K=B(),W(G.$$.fragment),P=B(),W(p.$$.fragment),y=B(),I.c(),Y=De(),$(e,"class","secondary"),$(i,"class","secondary"),z(n,"display","flex"),z(n,"justify-content","space-between"),z(k,"color","red")},m(a,v){_(a,n,v),M(n,e),M(n,t),M(n,i),_(a,s,v),_(a,f,v),_(a,o,v),_(a,r,v),M(r,m),M(r,g),M(r,k),M(k,b),M(k,J),M(r,j),M(r,O),M(r,S),_(a,K,v),q(G,a,v),_(a,P,v),q(p,a,v),_(a,y,v),D[L].m(a,v),_(a,Y,v),F=!0,ee||(ce=[U(e,"click",l[12]),U(i,"click",l[11])],ee=!0)},p(a,v){(!F||v&16)&&c!==(c=a[4].features.length+"")&&X(m,c),(!F||v&1)&&w!==(w=a[0].features.length+"")&&X(b,w),(!F||v&4)&&H!==(H=a[2].filter(Ge).length+"")&&X(O,H);const V={};!Q&&v&32&&(Q=!0,V.options=a[5],Ke(()=>Q=!1)),G.$set(V);const A={};v&128&&(A.items=a[7]),v&1&&(A.total=a[0].features.length),v&4194433&&(A.$$scope={dirty:v,ctx:a}),p.$set(A);let te=L;L=Z(a),L===te?D[L].p(a,v):(ge(),E(D[te],1,1,()=>{D[te]=null}),he(),I=D[L],I?I.p(a,v):(I=D[L]=h[L](a),I.c()),C(I,1),I.m(Y.parentNode,Y))},i(a){F||(C(G.$$.fragment,a),C(p.$$.fragment,a),C(I),F=!0)},o(a){E(G.$$.fragment,a),E(p.$$.fragment,a),E(I),F=!1},d(a){a&&(d(n),d(s),d(f),d(o),d(r),d(K),d(P),d(y),d(Y)),R(G,a),R(p,a),D[L].d(a),ee=!1,Ze(ce)}}}function ht(l){let n,e,t=l[0].features.length+"",i,s;return{c(){n=N(l[7]),e=N(" / "),i=N(t),s=N(" targets reviewed")},m(f,o){_(f,n,o),_(f,e,o),_(f,i,o),_(f,s,o)},p(f,o){o&128&&X(n,f[7]),o&1&&t!==(t=f[0].features.length+"")&&X(i,t)},d(f){f&&(d(n),d(e),d(i),d(s))}}}function kt(l){let n,e;return n=new gt({props:{clickedTarget:l[1],targetGj:l[0],matchingSourceIndices:l[8],onConfirm:l[13]}}),{c(){W(n.$$.fragment)},m(t,i){q(n,t,i),e=!0},p(t,i){const s={};i&2&&(s.clickedTarget=t[1]),i&1&&(s.targetGj=t[0]),i&256&&(s.matchingSourceIndices=t[8]),n.$set(s)},i(t){e||(C(n.$$.fragment,t),e=!0)},o(t){E(n.$$.fragment,t),e=!1},d(t){R(n,t)}}}function bt(l){let n,e,t;return{c(){n=T("button"),n.textContent="Goto next unreviewed"},m(i,s){_(i,n,s),e||(t=U(n,"click",l[15]),e=!0)},p:ie,i:ie,o:ie,d(i){i&&d(n),e=!1,t()}}}function wt(l){let n,e,t,i,s,f,o,r,c,m,g=l[4].features.length>0&&Je(l);return{c(){n=T("div"),e=T("h1"),e.textContent="Match LineStrings - review results to make test cases",t=B(),i=T("label"),s=N(`Load two .geojson files
      `),f=T("input"),o=B(),g&&g.c(),$(f,"type","file"),f.multiple=!0,$(n,"slot","left")},m(k,w){_(k,n,w),M(n,e),M(n,t),M(n,i),M(i,s),M(i,f),l[19](f),M(n,o),g&&g.m(n,null),r=!0,c||(m=U(f,"change",l[10]),c=!0)},p(k,w){k[4].features.length>0?g?(g.p(k,w),w&16&&C(g,1)):(g=Je(k),g.c(),C(g,1),g.m(n,null)):g&&(ge(),E(g,1,1,()=>{g=null}),he())},i(k){r||(C(g),r=!0)},o(k){E(g),r=!1},d(k){k&&d(n),l[19](null),g&&g.d(),c=!1,m()}}}function Ot(l){let n,e=de(l[21]).id+"",t;return{c(){n=N("Source "),t=N(e)},m(i,s){_(i,n,s),_(i,t,s)},p(i,s){s&2097152&&e!==(e=de(i[21]).id+"")&&X(t,e)},d(i){i&&(d(n),d(t))}}}function yt(l){let n,e;return n=new Ue({props:{openOn:"hover",$$slots:{default:[Ot,({data:t})=>({21:t}),({data:t})=>t?2097152:0]},$$scope:{ctx:l}}}),{c(){W(n.$$.fragment)},m(t,i){q(n,t,i),e=!0},p(t,i){const s={};i&6291456&&(s.$$scope={dirty:i,ctx:t}),n.$set(s)},i(t){e||(C(n.$$.fragment,t),e=!0)},o(t){E(n.$$.fragment,t),e=!1},d(t){R(n,t)}}}function vt(l){let n,e;return n=new Qe({props:{manageHoverState:!0,paint:{"line-width":["case",["in",["id"],["literal",l[8]]],8,5],"line-color":"black","line-opacity":Te(.5,1)},$$slots:{default:[yt]},$$scope:{ctx:l}}}),{c(){W(n.$$.fragment)},m(t,i){q(n,t,i),e=!0},p(t,i){const s={};i&256&&(s.paint={"line-width":["case",["in",["id"],["literal",t[8]]],8,5],"line-color":"black","line-opacity":Te(.5,1)}),i&4194304&&(s.$$scope={dirty:i,ctx:t}),n.$set(s)},i(t){e||(C(n.$$.fragment,t),e=!0)},o(t){E(n.$$.fragment,t),e=!1},d(t){R(n,t)}}}function Ct(l){let n,e=de(l[21]).id+"",t,i,s=JSON.stringify(l[8])+"",f;return{c(){n=N("Target "),t=N(e),i=N(" matches "),f=N(s)},m(o,r){_(o,n,r),_(o,t,r),_(o,i,r),_(o,f,r)},p(o,r){r&2097152&&e!==(e=de(o[21]).id+"")&&X(t,e),r&256&&s!==(s=JSON.stringify(o[8])+"")&&X(f,s)},d(o){o&&(d(n),d(t),d(i),d(f))}}}function Mt(l){let n,e;return n=new Ue({props:{openOn:"hover",$$slots:{default:[Ct,({data:t})=>({21:t}),({data:t})=>t?2097152:0]},$$scope:{ctx:l}}}),{c(){W(n.$$.fragment)},m(t,i){q(n,t,i),e=!0},p(t,i){const s={};i&6291712&&(s.$$scope={dirty:i,ctx:t}),n.$set(s)},i(t){e||(C(n.$$.fragment,t),e=!0)},o(t){E(n.$$.fragment,t),e=!1},d(t){R(n,t)}}}function St(l){let n,e;return n=new Qe({props:{manageHoverState:!0,paint:{"line-width":8,"line-color":["match",["get","reviewed"],"unreviewed","red","blue"],"line-opacity":["case",["==",["id"],l[1]??-1],1,["boolean",["feature-state","hover"],!1],.6,["get","has_match"],.5,.2]},hoverCursor:"pointer",$$slots:{default:[Mt]},$$scope:{ctx:l}}}),n.$on("click",l[16]),{c(){W(n.$$.fragment)},m(t,i){q(n,t,i),e=!0},p(t,i){const s={};i&2&&(s.paint={"line-width":8,"line-color":["match",["get","reviewed"],"unreviewed","red","blue"],"line-opacity":["case",["==",["id"],t[1]??-1],1,["boolean",["feature-state","hover"],!1],.6,["get","has_match"],.5,.2]}),i&4194560&&(s.$$scope={dirty:i,ctx:t}),n.$set(s)},i(t){e||(C(n.$$.fragment,t),e=!0)},o(t){E(n.$$.fragment,t),e=!1},d(t){R(n,t)}}}function Lt(l){let n,e,t,i,s,f;return n=new rt({}),n.$on("click",l[14]),t=new Ne({props:{data:l[4],$$slots:{default:[vt]},$$scope:{ctx:l}}}),s=new Ne({props:{data:l[0],$$slots:{default:[St]},$$scope:{ctx:l}}}),{c(){W(n.$$.fragment),e=B(),W(t.$$.fragment),i=B(),W(s.$$.fragment)},m(o,r){q(n,o,r),_(o,e,r),q(t,o,r),_(o,i,r),q(s,o,r),f=!0},p(o,r){const c={};r&16&&(c.data=o[4]),r&4194560&&(c.$$scope={dirty:r,ctx:o}),t.$set(c);const m={};r&1&&(m.data=o[0]),r&4194562&&(m.$$scope={dirty:r,ctx:o}),s.$set(m)},i(o){f||(C(n.$$.fragment,o),C(t.$$.fragment,o),C(s.$$.fragment,o),f=!0)},o(o){E(n.$$.fragment,o),E(t.$$.fragment,o),E(s.$$.fragment,o),f=!1},d(o){o&&(d(e),d(i)),R(n,o),R(t,o),R(s,o)}}}function jt(l){let n,e,t,i;function s(o){l[17](o)}let f={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Lt]},$$scope:{ctx:l}};return l[3]!==void 0&&(f.map=l[3]),e=new nt({props:f}),ke.push(()=>Ve(e,"map",s)),e.$on("error",l[18]),{c(){n=T("div"),W(e.$$.fragment),$(n,"slot","main"),z(n,"position","relative"),z(n,"width","100%"),z(n,"height","100vh")},m(o,r){_(o,n,r),q(e,n,null),i=!0},p(o,r){const c={};r&4194579&&(c.$$scope={dirty:r,ctx:o}),!t&&r&8&&(t=!0,c.map=o[3],Ke(()=>t=!1)),e.$set(c)},i(o){i||(C(e.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),i=!1},d(o){o&&d(n),R(e)}}}function Nt(l){let n,e;return n=new tt({props:{$$slots:{main:[jt],left:[wt]},$$scope:{ctx:l}}}),{c(){W(n.$$.fragment)},m(t,i){q(n,t,i),e=!0},p(t,[i]){const s={};i&4194815&&(s.$$scope={dirty:i,ctx:t}),n.$set(s)},i(t){e||(C(n.$$.fragment,t),e=!0)},o(t){E(n.$$.fragment,t),e=!1},d(t){R(n,t)}}}function _e(l){let n=0;for(let e of l.features)e.id=n++,e.properties??(e.properties={});return l}const Ge=l=>l.matching_sources.length>0;function Tt(l,n,e){let t,i,s,f=Le(),o=Le(),r=null,c={buffer_meters:20,angle_diff_threshold:10,length_ratio_threshold:1.1,midpt_dist_threshold:15},m=[];ze(async()=>{await ot(),e(4,f=_e(await(await fetch("/sources.geojson")).json())),e(0,o=_e(await(await fetch("/targets.geojson")).json())),b(),e(1,r=null),g()});function g(){var p;try{e(2,m=JSON.parse(lt(JSON.stringify(f),JSON.stringify(o),c)))}catch(y){window.alert(`Bug: ${y}`);return}for(let[y,L]of o.features.entries())L.properties.has_match=m[y].matching_sources.length>0,(p=L.properties).reviewed??(p.reviewed="unreviewed");e(0,o)}let k;async function w(p){if(!k.files)return;if(k.files.length!=2){window.alert("Select two GeoJSON files");return}try{let L=await k.files[0].text(),I=await k.files[1].text();e(4,f=_e(JSON.parse(L))),e(0,o=_e(JSON.parse(I))),b(),e(1,r=null),g()}catch(L){window.alert(`Bad input file: ${L}`)}}function b(){let p={type:"FeatureCollection",features:[...f.features,...o.features]};s==null||s.fitBounds(je(p),{animate:!1,padding:10})}function J(){e(4,[f,o]=[o,f],f,e(0,o)),g()}function j(p){if(r==null)throw new Error("impossible");e(0,o.features[r].properties.reviewed=p,o),e(0,o),e(1,r=null)}function H(p){e(1,r=null)}function O(){for(let p of o.features)if(p.properties.reviewed=="unreviewed"){s==null||s.fitBounds(je(p),{animate:!1,padding:200}),e(1,r=p.id);return}}const S=p=>e(1,r=p.detail.features[0].id);function K(p){s=p,e(3,s)}const G=p=>{console.log(p.detail.error)};function Q(p){ke[p?"unshift":"push"](()=>{k=p,e(6,k)})}function P(p){c=p,e(5,c)}return l.$$.update=()=>{l.$$.dirty&6&&e(8,t=r==null?[]:m[r].matching_sources),l.$$.dirty&1&&e(7,i=o.features.filter(p=>p.properties.reviewed!="unreviewed").length)},[o,r,m,s,f,c,k,i,t,g,w,b,J,j,H,O,S,K,G,Q,P]}class Et extends re{constructor(n){super(),fe(this,n,Tt,Nt,ue,{})}}new Et({target:document.getElementById("app")});
