import{S as fe,i as ae,s as ce,k as h,t as M,e as y,n as x,q as $,r as p,P as ve,Q as lt,R as ot,T as it,U as he,o as Ze,V as st,W as se,X as rt,w as L,A as Y,Y as Qe,Z as Ve,$ as Xe,a0 as Ye,a1 as ut,a2 as ft,B as re,d as W,C as ue,g as q,h as U,a3 as at,a4 as oe,a5 as ne,a6 as ct,D as B,z as S,J as V,u as k,x as E,y as J,I as Oe,a7 as ie,v as A,a8 as mt,E as dt,H as gt,L as _t,j as pe,M as bt,a9 as ht,G as pt,K as ze,N as xe,O as Ne,aa as ke,_ as kt,F as De}from"./Settings-aCCF39mr.js";function Ee(l){return(l==null?void 0:l.length)!==void 0?l:Array.from(l)}const wt=l=>({features:l[0]&16,data:l[0]&16,map:l[0]&4,close:l[0]&1}),He=l=>{var e;return{features:l[4],data:((e=l[4])==null?void 0:e[0])??null,map:l[2],close:l[31]}};function Pe(l){var r;let e,t,n=(((r=l[4])==null?void 0:r.length)||l[3]instanceof se.Marker)&&Je(l);return{c(){e=L("div"),n&&n.c()},m(i,o){p(i,e,o),n&&n.m(e,null),l[32](e),t=!0},p(i,o){var s;(s=i[4])!=null&&s.length||i[3]instanceof se.Marker?n?(n.p(i,o),o[0]&24&&y(n,1)):(n=Je(i),n.c(),y(n,1),n.m(e,null)):n&&(x(),M(n,1,1,()=>{n=null}),$())},i(i){t||(y(n),t=!0)},o(i){M(n),t=!1},d(i){i&&h(e),n&&n.d(),l[32](null)}}}function Je(l){let e;const t=l[30].default,n=Qe(t,l,l[29],He);return{c(){n&&n.c()},m(r,i){n&&n.m(r,i),e=!0},p(r,i){n&&n.p&&(!e||i[0]&536870933)&&Ve(n,t,r,r[29],e?Ye(t,r[29],i,wt):Xe(r[29]),He)},i(r){e||(y(n,r),e=!0)},o(r){M(n,r),e=!1},d(r){n&&n.d(r)}}}function vt(l){let e,t,n=l[9].default&&Pe(l);return{c(){n&&n.c(),e=ve()},m(r,i){n&&n.m(r,i),p(r,e,i),t=!0},p(r,i){r[9].default?n?(n.p(r,i),i[0]&512&&y(n,1)):(n=Pe(r),n.c(),y(n,1),n.m(e.parentNode,e)):n&&(x(),M(n,1,1,()=>{n=null}),$())},i(r){t||(y(n),t=!0)},o(r){M(n),t=!1},d(r){r&&h(e),n&&n.d(r)}}}function yt(l,e,t){let n,r,i,o,s,u,{$$slots:c={},$$scope:f}=e;const v=lt(c);let{closeButton:m=void 0}=e,{closeOnClickOutside:C=!0}=e,{closeOnClickInside:I=!1}=e,{closeOnMove:H=!1}=e,{openOn:g="click"}=e,{openIfTopMost:P=!0}=e,{focusAfterOpen:O=!0}=e,{anchor:N=void 0}=e,{offset:F=void 0}=e,{popupClass:w=void 0}=e,{maxWidth:_=void 0}=e,{lngLat:G=void 0}=e,{html:Z=void 0}=e,{open:D=!1}=e;const b=ot(),{map:R,popupTarget:d,layerEvent:K,layer:me,eventTopMost:de,markerClickManager:Q}=it();he(l,R,a=>t(2,i=a)),he(l,d,a=>t(3,s=a)),he(l,K,a=>t(28,o=a)),he(l,me,a=>t(35,u=a));const ge=["click","dblclick","contextmenu"];let T,j=!1,z;function et(){if(!T)return;let a=T.getElement();!a||a===z||(z=a,g==="hover"&&(z.style.pointerEvents="none"),z.addEventListener("mouseenter",()=>{t(24,j=!0)},{passive:!0}),z.addEventListener("mouseleave",()=>{t(24,j=!1)},{passive:!0}),z.addEventListener("click",()=>{I&&t(0,D=!1)},{passive:!0}))}Ze(()=>{if(i)return i.on("click",be),i.on("contextmenu",be),Q.add(Ie),typeof s=="string"&&(i.on("click",s,te),i.on("dblclick",s,te),i.on("contextmenu",s,te),i.on("mousemove",s,Ge),i.on("mouseleave",s,Me),i.on("touchstart",s,je),i.on("touchend",s,Se)),()=>{i!=null&&i.loaded()&&(T==null||T.remove(),i.off("click",be),i.off("contextmenu",be),Q.remove(Ie),s instanceof se.Marker?s.getPopup()===T&&s.setPopup(void 0):typeof s=="string"&&(i.off("click",s,te),i.off("dblclick",s,te),i.off("contextmenu",s,te),i.off("mousemove",s,Ge),i.off("mouseleave",s,Me),i.off("touchstart",s,je),i.off("touchend",s,Se)))}});function Le(a){return P?!("marker"in a)&&!ut(a)&&de(a)!==u:!1}let ee=null,X="normal";function Te(a){"layerType"in a&&a.layerType==="deckgl"?(t(10,G=a.coordinate),t(4,ee=a.object?[a.object]:null)):(t(10,G=a.lngLat),t(4,ee=a.features??[]))}function te(a){a.type!==g||Le(a)||(Te(a),setTimeout(()=>t(0,D=!0)))}let le=null;function je(a){le=a.point}function Se(a){if(!le||g!=="hover")return;let ye=le.dist(a.point);le=null,ye<3&&(t(10,G=a.lngLat),t(4,ee=a.features??[]),T.isOpen()?t(25,X="justOpened"):(t(25,X="opening"),t(0,D=!0)))}function Me(a){g!=="hover"||le||X!=="normal"||(t(0,D=!1),t(4,ee=null))}function Ge(a){if(!(g!=="hover"||le||X!=="normal")){if(Le(a)){t(0,D=!1),t(4,ee=null);return}t(0,D=!0),t(4,ee=a.features??[]),t(10,G=a.lngLat)}}function be(a){if(X==="justOpened"){t(25,X="normal");return}if(!C)return;let ye=[z,s instanceof se.Marker?s==null?void 0:s.getElement():null];D&&T.isOpen()&&!ye.some(Ce=>Ce==null?void 0:Ce.contains(a.originalEvent.target))&&(a.type==="contextmenu"&&g==="contextmenu"||a.type!=="contextmenu")&&t(0,D=!1)}function Ie(a){C&&D&&T.isOpen()&&a.marker!==s&&t(0,D=!1)}st(()=>{i&&(T!=null&&T.isOpen())&&T.remove()});let _e;const tt=()=>t(0,D=!1);function nt(a){Y[a?"unshift":"push"](()=>{_e=a,t(1,_e)})}return l.$$set=a=>{"closeButton"in a&&t(11,m=a.closeButton),"closeOnClickOutside"in a&&t(12,C=a.closeOnClickOutside),"closeOnClickInside"in a&&t(13,I=a.closeOnClickInside),"closeOnMove"in a&&t(14,H=a.closeOnMove),"openOn"in a&&t(15,g=a.openOn),"openIfTopMost"in a&&t(16,P=a.openIfTopMost),"focusAfterOpen"in a&&t(17,O=a.focusAfterOpen),"anchor"in a&&t(18,N=a.anchor),"offset"in a&&t(19,F=a.offset),"popupClass"in a&&t(20,w=a.popupClass),"maxWidth"in a&&t(21,_=a.maxWidth),"lngLat"in a&&t(10,G=a.lngLat),"html"in a&&t(22,Z=a.html),"open"in a&&t(0,D=a.open),"$$scope"in a&&t(29,f=a.$$scope)},l.$$.update=()=>{if(l.$$.dirty[0]&14336&&t(27,n=m??(!C&&!I)),l.$$.dirty[0]&146685952&&(T||(t(23,T=new se.Popup({closeButton:n,closeOnClick:!1,closeOnMove:H,focusAfterOpen:O,maxWidth:_,className:w,anchor:N,offset:F})),z=T.getElement(),T.on("open",()=>{t(0,D=!0),et(),b("open",T)}),T.on("close",()=>{t(0,D=!1),b("close",T)}),T.on("hover",()=>{b("hover",T)}))),l.$$.dirty[0]&8421384&&T&&s instanceof se.Marker&&(g==="click"?s.setPopup(T):s.getPopup()===T&&s.setPopup(void 0)),l.$$.dirty[0]&268468224&&ge.includes(g)&&(o==null?void 0:o.type)===g&&(te(o),rt(K,o=null,o)),l.$$.dirty[0]&268468224&&t(26,r=g==="hover"&&((o==null?void 0:o.type)==="mousemove"||(o==null?void 0:o.type)==="mouseenter")),l.$$.dirty[0]&352354304&&g==="hover"&&K&&(r&&o&&Te(o),t(0,D=(r||j)??!1)),l.$$.dirty[0]&12582914&&(_e?T.setDOMContent(_e):Z&&T.setHTML(Z)),l.$$.dirty[0]&8389632&&G&&T.setLngLat(G),l.$$.dirty[0]&41943045&&i){let a=T.isOpen();D&&!a?(T.addTo(i),X==="opening"&&t(25,X="justOpened")):!D&&a&&T.remove()}},[D,_e,i,s,ee,R,d,K,me,v,G,m,C,I,H,g,P,O,N,F,w,_,Z,T,j,X,r,n,o,f,c,tt,nt]}class Ct extends fe{constructor(e){super(),ae(this,e,yt,vt,ce,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function Ot(l){let e;const t=l[16].default,n=Qe(t,l,l[24],null);return{c(){n&&n.c()},m(r,i){n&&n.m(r,i),e=!0},p(r,i){n&&n.p&&(!e||i&16777216)&&Ve(n,t,r,r[24],e?Ye(t,r[24],i,null):Xe(r[24]),null)},i(r){e||(y(n,r),e=!0)},o(r){M(n,r),e=!1},d(r){n&&n.d(r)}}}function Lt(l){let e,t,n;function r(o){l[17](o)}let i={id:l[1],type:"symbol",source:l[2],sourceLayer:l[3],beforeId:l[4],beforeLayerType:l[5],paint:l[6],layout:l[7],filter:l[8],applyToClusters:l[9],minzoom:l[10],maxzoom:l[11],hoverCursor:l[12],manageHoverState:l[13],eventsIfTopMost:l[14],interactive:l[15],$$slots:{default:[Ot]},$$scope:{ctx:l}};return l[0]!==void 0&&(i.hovered=l[0]),e=new ft({props:i}),Y.push(()=>re(e,"hovered",r)),e.$on("click",l[18]),e.$on("dblclick",l[19]),e.$on("contextmenu",l[20]),e.$on("mouseenter",l[21]),e.$on("mousemove",l[22]),e.$on("mouseleave",l[23]),{c(){U(e.$$.fragment)},m(o,s){q(e,o,s),n=!0},p(o,[s]){const u={};s&2&&(u.id=o[1]),s&4&&(u.source=o[2]),s&8&&(u.sourceLayer=o[3]),s&16&&(u.beforeId=o[4]),s&32&&(u.beforeLayerType=o[5]),s&64&&(u.paint=o[6]),s&128&&(u.layout=o[7]),s&256&&(u.filter=o[8]),s&512&&(u.applyToClusters=o[9]),s&1024&&(u.minzoom=o[10]),s&2048&&(u.maxzoom=o[11]),s&4096&&(u.hoverCursor=o[12]),s&8192&&(u.manageHoverState=o[13]),s&16384&&(u.eventsIfTopMost=o[14]),s&32768&&(u.interactive=o[15]),s&16777216&&(u.$$scope={dirty:s,ctx:o}),!t&&s&1&&(t=!0,u.hovered=o[0],ue(()=>t=!1)),e.$set(u)},i(o){n||(y(e.$$.fragment,o),n=!0)},o(o){M(e.$$.fragment,o),n=!1},d(o){W(e,o)}}}function Tt(l,e,t){let{$$slots:n={},$$scope:r}=e,{id:i=at("symbol")}=e,{source:o=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:u=void 0}=e,{beforeLayerType:c=void 0}=e,{paint:f=void 0}=e,{layout:v=void 0}=e,{filter:m=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:I=void 0}=e,{maxzoom:H=void 0}=e,{hoverCursor:g=void 0}=e,{manageHoverState:P=!1}=e,{hovered:O=null}=e,{eventsIfTopMost:N=!1}=e,{interactive:F=!0}=e;function w(d){O=d,t(0,O)}function _(d){oe.call(this,l,d)}function G(d){oe.call(this,l,d)}function Z(d){oe.call(this,l,d)}function D(d){oe.call(this,l,d)}function b(d){oe.call(this,l,d)}function R(d){oe.call(this,l,d)}return l.$$set=d=>{"id"in d&&t(1,i=d.id),"source"in d&&t(2,o=d.source),"sourceLayer"in d&&t(3,s=d.sourceLayer),"beforeId"in d&&t(4,u=d.beforeId),"beforeLayerType"in d&&t(5,c=d.beforeLayerType),"paint"in d&&t(6,f=d.paint),"layout"in d&&t(7,v=d.layout),"filter"in d&&t(8,m=d.filter),"applyToClusters"in d&&t(9,C=d.applyToClusters),"minzoom"in d&&t(10,I=d.minzoom),"maxzoom"in d&&t(11,H=d.maxzoom),"hoverCursor"in d&&t(12,g=d.hoverCursor),"manageHoverState"in d&&t(13,P=d.manageHoverState),"hovered"in d&&t(0,O=d.hovered),"eventsIfTopMost"in d&&t(14,N=d.eventsIfTopMost),"interactive"in d&&t(15,F=d.interactive),"$$scope"in d&&t(24,r=d.$$scope)},[O,i,o,s,u,c,f,v,m,C,I,H,g,P,N,F,n,w,_,G,Z,D,b,R,r]}class $e extends fe{constructor(e){super(),ae(this,e,Tt,Lt,ce,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function Be(l,e,t){const n=l.slice();return n[4]=e[t][0],n[5]=e[t][1],n}function Fe(l){let e,t,n,r,i=l[4]+"",o,s;return{c(){e=L("div"),t=L("span"),r=E(),o=J(i),s=E(),S(t,"class",n="color-swatch "+l[1]+" svelte-1enycr6"),B(t,"background",l[5]),B(e,"display","flex"),B(e,"align-items","center"),B(e,"gap","6px")},m(u,c){p(u,e,c),k(e,t),k(e,r),k(e,o),k(e,s)},p(u,c){c&2&&n!==(n="color-swatch "+u[1]+" svelte-1enycr6")&&S(t,"class",n),c&1&&B(t,"background",u[5]),c&1&&i!==(i=u[4]+"")&&V(o,i)},d(u){u&&h(e)}}}function jt(l){let e,t=Ee(Object.entries(l[0])),n=[];for(let r=0;r<t.length;r+=1)n[r]=Fe(Be(l,t,r));return{c(){e=L("div");for(let r=0;r<n.length;r+=1)n[r].c();B(e,"display","grid"),B(e,"grid-template-columns","repeat(auto-fill, calc("+l[2]+" - 10px))"),B(e,"gap","10px")},m(r,i){p(r,e,i);for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(e,null)},p(r,[i]){if(i&3){t=Ee(Object.entries(r[0]));let o;for(o=0;o<t.length;o+=1){const s=Be(r,t,o);n[o]?n[o].p(s,i):(n[o]=Fe(s),n[o].c(),n[o].m(e,null))}for(;o<n.length;o+=1)n[o].d(1);n.length=t.length}i&4&&B(e,"grid-template-columns","repeat(auto-fill, calc("+r[2]+" - 10px))")},i:ne,o:ne,d(r){r&&h(e),ct(n,r)}}}function St(l,e,t){let n,{labelColors:r}=e,{swatchClass:i="rectangle"}=e,{itemsPerRow:o=2}=e;return l.$$set=s=>{"labelColors"in s&&t(0,r=s.labelColors),"swatchClass"in s&&t(1,i=s.swatchClass),"itemsPerRow"in s&&t(3,o=s.itemsPerRow)},l.$$.update=()=>{l.$$.dirty&8&&t(2,n=`${100/o}%`)},[r,i,n,o]}class Mt extends fe{constructor(e){super(),ae(this,e,St,jt,ce,{labelColors:0,swatchClass:1,itemsPerRow:3})}}let we="match-linestrings-review";function Gt(l){let e,t,n,r,i,o=JSON.stringify(l[1].features[l[0]].properties.matching_sources)+"",s,u,c,f,v,m,C,I,H,g,P,O,N,F;return{c(){e=L("div"),t=L("h3"),n=J("Target "),r=J(l[0]),i=J(": "),s=J(o),u=E(),c=L("button"),c.innerHTML=`<kbd>Escape</kbd>
    - Back`,f=E(),v=L("h6"),v.textContent="Click sources to add or remove",m=E(),C=L("div"),I=L("button"),I.innerHTML=`<kbd>1</kbd>
    - Unreviewed`,H=E(),g=L("button"),g.innerHTML=`<kbd>2</kbd>
    - Not sure`,P=E(),O=L("button"),O.innerHTML=`<kbd>3</kbd>
    - Confirm correct`,S(c,"class","btn btn-secondary"),B(e,"display","flex"),B(e,"justify-content","space-between"),S(I,"class","btn btn-danger svelte-1tzb8bs"),ie(I,"current",l[4]=="unreviewed"),S(g,"class","btn btn-warning svelte-1tzb8bs"),ie(g,"current",l[4]=="not sure"),S(O,"class","btn btn-success svelte-1tzb8bs"),ie(O,"current",l[4]=="confirmed"),B(C,"display","flex"),B(C,"justify-content","space-between")},m(w,_){p(w,e,_),k(e,t),k(t,n),k(t,r),k(t,i),k(t,s),k(e,u),k(e,c),p(w,f,_),p(w,v,_),p(w,m,_),p(w,C,_),k(C,I),k(C,H),k(C,g),k(C,P),k(C,O),N||(F=[A(window,"keydown",l[5]),A(c,"click",function(){mt(l[3])&&l[3].apply(this,arguments)}),A(I,"click",l[6]),A(g,"click",l[7]),A(O,"click",l[8])],N=!0)},p(w,[_]){l=w,_&1&&V(r,l[0]),_&3&&o!==(o=JSON.stringify(l[1].features[l[0]].properties.matching_sources)+"")&&V(s,o),_&16&&ie(I,"current",l[4]=="unreviewed"),_&16&&ie(g,"current",l[4]=="not sure"),_&16&&ie(O,"current",l[4]=="confirmed")},i:ne,o:ne,d(w){w&&(h(e),h(f),h(v),h(m),h(C)),N=!1,Oe(F)}}}function It(l,e,t){let n,{clickedTarget:r}=e,{targetGj:i}=e,{onConfirm:o}=e,{onCancel:s}=e;function u(m){m.target.tagName!="INPUT"&&(m.key=="1"?o("unreviewed"):m.key=="2"?o("not sure"):m.key=="3"?o("confirmed"):m.key=="Escape"&&s())}const c=()=>o("unreviewed"),f=()=>o("not sure"),v=()=>o("confirmed");return l.$$set=m=>{"clickedTarget"in m&&t(0,r=m.clickedTarget),"targetGj"in m&&t(1,i=m.targetGj),"onConfirm"in m&&t(2,o=m.onConfirm),"onCancel"in m&&t(3,s=m.onCancel)},l.$$.update=()=>{l.$$.dirty&3&&t(4,n=i.features[r].properties.reviewed)},[r,i,o,s,n,u,c,f,v]}class zt extends fe{constructor(e){super(),ae(this,e,It,Gt,ce,{clickedTarget:0,targetGj:1,onConfirm:2,onCancel:3})}}function Re(l){let e,t,n,r,i=l[0].features.length+"",o,s,u=l[1].features.length+"",c,f,v=l[1].features.filter(qe).length+"",m,C,I,H,g,P,O,N,F,w=!l[3]&&Ae(l);return{c(){e=L("button"),t=J("Swap"),n=E(),r=L("p"),o=J(i),s=J(` sources and
    `),c=J(u),f=J(" targets , with "),m=J(v),C=J(" matching a source"),I=E(),H=L("button"),H.textContent="Start review",g=E(),w&&w.c(),P=ve(),S(e,"class","btn btn-secondary"),e.disabled=l[3],S(H,"class","btn btn-primary mb-5")},m(_,G){p(_,e,G),k(e,t),p(_,n,G),p(_,r,G),k(r,o),k(r,s),k(r,c),k(r,f),k(r,m),k(r,C),p(_,I,G),p(_,H,G),p(_,g,G),w&&w.m(_,G),p(_,P,G),O=!0,N||(F=[A(e,"click",l[8]),A(H,"click",l[11])],N=!0)},p(_,G){(!O||G&8)&&(e.disabled=_[3]),(!O||G&1)&&i!==(i=_[0].features.length+"")&&V(o,i),(!O||G&2)&&u!==(u=_[1].features.length+"")&&V(c,u),(!O||G&2)&&v!==(v=_[1].features.filter(qe).length+"")&&V(m,v),_[3]?w&&(x(),M(w,1,1,()=>{w=null}),$()):w?(w.p(_,G),G&8&&y(w,1)):(w=Ae(_),w.c(),y(w,1),w.m(P.parentNode,P))},i(_){O||(y(w),O=!0)},o(_){M(w),O=!1},d(_){_&&(h(e),h(n),h(r),h(I),h(H),h(g),h(P)),w&&w.d(_),N=!1,Oe(F)}}}function Ae(l){let e,t,n;function r(o){l[12](o)}let i={onChange:l[6]};return l[4]!==void 0&&(i.options=l[4]),e=new gt({props:i}),Y.push(()=>re(e,"options",r)),{c(){U(e.$$.fragment)},m(o,s){q(e,o,s),n=!0},p(o,s){const u={};!t&&s&16&&(t=!0,u.options=o[4],ue(()=>t=!1)),e.$set(u)},i(o){n||(y(e.$$.fragment,o),n=!0)},o(o){M(e.$$.fragment,o),n=!1},d(o){W(e,o)}}}function Nt(l){let e,t,n,r,i,o,s,u,c=l[0].features.length>0&&Re(l);return{c(){e=L("label"),t=J(`Load two .geojson files
  `),n=L("input"),r=E(),c&&c.c(),i=ve(),S(n,"class","form-control"),S(n,"type","file"),n.multiple=!0,S(e,"class","form-label")},m(f,v){p(f,e,v),k(e,t),k(e,n),l[10](n),p(f,r,v),c&&c.m(f,v),p(f,i,v),o=!0,s||(u=A(n,"change",l[7]),s=!0)},p(f,[v]){f[0].features.length>0?c?(c.p(f,v),v&1&&y(c,1)):(c=Re(f),c.c(),y(c,1),c.m(i.parentNode,i)):c&&(x(),M(c,1,1,()=>{c=null}),$())},i(f){o||(y(c),o=!0)},o(f){M(c),o=!1},d(f){f&&(h(e),h(r),h(i)),l[10](null),c&&c.d(f),s=!1,u()}}}function We(l){let e=0;for(let t of l.features)t.id=e++,t.properties??(t.properties={});return l}const qe=l=>l.properties.matching_sources.length>0;function Dt(l,e,t){let{sourceGj:n}=e,{targetGj:r}=e,{setupDone:i}=e,{zoomFit:o}=e,s=!1,u={buffer_meters:20,angle_diff_threshold:10,length_ratio_threshold:1.1,midpt_dist_threshold:15};function c(){var g;if(!s)try{let P=JSON.parse(dt(JSON.stringify(n),JSON.stringify(r),u));for(let[O,N]of r.features.entries())N.properties.matching_sources=P[O].matching_sources,(g=N.properties).reviewed??(g.reviewed="unreviewed");t(1,r)}catch(P){window.alert(`Bug: ${P}`)}}let f;async function v(g){if(!f.files)return;if(f.files.length!=2){window.alert("Select two GeoJSON files");return}try{let O=await f.files[0].text(),N=await f.files[1].text();t(0,n=We(JSON.parse(O))),t(1,r=We(JSON.parse(N))),"matching_sources"in r.features[0].properties?t(3,s=!0):"matching_sources"in n.features[0].properties&&(t(3,s=!0),t(0,[n,r]=[r,n],n,t(1,r))),o(),c()}catch(O){window.alert(`Bad input file: ${O}`)}}function m(){t(0,[n,r]=[r,n],n,t(1,r)),c()}function C(g){Y[g?"unshift":"push"](()=>{f=g,t(5,f)})}const I=()=>t(2,i=!0);function H(g){u=g,t(4,u)}return l.$$set=g=>{"sourceGj"in g&&t(0,n=g.sourceGj),"targetGj"in g&&t(1,r=g.targetGj),"setupDone"in g&&t(2,i=g.setupDone),"zoomFit"in g&&t(9,o=g.zoomFit)},[n,r,i,s,u,f,c,v,m,o,C,I,H]}class Et extends fe{constructor(e){super(),ae(this,e,Dt,Nt,ce,{sourceGj:0,targetGj:1,setupDone:2,zoomFit:9})}}const{window:Ht}=ht;function Pt(l){let e,t,n,r,i,o,s,u,c,f,v,m,C,I,H=l[1].features.length+"",g,P,O,N,F,w,_,G,Z,D,b,R,d,K,me,de,Q,ge,T;return K=new Mt({props:{itemsPerRow:1,labelColors:{Confirmed:"green","Not sure":"orange",Unreviewed:"red",Source:"grey"}}}),{c(){e=L("div"),t=L("button"),t.textContent="Start over",n=E(),r=L("button"),r.textContent="Zoom to fit",i=E(),o=L("br"),s=E(),u=L("div"),c=L("div"),v=E(),m=L("p"),C=J(l[4]),I=J(" / "),g=J(H),P=J(" targets reviewed"),O=E(),N=L("button"),N.textContent="Download reviews",F=E(),w=L("label"),_=L("input"),G=J(`
        Show labels for matches`),Z=E(),D=L("div"),b=L("div"),R=L("h5"),R.textContent="Legend",d=E(),U(K.$$.fragment),me=E(),de=L("p"),de.textContent="Thinner lines have a match, thicker are off-road",S(t,"class","btn btn-outline-danger"),S(r,"class","btn btn-outline-secondary"),B(e,"display","flex"),B(e,"justify-content","space-between"),S(c,"class","progress-bar"),B(c,"width",`${100*l[4]/l[1].features.length}%`),S(u,"class","progress"),S(u,"role","progressbar"),S(u,"aria-valuenow",l[4]),S(u,"aria-valuemin","0"),S(u,"aria-valuemax",f=l[1].features.length),S(N,"class","btn btn-outline-success"),S(_,"class","form-check-input"),S(_,"type","checkbox"),S(w,"class","form-check-label mt-5"),S(R,"class","card-title"),S(b,"class","card-body"),S(D,"class","card")},m(j,z){p(j,e,z),k(e,t),k(e,n),k(e,r),p(j,i,z),p(j,o,z),p(j,s,z),p(j,u,z),k(u,c),p(j,v,z),p(j,m,z),k(m,C),k(m,I),k(m,g),k(m,P),p(j,O,z),p(j,N,z),p(j,F,z),p(j,w,z),k(w,_),_.checked=l[6],k(w,G),p(j,Z,z),p(j,D,z),k(D,b),k(b,R),k(b,d),q(K,b,null),k(b,me),k(b,de),Q=!0,ge||(T=[A(t,"click",l[13]),A(r,"click",l[8]),A(N,"click",l[12]),A(_,"change",l[22])],ge=!0)},p(j,z){z&18&&B(c,"width",`${100*j[4]/j[1].features.length}%`),(!Q||z&16)&&S(u,"aria-valuenow",j[4]),(!Q||z&2&&f!==(f=j[1].features.length))&&S(u,"aria-valuemax",f),(!Q||z&16)&&V(C,j[4]),(!Q||z&2)&&H!==(H=j[1].features.length+"")&&V(g,H),z&64&&(_.checked=j[6])},i(j){Q||(y(K.$$.fragment,j),Q=!0)},o(j){M(K.$$.fragment,j),Q=!1},d(j){j&&(h(e),h(i),h(o),h(s),h(u),h(v),h(m),h(O),h(N),h(F),h(w),h(Z),h(D)),W(K),ge=!1,Oe(T)}}}function Jt(l){let e,t,n,r,i;function o(f){l[19](f)}function s(f){l[20](f)}function u(f){l[21](f)}let c={zoomFit:l[8]};return l[0]!==void 0&&(c.sourceGj=l[0]),l[1]!==void 0&&(c.targetGj=l[1]),l[2]!==void 0&&(c.setupDone=l[2]),e=new Et({props:c}),Y.push(()=>re(e,"sourceGj",o)),Y.push(()=>re(e,"targetGj",s)),Y.push(()=>re(e,"setupDone",u)),{c(){U(e.$$.fragment)},m(f,v){q(e,f,v),i=!0},p(f,v){const m={};!t&&v&1&&(t=!0,m.sourceGj=f[0],ue(()=>t=!1)),!n&&v&2&&(n=!0,m.targetGj=f[1],ue(()=>n=!1)),!r&&v&4&&(r=!0,m.setupDone=f[2],ue(()=>r=!1)),e.$set(m)},i(f){i||(y(e.$$.fragment,f),i=!0)},o(f){M(e.$$.fragment,f),i=!1},d(f){W(e,f)}}}function Bt(l){let e,t,n,r,i,o,s,u;const c=[Jt,Pt],f=[];function v(m,C){return m[2]?1:0}return o=v(l),s=f[o]=c[o](l),{c(){e=L("div"),t=L("h1"),t.textContent="Manually specify LineString matchings for test cases",n=E(),r=L("div"),r.innerHTML='<a class="icon-link mb-3" href="https://github.com/nptscot/match_linestrings/blob/main/tests/README.md" target="_blank">About <i class="fa-solid fa-arrow-up-right-from-square"></i></a>',i=E(),s.c(),S(e,"slot","left")},m(m,C){p(m,e,C),k(e,t),k(e,n),k(e,r),k(e,i),f[o].m(e,null),u=!0},p(m,C){let I=o;o=v(m),o===I?f[o].p(m,C):(x(),M(f[I],1,1,()=>{f[I]=null}),$(),s=f[o],s?s.p(m,C):(s=f[o]=c[o](m),s.c()),y(s,1),s.m(e,null))},i(m){u||(y(s),u=!0)},o(m){M(s),u=!1},d(m){m&&h(e),f[o].d()}}}function Ue(l){let e,t,n,r;const i=[Rt,Ft],o=[];function s(u,c){return u[3]==null?0:1}return t=s(l),n=o[t]=i[t](l),{c(){e=L("div"),n.c(),S(e,"class","map-panel svelte-hr6p1s")},m(u,c){p(u,e,c),o[t].m(e,null),r=!0},p(u,c){let f=t;t=s(u),t===f?o[t].p(u,c):(x(),M(o[f],1,1,()=>{o[f]=null}),$(),n=o[t],n?n.p(u,c):(n=o[t]=i[t](u),n.c()),y(n,1),n.m(e,null))},i(u){r||(y(n),r=!0)},o(u){M(n),r=!1},d(u){u&&h(e),o[t].d()}}}function Ft(l){let e,t;return e=new zt({props:{clickedTarget:l[3],targetGj:l[1],onConfirm:l[9],onCancel:l[16]}}),{c(){U(e.$$.fragment)},m(n,r){q(e,n,r),t=!0},p(n,r){const i={};r&8&&(i.clickedTarget=n[3]),r&2&&(i.targetGj=n[1]),r&8&&(i.onCancel=n[16]),e.$set(i)},i(n){t||(y(e.$$.fragment,n),t=!0)},o(n){M(e.$$.fragment,n),t=!1},d(n){W(e,n)}}}function Rt(l){let e,t,n;return{c(){e=L("button"),e.innerHTML=`Goto <kbd>n</kbd>
              ext unreviewed`,S(e,"class","btn btn-primary")},m(r,i){p(r,e,i),t||(n=A(e,"click",l[10]),t=!0)},p:ne,i:ne,o:ne,d(r){r&&h(e),t=!1,n()}}}function Ke(l){let e,t;return e=new Ct({props:{openOn:"hover",$$slots:{default:[At,({data:n})=>({23:n}),({data:n})=>n?8388608:0]},$$scope:{ctx:l}}}),{c(){U(e.$$.fragment)},m(n,r){q(e,n,r),t=!0},p(n,r){const i={};r&25165952&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(y(e.$$.fragment,n),t=!0)},o(n){M(e.$$.fragment,n),t=!1},d(n){W(e,n)}}}function At(l){let e,t=ke(l[23]).id+"",n,r,i=l[7].includes(ke(l[23]).id)?"remove":"add",o;return{c(){e=J("Source "),n=J(t),r=J(" -- click to "),o=J(i)},m(s,u){p(s,e,u),p(s,n,u),p(s,r,u),p(s,o,u)},p(s,u){u&8388608&&t!==(t=ke(s[23]).id+"")&&V(n,t),u&8388736&&i!==(i=s[7].includes(ke(s[23]).id)?"remove":"add")&&V(o,i)},d(s){s&&(h(e),h(n),h(r),h(o))}}}function Wt(l){let e,t,n=l[3]!=null&&Ke(l);return{c(){n&&n.c(),e=ve()},m(r,i){n&&n.m(r,i),p(r,e,i),t=!0},p(r,i){r[3]!=null?n?(n.p(r,i),i&8&&y(n,1)):(n=Ke(r),n.c(),y(n,1),n.m(e.parentNode,e)):n&&(x(),M(n,1,1,()=>{n=null}),$())},i(r){t||(y(n),t=!0)},o(r){M(n),t=!1},d(r){r&&h(e),n&&n.d(r)}}}function qt(l){let e,t,n,r;return e=new xe({props:{manageHoverState:!0,paint:{"line-color":["case",["in",["id"],["literal",l[7]]],"blue","black"],"line-width":8,"line-opacity":Ne(.5,1)},hoverCursor:l[3]==null?void 0:"pointer",$$slots:{default:[Wt]},$$scope:{ctx:l}}}),e.$on("click",l[15]),n=new $e({props:{paint:{"text-color":"white","text-halo-color":"grey","text-halo-width":4},layout:{"text-field":["to-string",["id"]],"text-size":16,"symbol-placement":"line",visibility:l[6]?"visible":"none"}}}),{c(){U(e.$$.fragment),t=E(),U(n.$$.fragment)},m(i,o){q(e,i,o),p(i,t,o),q(n,i,o),r=!0},p(i,o){const s={};o&128&&(s.paint={"line-color":["case",["in",["id"],["literal",i[7]]],"blue","black"],"line-width":8,"line-opacity":Ne(.5,1)}),o&8&&(s.hoverCursor=i[3]==null?void 0:"pointer"),o&16777352&&(s.$$scope={dirty:o,ctx:i}),e.$set(s);const u={};o&64&&(u.layout={"text-field":["to-string",["id"]],"text-size":16,"symbol-placement":"line",visibility:i[6]?"visible":"none"}),n.$set(u)},i(i){r||(y(e.$$.fragment,i),y(n.$$.fragment,i),r=!0)},o(i){M(e.$$.fragment,i),M(n.$$.fragment,i),r=!1},d(i){i&&h(t),W(e,i),W(n,i)}}}function Ut(l){let e,t,n,r;return e=new xe({props:{manageHoverState:!0,paint:{"line-width":["case",[">",["length",["get","matching_sources"]],0],8,16],"line-color":["match",["get","reviewed"],"unreviewed","red","not sure","orange","green"],"line-opacity":["case",["==",["id"],l[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,.3]},hoverCursor:"pointer"}}),e.$on("click",l[14]),n=new $e({props:{paint:{"text-color":"white","text-halo-color":["match",["get","reviewed"],"unreviewed","red","not sure","orange","green"],"text-halo-width":4},layout:{"text-field":["to-string",["get","matching_sources"]],"text-size":16,"symbol-placement":"line",visibility:l[6]?"visible":"none"}}}),{c(){U(e.$$.fragment),t=E(),U(n.$$.fragment)},m(i,o){q(e,i,o),p(i,t,o),q(n,i,o),r=!0},p(i,o){const s={};o&8&&(s.paint={"line-width":["case",[">",["length",["get","matching_sources"]],0],8,16],"line-color":["match",["get","reviewed"],"unreviewed","red","not sure","orange","green"],"line-opacity":["case",["==",["id"],i[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,.3]}),e.$set(s);const u={};o&64&&(u.layout={"text-field":["to-string",["get","matching_sources"]],"text-size":16,"symbol-placement":"line",visibility:i[6]?"visible":"none"}),n.$set(u)},i(i){r||(y(e.$$.fragment,i),y(n.$$.fragment,i),r=!0)},o(i){M(e.$$.fragment,i),M(n.$$.fragment,i),r=!1},d(i){i&&h(t),W(e,i),W(n,i)}}}function Kt(l){let e,t,n,r,i,o=l[2]&&Ue(l);return t=new ze({props:{data:l[0],$$slots:{default:[qt]},$$scope:{ctx:l}}}),r=new ze({props:{data:l[1],$$slots:{default:[Ut]},$$scope:{ctx:l}}}),{c(){o&&o.c(),e=E(),U(t.$$.fragment),n=E(),U(r.$$.fragment)},m(s,u){o&&o.m(s,u),p(s,e,u),q(t,s,u),p(s,n,u),q(r,s,u),i=!0},p(s,u){s[2]?o?(o.p(s,u),u&4&&y(o,1)):(o=Ue(s),o.c(),y(o,1),o.m(e.parentNode,e)):o&&(x(),M(o,1,1,()=>{o=null}),$());const c={};u&1&&(c.data=s[0]),u&16777416&&(c.$$scope={dirty:u,ctx:s}),t.$set(c);const f={};u&2&&(f.data=s[1]),u&16777288&&(f.$$scope={dirty:u,ctx:s}),r.$set(f)},i(s){i||(y(o),y(t.$$.fragment,s),y(r.$$.fragment,s),i=!0)},o(s){M(o),M(t.$$.fragment,s),M(r.$$.fragment,s),i=!1},d(s){s&&(h(e),h(n)),o&&o.d(s),W(t,s),W(r,s)}}}function Zt(l){let e,t,n,r;function i(s){l[17](s)}let o={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Kt]},$$scope:{ctx:l}};return l[5]!==void 0&&(o.map=l[5]),t=new bt({props:o}),Y.push(()=>re(t,"map",i)),t.$on("error",l[18]),{c(){e=L("div"),U(t.$$.fragment),S(e,"slot","main"),B(e,"position","relative"),B(e,"width","100%"),B(e,"height","100vh")},m(s,u){p(s,e,u),q(t,e,null),r=!0},p(s,u){const c={};u&16777423&&(c.$$scope={dirty:u,ctx:s}),!n&&u&32&&(n=!0,c.map=s[5],ue(()=>n=!1)),t.$set(c)},i(s){r||(y(t.$$.fragment,s),r=!0)},o(s){M(t.$$.fragment,s),r=!1},d(s){s&&h(e),W(t)}}}function Qt(l){let e,t,n,r;return e=new _t({props:{$$slots:{main:[Zt],left:[Bt]},$$scope:{ctx:l}}}),{c(){U(e.$$.fragment)},m(i,o){q(e,i,o),t=!0,n||(r=A(Ht,"keydown",l[11]),n=!0)},p(i,[o]){const s={};o&16777471&&(s.$$scope={dirty:o,ctx:i}),e.$set(s)},i(i){t||(y(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){W(e,i),n=!1,r()}}}function Vt(l,e,t){let n,r,i,o=pe(),s=pe(),u=!1,c=!1,f=null;Ze(async()=>{await kt();try{let b=window.localStorage.getItem(we);if(b){let R=JSON.parse(b);t(0,[o,s]=R,o,t(1,s)),t(2,u=!0),console.log(`Restored data from local storage ${we}`)}}catch(b){console.log(`Couldn't restore data from local storage: ${b}`)}});function v(){let b={type:"FeatureCollection",features:[...o.features,...s.features]};i==null||i.fitBounds(De(b),{animate:!1,padding:10})}function m(b){if(f==null)throw new Error("impossible");t(1,s.features[f].properties.reviewed=b,s),t(1,s),t(3,f=null)}function C(){for(let b of s.features)if(b.properties.reviewed=="unreviewed"){i==null||i.fitBounds(De(b),{duration:600,padding:200}),t(3,f=b.id);return}}function I(b){b.target.tagName=="INPUT"||!u||b.key=="n"&&C()}function H(){pt("reviewed_targets.geojson",JSON.stringify(s))}function g(){window.confirm("Do you want to discard this review and start over?")&&(t(0,o=pe()),t(1,s=pe()),t(2,u=!1),t(3,f=null),t(6,c=!1),window.localStorage.removeItem(we))}function P(b){u&&t(3,f=b.detail.features[0].id)}function O(b){if(!u||f==null)return;let R=b.detail.features[0].id,d=s.features[f].properties;d.matching_sources.includes(R)?d.matching_sources=d.matching_sources.filter(K=>K!=R):d.matching_sources.push(R),t(1,s)}const N=()=>t(3,f=null);function F(b){i=b,t(5,i)}const w=b=>{console.log(b.detail.error)};function _(b){o=b,t(0,o)}function G(b){s=b,t(1,s)}function Z(b){u=b,t(2,u)}function D(){c=this.checked,t(6,c)}return l.$$.update=()=>{l.$$.dirty&10&&t(7,n=f==null?[]:s.features[f].properties.matching_sources),l.$$.dirty&2&&t(4,r=s.features.filter(b=>b.properties.reviewed!="unreviewed").length),l.$$.dirty&23&&u&&(console.log(`Autosaving with ${r} reviewed targets`),window.localStorage.setItem(we,JSON.stringify([o,s])))},[o,s,u,f,r,i,c,n,v,m,C,I,H,g,P,O,N,F,w,_,G,Z,D]}class Xt extends fe{constructor(e){super(),ae(this,e,Vt,Qt,ce,{})}}new Xt({target:document.getElementById("app")});
