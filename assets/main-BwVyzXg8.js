import{p as Ge,f as we,a as ce,b as Re,m as qe,l as Qe,c as se,S as ze,i as He,s as We,L as Ke,d as q,t as G,e as D,g as Q,h as z,o as Ze,_ as Ue,j as Ve,k as ye,n as M,q as Xe,r as Ye,u as N,v as B,w as re,x as O,y as J,z as K,A as R,M as xe,B as X,C as ie,D as oe,E as U,F as et,G as _e,H as ve,I as tt,J as nt,K as ue,N as rt,O as st,P as it,Q as $e,R as je,T as pe}from"./Settings-CIHFOGW5.js";function ot(t,e={}){const n=Number(t[0]),r=Number(t[1]),l=Number(t[2]),s=Number(t[3]);if(t.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");const o=[n,r];return Ge([[o,[l,r],[l,s],[n,s],o]],e.properties,{bbox:t,id:e.id})}const H=11102230246251565e-32,A=134217729,lt=(3+8*H)*H;function fe(t,e,n,r,l){let s,o,i,a,p=e[0],d=r[0],u=0,h=0;d>p==d>-p?(s=p,p=e[++u]):(s=d,d=r[++h]);let c=0;if(u<t&&h<n)for(d>p==d>-p?(o=p+s,i=s-(o-p),p=e[++u]):(o=d+s,i=s-(o-d),d=r[++h]),s=o,i!==0&&(l[c++]=i);u<t&&h<n;)d>p==d>-p?(o=s+p,a=o-s,i=s-(o-a)+(p-a),p=e[++u]):(o=s+d,a=o-s,i=s-(o-a)+(d-a),d=r[++h]),s=o,i!==0&&(l[c++]=i);for(;u<t;)o=s+p,a=o-s,i=s-(o-a)+(p-a),p=e[++u],s=o,i!==0&&(l[c++]=i);for(;h<n;)o=s+d,a=o-s,i=s-(o-a)+(d-a),d=r[++h],s=o,i!==0&&(l[c++]=i);return(s!==0||c===0)&&(l[c++]=s),c}function at(t,e){let n=e[0];for(let r=1;r<t;r++)n+=e[r];return n}function Y(t){return new Float64Array(t)}const ut=(3+16*H)*H,ft=(2+12*H)*H,ct=(9+64*H)*H*H,Z=Y(4),be=Y(8),Se=Y(12),Ee=Y(16),j=Y(4);function pt(t,e,n,r,l,s,o){let i,a,p,d,u,h,c,f,g,w,m,_,b,$,P,S,C,k;const y=t-l,E=n-l,F=e-s,L=r-s;$=y*L,h=A*y,c=h-(h-y),f=y-c,h=A*L,g=h-(h-L),w=L-g,P=f*w-($-c*g-f*g-c*w),S=F*E,h=A*F,c=h-(h-F),f=F-c,h=A*E,g=h-(h-E),w=E-g,C=f*w-(S-c*g-f*g-c*w),m=P-C,u=P-m,Z[0]=P-(m+u)+(u-C),_=$+m,u=_-$,b=$-(_-u)+(m-u),m=b-S,u=b-m,Z[1]=b-(m+u)+(u-S),k=_+m,u=k-_,Z[2]=_-(k-u)+(m-u),Z[3]=k;let T=at(4,Z),W=ft*o;if(T>=W||-T>=W||(u=t-y,i=t-(y+u)+(u-l),u=n-E,p=n-(E+u)+(u-l),u=e-F,a=e-(F+u)+(u-s),u=r-L,d=r-(L+u)+(u-s),i===0&&a===0&&p===0&&d===0)||(W=ct*o+lt*Math.abs(T),T+=y*d+L*i-(F*p+E*a),T>=W||-T>=W))return T;$=i*L,h=A*i,c=h-(h-i),f=i-c,h=A*L,g=h-(h-L),w=L-g,P=f*w-($-c*g-f*g-c*w),S=a*E,h=A*a,c=h-(h-a),f=a-c,h=A*E,g=h-(h-E),w=E-g,C=f*w-(S-c*g-f*g-c*w),m=P-C,u=P-m,j[0]=P-(m+u)+(u-C),_=$+m,u=_-$,b=$-(_-u)+(m-u),m=b-S,u=b-m,j[1]=b-(m+u)+(u-S),k=_+m,u=k-_,j[2]=_-(k-u)+(m-u),j[3]=k;const ae=fe(4,Z,4,j,be);$=y*d,h=A*y,c=h-(h-y),f=y-c,h=A*d,g=h-(h-d),w=d-g,P=f*w-($-c*g-f*g-c*w),S=F*p,h=A*F,c=h-(h-F),f=F-c,h=A*p,g=h-(h-p),w=p-g,C=f*w-(S-c*g-f*g-c*w),m=P-C,u=P-m,j[0]=P-(m+u)+(u-C),_=$+m,u=_-$,b=$-(_-u)+(m-u),m=b-S,u=b-m,j[1]=b-(m+u)+(u-S),k=_+m,u=k-_,j[2]=_-(k-u)+(m-u),j[3]=k;const x=fe(ae,be,4,j,Se);$=i*d,h=A*i,c=h-(h-i),f=i-c,h=A*d,g=h-(h-d),w=d-g,P=f*w-($-c*g-f*g-c*w),S=a*p,h=A*a,c=h-(h-a),f=a-c,h=A*p,g=h-(h-p),w=p-g,C=f*w-(S-c*g-f*g-c*w),m=P-C,u=P-m,j[0]=P-(m+u)+(u-C),_=$+m,u=_-$,b=$-(_-u)+(m-u),m=b-S,u=b-m,j[1]=b-(m+u)+(u-S),k=_+m,u=k-_,j[2]=_-(k-u)+(m-u),j[3]=k;const v=fe(x,Se,4,j,Ee);return Ee[v-1]}function ht(t,e,n,r,l,s){const o=(e-s)*(n-l),i=(t-l)*(r-s),a=o-i,p=Math.abs(o+i);return Math.abs(a)>=ut*p?a:-pt(t,e,n,r,l,s,p)}function dt(t,e){var n,r,l=0,s,o,i,a,p,d,u,h=t[0],c=t[1],f=e.length;for(n=0;n<f;n++){r=0;var g=e[n],w=g.length-1;if(d=g[0],d[0]!==g[w][0]&&d[1]!==g[w][1])throw new Error("First and last coordinates in a ring must be the same");for(o=d[0]-h,i=d[1]-c,r;r<w;r++){if(u=g[r+1],a=u[0]-h,p=u[1]-c,i===0&&p===0){if(a<=0&&o>=0||o<=0&&a>=0)return 0}else if(p>=0&&i<=0||p<=0&&i>=0){if(s=ht(o,a,i,p,0,0),s===0)return 0;(s>0&&p>0&&i<=0||s<0&&p<=0&&i>0)&&l++}d=u,i=p,o=a}}return l%2!==0}function gt(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function le(t){return t.type==="Feature"?t.geometry:t}function V(t,e,n={}){if(!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");const r=gt(t),l=le(e),s=l.type,o=e.bbox;let i=l.coordinates;if(o&&mt(r,o)===!1)return!1;s==="Polygon"&&(i=[i]);let a=!1;for(var p=0;p<i.length;++p){const d=dt(r,i[p]);if(d===0)return!n.ignoreBoundary;d&&(a=!0)}return a}function mt(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}class Oe{constructor(e=[],n=wt){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:r}=this,l=n[e];for(;e>0;){const s=e-1>>1,o=n[s];if(r(l,o)>=0)break;n[e]=o,e=s}n[e]=l}_down(e){const{data:n,compare:r}=this,l=this.length>>1,s=n[e];for(;e<l;){let o=(e<<1)+1,i=n[o];const a=o+1;if(a<this.length&&r(n[a],i)<0&&(o=a,i=n[a]),r(i,s)>=0)break;n[e]=i,e=o}n[e]=s}}function wt(t,e){return t<e?-1:t>e?1:0}function Je(t,e){return t.p.x>e.p.x?1:t.p.x<e.p.x?-1:t.p.y!==e.p.y?t.p.y>e.p.y?1:-1:1}function yt(t,e){return t.rightSweepEvent.p.x>e.rightSweepEvent.p.x?1:t.rightSweepEvent.p.x<e.rightSweepEvent.p.x?-1:t.rightSweepEvent.p.y!==e.rightSweepEvent.p.y?t.rightSweepEvent.p.y<e.rightSweepEvent.p.y?1:-1:1}class Le{constructor(e,n,r,l){this.p={x:e[0],y:e[1]},this.featureId=n,this.ringId=r,this.eventId=l,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(e){return this.p.x===e.p.x&&this.p.y===e.p.y}}function _t(t,e){if(t.type==="FeatureCollection"){const n=t.features;for(let r=0;r<n.length;r++)Pe(n[r],e)}else Pe(t,e)}let ee=0,te=0,ne=0;function Pe(t,e){const n=t.type==="Feature"?t.geometry:t;let r=n.coordinates;(n.type==="Polygon"||n.type==="MultiLineString")&&(r=[r]),n.type==="LineString"&&(r=[[r]]);for(let l=0;l<r.length;l++)for(let s=0;s<r[l].length;s++){let o=r[l][s][0],i=null;te=te+1;for(let a=0;a<r[l][s].length-1;a++){i=r[l][s][a+1];const p=new Le(o,ee,te,ne),d=new Le(i,ee,te,ne+1);p.otherEvent=d,d.otherEvent=p,Je(p,d)>0?(d.isLeftEndpoint=!0,p.isLeftEndpoint=!1):(p.isLeftEndpoint=!0,d.isLeftEndpoint=!1),e.push(p),e.push(d),o=i,ne=ne+1}}ee=ee+1}class vt{constructor(e){this.leftSweepEvent=e,this.rightSweepEvent=e.otherEvent}}function $t(t,e){if(t===null||e===null||t.leftSweepEvent.ringId===e.leftSweepEvent.ringId&&(t.rightSweepEvent.isSamePoint(e.leftSweepEvent)||t.rightSweepEvent.isSamePoint(e.leftSweepEvent)||t.rightSweepEvent.isSamePoint(e.rightSweepEvent)||t.leftSweepEvent.isSamePoint(e.leftSweepEvent)||t.leftSweepEvent.isSamePoint(e.rightSweepEvent)))return!1;const n=t.leftSweepEvent.p.x,r=t.leftSweepEvent.p.y,l=t.rightSweepEvent.p.x,s=t.rightSweepEvent.p.y,o=e.leftSweepEvent.p.x,i=e.leftSweepEvent.p.y,a=e.rightSweepEvent.p.x,p=e.rightSweepEvent.p.y,d=(p-i)*(l-n)-(a-o)*(s-r),u=(a-o)*(r-i)-(p-i)*(n-o),h=(l-n)*(r-i)-(s-r)*(n-o);if(d===0)return!1;const c=u/d,f=h/d;if(c>=0&&c<=1&&f>=0&&f<=1){const g=n+c*(l-n),w=r+c*(s-r);return[g,w]}return!1}function bt(t,e){e=e||!1;const n=[],r=new Oe([],yt);for(;t.length;){const l=t.pop();if(l.isLeftEndpoint){const s=new vt(l);for(let o=0;o<r.data.length;o++){const i=r.data[o];if(e&&i.leftSweepEvent.featureId===l.featureId)continue;const a=$t(s,i);a!==!1&&n.push(a)}r.push(s)}else l.isLeftEndpoint===!1&&r.pop()}return n}function St(t,e){const n=new Oe([],Je);return _t(t,n),bt(n,e)}var Et=St;function ge(t,e,n={}){const{removeDuplicates:r=!0,ignoreSelfIntersections:l=!0}=n;let s=[];t.type==="FeatureCollection"?s=s.concat(t.features):t.type==="Feature"?s.push(t):(t.type==="LineString"||t.type==="Polygon"||t.type==="MultiLineString"||t.type==="MultiPolygon")&&s.push(we(t)),e.type==="FeatureCollection"?s=s.concat(e.features):e.type==="Feature"?s.push(e):(e.type==="LineString"||e.type==="Polygon"||e.type==="MultiLineString"||e.type==="MultiPolygon")&&s.push(we(e));const o=Et(ce(s),l);let i=[];if(r){const a={};o.forEach(p=>{const d=p.join(",");a[d]||(a[d]=!0,i.push(p))})}else i=o;return ce(i.map(a=>Re(a)))}function he(t,e={}){const n=le(t);switch(!e.properties&&t.type==="Feature"&&(e.properties=t.properties),n.type){case"Polygon":return Lt(n,e);case"MultiPolygon":return Pt(n,e);default:throw new Error("invalid poly")}}function Lt(t,e={}){const r=le(t).coordinates,l=e.properties?e.properties:t.type==="Feature"?t.properties:{};return Te(r,l)}function Pt(t,e={}){const r=le(t).coordinates,l=e.properties?e.properties:t.type==="Feature"?t.properties:{},s=[];return r.forEach(o=>{s.push(Te(o,l))}),ce(s)}function Te(t,e){return t.length>1?qe(t,e):Qe(t[0],e)}function Ct(t,e,{ignoreSelfIntersections:n=!0}={ignoreSelfIntersections:!0}){let r=!0;return se(t,l=>{se(e,s=>{if(r===!1)return!1;r=kt(l.geometry,s.geometry,n)})}),r}function kt(t,e,n){switch(t.type){case"Point":switch(e.type){case"Point":return!Nt(t.coordinates,e.coordinates);case"LineString":return!Ce(e,t);case"Polygon":return!V(t,e)}break;case"LineString":switch(e.type){case"Point":return!Ce(t,e);case"LineString":return!It(t,e,n);case"Polygon":return!ke(e,t,n)}break;case"Polygon":switch(e.type){case"Point":return!V(e,t);case"LineString":return!ke(t,e,n);case"Polygon":return!Ft(e,t,n)}}return!1}function Ce(t,e){for(let n=0;n<t.coordinates.length-1;n++)if(Mt(t.coordinates[n],t.coordinates[n+1],e.coordinates))return!0;return!1}function It(t,e,n){return ge(t,e,{ignoreSelfIntersections:n}).features.length>0}function ke(t,e,n){for(const l of e.coordinates)if(V(l,t))return!0;return ge(e,he(t),{ignoreSelfIntersections:n}).features.length>0}function Ft(t,e,n){for(const l of t.coordinates[0])if(V(l,e))return!0;for(const l of e.coordinates[0])if(V(l,t))return!0;return ge(he(t),he(e),{ignoreSelfIntersections:n}).features.length>0}function Mt(t,e,n){const r=n[0]-t[0],l=n[1]-t[1],s=e[0]-t[0],o=e[1]-t[1];return r*o-l*s!==0?!1:Math.abs(s)>=Math.abs(o)?s>0?t[0]<=n[0]&&n[0]<=e[0]:e[0]<=n[0]&&n[0]<=t[0]:o>0?t[1]<=n[1]&&n[1]<=e[1]:e[1]<=n[1]&&n[1]<=t[1]}function Nt(t,e){return t[0]===e[0]&&t[1]===e[1]}function Ie(t,e,{ignoreSelfIntersections:n=!0}={}){let r=!1;return se(t,l=>{se(e,s=>{if(r===!0)return!0;r=!Ct(l.geometry,s.geometry,{ignoreSelfIntersections:n})})}),r}function Fe(t){let e,n,r,l,s,o,i,a=t[4].features.length+"",p,d,u,h,c,f,g=t[5].features.length+"",w,m,_=t[1].filter(Be).length+"",b,$,P,S,C,k,y,E,F,L,T,W;function ae(v){t[21](v)}let x={onChange:t[10]};return t[7]!==void 0&&(x.options=t[7]),E=new tt({props:x}),X.push(()=>ie(E,"options",ae)),{c(){e=O("button"),e.textContent="Swap",n=J(),r=O("button"),r.textContent="Zoom to fit",l=J(),s=O("div"),s.textContent="Sources",o=J(),i=O("p"),p=K(a),d=K(" sources"),u=J(),h=O("div"),h.textContent="Target",c=J(),f=O("p"),w=K(g),m=K(" targets, with "),b=K(_),$=K(" matching a source"),P=J(),S=O("label"),C=O("input"),k=K(`
        Show targets matching a source`),y=J(),z(E.$$.fragment),R(e,"class","btn btn-secondary"),R(r,"class","btn btn-secondary"),U(s,"background",de),U(h,"background",De),R(C,"class","form-check-input"),R(C,"type","checkbox"),R(S,"class","form-check-label mb-3")},m(v,I){N(v,e,I),N(v,n,I),N(v,r,I),N(v,l,I),N(v,s,I),N(v,o,I),N(v,i,I),B(i,p),B(i,d),N(v,u,I),N(v,h,I),N(v,c,I),N(v,f,I),B(f,w),B(f,m),B(f,b),B(f,$),N(v,P,I),N(v,S,I),B(S,C),C.checked=t[6],B(S,k),N(v,y,I),Q(E,v,I),L=!0,T||(W=[re(e,"click",t[13]),re(r,"click",t[12]),re(C,"change",t[20])],T=!0)},p(v,I){(!L||I&16)&&a!==(a=v[4].features.length+"")&&ue(p,a),(!L||I&32)&&g!==(g=v[5].features.length+"")&&ue(w,g),(!L||I&2)&&_!==(_=v[1].filter(Be).length+"")&&ue(b,_),I&64&&(C.checked=v[6]);const me={};!F&&I&128&&(F=!0,me.options=v[7],oe(()=>F=!1)),E.$set(me)},i(v){L||(D(E.$$.fragment,v),L=!0)},o(v){G(E.$$.fragment,v),L=!1},d(v){v&&(M(e),M(n),M(r),M(l),M(s),M(o),M(i),M(u),M(h),M(c),M(f),M(P),M(S),M(y)),q(E,v),T=!1,nt(W)}}}function At(t){let e,n,r,l,s,o,i,a,p,d,u,h,c=t[4].features.length>0&&Fe(t);return{c(){e=O("div"),n=O("h1"),n.textContent="Match LineStrings",r=J(),l=O("a"),l.textContent="Looking for the tool to review test cases?",s=J(),o=O("label"),i=K(`Load two .geojson files
      `),a=O("input"),p=J(),c&&c.c(),R(l,"href","review.html"),R(a,"class","form-control"),R(a,"type","file"),a.multiple=!0,R(o,"class","form-label"),R(e,"slot","left")},m(f,g){N(f,e,g),B(e,n),B(e,r),B(e,l),B(e,s),B(e,o),B(o,i),B(o,a),t[19](a),B(e,p),c&&c.m(e,null),d=!0,u||(h=re(a,"change",t[11]),u=!0)},p(f,g){f[4].features.length>0?c?(c.p(f,g),g&16&&D(c,1)):(c=Fe(f),c.c(),D(c,1),c.m(e,null)):c&&(Xe(),G(c,1,1,()=>{c=null}),Ye())},i(f){d||(D(c),d=!0)},o(f){G(c),d=!1},d(f){f&&M(e),t[19](null),c&&c.d(),u=!1,h()}}}function Bt(t){let e,n;return e=new je({props:{manageHoverState:!0,paint:{"line-width":["case",["in",["id"],["literal",t[9]]],8,5],"line-color":de,"line-opacity":pe(.5,1)}}}),{c(){z(e.$$.fragment)},m(r,l){Q(e,r,l),n=!0},p(r,l){const s={};l&512&&(s.paint={"line-width":["case",["in",["id"],["literal",r[9]]],8,5],"line-color":de,"line-opacity":pe(.5,1)}),e.$set(s)},i(r){n||(D(e.$$.fragment,r),n=!0)},o(r){G(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function jt(t){let e,n,r;function l(o){t[16](o)}let s={manageHoverState:!0,filter:t[6]?void 0:["!",["get","has_match"]],paint:{"line-width":8,"line-color":De,"line-opacity":pe(["case",["get","has_match"],.5,.2],1)}};return t[0]!==void 0&&(s.hovered=t[0]),e=new je({props:s}),X.push(()=>ie(e,"hovered",l)),e.$on("click",t[14]),{c(){z(e.$$.fragment)},m(o,i){Q(e,o,i),r=!0},p(o,i){const a={};i&64&&(a.filter=o[6]?void 0:["!",["get","has_match"]]),!n&&i&1&&(n=!0,a.hovered=o[0],oe(()=>n=!1)),e.$set(a)},i(o){r||(D(e.$$.fragment,o),r=!0)},o(o){G(e.$$.fragment,o),r=!1},d(o){q(e,o)}}}function Ot(t){let e,n,r,l,s,o,i,a,p,d,u;e=new rt({props:{map:t[2]}}),r=new st({props:{map:t[2]}});function h(f){t[15](f)}let c={choice:"Maptiler Dataviz"};return t[3]!==void 0&&(c.style=t[3]),s=new it({props:c}),X.push(()=>ie(s,"style",h)),a=new $e({props:{data:t[4],$$slots:{default:[Bt]},$$scope:{ctx:t}}}),d=new $e({props:{data:t[5],$$slots:{default:[jt]},$$scope:{ctx:t}}}),{c(){z(e.$$.fragment),n=J(),z(r.$$.fragment),l=J(),z(s.$$.fragment),i=J(),z(a.$$.fragment),p=J(),z(d.$$.fragment)},m(f,g){Q(e,f,g),N(f,n,g),Q(r,f,g),N(f,l,g),Q(s,f,g),N(f,i,g),Q(a,f,g),N(f,p,g),Q(d,f,g),u=!0},p(f,g){const w={};g&4&&(w.map=f[2]),e.$set(w);const m={};g&4&&(m.map=f[2]),r.$set(m);const _={};!o&&g&8&&(o=!0,_.style=f[3],oe(()=>o=!1)),s.$set(_);const b={};g&16&&(b.data=f[4]),g&4194816&&(b.$$scope={dirty:g,ctx:f}),a.$set(b);const $={};g&32&&($.data=f[5]),g&4194369&&($.$$scope={dirty:g,ctx:f}),d.$set($)},i(f){u||(D(e.$$.fragment,f),D(r.$$.fragment,f),D(s.$$.fragment,f),D(a.$$.fragment,f),D(d.$$.fragment,f),u=!0)},o(f){G(e.$$.fragment,f),G(r.$$.fragment,f),G(s.$$.fragment,f),G(a.$$.fragment,f),G(d.$$.fragment,f),u=!1},d(f){f&&(M(n),M(l),M(i),M(p)),q(e,f),q(r,f),q(s,f),q(a,f),q(d,f)}}}function Jt(t){let e,n,r,l;function s(i){t[17](i)}let o={style:t[3],hash:!0,$$slots:{default:[Ot]},$$scope:{ctx:t}};return t[2]!==void 0&&(o.map=t[2]),n=new xe({props:o}),X.push(()=>ie(n,"map",s)),n.$on("error",t[18]),{c(){e=O("div"),z(n.$$.fragment),R(e,"slot","main"),U(e,"position","relative"),U(e,"width","100%"),U(e,"height","100vh")},m(i,a){N(i,e,a),Q(n,e,null),l=!0},p(i,a){const p={};a&8&&(p.style=i[3]),a&4194941&&(p.$$scope={dirty:a,ctx:i}),!r&&a&4&&(r=!0,p.map=i[2],oe(()=>r=!1)),n.$set(p)},i(i){l||(D(n.$$.fragment,i),l=!0)},o(i){G(n.$$.fragment,i),l=!1},d(i){i&&M(e),q(n)}}}function Tt(t){let e,n;return e=new Ke({props:{$$slots:{main:[Jt],left:[At]},$$scope:{ctx:t}}}),{c(){z(e.$$.fragment)},m(r,l){Q(e,r,l),n=!0},p(r,[l]){const s={};l&4195327&&(s.$$scope={dirty:l,ctx:r}),e.$set(s)},i(r){n||(D(e.$$.fragment,r),n=!0)},o(r){G(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}let de="red",De="blue";async function Me(t){let e=await t.text(),n=JSON.parse(e),r=0;for(let l of n.features)l.id=r++,l.properties??(l.properties={});return n}function Ne(t){let e=JSON.parse(JSON.stringify(t));return delete e.properties,e}function Ae(t){let e=0;for(let n of t)n.id=e++;return t}const Be=t=>t.matching_sources.length>0;function Dt(t,e,n){let r,l,s=Ve["Maptiler Dataviz"],o=ye(),i=ye(),a=null,p=!0,d={buffer_meters:20,angle_diff_threshold:10,length_ratio_threshold:1.1,midpt_dist_threshold:15},u=[];Ze(async()=>{await Ue()});function h(){try{n(1,u=JSON.parse(et(JSON.stringify(o),JSON.stringify(i),d)))}catch(y){window.alert(`Bug: ${y}`);return}for(let[y,E]of i.features.entries())E.properties.has_match=u[y].matching_sources.length>0;n(5,i)}let c;async function f(y){if(!c.files)return;if(c.files.length!=2){window.alert("Select two GeoJSON files");return}try{n(4,o=await Me(c.files[0])),n(5,i=await Me(c.files[1])),g(),n(0,a=null),h()}catch(F){window.alert(`Bad input file: ${F}`)}}function g(){let y={type:"FeatureCollection",features:[...o.features,...i.features]};l==null||l.fitBounds(_e(y),{animate:!1,padding:10})}function w(){n(4,[o,i]=[i,o],o,n(5,i)),h()}function m(y){let E=i.features[y.detail.features[0].id],F=ot(_e(E));ve("sources.geojson",JSON.stringify({type:"FeatureCollection",features:Ae(o.features.filter(L=>Ie(L,F)).map(Ne))})),ve("targets.geojson",JSON.stringify({type:"FeatureCollection",features:Ae(i.features.filter(L=>Ie(L,F)).map(Ne))}))}function _(y){s=y,n(3,s)}function b(y){a=y,n(0,a)}function $(y){l=y,n(2,l)}const P=y=>{console.log(y.detail.error)};function S(y){X[y?"unshift":"push"](()=>{c=y,n(8,c)})}function C(){p=this.checked,n(6,p)}function k(y){d=y,n(7,d)}return t.$$.update=()=>{t.$$.dirty&3&&n(9,r=a==null?[]:u[a.id].matching_sources)},[a,u,l,s,o,i,p,d,c,r,h,f,g,w,m,_,b,$,P,S,C,k]}class Gt extends ze{constructor(e){super(),He(this,e,Dt,Tt,We,{})}}new Gt({target:document.getElementById("app")});
