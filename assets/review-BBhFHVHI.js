import{S as de,i as _e,s as ge,n as h,t as G,e as L,q as $,r as ee,u as k,T as ye,U as lt,V as ot,W as st,X as he,o as Ze,Y as it,Z as me,$ as rt,x as T,B as x,a0 as Ve,a1 as Xe,a2 as Ye,a3 as xe,a4 as ft,a5 as ut,C as oe,d as F,D as se,g as R,h as A,a6 as at,a7 as ae,a8 as Ne,a9 as ie,aa as ct,E as J,A as I,K as X,v as y,y as D,z as H,J as Le,ab as ce,w as q,ac as mt,F as dt,I as _t,L as gt,k as ke,j as bt,M as pt,ad as ht,H as kt,N as wt,O as vt,P as De,Q as $e,R as Ee,ae as we,_ as yt,G as He}from"./Settings-C_jMbddS.js";const Ct=l=>({features:l[0]&16,data:l[0]&16,map:l[0]&4,close:l[0]&1}),Pe=l=>{var e;return{features:l[4],data:((e=l[4])==null?void 0:e[0])??null,map:l[2],close:l[31]}};function Be(l){var s;let e,t,n=(((s=l[4])==null?void 0:s.length)||l[3]instanceof me.Marker)&&Je(l);return{c(){e=T("div"),n&&n.c()},m(o,i){k(o,e,i),n&&n.m(e,null),l[32](e),t=!0},p(o,i){var r;(r=o[4])!=null&&r.length||o[3]instanceof me.Marker?n?(n.p(o,i),i[0]&24&&L(n,1)):(n=Je(o),n.c(),L(n,1),n.m(e,null)):n&&($(),G(n,1,1,()=>{n=null}),ee())},i(o){t||(L(n),t=!0)},o(o){G(n),t=!1},d(o){o&&h(e),n&&n.d(),l[32](null)}}}function Je(l){let e;const t=l[30].default,n=Ve(t,l,l[29],Pe);return{c(){n&&n.c()},m(s,o){n&&n.m(s,o),e=!0},p(s,o){n&&n.p&&(!e||o[0]&536870933)&&Xe(n,t,s,s[29],e?xe(t,s[29],o,Ct):Ye(s[29]),Pe)},i(s){e||(L(n,s),e=!0)},o(s){G(n,s),e=!1},d(s){n&&n.d(s)}}}function Ot(l){let e,t,n=l[9].default&&Be(l);return{c(){n&&n.c(),e=ye()},m(s,o){n&&n.m(s,o),k(s,e,o),t=!0},p(s,o){s[9].default?n?(n.p(s,o),o[0]&512&&L(n,1)):(n=Be(s),n.c(),L(n,1),n.m(e.parentNode,e)):n&&($(),G(n,1,1,()=>{n=null}),ee())},i(s){t||(L(n),t=!0)},o(s){G(n),t=!1},d(s){s&&h(e),n&&n.d(s)}}}function Lt(l,e,t){let n,s,o,i,r,f,{$$slots:u={},$$scope:c}=e;const g=lt(u);let{closeButton:_=void 0}=e,{closeOnClickOutside:w=!0}=e,{closeOnClickInside:d=!1}=e,{closeOnMove:C=!1}=e,{openOn:b="click"}=e,{openIfTopMost:N=!0}=e,{focusAfterOpen:j=!0}=e,{anchor:z=void 0}=e,{offset:B=void 0}=e,{popupClass:O=void 0}=e,{maxWidth:v=void 0}=e,{lngLat:p=void 0}=e,{html:Z=void 0}=e,{open:E=!1}=e;const K=ot(),{map:W,popupTarget:a,layerEvent:Q,layer:U,eventTopMost:re,markerClickManager:fe}=st();he(l,W,m=>t(2,o=m)),he(l,a,m=>t(3,r=m)),he(l,Q,m=>t(28,i=m)),he(l,U,m=>t(35,f=m));const V=["click","dblclick","contextmenu"];let S,te=!1,M;function P(){if(!S)return;let m=S.getElement();!m||m===M||(M=m,b==="hover"&&(M.style.pointerEvents="none"),M.addEventListener("mouseenter",()=>{t(24,te=!0)},{passive:!0}),M.addEventListener("mouseleave",()=>{t(24,te=!1)},{passive:!0}),M.addEventListener("click",()=>{d&&t(0,E=!1)},{passive:!0}))}Ze(()=>{if(o)return o.on("click",pe),o.on("contextmenu",pe),fe.add(ze),typeof r=="string"&&(o.on("click",r,le),o.on("dblclick",r,le),o.on("contextmenu",r,le),o.on("mousemove",r,Ie),o.on("mouseleave",r,Ge),o.on("touchstart",r,Se),o.on("touchend",r,Me)),()=>{o!=null&&o.loaded()&&(S==null||S.remove(),o.off("click",pe),o.off("contextmenu",pe),fe.remove(ze),r instanceof me.Marker?r.getPopup()===S&&r.setPopup(void 0):typeof r=="string"&&(o.off("click",r,le),o.off("dblclick",r,le),o.off("contextmenu",r,le),o.off("mousemove",r,Ie),o.off("mouseleave",r,Ge),o.off("touchstart",r,Se),o.off("touchend",r,Me)))}});function Te(m){return N?!("marker"in m)&&!ft(m)&&re(m)!==f:!1}let ne=null,Y="normal";function je(m){"layerType"in m&&m.layerType==="deckgl"?(t(10,p=m.coordinate),t(4,ne=m.object?[m.object]:null)):(t(10,p=m.lngLat),t(4,ne=m.features??[]))}function le(m){m.type!==b||Te(m)||(je(m),setTimeout(()=>t(0,E=!0)))}let ue=null;function Se(m){ue=m.point}function Me(m){if(!ue||b!=="hover")return;let Ce=ue.dist(m.point);ue=null,Ce<3&&(t(10,p=m.lngLat),t(4,ne=m.features??[]),S.isOpen()?t(25,Y="justOpened"):(t(25,Y="opening"),t(0,E=!0)))}function Ge(m){b!=="hover"||ue||Y!=="normal"||(t(0,E=!1),t(4,ne=null))}function Ie(m){if(!(b!=="hover"||ue||Y!=="normal")){if(Te(m)){t(0,E=!1),t(4,ne=null);return}t(0,E=!0),t(4,ne=m.features??[]),t(10,p=m.lngLat)}}function pe(m){if(Y==="justOpened"){t(25,Y="normal");return}if(!w)return;let Ce=[M,r instanceof me.Marker?r==null?void 0:r.getElement():null];E&&S.isOpen()&&!Ce.some(Oe=>Oe==null?void 0:Oe.contains(m.originalEvent.target))&&(m.type==="contextmenu"&&b==="contextmenu"||m.type!=="contextmenu")&&t(0,E=!1)}function ze(m){w&&E&&S.isOpen()&&m.marker!==r&&t(0,E=!1)}it(()=>{o&&(S!=null&&S.isOpen())&&S.remove()});let be;const tt=()=>t(0,E=!1);function nt(m){x[m?"unshift":"push"](()=>{be=m,t(1,be)})}return l.$$set=m=>{"closeButton"in m&&t(11,_=m.closeButton),"closeOnClickOutside"in m&&t(12,w=m.closeOnClickOutside),"closeOnClickInside"in m&&t(13,d=m.closeOnClickInside),"closeOnMove"in m&&t(14,C=m.closeOnMove),"openOn"in m&&t(15,b=m.openOn),"openIfTopMost"in m&&t(16,N=m.openIfTopMost),"focusAfterOpen"in m&&t(17,j=m.focusAfterOpen),"anchor"in m&&t(18,z=m.anchor),"offset"in m&&t(19,B=m.offset),"popupClass"in m&&t(20,O=m.popupClass),"maxWidth"in m&&t(21,v=m.maxWidth),"lngLat"in m&&t(10,p=m.lngLat),"html"in m&&t(22,Z=m.html),"open"in m&&t(0,E=m.open),"$$scope"in m&&t(29,c=m.$$scope)},l.$$.update=()=>{if(l.$$.dirty[0]&14336&&t(27,n=_??(!w&&!d)),l.$$.dirty[0]&146685952&&(S||(t(23,S=new me.Popup({closeButton:n,closeOnClick:!1,closeOnMove:C,focusAfterOpen:j,maxWidth:v,className:O,anchor:z,offset:B})),M=S.getElement(),S.on("open",()=>{t(0,E=!0),P(),K("open",S)}),S.on("close",()=>{t(0,E=!1),K("close",S)}),S.on("hover",()=>{K("hover",S)}))),l.$$.dirty[0]&8421384&&S&&r instanceof me.Marker&&(b==="click"?r.setPopup(S):r.getPopup()===S&&r.setPopup(void 0)),l.$$.dirty[0]&268468224&&V.includes(b)&&(i==null?void 0:i.type)===b&&(le(i),rt(Q,i=null,i)),l.$$.dirty[0]&268468224&&t(26,s=b==="hover"&&((i==null?void 0:i.type)==="mousemove"||(i==null?void 0:i.type)==="mouseenter")),l.$$.dirty[0]&352354304&&b==="hover"&&Q&&(s&&i&&je(i),t(0,E=(s||te)??!1)),l.$$.dirty[0]&12582914&&(be?S.setDOMContent(be):Z&&S.setHTML(Z)),l.$$.dirty[0]&8389632&&p&&S.setLngLat(p),l.$$.dirty[0]&41943045&&o){let m=S.isOpen();E&&!m?(S.addTo(o),Y==="opening"&&t(25,Y="justOpened")):!E&&m&&S.remove()}},[E,be,o,r,ne,W,a,Q,U,g,p,_,w,d,C,b,N,j,z,B,O,v,Z,S,te,Y,s,n,i,c,u,tt,nt]}class Tt extends de{constructor(e){super(),_e(this,e,Lt,Ot,ge,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function jt(l){let e;const t=l[16].default,n=Ve(t,l,l[24],null);return{c(){n&&n.c()},m(s,o){n&&n.m(s,o),e=!0},p(s,o){n&&n.p&&(!e||o&16777216)&&Xe(n,t,s,s[24],e?xe(t,s[24],o,null):Ye(s[24]),null)},i(s){e||(L(n,s),e=!0)},o(s){G(n,s),e=!1},d(s){n&&n.d(s)}}}function St(l){let e,t,n;function s(i){l[17](i)}let o={id:l[1],type:"symbol",source:l[2],sourceLayer:l[3],beforeId:l[4],beforeLayerType:l[5],paint:l[6],layout:l[7],filter:l[8],applyToClusters:l[9],minzoom:l[10],maxzoom:l[11],hoverCursor:l[12],manageHoverState:l[13],eventsIfTopMost:l[14],interactive:l[15],$$slots:{default:[jt]},$$scope:{ctx:l}};return l[0]!==void 0&&(o.hovered=l[0]),e=new ut({props:o}),x.push(()=>oe(e,"hovered",s)),e.$on("click",l[18]),e.$on("dblclick",l[19]),e.$on("contextmenu",l[20]),e.$on("mouseenter",l[21]),e.$on("mousemove",l[22]),e.$on("mouseleave",l[23]),{c(){A(e.$$.fragment)},m(i,r){R(e,i,r),n=!0},p(i,[r]){const f={};r&2&&(f.id=i[1]),r&4&&(f.source=i[2]),r&8&&(f.sourceLayer=i[3]),r&16&&(f.beforeId=i[4]),r&32&&(f.beforeLayerType=i[5]),r&64&&(f.paint=i[6]),r&128&&(f.layout=i[7]),r&256&&(f.filter=i[8]),r&512&&(f.applyToClusters=i[9]),r&1024&&(f.minzoom=i[10]),r&2048&&(f.maxzoom=i[11]),r&4096&&(f.hoverCursor=i[12]),r&8192&&(f.manageHoverState=i[13]),r&16384&&(f.eventsIfTopMost=i[14]),r&32768&&(f.interactive=i[15]),r&16777216&&(f.$$scope={dirty:r,ctx:i}),!t&&r&1&&(t=!0,f.hovered=i[0],se(()=>t=!1)),e.$set(f)},i(i){n||(L(e.$$.fragment,i),n=!0)},o(i){G(e.$$.fragment,i),n=!1},d(i){F(e,i)}}}function Mt(l,e,t){let{$$slots:n={},$$scope:s}=e,{id:o=at("symbol")}=e,{source:i=void 0}=e,{sourceLayer:r=void 0}=e,{beforeId:f=void 0}=e,{beforeLayerType:u=void 0}=e,{paint:c=void 0}=e,{layout:g=void 0}=e,{filter:_=void 0}=e,{applyToClusters:w=void 0}=e,{minzoom:d=void 0}=e,{maxzoom:C=void 0}=e,{hoverCursor:b=void 0}=e,{manageHoverState:N=!1}=e,{hovered:j=null}=e,{eventsIfTopMost:z=!1}=e,{interactive:B=!0}=e;function O(a){j=a,t(0,j)}function v(a){ae.call(this,l,a)}function p(a){ae.call(this,l,a)}function Z(a){ae.call(this,l,a)}function E(a){ae.call(this,l,a)}function K(a){ae.call(this,l,a)}function W(a){ae.call(this,l,a)}return l.$$set=a=>{"id"in a&&t(1,o=a.id),"source"in a&&t(2,i=a.source),"sourceLayer"in a&&t(3,r=a.sourceLayer),"beforeId"in a&&t(4,f=a.beforeId),"beforeLayerType"in a&&t(5,u=a.beforeLayerType),"paint"in a&&t(6,c=a.paint),"layout"in a&&t(7,g=a.layout),"filter"in a&&t(8,_=a.filter),"applyToClusters"in a&&t(9,w=a.applyToClusters),"minzoom"in a&&t(10,d=a.minzoom),"maxzoom"in a&&t(11,C=a.maxzoom),"hoverCursor"in a&&t(12,b=a.hoverCursor),"manageHoverState"in a&&t(13,N=a.manageHoverState),"hovered"in a&&t(0,j=a.hovered),"eventsIfTopMost"in a&&t(14,z=a.eventsIfTopMost),"interactive"in a&&t(15,B=a.interactive),"$$scope"in a&&t(24,s=a.$$scope)},[j,o,i,r,f,u,c,g,_,w,d,C,b,N,z,B,n,O,v,p,Z,E,K,W,s]}class et extends de{constructor(e){super(),_e(this,e,Mt,St,ge,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function Fe(l,e,t){const n=l.slice();return n[4]=e[t][0],n[5]=e[t][1],n}function Re(l){let e,t,n,s,o=l[4]+"",i,r;return{c(){e=T("div"),t=T("span"),s=D(),i=H(o),r=D(),I(t,"class",n="color-swatch "+l[1]+" svelte-1enycr6"),J(t,"background",l[5]),J(e,"display","flex"),J(e,"align-items","center"),J(e,"gap","6px")},m(f,u){k(f,e,u),y(e,t),y(e,s),y(e,i),y(e,r)},p(f,u){u&2&&n!==(n="color-swatch "+f[1]+" svelte-1enycr6")&&I(t,"class",n),u&1&&J(t,"background",f[5]),u&1&&o!==(o=f[4]+"")&&X(i,o)},d(f){f&&h(e)}}}function Gt(l){let e,t=Ne(Object.entries(l[0])),n=[];for(let s=0;s<t.length;s+=1)n[s]=Re(Fe(l,t,s));return{c(){e=T("div");for(let s=0;s<n.length;s+=1)n[s].c();J(e,"display","grid"),J(e,"grid-template-columns","repeat(auto-fill, calc("+l[2]+" - 10px))"),J(e,"gap","10px")},m(s,o){k(s,e,o);for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(e,null)},p(s,[o]){if(o&3){t=Ne(Object.entries(s[0]));let i;for(i=0;i<t.length;i+=1){const r=Fe(s,t,i);n[i]?n[i].p(r,o):(n[i]=Re(r),n[i].c(),n[i].m(e,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}o&4&&J(e,"grid-template-columns","repeat(auto-fill, calc("+s[2]+" - 10px))")},i:ie,o:ie,d(s){s&&h(e),ct(n,s)}}}function It(l,e,t){let n,{labelColors:s}=e,{swatchClass:o="rectangle"}=e,{itemsPerRow:i=2}=e;return l.$$set=r=>{"labelColors"in r&&t(0,s=r.labelColors),"swatchClass"in r&&t(1,o=r.swatchClass),"itemsPerRow"in r&&t(3,i=r.itemsPerRow)},l.$$.update=()=>{l.$$.dirty&8&&t(2,n=`${100/i}%`)},[s,o,n,i]}class zt extends de{constructor(e){super(),_e(this,e,It,Gt,ge,{labelColors:0,swatchClass:1,itemsPerRow:3})}}let ve="match-linestrings-review";function Nt(l){let e;return{c(){e=H("no matches (off-road)")},m(t,n){k(t,e,n)},p:ie,d(t){t&&h(e)}}}function Dt(l){let e=JSON.stringify(l[3].matching_sources)+"",t;return{c(){t=H(e)},m(n,s){k(n,t,s)},p(n,s){s&8&&e!==(e=JSON.stringify(n[3].matching_sources)+"")&&X(t,e)},d(n){n&&h(t)}}}function Et(l){let e,t,n,s,o,i,r,f,u,c,g,_,w,d,C,b,N,j;function z(v,p){return v[3].matching_sources.length>0?Dt:Nt}let B=z(l),O=B(l);return{c(){e=T("div"),t=T("h3"),n=H("Target "),s=H(l[0]),o=H(`:
    `),O.c(),i=D(),r=T("button"),r.innerHTML=`<kbd>Escape</kbd>
    - Back`,f=D(),u=T("h6"),u.textContent="Click sources to add or remove",c=D(),g=T("div"),_=T("button"),_.innerHTML=`<kbd>1</kbd>
    - Unreviewed`,w=D(),d=T("button"),d.innerHTML=`<kbd>2</kbd>
    - Not sure`,C=D(),b=T("button"),b.innerHTML=`<kbd>3</kbd>
    - Confirm correct`,I(r,"class","btn btn-secondary"),J(e,"display","flex"),J(e,"justify-content","space-between"),I(_,"class","btn btn-danger svelte-1tzb8bs"),ce(_,"current",l[3].reviewed=="unreviewed"),I(d,"class","btn btn-warning svelte-1tzb8bs"),ce(d,"current",l[3].reviewed=="not sure"),I(b,"class","btn btn-success svelte-1tzb8bs"),ce(b,"current",l[3].reviewed=="confirmed"),J(g,"display","flex"),J(g,"justify-content","space-between")},m(v,p){k(v,e,p),y(e,t),y(t,n),y(t,s),y(t,o),O.m(t,null),y(e,i),y(e,r),k(v,f,p),k(v,u,p),k(v,c,p),k(v,g,p),y(g,_),y(g,w),y(g,d),y(g,C),y(g,b),N||(j=[q(window,"keydown",l[4]),q(r,"click",function(){mt(l[2])&&l[2].apply(this,arguments)}),q(_,"click",l[6]),q(d,"click",l[7]),q(b,"click",l[8])],N=!0)},p(v,[p]){l=v,p&1&&X(s,l[0]),B===(B=z(l))&&O?O.p(l,p):(O.d(1),O=B(l),O&&(O.c(),O.m(t,null))),p&8&&ce(_,"current",l[3].reviewed=="unreviewed"),p&8&&ce(d,"current",l[3].reviewed=="not sure"),p&8&&ce(b,"current",l[3].reviewed=="confirmed")},i:ie,o:ie,d(v){v&&(h(e),h(f),h(u),h(c),h(g)),O.d(),N=!1,Le(j)}}}function Ht(l,e,t){let n,{clickedTarget:s}=e,{targetGj:o}=e,{onConfirm:i}=e,{onCancel:r}=e;function f(_){_.target.tagName!="INPUT"&&(_.key=="1"?i("unreviewed"):_.key=="2"?i("not sure"):_.key=="3"?i("confirmed"):_.key=="Escape"&&r())}const u=()=>i("unreviewed"),c=()=>i("not sure"),g=()=>i("confirmed");return l.$$set=_=>{"clickedTarget"in _&&t(0,s=_.clickedTarget),"targetGj"in _&&t(5,o=_.targetGj),"onConfirm"in _&&t(1,i=_.onConfirm),"onCancel"in _&&t(2,r=_.onCancel)},l.$$.update=()=>{l.$$.dirty&33&&t(3,n=o.features[s].properties)},[s,i,r,n,f,o,u,c,g]}class Pt extends de{constructor(e){super(),_e(this,e,Ht,Et,ge,{clickedTarget:0,targetGj:5,onConfirm:1,onCancel:2})}}function Ae(l){let e,t,n,s,o=l[0].features.length+"",i,r,f=l[1].features.length+"",u,c,g=l[1].features.filter(qe).length+"",_,w,d,C,b,N,j,z,B,O=!l[3]&&We(l);return{c(){e=T("button"),t=H("Swap"),n=D(),s=T("p"),i=H(o),r=H(` sources and
    `),u=H(f),c=H(" targets , with "),_=H(g),w=H(" matching a source"),d=D(),C=T("button"),C.textContent="Start review",b=D(),O&&O.c(),N=ye(),I(e,"class","btn btn-secondary"),e.disabled=l[3],I(C,"class","btn btn-primary mb-5")},m(v,p){k(v,e,p),y(e,t),k(v,n,p),k(v,s,p),y(s,i),y(s,r),y(s,u),y(s,c),y(s,_),y(s,w),k(v,d,p),k(v,C,p),k(v,b,p),O&&O.m(v,p),k(v,N,p),j=!0,z||(B=[q(e,"click",l[8]),q(C,"click",l[11])],z=!0)},p(v,p){(!j||p&8)&&(e.disabled=v[3]),(!j||p&1)&&o!==(o=v[0].features.length+"")&&X(i,o),(!j||p&2)&&f!==(f=v[1].features.length+"")&&X(u,f),(!j||p&2)&&g!==(g=v[1].features.filter(qe).length+"")&&X(_,g),v[3]?O&&($(),G(O,1,1,()=>{O=null}),ee()):O?(O.p(v,p),p&8&&L(O,1)):(O=We(v),O.c(),L(O,1),O.m(N.parentNode,N))},i(v){j||(L(O),j=!0)},o(v){G(O),j=!1},d(v){v&&(h(e),h(n),h(s),h(d),h(C),h(b),h(N)),O&&O.d(v),z=!1,Le(B)}}}function We(l){let e,t,n;function s(i){l[12](i)}let o={onChange:l[6]};return l[4]!==void 0&&(o.options=l[4]),e=new _t({props:o}),x.push(()=>oe(e,"options",s)),{c(){A(e.$$.fragment)},m(i,r){R(e,i,r),n=!0},p(i,r){const f={};!t&&r&16&&(t=!0,f.options=i[4],se(()=>t=!1)),e.$set(f)},i(i){n||(L(e.$$.fragment,i),n=!0)},o(i){G(e.$$.fragment,i),n=!1},d(i){F(e,i)}}}function Bt(l){let e,t,n,s,o,i,r,f,u=l[0].features.length>0&&Ae(l);return{c(){e=T("label"),t=H(`Load two .geojson files
  `),n=T("input"),s=D(),u&&u.c(),o=ye(),I(n,"class","form-control"),I(n,"type","file"),n.multiple=!0,I(e,"class","form-label")},m(c,g){k(c,e,g),y(e,t),y(e,n),l[10](n),k(c,s,g),u&&u.m(c,g),k(c,o,g),i=!0,r||(f=q(n,"change",l[7]),r=!0)},p(c,[g]){c[0].features.length>0?u?(u.p(c,g),g&1&&L(u,1)):(u=Ae(c),u.c(),L(u,1),u.m(o.parentNode,o)):u&&($(),G(u,1,1,()=>{u=null}),ee())},i(c){i||(L(u),i=!0)},o(c){G(u),i=!1},d(c){c&&(h(e),h(s),h(o)),l[10](null),u&&u.d(c),r=!1,f()}}}function Ue(l){let e=0;for(let t of l.features)t.id=e++,t.properties??(t.properties={});return l}const qe=l=>l.properties.matching_sources.length>0;function Jt(l,e,t){let{sourceGj:n}=e,{targetGj:s}=e,{setupDone:o}=e,{zoomFit:i}=e,r=!1,f={buffer_meters:20,angle_diff_threshold:10,length_ratio_threshold:1.1,midpt_dist_threshold:15};function u(){var b;if(!r)try{let N=JSON.parse(dt(JSON.stringify(n),JSON.stringify(s),f));for(let[j,z]of s.features.entries())z.properties.matching_sources=N[j].matching_sources,(b=z.properties).reviewed??(b.reviewed="unreviewed");t(1,s)}catch(N){window.alert(`Bug: ${N}`)}}let c;async function g(b){if(!c.files)return;if(c.files.length!=2){window.alert("Select two GeoJSON files");return}try{let j=await c.files[0].text(),z=await c.files[1].text();t(0,n=Ue(JSON.parse(j))),t(1,s=Ue(JSON.parse(z))),"matching_sources"in s.features[0].properties?t(3,r=!0):"matching_sources"in n.features[0].properties&&(t(3,r=!0),t(0,[n,s]=[s,n],n,t(1,s))),i(),u()}catch(j){window.alert(`Bad input file: ${j}`)}}function _(){t(0,[n,s]=[s,n],n,t(1,s)),u()}function w(b){x[b?"unshift":"push"](()=>{c=b,t(5,c)})}const d=()=>t(2,o=!0);function C(b){f=b,t(4,f)}return l.$$set=b=>{"sourceGj"in b&&t(0,n=b.sourceGj),"targetGj"in b&&t(1,s=b.targetGj),"setupDone"in b&&t(2,o=b.setupDone),"zoomFit"in b&&t(9,i=b.zoomFit)},[n,s,o,r,f,c,u,g,_,i,w,d,C]}class Ft extends de{constructor(e){super(),_e(this,e,Jt,Bt,ge,{sourceGj:0,targetGj:1,setupDone:2,zoomFit:9})}}const{window:Rt}=ht;function At(l){let e,t,n,s,o,i,r,f,u,c,g,_,w,d,C=l[1].features.length+"",b,N,j,z,B,O,v,p,Z,E,K,W,a,Q,U,re,fe,V,S,te;return U=new zt({props:{itemsPerRow:1,labelColors:{Confirmed:"green","Not sure":"orange",Unreviewed:"red",Source:"grey"}}}),{c(){e=T("div"),t=T("button"),t.textContent="Start over",n=D(),s=T("button"),s.textContent="Zoom to fit",o=D(),i=T("br"),r=D(),f=T("div"),u=T("div"),g=D(),_=T("p"),w=H(l[4]),d=H(" / "),b=H(C),N=H(" targets reviewed"),j=D(),z=T("button"),z.textContent="Download reviews",B=D(),O=T("div"),v=T("label"),p=T("input"),Z=H(`
          Show labels for matches`),E=D(),K=T("div"),W=T("div"),a=T("h5"),a.textContent="Legend",Q=D(),A(U.$$.fragment),re=D(),fe=T("p"),fe.textContent="Thinner lines have a match, thicker are off-road",I(t,"class","btn btn-outline-danger"),I(s,"class","btn btn-outline-secondary"),J(e,"display","flex"),J(e,"justify-content","space-between"),I(u,"class","progress-bar"),J(u,"width",`${100*l[4]/l[1].features.length}%`),I(f,"class","progress"),I(f,"role","progressbar"),I(f,"aria-valuenow",l[4]),I(f,"aria-valuemin","0"),I(f,"aria-valuemax",c=l[1].features.length),I(z,"class","btn btn-outline-success"),I(p,"class","form-check-input"),I(p,"type","checkbox"),I(v,"class","form-check-label mt-5"),I(a,"class","card-title"),I(W,"class","card-body"),I(K,"class","card")},m(M,P){k(M,e,P),y(e,t),y(e,n),y(e,s),k(M,o,P),k(M,i,P),k(M,r,P),k(M,f,P),y(f,u),k(M,g,P),k(M,_,P),y(_,w),y(_,d),y(_,b),y(_,N),k(M,j,P),k(M,z,P),k(M,B,P),k(M,O,P),y(O,v),y(v,p),p.checked=l[7],y(v,Z),k(M,E,P),k(M,K,P),y(K,W),y(W,a),y(W,Q),R(U,W,null),y(W,re),y(W,fe),V=!0,S||(te=[q(t,"click",l[14]),q(s,"click",l[9]),q(z,"click",l[13]),q(p,"change",l[24])],S=!0)},p(M,P){P&18&&J(u,"width",`${100*M[4]/M[1].features.length}%`),(!V||P&16)&&I(f,"aria-valuenow",M[4]),(!V||P&2&&c!==(c=M[1].features.length))&&I(f,"aria-valuemax",c),(!V||P&16)&&X(w,M[4]),(!V||P&2)&&C!==(C=M[1].features.length+"")&&X(b,C),P&128&&(p.checked=M[7])},i(M){V||(L(U.$$.fragment,M),V=!0)},o(M){G(U.$$.fragment,M),V=!1},d(M){M&&(h(e),h(o),h(i),h(r),h(f),h(g),h(_),h(j),h(z),h(B),h(O),h(E),h(K)),F(U),S=!1,Le(te)}}}function Wt(l){let e,t,n,s,o;function i(c){l[21](c)}function r(c){l[22](c)}function f(c){l[23](c)}let u={zoomFit:l[9]};return l[0]!==void 0&&(u.sourceGj=l[0]),l[1]!==void 0&&(u.targetGj=l[1]),l[2]!==void 0&&(u.setupDone=l[2]),e=new Ft({props:u}),x.push(()=>oe(e,"sourceGj",i)),x.push(()=>oe(e,"targetGj",r)),x.push(()=>oe(e,"setupDone",f)),{c(){A(e.$$.fragment)},m(c,g){R(e,c,g),o=!0},p(c,g){const _={};!t&&g&1&&(t=!0,_.sourceGj=c[0],se(()=>t=!1)),!n&&g&2&&(n=!0,_.targetGj=c[1],se(()=>n=!1)),!s&&g&4&&(s=!0,_.setupDone=c[2],se(()=>s=!1)),e.$set(_)},i(c){o||(L(e.$$.fragment,c),o=!0)},o(c){G(e.$$.fragment,c),o=!1},d(c){F(e,c)}}}function Ut(l){let e,t,n,s,o,i,r,f;const u=[Wt,At],c=[];function g(_,w){return _[2]?1:0}return i=g(l),r=c[i]=u[i](l),{c(){e=T("div"),t=T("h1"),t.textContent="Manually specify LineString matchings for test cases",n=D(),s=T("div"),s.innerHTML='<a class="icon-link mb-3" href="https://github.com/nptscot/match_linestrings/blob/main/tests/README.md" target="_blank">About <i class="fa-solid fa-arrow-up-right-from-square"></i></a>',o=D(),r.c(),I(e,"slot","left")},m(_,w){k(_,e,w),y(e,t),y(e,n),y(e,s),y(e,o),c[i].m(e,null),f=!0},p(_,w){let d=i;i=g(_),i===d?c[i].p(_,w):($(),G(c[d],1,1,()=>{c[d]=null}),ee(),r=c[i],r?r.p(_,w):(r=c[i]=u[i](_),r.c()),L(r,1),r.m(e,null))},i(_){f||(L(r),f=!0)},o(_){G(r),f=!1},d(_){_&&h(e),c[i].d()}}}function Ke(l){let e,t,n,s;const o=[Kt,qt],i=[];function r(f,u){return f[3]==null?0:1}return t=r(l),n=i[t]=o[t](l),{c(){e=T("div"),n.c(),I(e,"class","map-panel svelte-hr6p1s")},m(f,u){k(f,e,u),i[t].m(e,null),s=!0},p(f,u){let c=t;t=r(f),t===c?i[t].p(f,u):($(),G(i[c],1,1,()=>{i[c]=null}),ee(),n=i[t],n?n.p(f,u):(n=i[t]=o[t](f),n.c()),L(n,1),n.m(e,null))},i(f){s||(L(n),s=!0)},o(f){G(n),s=!1},d(f){f&&h(e),i[t].d()}}}function qt(l){let e,t;return e=new Pt({props:{clickedTarget:l[3],targetGj:l[1],onConfirm:l[10],onCancel:l[18]}}),{c(){A(e.$$.fragment)},m(n,s){R(e,n,s),t=!0},p(n,s){const o={};s&8&&(o.clickedTarget=n[3]),s&2&&(o.targetGj=n[1]),s&8&&(o.onCancel=n[18]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Kt(l){let e,t,n,s,o,i,r;return{c(){e=T("button"),t=H("Goto "),n=T("kbd"),n.textContent="n",s=H(`
              ext unreviewed`),I(e,"class","btn btn-primary"),e.disabled=o=l[4]==l[1].features.length},m(f,u){k(f,e,u),y(e,t),y(e,n),y(e,s),i||(r=q(e,"click",l[11]),i=!0)},p(f,u){u&18&&o!==(o=f[4]==f[1].features.length)&&(e.disabled=o)},i:ie,o:ie,d(f){f&&h(e),i=!1,r()}}}function Qe(l){let e,t;return e=new Tt({props:{openOn:"hover",$$slots:{default:[Qt,({data:n})=>({25:n}),({data:n})=>n?33554432:0]},$$scope:{ctx:l}}}),{c(){A(e.$$.fragment)},m(n,s){R(e,n,s),t=!0},p(n,s){const o={};s&100663552&&(o.$$scope={dirty:s,ctx:n}),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Qt(l){let e,t=we(l[25]).id+"",n,s,o=l[8].includes(we(l[25]).id)?"remove":"add",i;return{c(){e=H("Source "),n=H(t),s=H(" -- click to "),i=H(o)},m(r,f){k(r,e,f),k(r,n,f),k(r,s,f),k(r,i,f)},p(r,f){f&33554432&&t!==(t=we(r[25]).id+"")&&X(n,t),f&33554688&&o!==(o=r[8].includes(we(r[25]).id)?"remove":"add")&&X(i,o)},d(r){r&&(h(e),h(n),h(s),h(i))}}}function Zt(l){let e,t,n=l[3]!=null&&Qe(l);return{c(){n&&n.c(),e=ye()},m(s,o){n&&n.m(s,o),k(s,e,o),t=!0},p(s,o){s[3]!=null?n?(n.p(s,o),o&8&&L(n,1)):(n=Qe(s),n.c(),L(n,1),n.m(e.parentNode,e)):n&&($(),G(n,1,1,()=>{n=null}),ee())},i(s){t||(L(n),t=!0)},o(s){G(n),t=!1},d(s){s&&h(e),n&&n.d(s)}}}function Vt(l){let e,t,n,s;return e=new $e({props:{manageHoverState:!0,paint:{"line-color":["case",["in",["id"],["literal",l[8]]],"blue","black"],"line-width":8,"line-opacity":Ee(.5,1)},hoverCursor:l[3]==null?void 0:"pointer",$$slots:{default:[Zt]},$$scope:{ctx:l}}}),e.$on("click",l[16]),n=new et({props:{paint:{"text-color":"white","text-halo-color":"grey","text-halo-width":4},layout:{"text-field":["to-string",["id"]],"text-size":16,"symbol-placement":"line",visibility:l[7]?"visible":"none"}}}),{c(){A(e.$$.fragment),t=D(),A(n.$$.fragment)},m(o,i){R(e,o,i),k(o,t,i),R(n,o,i),s=!0},p(o,i){const r={};i&256&&(r.paint={"line-color":["case",["in",["id"],["literal",o[8]]],"blue","black"],"line-width":8,"line-opacity":Ee(.5,1)}),i&8&&(r.hoverCursor=o[3]==null?void 0:"pointer"),i&67109128&&(r.$$scope={dirty:i,ctx:o}),e.$set(r);const f={};i&128&&(f.layout={"text-field":["to-string",["id"]],"text-size":16,"symbol-placement":"line",visibility:o[7]?"visible":"none"}),n.$set(f)},i(o){s||(L(e.$$.fragment,o),L(n.$$.fragment,o),s=!0)},o(o){G(e.$$.fragment,o),G(n.$$.fragment,o),s=!1},d(o){o&&h(t),F(e,o),F(n,o)}}}function Xt(l){let e,t,n,s;return e=new $e({props:{manageHoverState:!0,paint:{"line-width":["case",[">",["length",["get","matching_sources"]],0],8,16],"line-color":["match",["get","reviewed"],"unreviewed","red","not sure","orange","green"],"line-opacity":["case",["==",["id"],l[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,.3]},hoverCursor:"pointer"}}),e.$on("click",l[15]),n=new et({props:{paint:{"text-color":"white","text-halo-color":["match",["get","reviewed"],"unreviewed","red","not sure","orange","green"],"text-halo-width":4},layout:{"text-field":["case",[">",["length",["get","matching_sources"]],0],["to-string",["get","matching_sources"]],"off-road"],"text-size":16,"symbol-placement":"line",visibility:l[7]?"visible":"none"}}}),{c(){A(e.$$.fragment),t=D(),A(n.$$.fragment)},m(o,i){R(e,o,i),k(o,t,i),R(n,o,i),s=!0},p(o,i){const r={};i&8&&(r.paint={"line-width":["case",[">",["length",["get","matching_sources"]],0],8,16],"line-color":["match",["get","reviewed"],"unreviewed","red","not sure","orange","green"],"line-opacity":["case",["==",["id"],o[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,.3]}),e.$set(r);const f={};i&128&&(f.layout={"text-field":["case",[">",["length",["get","matching_sources"]],0],["to-string",["get","matching_sources"]],"off-road"],"text-size":16,"symbol-placement":"line",visibility:o[7]?"visible":"none"}),n.$set(f)},i(o){s||(L(e.$$.fragment,o),L(n.$$.fragment,o),s=!0)},o(o){G(e.$$.fragment,o),G(n.$$.fragment,o),s=!1},d(o){o&&h(t),F(e,o),F(n,o)}}}function Yt(l){let e,t,n,s,o,i,r,f,u,c;e=new wt({props:{map:l[5]}});function g(d){l[17](d)}let _={choice:"Maptiler Dataviz"};l[6]!==void 0&&(_.style=l[6]),n=new vt({props:_}),x.push(()=>oe(n,"style",g));let w=l[2]&&Ke(l);return r=new De({props:{data:l[0],$$slots:{default:[Vt]},$$scope:{ctx:l}}}),u=new De({props:{data:l[1],$$slots:{default:[Xt]},$$scope:{ctx:l}}}),{c(){A(e.$$.fragment),t=D(),A(n.$$.fragment),o=D(),w&&w.c(),i=D(),A(r.$$.fragment),f=D(),A(u.$$.fragment)},m(d,C){R(e,d,C),k(d,t,C),R(n,d,C),k(d,o,C),w&&w.m(d,C),k(d,i,C),R(r,d,C),k(d,f,C),R(u,d,C),c=!0},p(d,C){const b={};C&32&&(b.map=d[5]),e.$set(b);const N={};!s&&C&64&&(s=!0,N.style=d[6],se(()=>s=!1)),n.$set(N),d[2]?w?(w.p(d,C),C&4&&L(w,1)):(w=Ke(d),w.c(),L(w,1),w.m(i.parentNode,i)):w&&($(),G(w,1,1,()=>{w=null}),ee());const j={};C&1&&(j.data=d[0]),C&67109256&&(j.$$scope={dirty:C,ctx:d}),r.$set(j);const z={};C&2&&(z.data=d[1]),C&67109e3&&(z.$$scope={dirty:C,ctx:d}),u.$set(z)},i(d){c||(L(e.$$.fragment,d),L(n.$$.fragment,d),L(w),L(r.$$.fragment,d),L(u.$$.fragment,d),c=!0)},o(d){G(e.$$.fragment,d),G(n.$$.fragment,d),G(w),G(r.$$.fragment,d),G(u.$$.fragment,d),c=!1},d(d){d&&(h(t),h(o),h(i),h(f)),F(e,d),F(n,d),w&&w.d(d),F(r,d),F(u,d)}}}function xt(l){let e,t,n,s;function o(r){l[19](r)}let i={style:l[6],hash:!0,$$slots:{default:[Yt]},$$scope:{ctx:l}};return l[5]!==void 0&&(i.map=l[5]),t=new pt({props:i}),x.push(()=>oe(t,"map",o)),t.$on("error",l[20]),{c(){e=T("div"),A(t.$$.fragment),I(e,"slot","main"),J(e,"position","relative"),J(e,"width","100%"),J(e,"height","100vh")},m(r,f){k(r,e,f),R(t,e,null),s=!0},p(r,f){const u={};f&64&&(u.style=r[6]),f&67109375&&(u.$$scope={dirty:f,ctx:r}),!n&&f&32&&(n=!0,u.map=r[5],se(()=>n=!1)),t.$set(u)},i(r){s||(L(t.$$.fragment,r),s=!0)},o(r){G(t.$$.fragment,r),s=!1},d(r){r&&h(e),F(t)}}}function $t(l){let e,t,n,s;return e=new gt({props:{$$slots:{main:[xt],left:[Ut]},$$scope:{ctx:l}}}),{c(){A(e.$$.fragment)},m(o,i){R(e,o,i),t=!0,n||(s=q(Rt,"keydown",l[12]),n=!0)},p(o,[i]){const r={};i&67109375&&(r.$$scope={dirty:i,ctx:o}),e.$set(r)},i(o){t||(L(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){F(e,o),n=!1,s()}}}function en(l,e,t){let n,s,o,i=bt["Maptiler Dataviz"],r=ke(),f=ke(),u=!1,c=!1,g=null;Ze(async()=>{await yt();try{let a=window.localStorage.getItem(ve);if(a){let Q=JSON.parse(a);t(0,[r,f]=Q,r,t(1,f)),t(2,u=!0),console.log(`Restored data from local storage ${ve}`)}}catch(a){console.log(`Couldn't restore data from local storage: ${a}`)}});function _(){let a={type:"FeatureCollection",features:[...r.features,...f.features]};o==null||o.fitBounds(He(a),{animate:!1,padding:10})}function w(a){if(g==null)throw new Error("impossible");t(1,f.features[g].properties.reviewed=a,f),t(1,f),t(3,g=null)}function d(){for(let a of f.features)if(a.properties.reviewed=="unreviewed"){o==null||o.fitBounds(He(a),{duration:600,padding:200}),t(3,g=a.id);return}}function C(a){a.target.tagName=="INPUT"||!u||a.key=="n"&&d()}function b(){kt("reviewed_targets.geojson",JSON.stringify(f))}function N(){window.confirm("Do you want to discard this review and start over?")&&(t(0,r=ke()),t(1,f=ke()),t(2,u=!1),t(3,g=null),t(7,c=!1),window.localStorage.removeItem(ve))}function j(a){u&&t(3,g=a.detail.features[0].id)}function z(a){if(!u||g==null)return;let Q=a.detail.features[0].id,U=f.features[g].properties;U.matching_sources.includes(Q)?U.matching_sources=U.matching_sources.filter(re=>re!=Q):U.matching_sources.push(Q),t(1,f)}function B(a){i=a,t(6,i)}const O=()=>t(3,g=null);function v(a){o=a,t(5,o)}const p=a=>{console.log(a.detail.error)};function Z(a){r=a,t(0,r)}function E(a){f=a,t(1,f)}function K(a){u=a,t(2,u)}function W(){c=this.checked,t(7,c)}return l.$$.update=()=>{l.$$.dirty&10&&t(8,n=g==null?[]:f.features[g].properties.matching_sources),l.$$.dirty&2&&t(4,s=f.features.filter(a=>a.properties.reviewed!="unreviewed").length),l.$$.dirty&23&&u&&(console.log(`Autosaving with ${s} reviewed targets`),window.localStorage.setItem(ve,JSON.stringify([r,f])))},[r,f,u,g,s,o,i,c,n,_,w,d,C,b,N,j,z,B,O,v,p,Z,E,K,W]}class tn extends de{constructor(e){super(),_e(this,e,en,$t,ge,{})}}new tn({target:document.getElementById("app")});
