import{S as ae,i as ce,s as me,P as de,r as g,t as k,w as K,g as S,x as U,y as b,Q as Ze,R as Qe,T as Ve,U as ie,o as ze,V as x,W as Xe,X as Ye,j as G,Y as xe,Z as $e,$ as et,a0 as tt,a1 as nt,z as V,n as E,k as H,q as T,B as F,u as O,v as B,I as W,a2 as X,J as ge,H as ot,A as te,d as P,e as z,C as ne,h as A,E as lt,L as st,a3 as it,M as rt,D as re,_ as ut,G as ft,F as Se,K as Le,N as Ae,O as Te,a4 as ue}from"./Settings-26083545.js";const at=l=>({features:l[0]&16,data:l[0]&16,map:l[0]&4,close:l[0]&1}),Ne=l=>{var t;return{features:l[4],data:((t=l[4])==null?void 0:t[0])??null,map:l[2],close:l[31]}};function De(l){var s;let t,e,n=(((s=l[4])==null?void 0:s.length)||l[3]instanceof x.Marker)&&Ee(l);return{c(){t=G("div"),n&&n.c()},m(o,r){g(o,t,r),n&&n.m(t,null),l[32](t),e=!0},p(o,r){var i;(i=o[4])!=null&&i.length||o[3]instanceof x.Marker?n?(n.p(o,r),r[0]&24&&k(n,1)):(n=Ee(o),n.c(),k(n,1),n.m(t,null)):n&&(K(),S(n,1,1,()=>{n=null}),U())},i(o){e||(k(n),e=!0)},o(o){S(n),e=!1},d(o){o&&b(t),n&&n.d(),l[32](null)}}}function Ee(l){let t;const e=l[30].default,n=xe(e,l,l[29],Ne);return{c(){n&&n.c()},m(s,o){n&&n.m(s,o),t=!0},p(s,o){n&&n.p&&(!t||o[0]&536870933)&&$e(n,e,s,s[29],t?tt(e,s[29],o,at):et(s[29]),Ne)},i(s){t||(k(n,s),t=!0)},o(s){S(n,s),t=!1},d(s){n&&n.d(s)}}}function ct(l){let t,e,n=l[9].default&&De(l);return{c(){n&&n.c(),t=de()},m(s,o){n&&n.m(s,o),g(s,t,o),e=!0},p(s,o){s[9].default?n?(n.p(s,o),o[0]&512&&k(n,1)):(n=De(s),n.c(),k(n,1),n.m(t.parentNode,t)):n&&(K(),S(n,1,1,()=>{n=null}),U())},i(s){e||(k(n),e=!0)},o(s){S(n),e=!1},d(s){s&&b(t),n&&n.d(s)}}}function mt(l,t,e){let n,s,o,r,i,u,{$$slots:c={},$$scope:f}=t;const h=Ze(c);let{closeButton:p=void 0}=t,{closeOnClickOutside:j=!0}=t,{closeOnClickInside:N=!1}=t,{closeOnMove:D=!1}=t,{openOn:d="click"}=t,{openIfTopMost:L=!0}=t,{focusAfterOpen:C=!0}=t,{anchor:w=void 0}=t,{offset:I=void 0}=t,{popupClass:J=void 0}=t,{maxWidth:M=void 0}=t,{lngLat:m=void 0}=t,{html:y=void 0}=t,{open:_=!1}=t;const $=Qe(),{map:be,popupTarget:he,layerEvent:oe,layer:ke,eventTopMost:Re,markerClickManager:we}=Ve();ie(l,be,a=>e(2,o=a)),ie(l,he,a=>e(3,i=a)),ie(l,oe,a=>e(28,r=a)),ie(l,ke,a=>e(35,u=a));const We=["click","dblclick","contextmenu"];let v,le=!1,q;function qe(){if(!v)return;let a=v.getElement();!a||a===q||(q=a,d==="hover"&&(q.style.pointerEvents="none"),q.addEventListener("mouseenter",()=>{e(24,le=!0)},{passive:!0}),q.addEventListener("mouseleave",()=>{e(24,le=!1)},{passive:!0}),q.addEventListener("click",()=>{N&&e(0,_=!1)},{passive:!0}))}ze(()=>{if(o)return o.on("click",se),o.on("contextmenu",se),we.add(Ge),typeof i=="string"&&(o.on("click",i,Q),o.on("dblclick",i,Q),o.on("contextmenu",i,Q),o.on("mousemove",i,Me),o.on("mouseleave",i,je),o.on("touchstart",i,Oe),o.on("touchend",i,Ce)),()=>{o!=null&&o.loaded()&&(v==null||v.remove(),o.off("click",se),o.off("contextmenu",se),we.remove(Ge),i instanceof x.Marker?i.getPopup()===v&&i.setPopup(void 0):typeof i=="string"&&(o.off("click",i,Q),o.off("dblclick",i,Q),o.off("contextmenu",i,Q),o.off("mousemove",i,Me),o.off("mouseleave",i,je),o.off("touchstart",i,Oe),o.off("touchend",i,Ce)))}});function ye(a){return L?!("marker"in a)&&!nt(a)&&Re(a)!==u:!1}let Z=null,R="normal";function ve(a){"layerType"in a&&a.layerType==="deckgl"?(e(10,m=a.coordinate),e(4,Z=a.object?[a.object]:null)):(e(10,m=a.lngLat),e(4,Z=a.features??[]))}function Q(a){a.type!==d||ye(a)||(ve(a),setTimeout(()=>e(0,_=!0)))}let Y=null;function Oe(a){Y=a.point}function Ce(a){if(!Y||d!=="hover")return;let pe=Y.dist(a.point);Y=null,pe<3&&(e(10,m=a.lngLat),e(4,Z=a.features??[]),v.isOpen()?e(25,R="justOpened"):(e(25,R="opening"),e(0,_=!0)))}function je(a){d!=="hover"||Y||R!=="normal"||(e(0,_=!1),e(4,Z=null))}function Me(a){if(!(d!=="hover"||Y||R!=="normal")){if(ye(a)){e(0,_=!1),e(4,Z=null);return}e(0,_=!0),e(4,Z=a.features??[]),e(10,m=a.lngLat)}}function se(a){if(R==="justOpened"){e(25,R="normal");return}if(!j)return;let pe=[q,i instanceof x.Marker?i==null?void 0:i.getElement():null];_&&v.isOpen()&&!pe.some(_e=>_e==null?void 0:_e.contains(a.originalEvent.target))&&(a.type==="contextmenu"&&d==="contextmenu"||a.type!=="contextmenu")&&e(0,_=!1)}function Ge(a){j&&_&&v.isOpen()&&a.marker!==i&&e(0,_=!1)}Xe(()=>{o&&(v!=null&&v.isOpen())&&v.remove()});let ee;const Ke=()=>e(0,_=!1);function Ue(a){V[a?"unshift":"push"](()=>{ee=a,e(1,ee)})}return l.$$set=a=>{"closeButton"in a&&e(11,p=a.closeButton),"closeOnClickOutside"in a&&e(12,j=a.closeOnClickOutside),"closeOnClickInside"in a&&e(13,N=a.closeOnClickInside),"closeOnMove"in a&&e(14,D=a.closeOnMove),"openOn"in a&&e(15,d=a.openOn),"openIfTopMost"in a&&e(16,L=a.openIfTopMost),"focusAfterOpen"in a&&e(17,C=a.focusAfterOpen),"anchor"in a&&e(18,w=a.anchor),"offset"in a&&e(19,I=a.offset),"popupClass"in a&&e(20,J=a.popupClass),"maxWidth"in a&&e(21,M=a.maxWidth),"lngLat"in a&&e(10,m=a.lngLat),"html"in a&&e(22,y=a.html),"open"in a&&e(0,_=a.open),"$$scope"in a&&e(29,f=a.$$scope)},l.$$.update=()=>{if(l.$$.dirty[0]&14336&&e(27,n=p??(!j&&!N)),l.$$.dirty[0]&146685952&&(v||(e(23,v=new x.Popup({closeButton:n,closeOnClick:!1,closeOnMove:D,focusAfterOpen:C,maxWidth:M,className:J,anchor:w,offset:I})),q=v.getElement(),v.on("open",()=>{e(0,_=!0),qe(),$("open",v)}),v.on("close",()=>{e(0,_=!1),$("close",v)}),v.on("hover",()=>{$("hover",v)}))),l.$$.dirty[0]&8421384&&v&&i instanceof x.Marker&&(d==="click"?i.setPopup(v):i.getPopup()===v&&i.setPopup(void 0)),l.$$.dirty[0]&268468224&&We.includes(d)&&(r==null?void 0:r.type)===d&&(Q(r),Ye(oe,r=null,r)),l.$$.dirty[0]&268468224&&e(26,s=d==="hover"&&((r==null?void 0:r.type)==="mousemove"||(r==null?void 0:r.type)==="mouseenter")),l.$$.dirty[0]&352354304&&d==="hover"&&oe&&(s&&r&&ve(r),e(0,_=(s||le)??!1)),l.$$.dirty[0]&12582914&&(ee?v.setDOMContent(ee):y&&v.setHTML(y)),l.$$.dirty[0]&8389632&&m&&v.setLngLat(m),l.$$.dirty[0]&41943045&&o){let a=v.isOpen();_&&!a?(v.addTo(o),R==="opening"&&e(25,R="justOpened")):!_&&a&&v.remove()}},[_,ee,o,i,Z,be,he,oe,ke,h,m,p,j,N,D,d,L,C,w,I,J,M,y,v,le,R,s,n,r,f,c,Ke,Ue]}class dt extends ae{constructor(t){super(),ce(this,t,mt,ct,me,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}let fe="match-linestrings-review";function pt(l){let t,e,n,s,o=JSON.stringify(l[1].features[l[0]].properties.matching_sources)+"",r,i,u,c,f,h,p,j,N,D,d,L;return{c(){t=G("h3"),e=E("Target "),n=E(l[0]),s=E(": "),r=E(o),i=H(),u=G("h6"),u.textContent="Click sources to add or remove",c=H(),f=G("div"),h=G("button"),h.innerHTML=`<kbd>1</kbd>
    - Unreviewed`,p=H(),j=G("button"),j.innerHTML=`<kbd>2</kbd>
    - Not sure`,N=H(),D=G("button"),D.innerHTML=`<kbd>3</kbd>
    - Confirm correct`,T(h,"class","btn btn-secondary"),T(j,"class","btn btn-warning"),T(D,"class","btn btn-success"),F(f,"display","flex"),F(f,"justify-content","space-between")},m(C,w){g(C,t,w),O(t,e),O(t,n),O(t,s),O(t,r),g(C,i,w),g(C,u,w),g(C,c,w),g(C,f,w),O(f,h),O(f,p),O(f,j),O(f,N),O(f,D),d||(L=[B(window,"keydown",l[3]),B(h,"click",l[4]),B(j,"click",l[5]),B(D,"click",l[6])],d=!0)},p(C,[w]){w&1&&W(n,C[0]),w&3&&o!==(o=JSON.stringify(C[1].features[C[0]].properties.matching_sources)+"")&&W(r,o)},i:X,o:X,d(C){C&&(b(t),b(i),b(u),b(c),b(f)),d=!1,ge(L)}}}function _t(l,t,e){let{clickedTarget:n}=t,{targetGj:s}=t,{onConfirm:o}=t;function r(f){f.target.tagName!="INPUT"&&(f.key=="1"?o("unreviewed"):f.key=="2"?o("not sure"):f.key=="3"&&o("confirmed"))}const i=()=>o("unreviewed"),u=()=>o("not sure"),c=()=>o("confirmed");return l.$$set=f=>{"clickedTarget"in f&&e(0,n=f.clickedTarget),"targetGj"in f&&e(1,s=f.targetGj),"onConfirm"in f&&e(2,o=f.onConfirm)},[n,s,o,r,i,u,c]}class gt extends ae{constructor(t){super(),ce(this,t,_t,pt,me,{clickedTarget:0,targetGj:1,onConfirm:2})}}function Ie(l){let t,e,n,s,o=l[0].features.length+"",r,i,u,c=l[1].features.length+"",f,h,p,j=l[1].features.filter(Be).length+"",N,D,d,L,C,w,I,J,M,m=!l[3]&&He(l);return{c(){t=G("button"),e=E("Swap"),n=H(),s=G("p"),r=E(o),i=E(` sources and
    `),u=G("span"),f=E(c),h=E(" targets"),p=E(`
    , with `),N=E(j),D=E(" matching a source"),d=H(),L=G("button"),L.textContent="Start review",C=H(),m&&m.c(),w=de(),T(t,"class","btn btn-secondary"),t.disabled=l[3],F(u,"color","red"),T(L,"class","btn btn-primary mb-5")},m(y,_){g(y,t,_),O(t,e),g(y,n,_),g(y,s,_),O(s,r),O(s,i),O(s,u),O(u,f),O(u,h),O(s,p),O(s,N),O(s,D),g(y,d,_),g(y,L,_),g(y,C,_),m&&m.m(y,_),g(y,w,_),I=!0,J||(M=[B(t,"click",l[8]),B(L,"click",l[11])],J=!0)},p(y,_){(!I||_&8)&&(t.disabled=y[3]),(!I||_&1)&&o!==(o=y[0].features.length+"")&&W(r,o),(!I||_&2)&&c!==(c=y[1].features.length+"")&&W(f,c),(!I||_&2)&&j!==(j=y[1].features.filter(Be).length+"")&&W(N,j),y[3]?m&&(K(),S(m,1,1,()=>{m=null}),U()):m?(m.p(y,_),_&8&&k(m,1)):(m=He(y),m.c(),k(m,1),m.m(w.parentNode,w))},i(y){I||(k(m),I=!0)},o(y){S(m),I=!1},d(y){y&&(b(t),b(n),b(s),b(d),b(L),b(C),b(w)),m&&m.d(y),J=!1,ge(M)}}}function He(l){let t,e,n;function s(r){l[12](r)}let o={onChange:l[6]};return l[4]!==void 0&&(o.options=l[4]),t=new ot({props:o}),V.push(()=>te(t,"options",s)),{c(){P(t.$$.fragment)},m(r,i){z(t,r,i),n=!0},p(r,i){const u={};!e&&i&16&&(e=!0,u.options=r[4],ne(()=>e=!1)),t.$set(u)},i(r){n||(k(t.$$.fragment,r),n=!0)},o(r){S(t.$$.fragment,r),n=!1},d(r){A(t,r)}}}function bt(l){let t,e,n,s,o,r,i,u,c=l[0].features.length>0&&Ie(l);return{c(){t=G("label"),e=E(`Load two .geojson files
  `),n=G("input"),s=H(),c&&c.c(),o=de(),T(n,"class","form-control"),T(n,"type","file"),n.multiple=!0,T(t,"class","form-label")},m(f,h){g(f,t,h),O(t,e),O(t,n),l[10](n),g(f,s,h),c&&c.m(f,h),g(f,o,h),r=!0,i||(u=B(n,"change",l[7]),i=!0)},p(f,[h]){f[0].features.length>0?c?(c.p(f,h),h&1&&k(c,1)):(c=Ie(f),c.c(),k(c,1),c.m(o.parentNode,o)):c&&(K(),S(c,1,1,()=>{c=null}),U())},i(f){r||(k(c),r=!0)},o(f){S(c),r=!1},d(f){f&&(b(t),b(s),b(o)),l[10](null),c&&c.d(f),i=!1,u()}}}function Je(l){let t=0;for(let e of l.features)e.id=t++,e.properties??(e.properties={});return l}const Be=l=>l.properties.matching_sources.length>0;function ht(l,t,e){let{sourceGj:n}=t,{targetGj:s}=t,{setupDone:o}=t,{zoomFit:r}=t,i=!1,u={buffer_meters:20,angle_diff_threshold:10,length_ratio_threshold:1.1,midpt_dist_threshold:15};function c(){var d;if(!i)try{let L=JSON.parse(lt(JSON.stringify(n),JSON.stringify(s),u));for(let[C,w]of s.features.entries())w.properties.matching_sources=L[C].matching_sources,(d=w.properties).reviewed??(d.reviewed="unreviewed");e(1,s)}catch(L){window.alert(`Bug: ${L}`)}}let f;async function h(d){if(!f.files)return;if(f.files.length!=2){window.alert("Select two GeoJSON files");return}try{let C=await f.files[0].text(),w=await f.files[1].text();e(0,n=Je(JSON.parse(C))),e(1,s=Je(JSON.parse(w))),"matching_sources"in s.features[0].properties?e(3,i=!0):"matching_sources"in n.features[0].properties&&(e(3,i=!0),e(0,[n,s]=[s,n],n,e(1,s))),r(),c()}catch(C){window.alert(`Bad input file: ${C}`)}}function p(){e(0,[n,s]=[s,n],n,e(1,s)),c()}function j(d){V[d?"unshift":"push"](()=>{f=d,e(5,f)})}const N=()=>e(2,o=!0);function D(d){u=d,e(4,u)}return l.$$set=d=>{"sourceGj"in d&&e(0,n=d.sourceGj),"targetGj"in d&&e(1,s=d.targetGj),"setupDone"in d&&e(2,o=d.setupDone),"zoomFit"in d&&e(9,r=d.zoomFit)},[n,s,o,i,u,f,c,h,p,r,j,N,D]}class kt extends ae{constructor(t){super(),ce(this,t,ht,bt,me,{sourceGj:0,targetGj:1,setupDone:2,zoomFit:9})}}const{window:wt}=it;function yt(l){let t,e,n,s,o,r,i,u,c,f,h,p,j,N,D=l[1].features.length+"",d,L,C,w,I,J;return{c(){t=G("div"),e=G("button"),e.textContent="Start over",n=H(),s=G("button"),s.textContent="Zoom to fit",o=H(),r=G("br"),i=H(),u=G("div"),c=G("div"),h=H(),p=G("p"),j=E(l[4]),N=E(" / "),d=E(D),L=E(" targets reviewed"),C=H(),w=G("button"),w.textContent="Download reviews",T(e,"class","btn btn-danger"),T(s,"class","btn btn-secondary"),F(t,"display","flex"),F(t,"justify-content","space-between"),T(c,"class","progress-bar"),F(c,"width",`${100*l[4]/l[1].features.length}%`),T(u,"class","progress"),T(u,"role","progressbar"),T(u,"aria-valuenow",l[4]),T(u,"aria-valuemin","0"),T(u,"aria-valuemax",f=l[1].features.length),T(w,"class","btn btn-success")},m(M,m){g(M,t,m),O(t,e),O(t,n),O(t,s),g(M,o,m),g(M,r,m),g(M,i,m),g(M,u,m),O(u,c),g(M,h,m),g(M,p,m),O(p,j),O(p,N),O(p,d),O(p,L),g(M,C,m),g(M,w,m),I||(J=[B(e,"click",l[12]),B(s,"click",l[7]),B(w,"click",l[11])],I=!0)},p(M,m){m&18&&F(c,"width",`${100*M[4]/M[1].features.length}%`),m&16&&T(u,"aria-valuenow",M[4]),m&2&&f!==(f=M[1].features.length)&&T(u,"aria-valuemax",f),m&16&&W(j,M[4]),m&2&&D!==(D=M[1].features.length+"")&&W(d,D)},i:X,o:X,d(M){M&&(b(t),b(o),b(r),b(i),b(u),b(h),b(p),b(C),b(w)),I=!1,ge(J)}}}function vt(l){let t,e,n,s,o;function r(f){l[17](f)}function i(f){l[18](f)}function u(f){l[19](f)}let c={zoomFit:l[7]};return l[0]!==void 0&&(c.sourceGj=l[0]),l[1]!==void 0&&(c.targetGj=l[1]),l[2]!==void 0&&(c.setupDone=l[2]),t=new kt({props:c}),V.push(()=>te(t,"sourceGj",r)),V.push(()=>te(t,"targetGj",i)),V.push(()=>te(t,"setupDone",u)),{c(){P(t.$$.fragment)},m(f,h){z(t,f,h),o=!0},p(f,h){const p={};!e&&h&1&&(e=!0,p.sourceGj=f[0],ne(()=>e=!1)),!n&&h&2&&(n=!0,p.targetGj=f[1],ne(()=>n=!1)),!s&&h&4&&(s=!0,p.setupDone=f[2],ne(()=>s=!1)),t.$set(p)},i(f){o||(k(t.$$.fragment,f),o=!0)},o(f){S(t.$$.fragment,f),o=!1},d(f){A(t,f)}}}function Ot(l){let t,e,n,s,o,r,i,u;const c=[vt,yt],f=[];function h(p,j){return p[2]?1:0}return r=h(l),i=f[r]=c[r](l),{c(){t=G("div"),e=G("h1"),e.textContent="Manually specify LineString matchings for test cases",n=H(),s=G("div"),s.innerHTML='<a class="icon-link mb-3" href="https://github.com/nptscot/match_linestrings/blob/main/tests/README.md" target="_blank">About <i class="fa-solid fa-arrow-up-right-from-square"></i></a>',o=H(),i.c(),T(t,"slot","left")},m(p,j){g(p,t,j),O(t,e),O(t,n),O(t,s),O(t,o),f[r].m(t,null),u=!0},p(p,j){let N=r;r=h(p),r===N?f[r].p(p,j):(K(),S(f[N],1,1,()=>{f[N]=null}),U(),i=f[r],i?i.p(p,j):(i=f[r]=c[r](p),i.c()),k(i,1),i.m(t,null))},i(p){u||(k(i),u=!0)},o(p){S(i),u=!1},d(p){p&&b(t),f[r].d()}}}function Fe(l){let t,e,n,s;const o=[jt,Ct],r=[];function i(u,c){return u[3]==null?0:1}return e=i(l),n=r[e]=o[e](l),{c(){t=G("div"),n.c(),T(t,"class","map-panel svelte-hr6p1s")},m(u,c){g(u,t,c),r[e].m(t,null),s=!0},p(u,c){let f=e;e=i(u),e===f?r[e].p(u,c):(K(),S(r[f],1,1,()=>{r[f]=null}),U(),n=r[e],n?n.p(u,c):(n=r[e]=o[e](u),n.c()),k(n,1),n.m(t,null))},i(u){s||(k(n),s=!0)},o(u){S(n),s=!1},d(u){u&&b(t),r[e].d()}}}function Ct(l){let t,e;return t=new gt({props:{clickedTarget:l[3],targetGj:l[1],onConfirm:l[8]}}),{c(){P(t.$$.fragment)},m(n,s){z(t,n,s),e=!0},p(n,s){const o={};s&8&&(o.clickedTarget=n[3]),s&2&&(o.targetGj=n[1]),t.$set(o)},i(n){e||(k(t.$$.fragment,n),e=!0)},o(n){S(t.$$.fragment,n),e=!1},d(n){A(t,n)}}}function jt(l){let t,e,n;return{c(){t=G("button"),t.innerHTML=`Goto <kbd>n</kbd>
              ext unreviewed`,T(t,"class","btn btn-primary")},m(s,o){g(s,t,o),e||(n=B(t,"click",l[9]),e=!0)},p:X,i:X,o:X,d(s){s&&b(t),e=!1,n()}}}function Pe(l){let t,e;return t=new dt({props:{openOn:"hover",$$slots:{default:[Mt,({data:n})=>({20:n}),({data:n})=>n?1048576:0]},$$scope:{ctx:l}}}),{c(){P(t.$$.fragment)},m(n,s){z(t,n,s),e=!0},p(n,s){const o={};s&3145792&&(o.$$scope={dirty:s,ctx:n}),t.$set(o)},i(n){e||(k(t.$$.fragment,n),e=!0)},o(n){S(t.$$.fragment,n),e=!1},d(n){A(t,n)}}}function Mt(l){let t,e=ue(l[20]).id+"",n,s,o=l[6].includes(ue(l[20]).id)?"remove":"add",r;return{c(){t=E("Source "),n=E(e),s=E(" -- click to "),r=E(o)},m(i,u){g(i,t,u),g(i,n,u),g(i,s,u),g(i,r,u)},p(i,u){u&1048576&&e!==(e=ue(i[20]).id+"")&&W(n,e),u&1048640&&o!==(o=i[6].includes(ue(i[20]).id)?"remove":"add")&&W(r,o)},d(i){i&&(b(t),b(n),b(s),b(r))}}}function Gt(l){let t,e,n=l[3]!=null&&Pe(l);return{c(){n&&n.c(),t=de()},m(s,o){n&&n.m(s,o),g(s,t,o),e=!0},p(s,o){s[3]!=null?n?(n.p(s,o),o&8&&k(n,1)):(n=Pe(s),n.c(),k(n,1),n.m(t.parentNode,t)):n&&(K(),S(n,1,1,()=>{n=null}),U())},i(s){e||(k(n),e=!0)},o(s){S(n),e=!1},d(s){s&&b(t),n&&n.d(s)}}}function St(l){let t,e;return t=new Ae({props:{manageHoverState:!0,paint:{"line-color":["case",["in",["id"],["literal",l[6]]],"blue","black"],"line-width":8,"line-opacity":Te(.5,1)},hoverCursor:l[3]==null?void 0:"pointer",$$slots:{default:[Gt]},$$scope:{ctx:l}}}),t.$on("click",l[14]),{c(){P(t.$$.fragment)},m(n,s){z(t,n,s),e=!0},p(n,s){const o={};s&64&&(o.paint={"line-color":["case",["in",["id"],["literal",n[6]]],"blue","black"],"line-width":8,"line-opacity":Te(.5,1)}),s&8&&(o.hoverCursor=n[3]==null?void 0:"pointer"),s&2097224&&(o.$$scope={dirty:s,ctx:n}),t.$set(o)},i(n){e||(k(t.$$.fragment,n),e=!0)},o(n){S(t.$$.fragment,n),e=!1},d(n){A(t,n)}}}function Lt(l){let t,e;return t=new Ae({props:{manageHoverState:!0,paint:{"line-width":8,"line-color":["match",["get","reviewed"],"unreviewed","red","green"],"line-opacity":["case",["==",["id"],l[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,[">",["length",["get","matching_sources"]],0],.5,.2]},hoverCursor:"pointer"}}),t.$on("click",l[13]),{c(){P(t.$$.fragment)},m(n,s){z(t,n,s),e=!0},p(n,s){const o={};s&8&&(o.paint={"line-width":8,"line-color":["match",["get","reviewed"],"unreviewed","red","green"],"line-opacity":["case",["==",["id"],n[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,[">",["length",["get","matching_sources"]],0],.5,.2]}),t.$set(o)},i(n){e||(k(t.$$.fragment,n),e=!0)},o(n){S(t.$$.fragment,n),e=!1},d(n){A(t,n)}}}function Tt(l){let t,e,n,s,o,r=l[2]&&Fe(l);return e=new Le({props:{data:l[0],$$slots:{default:[St]},$$scope:{ctx:l}}}),s=new Le({props:{data:l[1],$$slots:{default:[Lt]},$$scope:{ctx:l}}}),{c(){r&&r.c(),t=H(),P(e.$$.fragment),n=H(),P(s.$$.fragment)},m(i,u){r&&r.m(i,u),g(i,t,u),z(e,i,u),g(i,n,u),z(s,i,u),o=!0},p(i,u){i[2]?r?(r.p(i,u),u&4&&k(r,1)):(r=Fe(i),r.c(),k(r,1),r.m(t.parentNode,t)):r&&(K(),S(r,1,1,()=>{r=null}),U());const c={};u&1&&(c.data=i[0]),u&2097224&&(c.$$scope={dirty:u,ctx:i}),e.$set(c);const f={};u&2&&(f.data=i[1]),u&2097160&&(f.$$scope={dirty:u,ctx:i}),s.$set(f)},i(i){o||(k(r),k(e.$$.fragment,i),k(s.$$.fragment,i),o=!0)},o(i){S(r),S(e.$$.fragment,i),S(s.$$.fragment,i),o=!1},d(i){i&&(b(t),b(n)),r&&r.d(i),A(e,i),A(s,i)}}}function Nt(l){let t,e,n,s;function o(i){l[15](i)}let r={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Tt]},$$scope:{ctx:l}};return l[5]!==void 0&&(r.map=l[5]),e=new rt({props:r}),V.push(()=>te(e,"map",o)),e.$on("error",l[16]),{c(){t=G("div"),P(e.$$.fragment),T(t,"slot","main"),F(t,"position","relative"),F(t,"width","100%"),F(t,"height","100vh")},m(i,u){g(i,t,u),z(e,t,null),s=!0},p(i,u){const c={};u&2097231&&(c.$$scope={dirty:u,ctx:i}),!n&&u&32&&(n=!0,c.map=i[5],ne(()=>n=!1)),e.$set(c)},i(i){s||(k(e.$$.fragment,i),s=!0)},o(i){S(e.$$.fragment,i),s=!1},d(i){i&&b(t),A(e)}}}function Dt(l){let t,e,n,s;return t=new st({props:{$$slots:{main:[Nt],left:[Ot]},$$scope:{ctx:l}}}),{c(){P(t.$$.fragment)},m(o,r){z(t,o,r),e=!0,n||(s=B(wt,"keydown",l[10]),n=!0)},p(o,[r]){const i={};r&2097279&&(i.$$scope={dirty:r,ctx:o}),t.$set(i)},i(o){e||(k(t.$$.fragment,o),e=!0)},o(o){S(t.$$.fragment,o),e=!1},d(o){A(t,o),n=!1,s()}}}function Et(l,t,e){let n,s,o,r=re(),i=re(),u=!1,c=null;ze(async()=>{await ut();try{let m=window.localStorage.getItem(fe);if(m){let y=JSON.parse(m);e(0,[r,i]=y,r,e(1,i)),e(2,u=!0),console.log(`Restored data from local storage ${fe}`)}}catch(m){console.log(`Couldn't restore data from local storage: ${m}`)}});function f(){let m={type:"FeatureCollection",features:[...r.features,...i.features]};o==null||o.fitBounds(Se(m),{animate:!1,padding:10})}function h(m){if(c==null)throw new Error("impossible");e(1,i.features[c].properties.reviewed=m,i),e(1,i),e(3,c=null)}function p(){for(let m of i.features)if(m.properties.reviewed=="unreviewed"){o==null||o.fitBounds(Se(m),{duration:600,padding:200}),e(3,c=m.id);return}}function j(m){m.target.tagName=="INPUT"||!u||m.key=="n"&&p()}function N(){ft("reviewed_targets.geojson",JSON.stringify(i))}function D(){window.confirm("Do you want to discard this review and start over?")&&(e(0,r=re()),e(1,i=re()),e(2,u=!1),e(3,c=null),window.localStorage.removeItem(fe))}function d(m){u&&e(3,c=m.detail.features[0].id)}function L(m){if(!u||c==null)return;let y=m.detail.features[0].id,_=i.features[c].properties;_.matching_sources.includes(y)?_.matching_sources=_.matching_sources.filter($=>$!=y):_.matching_sources.push(y),e(1,i)}function C(m){o=m,e(5,o)}const w=m=>{console.log(m.detail.error)};function I(m){r=m,e(0,r)}function J(m){i=m,e(1,i)}function M(m){u=m,e(2,u)}return l.$$.update=()=>{l.$$.dirty&10&&e(6,n=c==null?[]:i.features[c].properties.matching_sources),l.$$.dirty&2&&e(4,s=i.features.filter(m=>m.properties.reviewed!="unreviewed").length),l.$$.dirty&23&&u&&(console.log(`Autosaving with ${s} reviewed targets`),window.localStorage.setItem(fe,JSON.stringify([r,i])))},[r,i,u,c,s,o,n,f,h,p,j,N,D,d,L,C,w,I,J,M]}class It extends ae{constructor(t){super(),ce(this,t,Et,Dt,me,{})}}new It({target:document.getElementById("app")});
