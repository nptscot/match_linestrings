import{S as ce,i as me,s as de,n as p,t as j,e as C,q as $,r as ee,u as h,R as ve,T as lt,U as ot,V as st,W as pe,o as Qe,X as it,Y as ae,Z as rt,x as O,B as x,$ as Ze,a0 as Ve,a1 as Xe,a2 as Ye,a3 as ut,a4 as ft,C as oe,d as A,D as se,g as W,h as U,a5 as at,a6 as ue,a7 as ze,a8 as ie,a9 as ct,E as J,A as G,K as X,v as w,y as E,z as P,J as Oe,aa as fe,w as q,ab as mt,F as dt,I as _t,L as gt,k as he,j as bt,M as pt,ac as ht,H as kt,N as wt,O as Ne,P as xe,Q as De,ad as ke,_ as vt,G as Ee}from"./Settings-CV3NVTZE.js";const yt=l=>({features:l[0]&16,data:l[0]&16,map:l[0]&4,close:l[0]&1}),He=l=>{var e;return{features:l[4],data:((e=l[4])==null?void 0:e[0])??null,map:l[2],close:l[31]}};function Pe(l){var s;let e,t,n=(((s=l[4])==null?void 0:s.length)||l[3]instanceof ae.Marker)&&Be(l);return{c(){e=O("div"),n&&n.c()},m(o,i){h(o,e,i),n&&n.m(e,null),l[32](e),t=!0},p(o,i){var r;(r=o[4])!=null&&r.length||o[3]instanceof ae.Marker?n?(n.p(o,i),i[0]&24&&C(n,1)):(n=Be(o),n.c(),C(n,1),n.m(e,null)):n&&($(),j(n,1,1,()=>{n=null}),ee())},i(o){t||(C(n),t=!0)},o(o){j(n),t=!1},d(o){o&&p(e),n&&n.d(),l[32](null)}}}function Be(l){let e;const t=l[30].default,n=Ze(t,l,l[29],He);return{c(){n&&n.c()},m(s,o){n&&n.m(s,o),e=!0},p(s,o){n&&n.p&&(!e||o[0]&536870933)&&Ve(n,t,s,s[29],e?Ye(t,s[29],o,yt):Xe(s[29]),He)},i(s){e||(C(n,s),e=!0)},o(s){j(n,s),e=!1},d(s){n&&n.d(s)}}}function Ct(l){let e,t,n=l[9].default&&Pe(l);return{c(){n&&n.c(),e=ve()},m(s,o){n&&n.m(s,o),h(s,e,o),t=!0},p(s,o){s[9].default?n?(n.p(s,o),o[0]&512&&C(n,1)):(n=Pe(s),n.c(),C(n,1),n.m(e.parentNode,e)):n&&($(),j(n,1,1,()=>{n=null}),ee())},i(s){t||(C(n),t=!0)},o(s){j(n),t=!1},d(s){s&&p(e),n&&n.d(s)}}}function Ot(l,e,t){let n,s,o,i,r,u,{$$slots:c={},$$scope:d}=e;const _=lt(c);let{closeButton:f=void 0}=e,{closeOnClickOutside:k=!0}=e,{closeOnClickInside:T=!1}=e,{closeOnMove:I=!1}=e,{openOn:g="click"}=e,{openIfTopMost:H=!0}=e,{focusAfterOpen:S=!0}=e,{anchor:D=void 0}=e,{offset:B=void 0}=e,{popupClass:v=void 0}=e,{maxWidth:b=void 0}=e,{lngLat:y=void 0}=e,{html:K=void 0}=e,{open:N=!1}=e;const R=ot(),{map:Q,popupTarget:a,layerEvent:F,layer:V,eventTopMost:te,markerClickManager:Z}=st();pe(l,Q,m=>t(2,o=m)),pe(l,a,m=>t(3,r=m)),pe(l,F,m=>t(28,i=m)),pe(l,V,m=>t(35,u=m));const _e=["click","dblclick","contextmenu"];let L,M=!1,z;function et(){if(!L)return;let m=L.getElement();!m||m===z||(z=m,g==="hover"&&(z.style.pointerEvents="none"),z.addEventListener("mouseenter",()=>{t(24,M=!0)},{passive:!0}),z.addEventListener("mouseleave",()=>{t(24,M=!1)},{passive:!0}),z.addEventListener("click",()=>{T&&t(0,N=!1)},{passive:!0}))}Qe(()=>{if(o)return o.on("click",be),o.on("contextmenu",be),Z.add(Ie),typeof r=="string"&&(o.on("click",r,le),o.on("dblclick",r,le),o.on("contextmenu",r,le),o.on("mousemove",r,Ge),o.on("mouseleave",r,Me),o.on("touchstart",r,je),o.on("touchend",r,Se)),()=>{o!=null&&o.loaded()&&(L==null||L.remove(),o.off("click",be),o.off("contextmenu",be),Z.remove(Ie),r instanceof ae.Marker?r.getPopup()===L&&r.setPopup(void 0):typeof r=="string"&&(o.off("click",r,le),o.off("dblclick",r,le),o.off("contextmenu",r,le),o.off("mousemove",r,Ge),o.off("mouseleave",r,Me),o.off("touchstart",r,je),o.off("touchend",r,Se)))}});function Le(m){return H?!("marker"in m)&&!ut(m)&&te(m)!==u:!1}let ne=null,Y="normal";function Te(m){"layerType"in m&&m.layerType==="deckgl"?(t(10,y=m.coordinate),t(4,ne=m.object?[m.object]:null)):(t(10,y=m.lngLat),t(4,ne=m.features??[]))}function le(m){m.type!==g||Le(m)||(Te(m),setTimeout(()=>t(0,N=!0)))}let re=null;function je(m){re=m.point}function Se(m){if(!re||g!=="hover")return;let ye=re.dist(m.point);re=null,ye<3&&(t(10,y=m.lngLat),t(4,ne=m.features??[]),L.isOpen()?t(25,Y="justOpened"):(t(25,Y="opening"),t(0,N=!0)))}function Me(m){g!=="hover"||re||Y!=="normal"||(t(0,N=!1),t(4,ne=null))}function Ge(m){if(!(g!=="hover"||re||Y!=="normal")){if(Le(m)){t(0,N=!1),t(4,ne=null);return}t(0,N=!0),t(4,ne=m.features??[]),t(10,y=m.lngLat)}}function be(m){if(Y==="justOpened"){t(25,Y="normal");return}if(!k)return;let ye=[z,r instanceof ae.Marker?r==null?void 0:r.getElement():null];N&&L.isOpen()&&!ye.some(Ce=>Ce==null?void 0:Ce.contains(m.originalEvent.target))&&(m.type==="contextmenu"&&g==="contextmenu"||m.type!=="contextmenu")&&t(0,N=!1)}function Ie(m){k&&N&&L.isOpen()&&m.marker!==r&&t(0,N=!1)}it(()=>{o&&(L!=null&&L.isOpen())&&L.remove()});let ge;const tt=()=>t(0,N=!1);function nt(m){x[m?"unshift":"push"](()=>{ge=m,t(1,ge)})}return l.$$set=m=>{"closeButton"in m&&t(11,f=m.closeButton),"closeOnClickOutside"in m&&t(12,k=m.closeOnClickOutside),"closeOnClickInside"in m&&t(13,T=m.closeOnClickInside),"closeOnMove"in m&&t(14,I=m.closeOnMove),"openOn"in m&&t(15,g=m.openOn),"openIfTopMost"in m&&t(16,H=m.openIfTopMost),"focusAfterOpen"in m&&t(17,S=m.focusAfterOpen),"anchor"in m&&t(18,D=m.anchor),"offset"in m&&t(19,B=m.offset),"popupClass"in m&&t(20,v=m.popupClass),"maxWidth"in m&&t(21,b=m.maxWidth),"lngLat"in m&&t(10,y=m.lngLat),"html"in m&&t(22,K=m.html),"open"in m&&t(0,N=m.open),"$$scope"in m&&t(29,d=m.$$scope)},l.$$.update=()=>{if(l.$$.dirty[0]&14336&&t(27,n=f??(!k&&!T)),l.$$.dirty[0]&146685952&&(L||(t(23,L=new ae.Popup({closeButton:n,closeOnClick:!1,closeOnMove:I,focusAfterOpen:S,maxWidth:b,className:v,anchor:D,offset:B})),z=L.getElement(),L.on("open",()=>{t(0,N=!0),et(),R("open",L)}),L.on("close",()=>{t(0,N=!1),R("close",L)}),L.on("hover",()=>{R("hover",L)}))),l.$$.dirty[0]&8421384&&L&&r instanceof ae.Marker&&(g==="click"?r.setPopup(L):r.getPopup()===L&&r.setPopup(void 0)),l.$$.dirty[0]&268468224&&_e.includes(g)&&(i==null?void 0:i.type)===g&&(le(i),rt(F,i=null,i)),l.$$.dirty[0]&268468224&&t(26,s=g==="hover"&&((i==null?void 0:i.type)==="mousemove"||(i==null?void 0:i.type)==="mouseenter")),l.$$.dirty[0]&352354304&&g==="hover"&&F&&(s&&i&&Te(i),t(0,N=(s||M)??!1)),l.$$.dirty[0]&12582914&&(ge?L.setDOMContent(ge):K&&L.setHTML(K)),l.$$.dirty[0]&8389632&&y&&L.setLngLat(y),l.$$.dirty[0]&41943045&&o){let m=L.isOpen();N&&!m?(L.addTo(o),Y==="opening"&&t(25,Y="justOpened")):!N&&m&&L.remove()}},[N,ge,o,r,ne,Q,a,F,V,_,y,f,k,T,I,g,H,S,D,B,v,b,K,L,M,Y,s,n,i,d,c,tt,nt]}class Lt extends ce{constructor(e){super(),me(this,e,Ot,Ct,de,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function Tt(l){let e;const t=l[16].default,n=Ze(t,l,l[24],null);return{c(){n&&n.c()},m(s,o){n&&n.m(s,o),e=!0},p(s,o){n&&n.p&&(!e||o&16777216)&&Ve(n,t,s,s[24],e?Ye(t,s[24],o,null):Xe(s[24]),null)},i(s){e||(C(n,s),e=!0)},o(s){j(n,s),e=!1},d(s){n&&n.d(s)}}}function jt(l){let e,t,n;function s(i){l[17](i)}let o={id:l[1],type:"symbol",source:l[2],sourceLayer:l[3],beforeId:l[4],beforeLayerType:l[5],paint:l[6],layout:l[7],filter:l[8],applyToClusters:l[9],minzoom:l[10],maxzoom:l[11],hoverCursor:l[12],manageHoverState:l[13],eventsIfTopMost:l[14],interactive:l[15],$$slots:{default:[Tt]},$$scope:{ctx:l}};return l[0]!==void 0&&(o.hovered=l[0]),e=new ft({props:o}),x.push(()=>oe(e,"hovered",s)),e.$on("click",l[18]),e.$on("dblclick",l[19]),e.$on("contextmenu",l[20]),e.$on("mouseenter",l[21]),e.$on("mousemove",l[22]),e.$on("mouseleave",l[23]),{c(){U(e.$$.fragment)},m(i,r){W(e,i,r),n=!0},p(i,[r]){const u={};r&2&&(u.id=i[1]),r&4&&(u.source=i[2]),r&8&&(u.sourceLayer=i[3]),r&16&&(u.beforeId=i[4]),r&32&&(u.beforeLayerType=i[5]),r&64&&(u.paint=i[6]),r&128&&(u.layout=i[7]),r&256&&(u.filter=i[8]),r&512&&(u.applyToClusters=i[9]),r&1024&&(u.minzoom=i[10]),r&2048&&(u.maxzoom=i[11]),r&4096&&(u.hoverCursor=i[12]),r&8192&&(u.manageHoverState=i[13]),r&16384&&(u.eventsIfTopMost=i[14]),r&32768&&(u.interactive=i[15]),r&16777216&&(u.$$scope={dirty:r,ctx:i}),!t&&r&1&&(t=!0,u.hovered=i[0],se(()=>t=!1)),e.$set(u)},i(i){n||(C(e.$$.fragment,i),n=!0)},o(i){j(e.$$.fragment,i),n=!1},d(i){A(e,i)}}}function St(l,e,t){let{$$slots:n={},$$scope:s}=e,{id:o=at("symbol")}=e,{source:i=void 0}=e,{sourceLayer:r=void 0}=e,{beforeId:u=void 0}=e,{beforeLayerType:c=void 0}=e,{paint:d=void 0}=e,{layout:_=void 0}=e,{filter:f=void 0}=e,{applyToClusters:k=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:I=void 0}=e,{hoverCursor:g=void 0}=e,{manageHoverState:H=!1}=e,{hovered:S=null}=e,{eventsIfTopMost:D=!1}=e,{interactive:B=!0}=e;function v(a){S=a,t(0,S)}function b(a){ue.call(this,l,a)}function y(a){ue.call(this,l,a)}function K(a){ue.call(this,l,a)}function N(a){ue.call(this,l,a)}function R(a){ue.call(this,l,a)}function Q(a){ue.call(this,l,a)}return l.$$set=a=>{"id"in a&&t(1,o=a.id),"source"in a&&t(2,i=a.source),"sourceLayer"in a&&t(3,r=a.sourceLayer),"beforeId"in a&&t(4,u=a.beforeId),"beforeLayerType"in a&&t(5,c=a.beforeLayerType),"paint"in a&&t(6,d=a.paint),"layout"in a&&t(7,_=a.layout),"filter"in a&&t(8,f=a.filter),"applyToClusters"in a&&t(9,k=a.applyToClusters),"minzoom"in a&&t(10,T=a.minzoom),"maxzoom"in a&&t(11,I=a.maxzoom),"hoverCursor"in a&&t(12,g=a.hoverCursor),"manageHoverState"in a&&t(13,H=a.manageHoverState),"hovered"in a&&t(0,S=a.hovered),"eventsIfTopMost"in a&&t(14,D=a.eventsIfTopMost),"interactive"in a&&t(15,B=a.interactive),"$$scope"in a&&t(24,s=a.$$scope)},[S,o,i,r,u,c,d,_,f,k,T,I,g,H,D,B,n,v,b,y,K,N,R,Q,s]}class $e extends ce{constructor(e){super(),me(this,e,St,jt,de,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function Je(l,e,t){const n=l.slice();return n[4]=e[t][0],n[5]=e[t][1],n}function Fe(l){let e,t,n,s,o=l[4]+"",i,r;return{c(){e=O("div"),t=O("span"),s=E(),i=P(o),r=E(),G(t,"class",n="color-swatch "+l[1]+" svelte-1enycr6"),J(t,"background",l[5]),J(e,"display","flex"),J(e,"align-items","center"),J(e,"gap","6px")},m(u,c){h(u,e,c),w(e,t),w(e,s),w(e,i),w(e,r)},p(u,c){c&2&&n!==(n="color-swatch "+u[1]+" svelte-1enycr6")&&G(t,"class",n),c&1&&J(t,"background",u[5]),c&1&&o!==(o=u[4]+"")&&X(i,o)},d(u){u&&p(e)}}}function Mt(l){let e,t=ze(Object.entries(l[0])),n=[];for(let s=0;s<t.length;s+=1)n[s]=Fe(Je(l,t,s));return{c(){e=O("div");for(let s=0;s<n.length;s+=1)n[s].c();J(e,"display","grid"),J(e,"grid-template-columns","repeat(auto-fill, calc("+l[2]+" - 10px))"),J(e,"gap","10px")},m(s,o){h(s,e,o);for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(e,null)},p(s,[o]){if(o&3){t=ze(Object.entries(s[0]));let i;for(i=0;i<t.length;i+=1){const r=Je(s,t,i);n[i]?n[i].p(r,o):(n[i]=Fe(r),n[i].c(),n[i].m(e,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}o&4&&J(e,"grid-template-columns","repeat(auto-fill, calc("+s[2]+" - 10px))")},i:ie,o:ie,d(s){s&&p(e),ct(n,s)}}}function Gt(l,e,t){let n,{labelColors:s}=e,{swatchClass:o="rectangle"}=e,{itemsPerRow:i=2}=e;return l.$$set=r=>{"labelColors"in r&&t(0,s=r.labelColors),"swatchClass"in r&&t(1,o=r.swatchClass),"itemsPerRow"in r&&t(3,i=r.itemsPerRow)},l.$$.update=()=>{l.$$.dirty&8&&t(2,n=`${100/i}%`)},[s,o,n,i]}class It extends ce{constructor(e){super(),me(this,e,Gt,Mt,de,{labelColors:0,swatchClass:1,itemsPerRow:3})}}let we="match-linestrings-review";function zt(l){let e;return{c(){e=P("no matches (off-road)")},m(t,n){h(t,e,n)},p:ie,d(t){t&&p(e)}}}function Nt(l){let e=JSON.stringify(l[3].matching_sources)+"",t;return{c(){t=P(e)},m(n,s){h(n,t,s)},p(n,s){s&8&&e!==(e=JSON.stringify(n[3].matching_sources)+"")&&X(t,e)},d(n){n&&p(t)}}}function Dt(l){let e,t,n,s,o,i,r,u,c,d,_,f,k,T,I,g,H,S;function D(b,y){return b[3].matching_sources.length>0?Nt:zt}let B=D(l),v=B(l);return{c(){e=O("div"),t=O("h3"),n=P("Target "),s=P(l[0]),o=P(`:
    `),v.c(),i=E(),r=O("button"),r.innerHTML=`<kbd>Escape</kbd>
    - Back`,u=E(),c=O("h6"),c.textContent="Click sources to add or remove",d=E(),_=O("div"),f=O("button"),f.innerHTML=`<kbd>1</kbd>
    - Unreviewed`,k=E(),T=O("button"),T.innerHTML=`<kbd>2</kbd>
    - Not sure`,I=E(),g=O("button"),g.innerHTML=`<kbd>3</kbd>
    - Confirm correct`,G(r,"class","btn btn-secondary"),J(e,"display","flex"),J(e,"justify-content","space-between"),G(f,"class","btn btn-danger svelte-1tzb8bs"),fe(f,"current",l[3].reviewed=="unreviewed"),G(T,"class","btn btn-warning svelte-1tzb8bs"),fe(T,"current",l[3].reviewed=="not sure"),G(g,"class","btn btn-success svelte-1tzb8bs"),fe(g,"current",l[3].reviewed=="confirmed"),J(_,"display","flex"),J(_,"justify-content","space-between")},m(b,y){h(b,e,y),w(e,t),w(t,n),w(t,s),w(t,o),v.m(t,null),w(e,i),w(e,r),h(b,u,y),h(b,c,y),h(b,d,y),h(b,_,y),w(_,f),w(_,k),w(_,T),w(_,I),w(_,g),H||(S=[q(window,"keydown",l[4]),q(r,"click",function(){mt(l[2])&&l[2].apply(this,arguments)}),q(f,"click",l[6]),q(T,"click",l[7]),q(g,"click",l[8])],H=!0)},p(b,[y]){l=b,y&1&&X(s,l[0]),B===(B=D(l))&&v?v.p(l,y):(v.d(1),v=B(l),v&&(v.c(),v.m(t,null))),y&8&&fe(f,"current",l[3].reviewed=="unreviewed"),y&8&&fe(T,"current",l[3].reviewed=="not sure"),y&8&&fe(g,"current",l[3].reviewed=="confirmed")},i:ie,o:ie,d(b){b&&(p(e),p(u),p(c),p(d),p(_)),v.d(),H=!1,Oe(S)}}}function Et(l,e,t){let n,{clickedTarget:s}=e,{targetGj:o}=e,{onConfirm:i}=e,{onCancel:r}=e;function u(f){f.target.tagName!="INPUT"&&(f.key=="1"?i("unreviewed"):f.key=="2"?i("not sure"):f.key=="3"?i("confirmed"):f.key=="Escape"&&r())}const c=()=>i("unreviewed"),d=()=>i("not sure"),_=()=>i("confirmed");return l.$$set=f=>{"clickedTarget"in f&&t(0,s=f.clickedTarget),"targetGj"in f&&t(5,o=f.targetGj),"onConfirm"in f&&t(1,i=f.onConfirm),"onCancel"in f&&t(2,r=f.onCancel)},l.$$.update=()=>{l.$$.dirty&33&&t(3,n=o.features[s].properties)},[s,i,r,n,u,o,c,d,_]}class Ht extends ce{constructor(e){super(),me(this,e,Et,Dt,de,{clickedTarget:0,targetGj:5,onConfirm:1,onCancel:2})}}function Re(l){let e,t,n,s,o=l[0].features.length+"",i,r,u=l[1].features.length+"",c,d,_=l[1].features.filter(Ue).length+"",f,k,T,I,g,H,S,D,B,v=!l[3]&&Ae(l);return{c(){e=O("button"),t=P("Swap"),n=E(),s=O("p"),i=P(o),r=P(` sources and
    `),c=P(u),d=P(" targets , with "),f=P(_),k=P(" matching a source"),T=E(),I=O("button"),I.textContent="Start review",g=E(),v&&v.c(),H=ve(),G(e,"class","btn btn-secondary"),e.disabled=l[3],G(I,"class","btn btn-primary mb-5")},m(b,y){h(b,e,y),w(e,t),h(b,n,y),h(b,s,y),w(s,i),w(s,r),w(s,c),w(s,d),w(s,f),w(s,k),h(b,T,y),h(b,I,y),h(b,g,y),v&&v.m(b,y),h(b,H,y),S=!0,D||(B=[q(e,"click",l[8]),q(I,"click",l[11])],D=!0)},p(b,y){(!S||y&8)&&(e.disabled=b[3]),(!S||y&1)&&o!==(o=b[0].features.length+"")&&X(i,o),(!S||y&2)&&u!==(u=b[1].features.length+"")&&X(c,u),(!S||y&2)&&_!==(_=b[1].features.filter(Ue).length+"")&&X(f,_),b[3]?v&&($(),j(v,1,1,()=>{v=null}),ee()):v?(v.p(b,y),y&8&&C(v,1)):(v=Ae(b),v.c(),C(v,1),v.m(H.parentNode,H))},i(b){S||(C(v),S=!0)},o(b){j(v),S=!1},d(b){b&&(p(e),p(n),p(s),p(T),p(I),p(g),p(H)),v&&v.d(b),D=!1,Oe(B)}}}function Ae(l){let e,t,n;function s(i){l[12](i)}let o={onChange:l[6]};return l[4]!==void 0&&(o.options=l[4]),e=new _t({props:o}),x.push(()=>oe(e,"options",s)),{c(){U(e.$$.fragment)},m(i,r){W(e,i,r),n=!0},p(i,r){const u={};!t&&r&16&&(t=!0,u.options=i[4],se(()=>t=!1)),e.$set(u)},i(i){n||(C(e.$$.fragment,i),n=!0)},o(i){j(e.$$.fragment,i),n=!1},d(i){A(e,i)}}}function Pt(l){let e,t,n,s,o,i,r,u,c=l[0].features.length>0&&Re(l);return{c(){e=O("label"),t=P(`Load two .geojson files
  `),n=O("input"),s=E(),c&&c.c(),o=ve(),G(n,"class","form-control"),G(n,"type","file"),n.multiple=!0,G(e,"class","form-label")},m(d,_){h(d,e,_),w(e,t),w(e,n),l[10](n),h(d,s,_),c&&c.m(d,_),h(d,o,_),i=!0,r||(u=q(n,"change",l[7]),r=!0)},p(d,[_]){d[0].features.length>0?c?(c.p(d,_),_&1&&C(c,1)):(c=Re(d),c.c(),C(c,1),c.m(o.parentNode,o)):c&&($(),j(c,1,1,()=>{c=null}),ee())},i(d){i||(C(c),i=!0)},o(d){j(c),i=!1},d(d){d&&(p(e),p(s),p(o)),l[10](null),c&&c.d(d),r=!1,u()}}}function We(l){let e=0;for(let t of l.features)t.id=e++,t.properties??(t.properties={});return l}const Ue=l=>l.properties.matching_sources.length>0;function Bt(l,e,t){let{sourceGj:n}=e,{targetGj:s}=e,{setupDone:o}=e,{zoomFit:i}=e,r=!1,u={buffer_meters:20,angle_diff_threshold:10,length_ratio_threshold:1.1,midpt_dist_threshold:15};function c(){var g;if(!r)try{let H=JSON.parse(dt(JSON.stringify(n),JSON.stringify(s),u));for(let[S,D]of s.features.entries())D.properties.matching_sources=H[S].matching_sources,(g=D.properties).reviewed??(g.reviewed="unreviewed");t(1,s)}catch(H){window.alert(`Bug: ${H}`)}}let d;async function _(g){if(!d.files)return;if(d.files.length!=2){window.alert("Select two GeoJSON files");return}try{let S=await d.files[0].text(),D=await d.files[1].text();t(0,n=We(JSON.parse(S))),t(1,s=We(JSON.parse(D))),"matching_sources"in s.features[0].properties?t(3,r=!0):"matching_sources"in n.features[0].properties&&(t(3,r=!0),t(0,[n,s]=[s,n],n,t(1,s))),i(),c()}catch(S){window.alert(`Bad input file: ${S}`)}}function f(){t(0,[n,s]=[s,n],n,t(1,s)),c()}function k(g){x[g?"unshift":"push"](()=>{d=g,t(5,d)})}const T=()=>t(2,o=!0);function I(g){u=g,t(4,u)}return l.$$set=g=>{"sourceGj"in g&&t(0,n=g.sourceGj),"targetGj"in g&&t(1,s=g.targetGj),"setupDone"in g&&t(2,o=g.setupDone),"zoomFit"in g&&t(9,i=g.zoomFit)},[n,s,o,r,u,d,c,_,f,i,k,T,I]}class Jt extends ce{constructor(e){super(),me(this,e,Bt,Pt,de,{sourceGj:0,targetGj:1,setupDone:2,zoomFit:9})}}const{window:Ft}=ht;function Rt(l){let e,t,n,s,o,i,r,u,c,d,_,f,k,T,I=l[1].features.length+"",g,H,S,D,B,v,b,y,K,N,R,Q,a,F,V,te,Z,_e,L;return F=new It({props:{itemsPerRow:1,labelColors:{Confirmed:"green","Not sure":"orange",Unreviewed:"red",Source:"grey"}}}),{c(){e=O("div"),t=O("button"),t.textContent="Start over",n=E(),s=O("button"),s.textContent="Zoom to fit",o=E(),i=O("br"),r=E(),u=O("div"),c=O("div"),_=E(),f=O("p"),k=P(l[4]),T=P(" / "),g=P(I),H=P(" targets reviewed"),S=E(),D=O("button"),D.textContent="Download reviews",B=E(),v=O("label"),b=O("input"),y=P(`
        Show labels for matches`),K=E(),N=O("div"),R=O("div"),Q=O("h5"),Q.textContent="Legend",a=E(),U(F.$$.fragment),V=E(),te=O("p"),te.textContent="Thinner lines have a match, thicker are off-road",G(t,"class","btn btn-outline-danger"),G(s,"class","btn btn-outline-secondary"),J(e,"display","flex"),J(e,"justify-content","space-between"),G(c,"class","progress-bar"),J(c,"width",`${100*l[4]/l[1].features.length}%`),G(u,"class","progress"),G(u,"role","progressbar"),G(u,"aria-valuenow",l[4]),G(u,"aria-valuemin","0"),G(u,"aria-valuemax",d=l[1].features.length),G(D,"class","btn btn-outline-success"),G(b,"class","form-check-input"),G(b,"type","checkbox"),G(v,"class","form-check-label mt-5"),G(Q,"class","card-title"),G(R,"class","card-body"),G(N,"class","card")},m(M,z){h(M,e,z),w(e,t),w(e,n),w(e,s),h(M,o,z),h(M,i,z),h(M,r,z),h(M,u,z),w(u,c),h(M,_,z),h(M,f,z),w(f,k),w(f,T),w(f,g),w(f,H),h(M,S,z),h(M,D,z),h(M,B,z),h(M,v,z),w(v,b),b.checked=l[7],w(v,y),h(M,K,z),h(M,N,z),w(N,R),w(R,Q),w(R,a),W(F,R,null),w(R,V),w(R,te),Z=!0,_e||(L=[q(t,"click",l[14]),q(s,"click",l[9]),q(D,"click",l[13]),q(b,"change",l[24])],_e=!0)},p(M,z){z&18&&J(c,"width",`${100*M[4]/M[1].features.length}%`),(!Z||z&16)&&G(u,"aria-valuenow",M[4]),(!Z||z&2&&d!==(d=M[1].features.length))&&G(u,"aria-valuemax",d),(!Z||z&16)&&X(k,M[4]),(!Z||z&2)&&I!==(I=M[1].features.length+"")&&X(g,I),z&128&&(b.checked=M[7])},i(M){Z||(C(F.$$.fragment,M),Z=!0)},o(M){j(F.$$.fragment,M),Z=!1},d(M){M&&(p(e),p(o),p(i),p(r),p(u),p(_),p(f),p(S),p(D),p(B),p(v),p(K),p(N)),A(F),_e=!1,Oe(L)}}}function At(l){let e,t,n,s,o;function i(d){l[21](d)}function r(d){l[22](d)}function u(d){l[23](d)}let c={zoomFit:l[9]};return l[0]!==void 0&&(c.sourceGj=l[0]),l[1]!==void 0&&(c.targetGj=l[1]),l[2]!==void 0&&(c.setupDone=l[2]),e=new Jt({props:c}),x.push(()=>oe(e,"sourceGj",i)),x.push(()=>oe(e,"targetGj",r)),x.push(()=>oe(e,"setupDone",u)),{c(){U(e.$$.fragment)},m(d,_){W(e,d,_),o=!0},p(d,_){const f={};!t&&_&1&&(t=!0,f.sourceGj=d[0],se(()=>t=!1)),!n&&_&2&&(n=!0,f.targetGj=d[1],se(()=>n=!1)),!s&&_&4&&(s=!0,f.setupDone=d[2],se(()=>s=!1)),e.$set(f)},i(d){o||(C(e.$$.fragment,d),o=!0)},o(d){j(e.$$.fragment,d),o=!1},d(d){A(e,d)}}}function Wt(l){let e,t,n,s,o,i,r,u;const c=[At,Rt],d=[];function _(f,k){return f[2]?1:0}return i=_(l),r=d[i]=c[i](l),{c(){e=O("div"),t=O("h1"),t.textContent="Manually specify LineString matchings for test cases",n=E(),s=O("div"),s.innerHTML='<a class="icon-link mb-3" href="https://github.com/nptscot/match_linestrings/blob/main/tests/README.md" target="_blank">About <i class="fa-solid fa-arrow-up-right-from-square"></i></a>',o=E(),r.c(),G(e,"slot","left")},m(f,k){h(f,e,k),w(e,t),w(e,n),w(e,s),w(e,o),d[i].m(e,null),u=!0},p(f,k){let T=i;i=_(f),i===T?d[i].p(f,k):($(),j(d[T],1,1,()=>{d[T]=null}),ee(),r=d[i],r?r.p(f,k):(r=d[i]=c[i](f),r.c()),C(r,1),r.m(e,null))},i(f){u||(C(r),u=!0)},o(f){j(r),u=!1},d(f){f&&p(e),d[i].d()}}}function qe(l){let e,t,n,s;const o=[qt,Ut],i=[];function r(u,c){return u[3]==null?0:1}return t=r(l),n=i[t]=o[t](l),{c(){e=O("div"),n.c(),G(e,"class","map-panel svelte-hr6p1s")},m(u,c){h(u,e,c),i[t].m(e,null),s=!0},p(u,c){let d=t;t=r(u),t===d?i[t].p(u,c):($(),j(i[d],1,1,()=>{i[d]=null}),ee(),n=i[t],n?n.p(u,c):(n=i[t]=o[t](u),n.c()),C(n,1),n.m(e,null))},i(u){s||(C(n),s=!0)},o(u){j(n),s=!1},d(u){u&&p(e),i[t].d()}}}function Ut(l){let e,t;return e=new Ht({props:{clickedTarget:l[3],targetGj:l[1],onConfirm:l[10],onCancel:l[18]}}),{c(){U(e.$$.fragment)},m(n,s){W(e,n,s),t=!0},p(n,s){const o={};s&8&&(o.clickedTarget=n[3]),s&2&&(o.targetGj=n[1]),s&8&&(o.onCancel=n[18]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){j(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function qt(l){let e,t,n,s,o,i,r;return{c(){e=O("button"),t=P("Goto "),n=O("kbd"),n.textContent="n",s=P(`
              ext unreviewed`),G(e,"class","btn btn-primary"),e.disabled=o=l[4]==l[1].features.length},m(u,c){h(u,e,c),w(e,t),w(e,n),w(e,s),i||(r=q(e,"click",l[11]),i=!0)},p(u,c){c&18&&o!==(o=u[4]==u[1].features.length)&&(e.disabled=o)},i:ie,o:ie,d(u){u&&p(e),i=!1,r()}}}function Ke(l){let e,t;return e=new Lt({props:{openOn:"hover",$$slots:{default:[Kt,({data:n})=>({25:n}),({data:n})=>n?33554432:0]},$$scope:{ctx:l}}}),{c(){U(e.$$.fragment)},m(n,s){W(e,n,s),t=!0},p(n,s){const o={};s&100663552&&(o.$$scope={dirty:s,ctx:n}),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){j(e.$$.fragment,n),t=!1},d(n){A(e,n)}}}function Kt(l){let e,t=ke(l[25]).id+"",n,s,o=l[8].includes(ke(l[25]).id)?"remove":"add",i;return{c(){e=P("Source "),n=P(t),s=P(" -- click to "),i=P(o)},m(r,u){h(r,e,u),h(r,n,u),h(r,s,u),h(r,i,u)},p(r,u){u&33554432&&t!==(t=ke(r[25]).id+"")&&X(n,t),u&33554688&&o!==(o=r[8].includes(ke(r[25]).id)?"remove":"add")&&X(i,o)},d(r){r&&(p(e),p(n),p(s),p(i))}}}function Qt(l){let e,t,n=l[3]!=null&&Ke(l);return{c(){n&&n.c(),e=ve()},m(s,o){n&&n.m(s,o),h(s,e,o),t=!0},p(s,o){s[3]!=null?n?(n.p(s,o),o&8&&C(n,1)):(n=Ke(s),n.c(),C(n,1),n.m(e.parentNode,e)):n&&($(),j(n,1,1,()=>{n=null}),ee())},i(s){t||(C(n),t=!0)},o(s){j(n),t=!1},d(s){s&&p(e),n&&n.d(s)}}}function Zt(l){let e,t,n,s;return e=new xe({props:{manageHoverState:!0,paint:{"line-color":["case",["in",["id"],["literal",l[8]]],"blue","black"],"line-width":8,"line-opacity":De(.5,1)},hoverCursor:l[3]==null?void 0:"pointer",$$slots:{default:[Qt]},$$scope:{ctx:l}}}),e.$on("click",l[16]),n=new $e({props:{paint:{"text-color":"white","text-halo-color":"grey","text-halo-width":4},layout:{"text-field":["to-string",["id"]],"text-size":16,"symbol-placement":"line",visibility:l[7]?"visible":"none"}}}),{c(){U(e.$$.fragment),t=E(),U(n.$$.fragment)},m(o,i){W(e,o,i),h(o,t,i),W(n,o,i),s=!0},p(o,i){const r={};i&256&&(r.paint={"line-color":["case",["in",["id"],["literal",o[8]]],"blue","black"],"line-width":8,"line-opacity":De(.5,1)}),i&8&&(r.hoverCursor=o[3]==null?void 0:"pointer"),i&67109128&&(r.$$scope={dirty:i,ctx:o}),e.$set(r);const u={};i&128&&(u.layout={"text-field":["to-string",["id"]],"text-size":16,"symbol-placement":"line",visibility:o[7]?"visible":"none"}),n.$set(u)},i(o){s||(C(e.$$.fragment,o),C(n.$$.fragment,o),s=!0)},o(o){j(e.$$.fragment,o),j(n.$$.fragment,o),s=!1},d(o){o&&p(t),A(e,o),A(n,o)}}}function Vt(l){let e,t,n,s;return e=new xe({props:{manageHoverState:!0,paint:{"line-width":["case",[">",["length",["get","matching_sources"]],0],8,16],"line-color":["match",["get","reviewed"],"unreviewed","red","not sure","orange","green"],"line-opacity":["case",["==",["id"],l[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,.3]},hoverCursor:"pointer"}}),e.$on("click",l[15]),n=new $e({props:{paint:{"text-color":"white","text-halo-color":["match",["get","reviewed"],"unreviewed","red","not sure","orange","green"],"text-halo-width":4},layout:{"text-field":["case",[">",["length",["get","matching_sources"]],0],["to-string",["get","matching_sources"]],"off-road"],"text-size":16,"symbol-placement":"line",visibility:l[7]?"visible":"none"}}}),{c(){U(e.$$.fragment),t=E(),U(n.$$.fragment)},m(o,i){W(e,o,i),h(o,t,i),W(n,o,i),s=!0},p(o,i){const r={};i&8&&(r.paint={"line-width":["case",[">",["length",["get","matching_sources"]],0],8,16],"line-color":["match",["get","reviewed"],"unreviewed","red","not sure","orange","green"],"line-opacity":["case",["==",["id"],o[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,.3]}),e.$set(r);const u={};i&128&&(u.layout={"text-field":["case",[">",["length",["get","matching_sources"]],0],["to-string",["get","matching_sources"]],"off-road"],"text-size":16,"symbol-placement":"line",visibility:o[7]?"visible":"none"}),n.$set(u)},i(o){s||(C(e.$$.fragment,o),C(n.$$.fragment,o),s=!0)},o(o){j(e.$$.fragment,o),j(n.$$.fragment,o),s=!1},d(o){o&&p(t),A(e,o),A(n,o)}}}function Xt(l){let e,t,n,s,o,i,r,u;function c(f){l[17](f)}let d={choice:"Maptiler Dataviz"};l[6]!==void 0&&(d.style=l[6]),e=new wt({props:d}),x.push(()=>oe(e,"style",c));let _=l[2]&&qe(l);return o=new Ne({props:{data:l[0],$$slots:{default:[Zt]},$$scope:{ctx:l}}}),r=new Ne({props:{data:l[1],$$slots:{default:[Vt]},$$scope:{ctx:l}}}),{c(){U(e.$$.fragment),n=E(),_&&_.c(),s=E(),U(o.$$.fragment),i=E(),U(r.$$.fragment)},m(f,k){W(e,f,k),h(f,n,k),_&&_.m(f,k),h(f,s,k),W(o,f,k),h(f,i,k),W(r,f,k),u=!0},p(f,k){const T={};!t&&k&64&&(t=!0,T.style=f[6],se(()=>t=!1)),e.$set(T),f[2]?_?(_.p(f,k),k&4&&C(_,1)):(_=qe(f),_.c(),C(_,1),_.m(s.parentNode,s)):_&&($(),j(_,1,1,()=>{_=null}),ee());const I={};k&1&&(I.data=f[0]),k&67109256&&(I.$$scope={dirty:k,ctx:f}),o.$set(I);const g={};k&2&&(g.data=f[1]),k&67109e3&&(g.$$scope={dirty:k,ctx:f}),r.$set(g)},i(f){u||(C(e.$$.fragment,f),C(_),C(o.$$.fragment,f),C(r.$$.fragment,f),u=!0)},o(f){j(e.$$.fragment,f),j(_),j(o.$$.fragment,f),j(r.$$.fragment,f),u=!1},d(f){f&&(p(n),p(s),p(i)),A(e,f),_&&_.d(f),A(o,f),A(r,f)}}}function Yt(l){let e,t,n,s;function o(r){l[19](r)}let i={style:l[6],standardControls:!0,hash:!0,$$slots:{default:[Xt]},$$scope:{ctx:l}};return l[5]!==void 0&&(i.map=l[5]),t=new pt({props:i}),x.push(()=>oe(t,"map",o)),t.$on("error",l[20]),{c(){e=O("div"),U(t.$$.fragment),G(e,"slot","main"),J(e,"position","relative"),J(e,"width","100%"),J(e,"height","100vh")},m(r,u){h(r,e,u),W(t,e,null),s=!0},p(r,u){const c={};u&64&&(c.style=r[6]),u&67109343&&(c.$$scope={dirty:u,ctx:r}),!n&&u&32&&(n=!0,c.map=r[5],se(()=>n=!1)),t.$set(c)},i(r){s||(C(t.$$.fragment,r),s=!0)},o(r){j(t.$$.fragment,r),s=!1},d(r){r&&p(e),A(t)}}}function xt(l){let e,t,n,s;return e=new gt({props:{$$slots:{main:[Yt],left:[Wt]},$$scope:{ctx:l}}}),{c(){U(e.$$.fragment)},m(o,i){W(e,o,i),t=!0,n||(s=q(Ft,"keydown",l[12]),n=!0)},p(o,[i]){const r={};i&67109375&&(r.$$scope={dirty:i,ctx:o}),e.$set(r)},i(o){t||(C(e.$$.fragment,o),t=!0)},o(o){j(e.$$.fragment,o),t=!1},d(o){A(e,o),n=!1,s()}}}function $t(l,e,t){let n,s,o,i=bt["Maptiler Dataviz"],r=he(),u=he(),c=!1,d=!1,_=null;Qe(async()=>{await vt();try{let a=window.localStorage.getItem(we);if(a){let F=JSON.parse(a);t(0,[r,u]=F,r,t(1,u)),t(2,c=!0),console.log(`Restored data from local storage ${we}`)}}catch(a){console.log(`Couldn't restore data from local storage: ${a}`)}});function f(){let a={type:"FeatureCollection",features:[...r.features,...u.features]};o==null||o.fitBounds(Ee(a),{animate:!1,padding:10})}function k(a){if(_==null)throw new Error("impossible");t(1,u.features[_].properties.reviewed=a,u),t(1,u),t(3,_=null)}function T(){for(let a of u.features)if(a.properties.reviewed=="unreviewed"){o==null||o.fitBounds(Ee(a),{duration:600,padding:200}),t(3,_=a.id);return}}function I(a){a.target.tagName=="INPUT"||!c||a.key=="n"&&T()}function g(){kt("reviewed_targets.geojson",JSON.stringify(u))}function H(){window.confirm("Do you want to discard this review and start over?")&&(t(0,r=he()),t(1,u=he()),t(2,c=!1),t(3,_=null),t(7,d=!1),window.localStorage.removeItem(we))}function S(a){c&&t(3,_=a.detail.features[0].id)}function D(a){if(!c||_==null)return;let F=a.detail.features[0].id,V=u.features[_].properties;V.matching_sources.includes(F)?V.matching_sources=V.matching_sources.filter(te=>te!=F):V.matching_sources.push(F),t(1,u)}function B(a){i=a,t(6,i)}const v=()=>t(3,_=null);function b(a){o=a,t(5,o)}const y=a=>{console.log(a.detail.error)};function K(a){r=a,t(0,r)}function N(a){u=a,t(1,u)}function R(a){c=a,t(2,c)}function Q(){d=this.checked,t(7,d)}return l.$$.update=()=>{l.$$.dirty&10&&t(8,n=_==null?[]:u.features[_].properties.matching_sources),l.$$.dirty&2&&t(4,s=u.features.filter(a=>a.properties.reviewed!="unreviewed").length),l.$$.dirty&23&&c&&(console.log(`Autosaving with ${s} reviewed targets`),window.localStorage.setItem(we,JSON.stringify([r,u])))},[r,u,c,_,s,o,i,d,n,f,k,T,I,g,H,S,D,B,v,b,y,K,N,R,Q]}class en extends ce{constructor(e){super(),me(this,e,$t,xt,de,{})}}new en({target:document.getElementById("app")});
