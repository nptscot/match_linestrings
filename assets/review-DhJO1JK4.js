import{S as de,i as _e,s as ge,n as p,t as T,e as O,q as le,r as oe,u as h,V as Ce,W as lt,X as ot,Y as st,Z as ke,o as Ze,$ as it,a0 as me,a1 as rt,x as L,B as x,a2 as Ve,a3 as Xe,a4 as Ye,a5 as xe,a6 as ft,a7 as ut,C as te,d as F,D as ne,g as R,h as A,a8 as at,a9 as ae,aa as Ne,ab as re,ac as ct,E as J,A as N,N as $,v as C,y as D,z as P,K as Te,ad as ce,w as q,ae as mt,F as dt,J as _t,L as gt,k as we,j as bt,M as pt,af as ht,H as kt,I as wt,O as vt,P as yt,Q as Ct,R as De,T as $e,U as Ee,ag as ve,_ as Ot,G as He}from"./Settings-CVLmKh1f.js";const Lt=l=>({features:l[0]&16,data:l[0]&16,map:l[0]&4,close:l[0]&1}),Pe=l=>{var e;return{features:l[4],data:((e=l[4])==null?void 0:e[0])??null,map:l[2],close:l[31]}};function Be(l){var s;let e,t,n=(((s=l[4])==null?void 0:s.length)||l[3]instanceof me.Marker)&&Je(l);return{c(){e=L("div"),n&&n.c()},m(o,i){h(o,e,i),n&&n.m(e,null),l[32](e),t=!0},p(o,i){var r;(r=o[4])!=null&&r.length||o[3]instanceof me.Marker?n?(n.p(o,i),i[0]&24&&O(n,1)):(n=Je(o),n.c(),O(n,1),n.m(e,null)):n&&(le(),T(n,1,1,()=>{n=null}),oe())},i(o){t||(O(n),t=!0)},o(o){T(n),t=!1},d(o){o&&p(e),n&&n.d(),l[32](null)}}}function Je(l){let e;const t=l[30].default,n=Ve(t,l,l[29],Pe);return{c(){n&&n.c()},m(s,o){n&&n.m(s,o),e=!0},p(s,o){n&&n.p&&(!e||o[0]&536870933)&&Xe(n,t,s,s[29],e?xe(t,s[29],o,Lt):Ye(s[29]),Pe)},i(s){e||(O(n,s),e=!0)},o(s){T(n,s),e=!1},d(s){n&&n.d(s)}}}function Tt(l){let e,t,n=l[9].default&&Be(l);return{c(){n&&n.c(),e=Ce()},m(s,o){n&&n.m(s,o),h(s,e,o),t=!0},p(s,o){s[9].default?n?(n.p(s,o),o[0]&512&&O(n,1)):(n=Be(s),n.c(),O(n,1),n.m(e.parentNode,e)):n&&(le(),T(n,1,1,()=>{n=null}),oe())},i(s){t||(O(n),t=!0)},o(s){T(n),t=!1},d(s){s&&p(e),n&&n.d(s)}}}function jt(l,e,t){let n,s,o,i,r,f,{$$slots:a={},$$scope:m}=e;const g=lt(a);let{closeButton:_=void 0}=e,{closeOnClickOutside:I=!0}=e,{closeOnClickInside:M=!1}=e,{closeOnMove:y=!1}=e,{openOn:u="click"}=e,{openIfTopMost:k=!0}=e,{focusAfterOpen:j=!0}=e,{anchor:z=void 0}=e,{offset:B=void 0}=e,{popupClass:w=void 0}=e,{maxWidth:b=void 0}=e,{lngLat:v=void 0}=e,{html:K=void 0}=e,{open:E=!1}=e;const U=ot(),{map:Q,popupTarget:c,layerEvent:W,layer:Y,eventTopMost:se,markerClickManager:Z}=st();ke(l,Q,d=>t(2,o=d)),ke(l,c,d=>t(3,r=d)),ke(l,W,d=>t(28,i=d)),ke(l,Y,d=>t(35,f=d));const be=["click","dblclick","contextmenu"];let S,fe=!1,V;function G(){if(!S)return;let d=S.getElement();!d||d===V||(V=d,u==="hover"&&(V.style.pointerEvents="none"),V.addEventListener("mouseenter",()=>{t(24,fe=!0)},{passive:!0}),V.addEventListener("mouseleave",()=>{t(24,fe=!1)},{passive:!0}),V.addEventListener("click",()=>{M&&t(0,E=!1)},{passive:!0}))}Ze(()=>{if(o)return o.on("click",he),o.on("contextmenu",he),Z.add(ze),typeof r=="string"&&(o.on("click",r,ie),o.on("dblclick",r,ie),o.on("contextmenu",r,ie),o.on("mousemove",r,Ie),o.on("mouseleave",r,Ge),o.on("touchstart",r,Se),o.on("touchend",r,Me)),()=>{o!=null&&o.loaded()&&(S==null||S.remove(),o.off("click",he),o.off("contextmenu",he),Z.remove(ze),r instanceof me.Marker?r.getPopup()===S&&r.setPopup(void 0):typeof r=="string"&&(o.off("click",r,ie),o.off("dblclick",r,ie),o.off("contextmenu",r,ie),o.off("mousemove",r,Ie),o.off("mouseleave",r,Ge),o.off("touchstart",r,Se),o.off("touchend",r,Me)))}});function H(d){return k?!("marker"in d)&&!ft(d)&&se(d)!==f:!1}let X=null,ee="normal";function je(d){"layerType"in d&&d.layerType==="deckgl"?(t(10,v=d.coordinate),t(4,X=d.object?[d.object]:null)):(t(10,v=d.lngLat),t(4,X=d.features??[]))}function ie(d){d.type!==u||H(d)||(je(d),setTimeout(()=>t(0,E=!0)))}let ue=null;function Se(d){ue=d.point}function Me(d){if(!ue||u!=="hover")return;let Oe=ue.dist(d.point);ue=null,Oe<3&&(t(10,v=d.lngLat),t(4,X=d.features??[]),S.isOpen()?t(25,ee="justOpened"):(t(25,ee="opening"),t(0,E=!0)))}function Ge(d){u!=="hover"||ue||ee!=="normal"||(t(0,E=!1),t(4,X=null))}function Ie(d){if(!(u!=="hover"||ue||ee!=="normal")){if(H(d)){t(0,E=!1),t(4,X=null);return}t(0,E=!0),t(4,X=d.features??[]),t(10,v=d.lngLat)}}function he(d){if(ee==="justOpened"){t(25,ee="normal");return}if(!I)return;let Oe=[V,r instanceof me.Marker?r==null?void 0:r.getElement():null];E&&S.isOpen()&&!Oe.some(Le=>Le==null?void 0:Le.contains(d.originalEvent.target))&&(d.type==="contextmenu"&&u==="contextmenu"||d.type!=="contextmenu")&&t(0,E=!1)}function ze(d){I&&E&&S.isOpen()&&d.marker!==r&&t(0,E=!1)}it(()=>{o&&(S!=null&&S.isOpen())&&S.remove()});let pe;const tt=()=>t(0,E=!1);function nt(d){x[d?"unshift":"push"](()=>{pe=d,t(1,pe)})}return l.$$set=d=>{"closeButton"in d&&t(11,_=d.closeButton),"closeOnClickOutside"in d&&t(12,I=d.closeOnClickOutside),"closeOnClickInside"in d&&t(13,M=d.closeOnClickInside),"closeOnMove"in d&&t(14,y=d.closeOnMove),"openOn"in d&&t(15,u=d.openOn),"openIfTopMost"in d&&t(16,k=d.openIfTopMost),"focusAfterOpen"in d&&t(17,j=d.focusAfterOpen),"anchor"in d&&t(18,z=d.anchor),"offset"in d&&t(19,B=d.offset),"popupClass"in d&&t(20,w=d.popupClass),"maxWidth"in d&&t(21,b=d.maxWidth),"lngLat"in d&&t(10,v=d.lngLat),"html"in d&&t(22,K=d.html),"open"in d&&t(0,E=d.open),"$$scope"in d&&t(29,m=d.$$scope)},l.$$.update=()=>{if(l.$$.dirty[0]&14336&&t(27,n=_??(!I&&!M)),l.$$.dirty[0]&146685952&&(S||(t(23,S=new me.Popup({closeButton:n,closeOnClick:!1,closeOnMove:y,focusAfterOpen:j,maxWidth:b,className:w,anchor:z,offset:B})),V=S.getElement(),S.on("open",()=>{t(0,E=!0),G(),U("open",S)}),S.on("close",()=>{t(0,E=!1),U("close",S)}),S.on("hover",()=>{U("hover",S)}))),l.$$.dirty[0]&8421384&&S&&r instanceof me.Marker&&(u==="click"?r.setPopup(S):r.getPopup()===S&&r.setPopup(void 0)),l.$$.dirty[0]&268468224&&be.includes(u)&&(i==null?void 0:i.type)===u&&(ie(i),rt(W,i=null,i)),l.$$.dirty[0]&268468224&&t(26,s=u==="hover"&&((i==null?void 0:i.type)==="mousemove"||(i==null?void 0:i.type)==="mouseenter")),l.$$.dirty[0]&352354304&&u==="hover"&&W&&(s&&i&&je(i),t(0,E=(s||fe)??!1)),l.$$.dirty[0]&12582914&&(pe?S.setDOMContent(pe):K&&S.setHTML(K)),l.$$.dirty[0]&8389632&&v&&S.setLngLat(v),l.$$.dirty[0]&41943045&&o){let d=S.isOpen();E&&!d?(S.addTo(o),ee==="opening"&&t(25,ee="justOpened")):!E&&d&&S.remove()}},[E,pe,o,r,X,Q,c,W,Y,g,v,_,I,M,y,u,k,j,z,B,w,b,K,S,fe,ee,s,n,i,m,a,tt,nt]}class St extends de{constructor(e){super(),_e(this,e,jt,Tt,ge,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function Mt(l){let e;const t=l[16].default,n=Ve(t,l,l[24],null);return{c(){n&&n.c()},m(s,o){n&&n.m(s,o),e=!0},p(s,o){n&&n.p&&(!e||o&16777216)&&Xe(n,t,s,s[24],e?xe(t,s[24],o,null):Ye(s[24]),null)},i(s){e||(O(n,s),e=!0)},o(s){T(n,s),e=!1},d(s){n&&n.d(s)}}}function Gt(l){let e,t,n;function s(i){l[17](i)}let o={id:l[1],type:"symbol",source:l[2],sourceLayer:l[3],beforeId:l[4],beforeLayerType:l[5],paint:l[6],layout:l[7],filter:l[8],applyToClusters:l[9],minzoom:l[10],maxzoom:l[11],hoverCursor:l[12],manageHoverState:l[13],eventsIfTopMost:l[14],interactive:l[15],$$slots:{default:[Mt]},$$scope:{ctx:l}};return l[0]!==void 0&&(o.hovered=l[0]),e=new ut({props:o}),x.push(()=>te(e,"hovered",s)),e.$on("click",l[18]),e.$on("dblclick",l[19]),e.$on("contextmenu",l[20]),e.$on("mouseenter",l[21]),e.$on("mousemove",l[22]),e.$on("mouseleave",l[23]),{c(){A(e.$$.fragment)},m(i,r){R(e,i,r),n=!0},p(i,[r]){const f={};r&2&&(f.id=i[1]),r&4&&(f.source=i[2]),r&8&&(f.sourceLayer=i[3]),r&16&&(f.beforeId=i[4]),r&32&&(f.beforeLayerType=i[5]),r&64&&(f.paint=i[6]),r&128&&(f.layout=i[7]),r&256&&(f.filter=i[8]),r&512&&(f.applyToClusters=i[9]),r&1024&&(f.minzoom=i[10]),r&2048&&(f.maxzoom=i[11]),r&4096&&(f.hoverCursor=i[12]),r&8192&&(f.manageHoverState=i[13]),r&16384&&(f.eventsIfTopMost=i[14]),r&32768&&(f.interactive=i[15]),r&16777216&&(f.$$scope={dirty:r,ctx:i}),!t&&r&1&&(t=!0,f.hovered=i[0],ne(()=>t=!1)),e.$set(f)},i(i){n||(O(e.$$.fragment,i),n=!0)},o(i){T(e.$$.fragment,i),n=!1},d(i){F(e,i)}}}function It(l,e,t){let{$$slots:n={},$$scope:s}=e,{id:o=at("symbol")}=e,{source:i=void 0}=e,{sourceLayer:r=void 0}=e,{beforeId:f=void 0}=e,{beforeLayerType:a=void 0}=e,{paint:m=void 0}=e,{layout:g=void 0}=e,{filter:_=void 0}=e,{applyToClusters:I=void 0}=e,{minzoom:M=void 0}=e,{maxzoom:y=void 0}=e,{hoverCursor:u=void 0}=e,{manageHoverState:k=!1}=e,{hovered:j=null}=e,{eventsIfTopMost:z=!1}=e,{interactive:B=!0}=e;function w(c){j=c,t(0,j)}function b(c){ae.call(this,l,c)}function v(c){ae.call(this,l,c)}function K(c){ae.call(this,l,c)}function E(c){ae.call(this,l,c)}function U(c){ae.call(this,l,c)}function Q(c){ae.call(this,l,c)}return l.$$set=c=>{"id"in c&&t(1,o=c.id),"source"in c&&t(2,i=c.source),"sourceLayer"in c&&t(3,r=c.sourceLayer),"beforeId"in c&&t(4,f=c.beforeId),"beforeLayerType"in c&&t(5,a=c.beforeLayerType),"paint"in c&&t(6,m=c.paint),"layout"in c&&t(7,g=c.layout),"filter"in c&&t(8,_=c.filter),"applyToClusters"in c&&t(9,I=c.applyToClusters),"minzoom"in c&&t(10,M=c.minzoom),"maxzoom"in c&&t(11,y=c.maxzoom),"hoverCursor"in c&&t(12,u=c.hoverCursor),"manageHoverState"in c&&t(13,k=c.manageHoverState),"hovered"in c&&t(0,j=c.hovered),"eventsIfTopMost"in c&&t(14,z=c.eventsIfTopMost),"interactive"in c&&t(15,B=c.interactive),"$$scope"in c&&t(24,s=c.$$scope)},[j,o,i,r,f,a,m,g,_,I,M,y,u,k,z,B,n,w,b,v,K,E,U,Q,s]}class et extends de{constructor(e){super(),_e(this,e,It,Gt,ge,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function Fe(l,e,t){const n=l.slice();return n[4]=e[t][0],n[5]=e[t][1],n}function Re(l){let e,t,n,s,o=l[4]+"",i,r;return{c(){e=L("div"),t=L("span"),s=D(),i=P(o),r=D(),N(t,"class",n="color-swatch "+l[1]+" svelte-1enycr6"),J(t,"background",l[5]),J(e,"display","flex"),J(e,"align-items","center"),J(e,"gap","6px")},m(f,a){h(f,e,a),C(e,t),C(e,s),C(e,i),C(e,r)},p(f,a){a&2&&n!==(n="color-swatch "+f[1]+" svelte-1enycr6")&&N(t,"class",n),a&1&&J(t,"background",f[5]),a&1&&o!==(o=f[4]+"")&&$(i,o)},d(f){f&&p(e)}}}function zt(l){let e,t=Ne(Object.entries(l[0])),n=[];for(let s=0;s<t.length;s+=1)n[s]=Re(Fe(l,t,s));return{c(){e=L("div");for(let s=0;s<n.length;s+=1)n[s].c();J(e,"display","grid"),J(e,"grid-template-columns","repeat(auto-fill, calc("+l[2]+" - 10px))"),J(e,"gap","10px")},m(s,o){h(s,e,o);for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(e,null)},p(s,[o]){if(o&3){t=Ne(Object.entries(s[0]));let i;for(i=0;i<t.length;i+=1){const r=Fe(s,t,i);n[i]?n[i].p(r,o):(n[i]=Re(r),n[i].c(),n[i].m(e,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}o&4&&J(e,"grid-template-columns","repeat(auto-fill, calc("+s[2]+" - 10px))")},i:re,o:re,d(s){s&&p(e),ct(n,s)}}}function Nt(l,e,t){let n,{labelColors:s}=e,{swatchClass:o="rectangle"}=e,{itemsPerRow:i=2}=e;return l.$$set=r=>{"labelColors"in r&&t(0,s=r.labelColors),"swatchClass"in r&&t(1,o=r.swatchClass),"itemsPerRow"in r&&t(3,i=r.itemsPerRow)},l.$$.update=()=>{l.$$.dirty&8&&t(2,n=`${100/i}%`)},[s,o,n,i]}class Dt extends de{constructor(e){super(),_e(this,e,Nt,zt,ge,{labelColors:0,swatchClass:1,itemsPerRow:3})}}let ye="match-linestrings-review";function Et(l){let e;return{c(){e=P("no matches (off-road)")},m(t,n){h(t,e,n)},p:re,d(t){t&&p(e)}}}function Ht(l){let e=JSON.stringify(l[3].matching_sources)+"",t;return{c(){t=P(e)},m(n,s){h(n,t,s)},p(n,s){s&8&&e!==(e=JSON.stringify(n[3].matching_sources)+"")&&$(t,e)},d(n){n&&p(t)}}}function Pt(l){let e,t,n,s,o,i,r,f,a,m,g,_,I,M,y,u,k,j;function z(b,v){return b[3].matching_sources.length>0?Ht:Et}let B=z(l),w=B(l);return{c(){e=L("div"),t=L("h3"),n=P("Target "),s=P(l[0]),o=P(`:
    `),w.c(),i=D(),r=L("button"),r.innerHTML=`<kbd>Escape</kbd>
    - Back`,f=D(),a=L("h6"),a.textContent="Click sources to add or remove",m=D(),g=L("div"),_=L("button"),_.innerHTML=`<kbd>1</kbd>
    - Unreviewed`,I=D(),M=L("button"),M.innerHTML=`<kbd>2</kbd>
    - Not sure`,y=D(),u=L("button"),u.innerHTML=`<kbd>3</kbd>
    - Confirm correct`,N(r,"class","btn btn-secondary"),J(e,"display","flex"),J(e,"justify-content","space-between"),N(_,"class","btn btn-danger svelte-1tzb8bs"),ce(_,"current",l[3].reviewed=="unreviewed"),N(M,"class","btn btn-warning svelte-1tzb8bs"),ce(M,"current",l[3].reviewed=="not sure"),N(u,"class","btn btn-success svelte-1tzb8bs"),ce(u,"current",l[3].reviewed=="confirmed"),J(g,"display","flex"),J(g,"justify-content","space-between")},m(b,v){h(b,e,v),C(e,t),C(t,n),C(t,s),C(t,o),w.m(t,null),C(e,i),C(e,r),h(b,f,v),h(b,a,v),h(b,m,v),h(b,g,v),C(g,_),C(g,I),C(g,M),C(g,y),C(g,u),k||(j=[q(window,"keydown",l[4]),q(r,"click",function(){mt(l[2])&&l[2].apply(this,arguments)}),q(_,"click",l[6]),q(M,"click",l[7]),q(u,"click",l[8])],k=!0)},p(b,[v]){l=b,v&1&&$(s,l[0]),B===(B=z(l))&&w?w.p(l,v):(w.d(1),w=B(l),w&&(w.c(),w.m(t,null))),v&8&&ce(_,"current",l[3].reviewed=="unreviewed"),v&8&&ce(M,"current",l[3].reviewed=="not sure"),v&8&&ce(u,"current",l[3].reviewed=="confirmed")},i:re,o:re,d(b){b&&(p(e),p(f),p(a),p(m),p(g)),w.d(),k=!1,Te(j)}}}function Bt(l,e,t){let n,{clickedTarget:s}=e,{targetGj:o}=e,{onConfirm:i}=e,{onCancel:r}=e;function f(_){_.target.tagName!="INPUT"&&(_.key=="1"?i("unreviewed"):_.key=="2"?i("not sure"):_.key=="3"?i("confirmed"):_.key=="Escape"&&r())}const a=()=>i("unreviewed"),m=()=>i("not sure"),g=()=>i("confirmed");return l.$$set=_=>{"clickedTarget"in _&&t(0,s=_.clickedTarget),"targetGj"in _&&t(5,o=_.targetGj),"onConfirm"in _&&t(1,i=_.onConfirm),"onCancel"in _&&t(2,r=_.onCancel)},l.$$.update=()=>{l.$$.dirty&33&&t(3,n=o.features[s].properties)},[s,i,r,n,f,o,a,m,g]}class Jt extends de{constructor(e){super(),_e(this,e,Bt,Pt,ge,{clickedTarget:0,targetGj:5,onConfirm:1,onCancel:2})}}function Ae(l){let e,t,n,s,o=l[0].features.length+"",i,r,f=l[1].features.length+"",a,m,g=l[1].features.filter(qe).length+"",_,I,M,y,u,k,j,z,B,w=!l[3]&&We(l);return{c(){e=L("button"),t=P("Swap"),n=D(),s=L("p"),i=P(o),r=P(` sources and
    `),a=P(f),m=P(" targets , with "),_=P(g),I=P(" matching a source"),M=D(),y=L("button"),y.textContent="Start review",u=D(),w&&w.c(),k=Ce(),N(e,"class","btn btn-secondary"),e.disabled=l[3],N(y,"class","btn btn-primary mb-5")},m(b,v){h(b,e,v),C(e,t),h(b,n,v),h(b,s,v),C(s,i),C(s,r),C(s,a),C(s,m),C(s,_),C(s,I),h(b,M,v),h(b,y,v),h(b,u,v),w&&w.m(b,v),h(b,k,v),j=!0,z||(B=[q(e,"click",l[8]),q(y,"click",l[11])],z=!0)},p(b,v){(!j||v&8)&&(e.disabled=b[3]),(!j||v&1)&&o!==(o=b[0].features.length+"")&&$(i,o),(!j||v&2)&&f!==(f=b[1].features.length+"")&&$(a,f),(!j||v&2)&&g!==(g=b[1].features.filter(qe).length+"")&&$(_,g),b[3]?w&&(le(),T(w,1,1,()=>{w=null}),oe()):w?(w.p(b,v),v&8&&O(w,1)):(w=We(b),w.c(),O(w,1),w.m(k.parentNode,k))},i(b){j||(O(w),j=!0)},o(b){T(w),j=!1},d(b){b&&(p(e),p(n),p(s),p(M),p(y),p(u),p(k)),w&&w.d(b),z=!1,Te(B)}}}function We(l){let e,t,n;function s(i){l[12](i)}let o={onChange:l[6]};return l[4]!==void 0&&(o.options=l[4]),e=new _t({props:o}),x.push(()=>te(e,"options",s)),{c(){A(e.$$.fragment)},m(i,r){R(e,i,r),n=!0},p(i,r){const f={};!t&&r&16&&(t=!0,f.options=i[4],ne(()=>t=!1)),e.$set(f)},i(i){n||(O(e.$$.fragment,i),n=!0)},o(i){T(e.$$.fragment,i),n=!1},d(i){F(e,i)}}}function Ft(l){let e,t,n,s,o,i,r,f,a=l[0].features.length>0&&Ae(l);return{c(){e=L("label"),t=P(`Load two .geojson files
  `),n=L("input"),s=D(),a&&a.c(),o=Ce(),N(n,"class","form-control"),N(n,"type","file"),n.multiple=!0,N(e,"class","form-label")},m(m,g){h(m,e,g),C(e,t),C(e,n),l[10](n),h(m,s,g),a&&a.m(m,g),h(m,o,g),i=!0,r||(f=q(n,"change",l[7]),r=!0)},p(m,[g]){m[0].features.length>0?a?(a.p(m,g),g&1&&O(a,1)):(a=Ae(m),a.c(),O(a,1),a.m(o.parentNode,o)):a&&(le(),T(a,1,1,()=>{a=null}),oe())},i(m){i||(O(a),i=!0)},o(m){T(a),i=!1},d(m){m&&(p(e),p(s),p(o)),l[10](null),a&&a.d(m),r=!1,f()}}}function Ue(l){let e=0;for(let t of l.features)t.id=e++,t.properties??(t.properties={});return l}const qe=l=>l.properties.matching_sources.length>0;function Rt(l,e,t){let{sourceGj:n}=e,{targetGj:s}=e,{setupDone:o}=e,{zoomFit:i}=e,r=!1,f={buffer_meters:20,angle_diff_threshold:10,length_ratio_threshold:1.1,midpt_dist_threshold:15};function a(){var u;if(!r)try{let k=JSON.parse(dt(JSON.stringify(n),JSON.stringify(s),f));for(let[j,z]of s.features.entries())z.properties.matching_sources=k[j].matching_sources,(u=z.properties).reviewed??(u.reviewed="unreviewed");t(1,s)}catch(k){window.alert(`Bug: ${k}`)}}let m;async function g(u){if(!m.files)return;if(m.files.length!=2){window.alert("Select two GeoJSON files");return}try{let j=await m.files[0].text(),z=await m.files[1].text();t(0,n=Ue(JSON.parse(j))),t(1,s=Ue(JSON.parse(z))),"matching_sources"in s.features[0].properties?t(3,r=!0):"matching_sources"in n.features[0].properties&&(t(3,r=!0),t(0,[n,s]=[s,n],n,t(1,s))),i(),a()}catch(j){window.alert(`Bad input file: ${j}`)}}function _(){t(0,[n,s]=[s,n],n,t(1,s)),a()}function I(u){x[u?"unshift":"push"](()=>{m=u,t(5,m)})}const M=()=>t(2,o=!0);function y(u){f=u,t(4,f)}return l.$$set=u=>{"sourceGj"in u&&t(0,n=u.sourceGj),"targetGj"in u&&t(1,s=u.targetGj),"setupDone"in u&&t(2,o=u.setupDone),"zoomFit"in u&&t(9,i=u.zoomFit)},[n,s,o,r,f,m,a,g,_,i,I,M,y]}class At extends de{constructor(e){super(),_e(this,e,Rt,Ft,ge,{sourceGj:0,targetGj:1,setupDone:2,zoomFit:9})}}const{window:Wt}=ht;function Ut(l){let e,t,n,s,o,i,r,f,a,m,g,_,I,M,y=l[1].features.length+"",u,k,j,z,B,w,b,v,K,E,U,Q,c,W,Y,se,Z,be,S;function fe(G){l[24](G)}let V={$$slots:{default:[Kt]},$$scope:{ctx:l}};return l[7]!==void 0&&(V.checked=l[7]),b=new wt({props:V}),x.push(()=>te(b,"checked",fe)),W=new Dt({props:{itemsPerRow:1,labelColors:{Confirmed:"green","Not sure":"orange",Unreviewed:"red",Source:"grey"}}}),{c(){e=L("div"),t=L("button"),t.textContent="Start over",n=D(),s=L("button"),s.textContent="Zoom to fit",o=D(),i=L("br"),r=D(),f=L("div"),a=L("div"),g=D(),_=L("p"),I=P(l[4]),M=P(" / "),u=P(y),k=P(" targets reviewed"),j=D(),z=L("button"),z.textContent="Download reviews",B=D(),w=L("div"),A(b.$$.fragment),K=D(),E=L("div"),U=L("div"),Q=L("h5"),Q.textContent="Legend",c=D(),A(W.$$.fragment),Y=D(),se=L("p"),se.textContent="Thinner lines have a match, thicker are off-road",N(t,"class","btn btn-outline-danger"),N(s,"class","btn btn-outline-secondary"),J(e,"display","flex"),J(e,"justify-content","space-between"),N(a,"class","progress-bar"),J(a,"width",`${100*l[4]/l[1].features.length}%`),N(f,"class","progress"),N(f,"role","progressbar"),N(f,"aria-valuenow",l[4]),N(f,"aria-valuemin","0"),N(f,"aria-valuemax",m=l[1].features.length),N(z,"class","btn btn-outline-success"),N(w,"class","mt-5"),N(Q,"class","card-title"),N(U,"class","card-body"),N(E,"class","card")},m(G,H){h(G,e,H),C(e,t),C(e,n),C(e,s),h(G,o,H),h(G,i,H),h(G,r,H),h(G,f,H),C(f,a),h(G,g,H),h(G,_,H),C(_,I),C(_,M),C(_,u),C(_,k),h(G,j,H),h(G,z,H),h(G,B,H),h(G,w,H),R(b,w,null),h(G,K,H),h(G,E,H),C(E,U),C(U,Q),C(U,c),R(W,U,null),C(U,Y),C(U,se),Z=!0,be||(S=[q(t,"click",l[14]),q(s,"click",l[9]),q(z,"click",l[13])],be=!0)},p(G,H){H&18&&J(a,"width",`${100*G[4]/G[1].features.length}%`),(!Z||H&16)&&N(f,"aria-valuenow",G[4]),(!Z||H&2&&m!==(m=G[1].features.length))&&N(f,"aria-valuemax",m),(!Z||H&16)&&$(I,G[4]),(!Z||H&2)&&y!==(y=G[1].features.length+"")&&$(u,y);const X={};H&67108864&&(X.$$scope={dirty:H,ctx:G}),!v&&H&128&&(v=!0,X.checked=G[7],ne(()=>v=!1)),b.$set(X)},i(G){Z||(O(b.$$.fragment,G),O(W.$$.fragment,G),Z=!0)},o(G){T(b.$$.fragment,G),T(W.$$.fragment,G),Z=!1},d(G){G&&(p(e),p(o),p(i),p(r),p(f),p(g),p(_),p(j),p(z),p(B),p(w),p(K),p(E)),F(b),F(W),be=!1,Te(S)}}}function qt(l){let e,t,n,s,o;function i(m){l[21](m)}function r(m){l[22](m)}function f(m){l[23](m)}let a={zoomFit:l[9]};return l[0]!==void 0&&(a.sourceGj=l[0]),l[1]!==void 0&&(a.targetGj=l[1]),l[2]!==void 0&&(a.setupDone=l[2]),e=new At({props:a}),x.push(()=>te(e,"sourceGj",i)),x.push(()=>te(e,"targetGj",r)),x.push(()=>te(e,"setupDone",f)),{c(){A(e.$$.fragment)},m(m,g){R(e,m,g),o=!0},p(m,g){const _={};!t&&g&1&&(t=!0,_.sourceGj=m[0],ne(()=>t=!1)),!n&&g&2&&(n=!0,_.targetGj=m[1],ne(()=>n=!1)),!s&&g&4&&(s=!0,_.setupDone=m[2],ne(()=>s=!1)),e.$set(_)},i(m){o||(O(e.$$.fragment,m),o=!0)},o(m){T(e.$$.fragment,m),o=!1},d(m){F(e,m)}}}function Kt(l){let e;return{c(){e=P("Show labels for matches")},m(t,n){h(t,e,n)},d(t){t&&p(e)}}}function Qt(l){let e,t,n,s,o,i,r,f;const a=[qt,Ut],m=[];function g(_,I){return _[2]?1:0}return i=g(l),r=m[i]=a[i](l),{c(){e=L("div"),t=L("h1"),t.textContent="Manually specify LineString matchings for test cases",n=D(),s=L("div"),s.innerHTML='<a class="icon-link mb-3" href="https://github.com/nptscot/match_linestrings/blob/main/tests/README.md" target="_blank">About <i class="fa-solid fa-arrow-up-right-from-square"></i></a>',o=D(),r.c(),N(e,"slot","left")},m(_,I){h(_,e,I),C(e,t),C(e,n),C(e,s),C(e,o),m[i].m(e,null),f=!0},p(_,I){let M=i;i=g(_),i===M?m[i].p(_,I):(le(),T(m[M],1,1,()=>{m[M]=null}),oe(),r=m[i],r?r.p(_,I):(r=m[i]=a[i](_),r.c()),O(r,1),r.m(e,null))},i(_){f||(O(r),f=!0)},o(_){T(r),f=!1},d(_){_&&p(e),m[i].d()}}}function Ke(l){let e,t,n,s;const o=[Vt,Zt],i=[];function r(f,a){return f[3]==null?0:1}return t=r(l),n=i[t]=o[t](l),{c(){e=L("div"),n.c(),N(e,"class","map-panel svelte-hr6p1s")},m(f,a){h(f,e,a),i[t].m(e,null),s=!0},p(f,a){let m=t;t=r(f),t===m?i[t].p(f,a):(le(),T(i[m],1,1,()=>{i[m]=null}),oe(),n=i[t],n?n.p(f,a):(n=i[t]=o[t](f),n.c()),O(n,1),n.m(e,null))},i(f){s||(O(n),s=!0)},o(f){T(n),s=!1},d(f){f&&p(e),i[t].d()}}}function Zt(l){let e,t;return e=new Jt({props:{clickedTarget:l[3],targetGj:l[1],onConfirm:l[10],onCancel:l[18]}}),{c(){A(e.$$.fragment)},m(n,s){R(e,n,s),t=!0},p(n,s){const o={};s&8&&(o.clickedTarget=n[3]),s&2&&(o.targetGj=n[1]),s&8&&(o.onCancel=n[18]),e.$set(o)},i(n){t||(O(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Vt(l){let e,t,n,s,o,i,r;return{c(){e=L("button"),t=P("Goto "),n=L("kbd"),n.textContent="n",s=P(`
              ext unreviewed`),N(e,"class","btn btn-primary"),e.disabled=o=l[4]==l[1].features.length},m(f,a){h(f,e,a),C(e,t),C(e,n),C(e,s),i||(r=q(e,"click",l[11]),i=!0)},p(f,a){a&18&&o!==(o=f[4]==f[1].features.length)&&(e.disabled=o)},i:re,o:re,d(f){f&&p(e),i=!1,r()}}}function Qe(l){let e,t;return e=new St({props:{openOn:"hover",$$slots:{default:[Xt,({data:n})=>({25:n}),({data:n})=>n?33554432:0]},$$scope:{ctx:l}}}),{c(){A(e.$$.fragment)},m(n,s){R(e,n,s),t=!0},p(n,s){const o={};s&100663552&&(o.$$scope={dirty:s,ctx:n}),e.$set(o)},i(n){t||(O(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Xt(l){let e,t=ve(l[25]).id+"",n,s,o=l[8].includes(ve(l[25]).id)?"remove":"add",i;return{c(){e=P("Source "),n=P(t),s=P(" -- click to "),i=P(o)},m(r,f){h(r,e,f),h(r,n,f),h(r,s,f),h(r,i,f)},p(r,f){f&33554432&&t!==(t=ve(r[25]).id+"")&&$(n,t),f&33554688&&o!==(o=r[8].includes(ve(r[25]).id)?"remove":"add")&&$(i,o)},d(r){r&&(p(e),p(n),p(s),p(i))}}}function Yt(l){let e,t,n=l[3]!=null&&Qe(l);return{c(){n&&n.c(),e=Ce()},m(s,o){n&&n.m(s,o),h(s,e,o),t=!0},p(s,o){s[3]!=null?n?(n.p(s,o),o&8&&O(n,1)):(n=Qe(s),n.c(),O(n,1),n.m(e.parentNode,e)):n&&(le(),T(n,1,1,()=>{n=null}),oe())},i(s){t||(O(n),t=!0)},o(s){T(n),t=!1},d(s){s&&p(e),n&&n.d(s)}}}function xt(l){let e,t,n,s;return e=new $e({props:{manageHoverState:!0,paint:{"line-color":["case",["in",["id"],["literal",l[8]]],"blue","black"],"line-width":8,"line-opacity":Ee(.5,1)},hoverCursor:l[3]==null?void 0:"pointer",$$slots:{default:[Yt]},$$scope:{ctx:l}}}),e.$on("click",l[16]),n=new et({props:{paint:{"text-color":"white","text-halo-color":"grey","text-halo-width":4},layout:{"text-field":["to-string",["id"]],"text-size":16,"symbol-placement":"line",visibility:l[7]?"visible":"none"}}}),{c(){A(e.$$.fragment),t=D(),A(n.$$.fragment)},m(o,i){R(e,o,i),h(o,t,i),R(n,o,i),s=!0},p(o,i){const r={};i&256&&(r.paint={"line-color":["case",["in",["id"],["literal",o[8]]],"blue","black"],"line-width":8,"line-opacity":Ee(.5,1)}),i&8&&(r.hoverCursor=o[3]==null?void 0:"pointer"),i&67109128&&(r.$$scope={dirty:i,ctx:o}),e.$set(r);const f={};i&128&&(f.layout={"text-field":["to-string",["id"]],"text-size":16,"symbol-placement":"line",visibility:o[7]?"visible":"none"}),n.$set(f)},i(o){s||(O(e.$$.fragment,o),O(n.$$.fragment,o),s=!0)},o(o){T(e.$$.fragment,o),T(n.$$.fragment,o),s=!1},d(o){o&&p(t),F(e,o),F(n,o)}}}function $t(l){let e,t,n,s;return e=new $e({props:{manageHoverState:!0,paint:{"line-width":["case",[">",["length",["get","matching_sources"]],0],8,16],"line-color":["match",["get","reviewed"],"unreviewed","red","not sure","orange","green"],"line-opacity":["case",["==",["id"],l[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,.3]},hoverCursor:"pointer"}}),e.$on("click",l[15]),n=new et({props:{paint:{"text-color":"white","text-halo-color":["match",["get","reviewed"],"unreviewed","red","not sure","orange","green"],"text-halo-width":4},layout:{"text-field":["case",[">",["length",["get","matching_sources"]],0],["to-string",["get","matching_sources"]],"off-road"],"text-size":16,"symbol-placement":"line",visibility:l[7]?"visible":"none"}}}),{c(){A(e.$$.fragment),t=D(),A(n.$$.fragment)},m(o,i){R(e,o,i),h(o,t,i),R(n,o,i),s=!0},p(o,i){const r={};i&8&&(r.paint={"line-width":["case",[">",["length",["get","matching_sources"]],0],8,16],"line-color":["match",["get","reviewed"],"unreviewed","red","not sure","orange","green"],"line-opacity":["case",["==",["id"],o[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,.3]}),e.$set(r);const f={};i&128&&(f.layout={"text-field":["case",[">",["length",["get","matching_sources"]],0],["to-string",["get","matching_sources"]],"off-road"],"text-size":16,"symbol-placement":"line",visibility:o[7]?"visible":"none"}),n.$set(f)},i(o){s||(O(e.$$.fragment,o),O(n.$$.fragment,o),s=!0)},o(o){T(e.$$.fragment,o),T(n.$$.fragment,o),s=!1},d(o){o&&p(t),F(e,o),F(n,o)}}}function en(l){let e,t,n,s,o,i,r,f,a,m,g,_;e=new vt({props:{map:l[5]}}),n=new yt({props:{map:l[5]}});function I(u){l[17](u)}let M={choice:"Maptiler Dataviz"};l[6]!==void 0&&(M.style=l[6]),o=new Ct({props:M}),x.push(()=>te(o,"style",I));let y=l[2]&&Ke(l);return a=new De({props:{data:l[0],$$slots:{default:[xt]},$$scope:{ctx:l}}}),g=new De({props:{data:l[1],$$slots:{default:[$t]},$$scope:{ctx:l}}}),{c(){A(e.$$.fragment),t=D(),A(n.$$.fragment),s=D(),A(o.$$.fragment),r=D(),y&&y.c(),f=D(),A(a.$$.fragment),m=D(),A(g.$$.fragment)},m(u,k){R(e,u,k),h(u,t,k),R(n,u,k),h(u,s,k),R(o,u,k),h(u,r,k),y&&y.m(u,k),h(u,f,k),R(a,u,k),h(u,m,k),R(g,u,k),_=!0},p(u,k){const j={};k&32&&(j.map=u[5]),e.$set(j);const z={};k&32&&(z.map=u[5]),n.$set(z);const B={};!i&&k&64&&(i=!0,B.style=u[6],ne(()=>i=!1)),o.$set(B),u[2]?y?(y.p(u,k),k&4&&O(y,1)):(y=Ke(u),y.c(),O(y,1),y.m(f.parentNode,f)):y&&(le(),T(y,1,1,()=>{y=null}),oe());const w={};k&1&&(w.data=u[0]),k&67109256&&(w.$$scope={dirty:k,ctx:u}),a.$set(w);const b={};k&2&&(b.data=u[1]),k&67109e3&&(b.$$scope={dirty:k,ctx:u}),g.$set(b)},i(u){_||(O(e.$$.fragment,u),O(n.$$.fragment,u),O(o.$$.fragment,u),O(y),O(a.$$.fragment,u),O(g.$$.fragment,u),_=!0)},o(u){T(e.$$.fragment,u),T(n.$$.fragment,u),T(o.$$.fragment,u),T(y),T(a.$$.fragment,u),T(g.$$.fragment,u),_=!1},d(u){u&&(p(t),p(s),p(r),p(f),p(m)),F(e,u),F(n,u),F(o,u),y&&y.d(u),F(a,u),F(g,u)}}}function tn(l){let e,t,n,s;function o(r){l[19](r)}let i={style:l[6],hash:!0,$$slots:{default:[en]},$$scope:{ctx:l}};return l[5]!==void 0&&(i.map=l[5]),t=new pt({props:i}),x.push(()=>te(t,"map",o)),t.$on("error",l[20]),{c(){e=L("div"),A(t.$$.fragment),N(e,"slot","main"),J(e,"position","relative"),J(e,"width","100%"),J(e,"height","100vh")},m(r,f){h(r,e,f),R(t,e,null),s=!0},p(r,f){const a={};f&64&&(a.style=r[6]),f&67109375&&(a.$$scope={dirty:f,ctx:r}),!n&&f&32&&(n=!0,a.map=r[5],ne(()=>n=!1)),t.$set(a)},i(r){s||(O(t.$$.fragment,r),s=!0)},o(r){T(t.$$.fragment,r),s=!1},d(r){r&&p(e),F(t)}}}function nn(l){let e,t,n,s;return e=new gt({props:{$$slots:{main:[tn],left:[Qt]},$$scope:{ctx:l}}}),{c(){A(e.$$.fragment)},m(o,i){R(e,o,i),t=!0,n||(s=q(Wt,"keydown",l[12]),n=!0)},p(o,[i]){const r={};i&67109375&&(r.$$scope={dirty:i,ctx:o}),e.$set(r)},i(o){t||(O(e.$$.fragment,o),t=!0)},o(o){T(e.$$.fragment,o),t=!1},d(o){F(e,o),n=!1,s()}}}function ln(l,e,t){let n,s,o,i=bt["Maptiler Dataviz"],r=we(),f=we(),a=!1,m=!1,g=null;Ze(async()=>{await Ot();try{let c=window.localStorage.getItem(ye);if(c){let W=JSON.parse(c);t(0,[r,f]=W,r,t(1,f)),t(2,a=!0),console.log(`Restored data from local storage ${ye}`)}}catch(c){console.log(`Couldn't restore data from local storage: ${c}`)}});function _(){let c={type:"FeatureCollection",features:[...r.features,...f.features]};o==null||o.fitBounds(He(c),{animate:!1,padding:10})}function I(c){if(g==null)throw new Error("impossible");t(1,f.features[g].properties.reviewed=c,f),t(1,f),t(3,g=null)}function M(){for(let c of f.features)if(c.properties.reviewed=="unreviewed"){o==null||o.fitBounds(He(c),{duration:600,padding:200}),t(3,g=c.id);return}}function y(c){c.target.tagName=="INPUT"||!a||c.key=="n"&&M()}function u(){kt("reviewed_targets.geojson",JSON.stringify(f))}function k(){window.confirm("Do you want to discard this review and start over?")&&(t(0,r=we()),t(1,f=we()),t(2,a=!1),t(3,g=null),t(7,m=!1),window.localStorage.removeItem(ye))}function j(c){a&&t(3,g=c.detail.features[0].id)}function z(c){if(!a||g==null)return;let W=c.detail.features[0].id,Y=f.features[g].properties;Y.matching_sources.includes(W)?Y.matching_sources=Y.matching_sources.filter(se=>se!=W):Y.matching_sources.push(W),t(1,f)}function B(c){i=c,t(6,i)}const w=()=>t(3,g=null);function b(c){o=c,t(5,o)}const v=c=>{console.log(c.detail.error)};function K(c){r=c,t(0,r)}function E(c){f=c,t(1,f)}function U(c){a=c,t(2,a)}function Q(c){m=c,t(7,m)}return l.$$.update=()=>{l.$$.dirty&10&&t(8,n=g==null?[]:f.features[g].properties.matching_sources),l.$$.dirty&2&&t(4,s=f.features.filter(c=>c.properties.reviewed!="unreviewed").length),l.$$.dirty&23&&a&&(console.log(`Autosaving with ${s} reviewed targets`),window.localStorage.setItem(ye,JSON.stringify([r,f])))},[r,f,a,g,s,o,i,m,n,_,I,M,y,u,k,j,z,B,w,b,v,K,E,U,Q]}class on extends de{constructor(e){super(),_e(this,e,ln,nn,ge,{})}}new on({target:document.getElementById("app")});
