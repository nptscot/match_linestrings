import{S as de,i as _e,s as ge,n as p,t as S,e as O,q as $,r as ee,u as h,R as ye,T as lt,U as ot,V as st,W as he,o as Ze,X as it,Y as me,Z as rt,x as C,B as x,$ as Ve,a0 as Xe,a1 as Ye,a2 as xe,a3 as ut,a4 as ft,C as oe,d as R,D as se,g as A,h as W,a5 as at,a6 as ae,a7 as Ne,a8 as ie,a9 as ct,E as J,A as G,K as X,v as w,y as N,z as H,J as Le,aa as ce,w as q,ab as mt,F as dt,I as _t,L as gt,k as ke,j as bt,M as pt,ac as ht,H as kt,N as wt,O as De,P as $e,Q as Ee,ad as we,_ as vt,G as He}from"./Settings-CV3NVTZE.js";const yt=l=>({features:l[0]&16,data:l[0]&16,map:l[0]&4,close:l[0]&1}),Pe=l=>{var e;return{features:l[4],data:((e=l[4])==null?void 0:e[0])??null,map:l[2],close:l[31]}};function Be(l){var s;let e,t,n=(((s=l[4])==null?void 0:s.length)||l[3]instanceof me.Marker)&&Je(l);return{c(){e=C("div"),n&&n.c()},m(o,i){h(o,e,i),n&&n.m(e,null),l[32](e),t=!0},p(o,i){var r;(r=o[4])!=null&&r.length||o[3]instanceof me.Marker?n?(n.p(o,i),i[0]&24&&O(n,1)):(n=Je(o),n.c(),O(n,1),n.m(e,null)):n&&($(),S(n,1,1,()=>{n=null}),ee())},i(o){t||(O(n),t=!0)},o(o){S(n),t=!1},d(o){o&&p(e),n&&n.d(),l[32](null)}}}function Je(l){let e;const t=l[30].default,n=Ve(t,l,l[29],Pe);return{c(){n&&n.c()},m(s,o){n&&n.m(s,o),e=!0},p(s,o){n&&n.p&&(!e||o[0]&536870933)&&Xe(n,t,s,s[29],e?xe(t,s[29],o,yt):Ye(s[29]),Pe)},i(s){e||(O(n,s),e=!0)},o(s){S(n,s),e=!1},d(s){n&&n.d(s)}}}function Ct(l){let e,t,n=l[9].default&&Be(l);return{c(){n&&n.c(),e=ye()},m(s,o){n&&n.m(s,o),h(s,e,o),t=!0},p(s,o){s[9].default?n?(n.p(s,o),o[0]&512&&O(n,1)):(n=Be(s),n.c(),O(n,1),n.m(e.parentNode,e)):n&&($(),S(n,1,1,()=>{n=null}),ee())},i(s){t||(O(n),t=!0)},o(s){S(n),t=!1},d(s){s&&p(e),n&&n.d(s)}}}function Ot(l,e,t){let n,s,o,i,r,u,{$$slots:c={},$$scope:d}=e;const _=lt(c);let{closeButton:f=void 0}=e,{closeOnClickOutside:v=!0}=e,{closeOnClickInside:j=!1}=e,{closeOnMove:I=!1}=e,{openOn:g="click"}=e,{openIfTopMost:D=!0}=e,{focusAfterOpen:M=!0}=e,{anchor:z=void 0}=e,{offset:B=void 0}=e,{popupClass:y=void 0}=e,{maxWidth:k=void 0}=e,{lngLat:b=void 0}=e,{html:Z=void 0}=e,{open:E=!1}=e;const K=ot(),{map:F,popupTarget:a,layerEvent:Q,layer:U,eventTopMost:re,markerClickManager:ue}=st();he(l,F,m=>t(2,o=m)),he(l,a,m=>t(3,r=m)),he(l,Q,m=>t(28,i=m)),he(l,U,m=>t(35,u=m));const V=["click","dblclick","contextmenu"];let L,te=!1,T;function P(){if(!L)return;let m=L.getElement();!m||m===T||(T=m,g==="hover"&&(T.style.pointerEvents="none"),T.addEventListener("mouseenter",()=>{t(24,te=!0)},{passive:!0}),T.addEventListener("mouseleave",()=>{t(24,te=!1)},{passive:!0}),T.addEventListener("click",()=>{j&&t(0,E=!1)},{passive:!0}))}Ze(()=>{if(o)return o.on("click",pe),o.on("contextmenu",pe),ue.add(ze),typeof r=="string"&&(o.on("click",r,le),o.on("dblclick",r,le),o.on("contextmenu",r,le),o.on("mousemove",r,Ie),o.on("mouseleave",r,Ge),o.on("touchstart",r,Se),o.on("touchend",r,Me)),()=>{o!=null&&o.loaded()&&(L==null||L.remove(),o.off("click",pe),o.off("contextmenu",pe),ue.remove(ze),r instanceof me.Marker?r.getPopup()===L&&r.setPopup(void 0):typeof r=="string"&&(o.off("click",r,le),o.off("dblclick",r,le),o.off("contextmenu",r,le),o.off("mousemove",r,Ie),o.off("mouseleave",r,Ge),o.off("touchstart",r,Se),o.off("touchend",r,Me)))}});function Te(m){return D?!("marker"in m)&&!ut(m)&&re(m)!==u:!1}let ne=null,Y="normal";function je(m){"layerType"in m&&m.layerType==="deckgl"?(t(10,b=m.coordinate),t(4,ne=m.object?[m.object]:null)):(t(10,b=m.lngLat),t(4,ne=m.features??[]))}function le(m){m.type!==g||Te(m)||(je(m),setTimeout(()=>t(0,E=!0)))}let fe=null;function Se(m){fe=m.point}function Me(m){if(!fe||g!=="hover")return;let Ce=fe.dist(m.point);fe=null,Ce<3&&(t(10,b=m.lngLat),t(4,ne=m.features??[]),L.isOpen()?t(25,Y="justOpened"):(t(25,Y="opening"),t(0,E=!0)))}function Ge(m){g!=="hover"||fe||Y!=="normal"||(t(0,E=!1),t(4,ne=null))}function Ie(m){if(!(g!=="hover"||fe||Y!=="normal")){if(Te(m)){t(0,E=!1),t(4,ne=null);return}t(0,E=!0),t(4,ne=m.features??[]),t(10,b=m.lngLat)}}function pe(m){if(Y==="justOpened"){t(25,Y="normal");return}if(!v)return;let Ce=[T,r instanceof me.Marker?r==null?void 0:r.getElement():null];E&&L.isOpen()&&!Ce.some(Oe=>Oe==null?void 0:Oe.contains(m.originalEvent.target))&&(m.type==="contextmenu"&&g==="contextmenu"||m.type!=="contextmenu")&&t(0,E=!1)}function ze(m){v&&E&&L.isOpen()&&m.marker!==r&&t(0,E=!1)}it(()=>{o&&(L!=null&&L.isOpen())&&L.remove()});let be;const tt=()=>t(0,E=!1);function nt(m){x[m?"unshift":"push"](()=>{be=m,t(1,be)})}return l.$$set=m=>{"closeButton"in m&&t(11,f=m.closeButton),"closeOnClickOutside"in m&&t(12,v=m.closeOnClickOutside),"closeOnClickInside"in m&&t(13,j=m.closeOnClickInside),"closeOnMove"in m&&t(14,I=m.closeOnMove),"openOn"in m&&t(15,g=m.openOn),"openIfTopMost"in m&&t(16,D=m.openIfTopMost),"focusAfterOpen"in m&&t(17,M=m.focusAfterOpen),"anchor"in m&&t(18,z=m.anchor),"offset"in m&&t(19,B=m.offset),"popupClass"in m&&t(20,y=m.popupClass),"maxWidth"in m&&t(21,k=m.maxWidth),"lngLat"in m&&t(10,b=m.lngLat),"html"in m&&t(22,Z=m.html),"open"in m&&t(0,E=m.open),"$$scope"in m&&t(29,d=m.$$scope)},l.$$.update=()=>{if(l.$$.dirty[0]&14336&&t(27,n=f??(!v&&!j)),l.$$.dirty[0]&146685952&&(L||(t(23,L=new me.Popup({closeButton:n,closeOnClick:!1,closeOnMove:I,focusAfterOpen:M,maxWidth:k,className:y,anchor:z,offset:B})),T=L.getElement(),L.on("open",()=>{t(0,E=!0),P(),K("open",L)}),L.on("close",()=>{t(0,E=!1),K("close",L)}),L.on("hover",()=>{K("hover",L)}))),l.$$.dirty[0]&8421384&&L&&r instanceof me.Marker&&(g==="click"?r.setPopup(L):r.getPopup()===L&&r.setPopup(void 0)),l.$$.dirty[0]&268468224&&V.includes(g)&&(i==null?void 0:i.type)===g&&(le(i),rt(Q,i=null,i)),l.$$.dirty[0]&268468224&&t(26,s=g==="hover"&&((i==null?void 0:i.type)==="mousemove"||(i==null?void 0:i.type)==="mouseenter")),l.$$.dirty[0]&352354304&&g==="hover"&&Q&&(s&&i&&je(i),t(0,E=(s||te)??!1)),l.$$.dirty[0]&12582914&&(be?L.setDOMContent(be):Z&&L.setHTML(Z)),l.$$.dirty[0]&8389632&&b&&L.setLngLat(b),l.$$.dirty[0]&41943045&&o){let m=L.isOpen();E&&!m?(L.addTo(o),Y==="opening"&&t(25,Y="justOpened")):!E&&m&&L.remove()}},[E,be,o,r,ne,F,a,Q,U,_,b,f,v,j,I,g,D,M,z,B,y,k,Z,L,te,Y,s,n,i,d,c,tt,nt]}class Lt extends de{constructor(e){super(),_e(this,e,Ot,Ct,ge,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function Tt(l){let e;const t=l[16].default,n=Ve(t,l,l[24],null);return{c(){n&&n.c()},m(s,o){n&&n.m(s,o),e=!0},p(s,o){n&&n.p&&(!e||o&16777216)&&Xe(n,t,s,s[24],e?xe(t,s[24],o,null):Ye(s[24]),null)},i(s){e||(O(n,s),e=!0)},o(s){S(n,s),e=!1},d(s){n&&n.d(s)}}}function jt(l){let e,t,n;function s(i){l[17](i)}let o={id:l[1],type:"symbol",source:l[2],sourceLayer:l[3],beforeId:l[4],beforeLayerType:l[5],paint:l[6],layout:l[7],filter:l[8],applyToClusters:l[9],minzoom:l[10],maxzoom:l[11],hoverCursor:l[12],manageHoverState:l[13],eventsIfTopMost:l[14],interactive:l[15],$$slots:{default:[Tt]},$$scope:{ctx:l}};return l[0]!==void 0&&(o.hovered=l[0]),e=new ft({props:o}),x.push(()=>oe(e,"hovered",s)),e.$on("click",l[18]),e.$on("dblclick",l[19]),e.$on("contextmenu",l[20]),e.$on("mouseenter",l[21]),e.$on("mousemove",l[22]),e.$on("mouseleave",l[23]),{c(){W(e.$$.fragment)},m(i,r){A(e,i,r),n=!0},p(i,[r]){const u={};r&2&&(u.id=i[1]),r&4&&(u.source=i[2]),r&8&&(u.sourceLayer=i[3]),r&16&&(u.beforeId=i[4]),r&32&&(u.beforeLayerType=i[5]),r&64&&(u.paint=i[6]),r&128&&(u.layout=i[7]),r&256&&(u.filter=i[8]),r&512&&(u.applyToClusters=i[9]),r&1024&&(u.minzoom=i[10]),r&2048&&(u.maxzoom=i[11]),r&4096&&(u.hoverCursor=i[12]),r&8192&&(u.manageHoverState=i[13]),r&16384&&(u.eventsIfTopMost=i[14]),r&32768&&(u.interactive=i[15]),r&16777216&&(u.$$scope={dirty:r,ctx:i}),!t&&r&1&&(t=!0,u.hovered=i[0],se(()=>t=!1)),e.$set(u)},i(i){n||(O(e.$$.fragment,i),n=!0)},o(i){S(e.$$.fragment,i),n=!1},d(i){R(e,i)}}}function St(l,e,t){let{$$slots:n={},$$scope:s}=e,{id:o=at("symbol")}=e,{source:i=void 0}=e,{sourceLayer:r=void 0}=e,{beforeId:u=void 0}=e,{beforeLayerType:c=void 0}=e,{paint:d=void 0}=e,{layout:_=void 0}=e,{filter:f=void 0}=e,{applyToClusters:v=void 0}=e,{minzoom:j=void 0}=e,{maxzoom:I=void 0}=e,{hoverCursor:g=void 0}=e,{manageHoverState:D=!1}=e,{hovered:M=null}=e,{eventsIfTopMost:z=!1}=e,{interactive:B=!0}=e;function y(a){M=a,t(0,M)}function k(a){ae.call(this,l,a)}function b(a){ae.call(this,l,a)}function Z(a){ae.call(this,l,a)}function E(a){ae.call(this,l,a)}function K(a){ae.call(this,l,a)}function F(a){ae.call(this,l,a)}return l.$$set=a=>{"id"in a&&t(1,o=a.id),"source"in a&&t(2,i=a.source),"sourceLayer"in a&&t(3,r=a.sourceLayer),"beforeId"in a&&t(4,u=a.beforeId),"beforeLayerType"in a&&t(5,c=a.beforeLayerType),"paint"in a&&t(6,d=a.paint),"layout"in a&&t(7,_=a.layout),"filter"in a&&t(8,f=a.filter),"applyToClusters"in a&&t(9,v=a.applyToClusters),"minzoom"in a&&t(10,j=a.minzoom),"maxzoom"in a&&t(11,I=a.maxzoom),"hoverCursor"in a&&t(12,g=a.hoverCursor),"manageHoverState"in a&&t(13,D=a.manageHoverState),"hovered"in a&&t(0,M=a.hovered),"eventsIfTopMost"in a&&t(14,z=a.eventsIfTopMost),"interactive"in a&&t(15,B=a.interactive),"$$scope"in a&&t(24,s=a.$$scope)},[M,o,i,r,u,c,d,_,f,v,j,I,g,D,z,B,n,y,k,b,Z,E,K,F,s]}class et extends de{constructor(e){super(),_e(this,e,St,jt,ge,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function Fe(l,e,t){const n=l.slice();return n[4]=e[t][0],n[5]=e[t][1],n}function Re(l){let e,t,n,s,o=l[4]+"",i,r;return{c(){e=C("div"),t=C("span"),s=N(),i=H(o),r=N(),G(t,"class",n="color-swatch "+l[1]+" svelte-1enycr6"),J(t,"background",l[5]),J(e,"display","flex"),J(e,"align-items","center"),J(e,"gap","6px")},m(u,c){h(u,e,c),w(e,t),w(e,s),w(e,i),w(e,r)},p(u,c){c&2&&n!==(n="color-swatch "+u[1]+" svelte-1enycr6")&&G(t,"class",n),c&1&&J(t,"background",u[5]),c&1&&o!==(o=u[4]+"")&&X(i,o)},d(u){u&&p(e)}}}function Mt(l){let e,t=Ne(Object.entries(l[0])),n=[];for(let s=0;s<t.length;s+=1)n[s]=Re(Fe(l,t,s));return{c(){e=C("div");for(let s=0;s<n.length;s+=1)n[s].c();J(e,"display","grid"),J(e,"grid-template-columns","repeat(auto-fill, calc("+l[2]+" - 10px))"),J(e,"gap","10px")},m(s,o){h(s,e,o);for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(e,null)},p(s,[o]){if(o&3){t=Ne(Object.entries(s[0]));let i;for(i=0;i<t.length;i+=1){const r=Fe(s,t,i);n[i]?n[i].p(r,o):(n[i]=Re(r),n[i].c(),n[i].m(e,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}o&4&&J(e,"grid-template-columns","repeat(auto-fill, calc("+s[2]+" - 10px))")},i:ie,o:ie,d(s){s&&p(e),ct(n,s)}}}function Gt(l,e,t){let n,{labelColors:s}=e,{swatchClass:o="rectangle"}=e,{itemsPerRow:i=2}=e;return l.$$set=r=>{"labelColors"in r&&t(0,s=r.labelColors),"swatchClass"in r&&t(1,o=r.swatchClass),"itemsPerRow"in r&&t(3,i=r.itemsPerRow)},l.$$.update=()=>{l.$$.dirty&8&&t(2,n=`${100/i}%`)},[s,o,n,i]}class It extends de{constructor(e){super(),_e(this,e,Gt,Mt,ge,{labelColors:0,swatchClass:1,itemsPerRow:3})}}let ve="match-linestrings-review";function zt(l){let e;return{c(){e=H("no matches (off-road)")},m(t,n){h(t,e,n)},p:ie,d(t){t&&p(e)}}}function Nt(l){let e=JSON.stringify(l[3].matching_sources)+"",t;return{c(){t=H(e)},m(n,s){h(n,t,s)},p(n,s){s&8&&e!==(e=JSON.stringify(n[3].matching_sources)+"")&&X(t,e)},d(n){n&&p(t)}}}function Dt(l){let e,t,n,s,o,i,r,u,c,d,_,f,v,j,I,g,D,M;function z(k,b){return k[3].matching_sources.length>0?Nt:zt}let B=z(l),y=B(l);return{c(){e=C("div"),t=C("h3"),n=H("Target "),s=H(l[0]),o=H(`:
    `),y.c(),i=N(),r=C("button"),r.innerHTML=`<kbd>Escape</kbd>
    - Back`,u=N(),c=C("h6"),c.textContent="Click sources to add or remove",d=N(),_=C("div"),f=C("button"),f.innerHTML=`<kbd>1</kbd>
    - Unreviewed`,v=N(),j=C("button"),j.innerHTML=`<kbd>2</kbd>
    - Not sure`,I=N(),g=C("button"),g.innerHTML=`<kbd>3</kbd>
    - Confirm correct`,G(r,"class","btn btn-secondary"),J(e,"display","flex"),J(e,"justify-content","space-between"),G(f,"class","btn btn-danger svelte-1tzb8bs"),ce(f,"current",l[3].reviewed=="unreviewed"),G(j,"class","btn btn-warning svelte-1tzb8bs"),ce(j,"current",l[3].reviewed=="not sure"),G(g,"class","btn btn-success svelte-1tzb8bs"),ce(g,"current",l[3].reviewed=="confirmed"),J(_,"display","flex"),J(_,"justify-content","space-between")},m(k,b){h(k,e,b),w(e,t),w(t,n),w(t,s),w(t,o),y.m(t,null),w(e,i),w(e,r),h(k,u,b),h(k,c,b),h(k,d,b),h(k,_,b),w(_,f),w(_,v),w(_,j),w(_,I),w(_,g),D||(M=[q(window,"keydown",l[4]),q(r,"click",function(){mt(l[2])&&l[2].apply(this,arguments)}),q(f,"click",l[6]),q(j,"click",l[7]),q(g,"click",l[8])],D=!0)},p(k,[b]){l=k,b&1&&X(s,l[0]),B===(B=z(l))&&y?y.p(l,b):(y.d(1),y=B(l),y&&(y.c(),y.m(t,null))),b&8&&ce(f,"current",l[3].reviewed=="unreviewed"),b&8&&ce(j,"current",l[3].reviewed=="not sure"),b&8&&ce(g,"current",l[3].reviewed=="confirmed")},i:ie,o:ie,d(k){k&&(p(e),p(u),p(c),p(d),p(_)),y.d(),D=!1,Le(M)}}}function Et(l,e,t){let n,{clickedTarget:s}=e,{targetGj:o}=e,{onConfirm:i}=e,{onCancel:r}=e;function u(f){f.target.tagName!="INPUT"&&(f.key=="1"?i("unreviewed"):f.key=="2"?i("not sure"):f.key=="3"?i("confirmed"):f.key=="Escape"&&r())}const c=()=>i("unreviewed"),d=()=>i("not sure"),_=()=>i("confirmed");return l.$$set=f=>{"clickedTarget"in f&&t(0,s=f.clickedTarget),"targetGj"in f&&t(5,o=f.targetGj),"onConfirm"in f&&t(1,i=f.onConfirm),"onCancel"in f&&t(2,r=f.onCancel)},l.$$.update=()=>{l.$$.dirty&33&&t(3,n=o.features[s].properties)},[s,i,r,n,u,o,c,d,_]}class Ht extends de{constructor(e){super(),_e(this,e,Et,Dt,ge,{clickedTarget:0,targetGj:5,onConfirm:1,onCancel:2})}}function Ae(l){let e,t,n,s,o=l[0].features.length+"",i,r,u=l[1].features.length+"",c,d,_=l[1].features.filter(qe).length+"",f,v,j,I,g,D,M,z,B,y=!l[3]&&We(l);return{c(){e=C("button"),t=H("Swap"),n=N(),s=C("p"),i=H(o),r=H(` sources and
    `),c=H(u),d=H(" targets , with "),f=H(_),v=H(" matching a source"),j=N(),I=C("button"),I.textContent="Start review",g=N(),y&&y.c(),D=ye(),G(e,"class","btn btn-secondary"),e.disabled=l[3],G(I,"class","btn btn-primary mb-5")},m(k,b){h(k,e,b),w(e,t),h(k,n,b),h(k,s,b),w(s,i),w(s,r),w(s,c),w(s,d),w(s,f),w(s,v),h(k,j,b),h(k,I,b),h(k,g,b),y&&y.m(k,b),h(k,D,b),M=!0,z||(B=[q(e,"click",l[8]),q(I,"click",l[11])],z=!0)},p(k,b){(!M||b&8)&&(e.disabled=k[3]),(!M||b&1)&&o!==(o=k[0].features.length+"")&&X(i,o),(!M||b&2)&&u!==(u=k[1].features.length+"")&&X(c,u),(!M||b&2)&&_!==(_=k[1].features.filter(qe).length+"")&&X(f,_),k[3]?y&&($(),S(y,1,1,()=>{y=null}),ee()):y?(y.p(k,b),b&8&&O(y,1)):(y=We(k),y.c(),O(y,1),y.m(D.parentNode,D))},i(k){M||(O(y),M=!0)},o(k){S(y),M=!1},d(k){k&&(p(e),p(n),p(s),p(j),p(I),p(g),p(D)),y&&y.d(k),z=!1,Le(B)}}}function We(l){let e,t,n;function s(i){l[12](i)}let o={onChange:l[6]};return l[4]!==void 0&&(o.options=l[4]),e=new _t({props:o}),x.push(()=>oe(e,"options",s)),{c(){W(e.$$.fragment)},m(i,r){A(e,i,r),n=!0},p(i,r){const u={};!t&&r&16&&(t=!0,u.options=i[4],se(()=>t=!1)),e.$set(u)},i(i){n||(O(e.$$.fragment,i),n=!0)},o(i){S(e.$$.fragment,i),n=!1},d(i){R(e,i)}}}function Pt(l){let e,t,n,s,o,i,r,u,c=l[0].features.length>0&&Ae(l);return{c(){e=C("label"),t=H(`Load two .geojson files
  `),n=C("input"),s=N(),c&&c.c(),o=ye(),G(n,"class","form-control"),G(n,"type","file"),n.multiple=!0,G(e,"class","form-label")},m(d,_){h(d,e,_),w(e,t),w(e,n),l[10](n),h(d,s,_),c&&c.m(d,_),h(d,o,_),i=!0,r||(u=q(n,"change",l[7]),r=!0)},p(d,[_]){d[0].features.length>0?c?(c.p(d,_),_&1&&O(c,1)):(c=Ae(d),c.c(),O(c,1),c.m(o.parentNode,o)):c&&($(),S(c,1,1,()=>{c=null}),ee())},i(d){i||(O(c),i=!0)},o(d){S(c),i=!1},d(d){d&&(p(e),p(s),p(o)),l[10](null),c&&c.d(d),r=!1,u()}}}function Ue(l){let e=0;for(let t of l.features)t.id=e++,t.properties??(t.properties={});return l}const qe=l=>l.properties.matching_sources.length>0;function Bt(l,e,t){let{sourceGj:n}=e,{targetGj:s}=e,{setupDone:o}=e,{zoomFit:i}=e,r=!1,u={buffer_meters:20,angle_diff_threshold:10,length_ratio_threshold:1.1,midpt_dist_threshold:15};function c(){var g;if(!r)try{let D=JSON.parse(dt(JSON.stringify(n),JSON.stringify(s),u));for(let[M,z]of s.features.entries())z.properties.matching_sources=D[M].matching_sources,(g=z.properties).reviewed??(g.reviewed="unreviewed");t(1,s)}catch(D){window.alert(`Bug: ${D}`)}}let d;async function _(g){if(!d.files)return;if(d.files.length!=2){window.alert("Select two GeoJSON files");return}try{let M=await d.files[0].text(),z=await d.files[1].text();t(0,n=Ue(JSON.parse(M))),t(1,s=Ue(JSON.parse(z))),"matching_sources"in s.features[0].properties?t(3,r=!0):"matching_sources"in n.features[0].properties&&(t(3,r=!0),t(0,[n,s]=[s,n],n,t(1,s))),i(),c()}catch(M){window.alert(`Bad input file: ${M}`)}}function f(){t(0,[n,s]=[s,n],n,t(1,s)),c()}function v(g){x[g?"unshift":"push"](()=>{d=g,t(5,d)})}const j=()=>t(2,o=!0);function I(g){u=g,t(4,u)}return l.$$set=g=>{"sourceGj"in g&&t(0,n=g.sourceGj),"targetGj"in g&&t(1,s=g.targetGj),"setupDone"in g&&t(2,o=g.setupDone),"zoomFit"in g&&t(9,i=g.zoomFit)},[n,s,o,r,u,d,c,_,f,i,v,j,I]}class Jt extends de{constructor(e){super(),_e(this,e,Bt,Pt,ge,{sourceGj:0,targetGj:1,setupDone:2,zoomFit:9})}}const{window:Ft}=ht;function Rt(l){let e,t,n,s,o,i,r,u,c,d,_,f,v,j,I=l[1].features.length+"",g,D,M,z,B,y,k,b,Z,E,K,F,a,Q,U,re,ue,V,L,te;return U=new It({props:{itemsPerRow:1,labelColors:{Confirmed:"green","Not sure":"orange",Unreviewed:"red",Source:"grey"}}}),{c(){e=C("div"),t=C("button"),t.textContent="Start over",n=N(),s=C("button"),s.textContent="Zoom to fit",o=N(),i=C("br"),r=N(),u=C("div"),c=C("div"),_=N(),f=C("p"),v=H(l[4]),j=H(" / "),g=H(I),D=H(" targets reviewed"),M=N(),z=C("button"),z.textContent="Download reviews",B=N(),y=C("div"),k=C("label"),b=C("input"),Z=H(`
          Show labels for matches`),E=N(),K=C("div"),F=C("div"),a=C("h5"),a.textContent="Legend",Q=N(),W(U.$$.fragment),re=N(),ue=C("p"),ue.textContent="Thinner lines have a match, thicker are off-road",G(t,"class","btn btn-outline-danger"),G(s,"class","btn btn-outline-secondary"),J(e,"display","flex"),J(e,"justify-content","space-between"),G(c,"class","progress-bar"),J(c,"width",`${100*l[4]/l[1].features.length}%`),G(u,"class","progress"),G(u,"role","progressbar"),G(u,"aria-valuenow",l[4]),G(u,"aria-valuemin","0"),G(u,"aria-valuemax",d=l[1].features.length),G(z,"class","btn btn-outline-success"),G(b,"class","form-check-input"),G(b,"type","checkbox"),G(k,"class","form-check-label mt-5"),G(a,"class","card-title"),G(F,"class","card-body"),G(K,"class","card")},m(T,P){h(T,e,P),w(e,t),w(e,n),w(e,s),h(T,o,P),h(T,i,P),h(T,r,P),h(T,u,P),w(u,c),h(T,_,P),h(T,f,P),w(f,v),w(f,j),w(f,g),w(f,D),h(T,M,P),h(T,z,P),h(T,B,P),h(T,y,P),w(y,k),w(k,b),b.checked=l[7],w(k,Z),h(T,E,P),h(T,K,P),w(K,F),w(F,a),w(F,Q),A(U,F,null),w(F,re),w(F,ue),V=!0,L||(te=[q(t,"click",l[14]),q(s,"click",l[9]),q(z,"click",l[13]),q(b,"change",l[24])],L=!0)},p(T,P){P&18&&J(c,"width",`${100*T[4]/T[1].features.length}%`),(!V||P&16)&&G(u,"aria-valuenow",T[4]),(!V||P&2&&d!==(d=T[1].features.length))&&G(u,"aria-valuemax",d),(!V||P&16)&&X(v,T[4]),(!V||P&2)&&I!==(I=T[1].features.length+"")&&X(g,I),P&128&&(b.checked=T[7])},i(T){V||(O(U.$$.fragment,T),V=!0)},o(T){S(U.$$.fragment,T),V=!1},d(T){T&&(p(e),p(o),p(i),p(r),p(u),p(_),p(f),p(M),p(z),p(B),p(y),p(E),p(K)),R(U),L=!1,Le(te)}}}function At(l){let e,t,n,s,o;function i(d){l[21](d)}function r(d){l[22](d)}function u(d){l[23](d)}let c={zoomFit:l[9]};return l[0]!==void 0&&(c.sourceGj=l[0]),l[1]!==void 0&&(c.targetGj=l[1]),l[2]!==void 0&&(c.setupDone=l[2]),e=new Jt({props:c}),x.push(()=>oe(e,"sourceGj",i)),x.push(()=>oe(e,"targetGj",r)),x.push(()=>oe(e,"setupDone",u)),{c(){W(e.$$.fragment)},m(d,_){A(e,d,_),o=!0},p(d,_){const f={};!t&&_&1&&(t=!0,f.sourceGj=d[0],se(()=>t=!1)),!n&&_&2&&(n=!0,f.targetGj=d[1],se(()=>n=!1)),!s&&_&4&&(s=!0,f.setupDone=d[2],se(()=>s=!1)),e.$set(f)},i(d){o||(O(e.$$.fragment,d),o=!0)},o(d){S(e.$$.fragment,d),o=!1},d(d){R(e,d)}}}function Wt(l){let e,t,n,s,o,i,r,u;const c=[At,Rt],d=[];function _(f,v){return f[2]?1:0}return i=_(l),r=d[i]=c[i](l),{c(){e=C("div"),t=C("h1"),t.textContent="Manually specify LineString matchings for test cases",n=N(),s=C("div"),s.innerHTML='<a class="icon-link mb-3" href="https://github.com/nptscot/match_linestrings/blob/main/tests/README.md" target="_blank">About <i class="fa-solid fa-arrow-up-right-from-square"></i></a>',o=N(),r.c(),G(e,"slot","left")},m(f,v){h(f,e,v),w(e,t),w(e,n),w(e,s),w(e,o),d[i].m(e,null),u=!0},p(f,v){let j=i;i=_(f),i===j?d[i].p(f,v):($(),S(d[j],1,1,()=>{d[j]=null}),ee(),r=d[i],r?r.p(f,v):(r=d[i]=c[i](f),r.c()),O(r,1),r.m(e,null))},i(f){u||(O(r),u=!0)},o(f){S(r),u=!1},d(f){f&&p(e),d[i].d()}}}function Ke(l){let e,t,n,s;const o=[qt,Ut],i=[];function r(u,c){return u[3]==null?0:1}return t=r(l),n=i[t]=o[t](l),{c(){e=C("div"),n.c(),G(e,"class","map-panel svelte-hr6p1s")},m(u,c){h(u,e,c),i[t].m(e,null),s=!0},p(u,c){let d=t;t=r(u),t===d?i[t].p(u,c):($(),S(i[d],1,1,()=>{i[d]=null}),ee(),n=i[t],n?n.p(u,c):(n=i[t]=o[t](u),n.c()),O(n,1),n.m(e,null))},i(u){s||(O(n),s=!0)},o(u){S(n),s=!1},d(u){u&&p(e),i[t].d()}}}function Ut(l){let e,t;return e=new Ht({props:{clickedTarget:l[3],targetGj:l[1],onConfirm:l[10],onCancel:l[18]}}),{c(){W(e.$$.fragment)},m(n,s){A(e,n,s),t=!0},p(n,s){const o={};s&8&&(o.clickedTarget=n[3]),s&2&&(o.targetGj=n[1]),s&8&&(o.onCancel=n[18]),e.$set(o)},i(n){t||(O(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){R(e,n)}}}function qt(l){let e,t,n,s,o,i,r;return{c(){e=C("button"),t=H("Goto "),n=C("kbd"),n.textContent="n",s=H(`
              ext unreviewed`),G(e,"class","btn btn-primary"),e.disabled=o=l[4]==l[1].features.length},m(u,c){h(u,e,c),w(e,t),w(e,n),w(e,s),i||(r=q(e,"click",l[11]),i=!0)},p(u,c){c&18&&o!==(o=u[4]==u[1].features.length)&&(e.disabled=o)},i:ie,o:ie,d(u){u&&p(e),i=!1,r()}}}function Qe(l){let e,t;return e=new Lt({props:{openOn:"hover",$$slots:{default:[Kt,({data:n})=>({25:n}),({data:n})=>n?33554432:0]},$$scope:{ctx:l}}}),{c(){W(e.$$.fragment)},m(n,s){A(e,n,s),t=!0},p(n,s){const o={};s&100663552&&(o.$$scope={dirty:s,ctx:n}),e.$set(o)},i(n){t||(O(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){R(e,n)}}}function Kt(l){let e,t=we(l[25]).id+"",n,s,o=l[8].includes(we(l[25]).id)?"remove":"add",i;return{c(){e=H("Source "),n=H(t),s=H(" -- click to "),i=H(o)},m(r,u){h(r,e,u),h(r,n,u),h(r,s,u),h(r,i,u)},p(r,u){u&33554432&&t!==(t=we(r[25]).id+"")&&X(n,t),u&33554688&&o!==(o=r[8].includes(we(r[25]).id)?"remove":"add")&&X(i,o)},d(r){r&&(p(e),p(n),p(s),p(i))}}}function Qt(l){let e,t,n=l[3]!=null&&Qe(l);return{c(){n&&n.c(),e=ye()},m(s,o){n&&n.m(s,o),h(s,e,o),t=!0},p(s,o){s[3]!=null?n?(n.p(s,o),o&8&&O(n,1)):(n=Qe(s),n.c(),O(n,1),n.m(e.parentNode,e)):n&&($(),S(n,1,1,()=>{n=null}),ee())},i(s){t||(O(n),t=!0)},o(s){S(n),t=!1},d(s){s&&p(e),n&&n.d(s)}}}function Zt(l){let e,t,n,s;return e=new $e({props:{manageHoverState:!0,paint:{"line-color":["case",["in",["id"],["literal",l[8]]],"blue","black"],"line-width":8,"line-opacity":Ee(.5,1)},hoverCursor:l[3]==null?void 0:"pointer",$$slots:{default:[Qt]},$$scope:{ctx:l}}}),e.$on("click",l[16]),n=new et({props:{paint:{"text-color":"white","text-halo-color":"grey","text-halo-width":4},layout:{"text-field":["to-string",["id"]],"text-size":16,"symbol-placement":"line",visibility:l[7]?"visible":"none"}}}),{c(){W(e.$$.fragment),t=N(),W(n.$$.fragment)},m(o,i){A(e,o,i),h(o,t,i),A(n,o,i),s=!0},p(o,i){const r={};i&256&&(r.paint={"line-color":["case",["in",["id"],["literal",o[8]]],"blue","black"],"line-width":8,"line-opacity":Ee(.5,1)}),i&8&&(r.hoverCursor=o[3]==null?void 0:"pointer"),i&67109128&&(r.$$scope={dirty:i,ctx:o}),e.$set(r);const u={};i&128&&(u.layout={"text-field":["to-string",["id"]],"text-size":16,"symbol-placement":"line",visibility:o[7]?"visible":"none"}),n.$set(u)},i(o){s||(O(e.$$.fragment,o),O(n.$$.fragment,o),s=!0)},o(o){S(e.$$.fragment,o),S(n.$$.fragment,o),s=!1},d(o){o&&p(t),R(e,o),R(n,o)}}}function Vt(l){let e,t,n,s;return e=new $e({props:{manageHoverState:!0,paint:{"line-width":["case",[">",["length",["get","matching_sources"]],0],8,16],"line-color":["match",["get","reviewed"],"unreviewed","red","not sure","orange","green"],"line-opacity":["case",["==",["id"],l[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,.3]},hoverCursor:"pointer"}}),e.$on("click",l[15]),n=new et({props:{paint:{"text-color":"white","text-halo-color":["match",["get","reviewed"],"unreviewed","red","not sure","orange","green"],"text-halo-width":4},layout:{"text-field":["case",[">",["length",["get","matching_sources"]],0],["to-string",["get","matching_sources"]],"off-road"],"text-size":16,"symbol-placement":"line",visibility:l[7]?"visible":"none"}}}),{c(){W(e.$$.fragment),t=N(),W(n.$$.fragment)},m(o,i){A(e,o,i),h(o,t,i),A(n,o,i),s=!0},p(o,i){const r={};i&8&&(r.paint={"line-width":["case",[">",["length",["get","matching_sources"]],0],8,16],"line-color":["match",["get","reviewed"],"unreviewed","red","not sure","orange","green"],"line-opacity":["case",["==",["id"],o[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,.3]}),e.$set(r);const u={};i&128&&(u.layout={"text-field":["case",[">",["length",["get","matching_sources"]],0],["to-string",["get","matching_sources"]],"off-road"],"text-size":16,"symbol-placement":"line",visibility:o[7]?"visible":"none"}),n.$set(u)},i(o){s||(O(e.$$.fragment,o),O(n.$$.fragment,o),s=!0)},o(o){S(e.$$.fragment,o),S(n.$$.fragment,o),s=!1},d(o){o&&p(t),R(e,o),R(n,o)}}}function Xt(l){let e,t,n,s,o,i,r,u;function c(f){l[17](f)}let d={choice:"Maptiler Dataviz"};l[6]!==void 0&&(d.style=l[6]),e=new wt({props:d}),x.push(()=>oe(e,"style",c));let _=l[2]&&Ke(l);return o=new De({props:{data:l[0],$$slots:{default:[Zt]},$$scope:{ctx:l}}}),r=new De({props:{data:l[1],$$slots:{default:[Vt]},$$scope:{ctx:l}}}),{c(){W(e.$$.fragment),n=N(),_&&_.c(),s=N(),W(o.$$.fragment),i=N(),W(r.$$.fragment)},m(f,v){A(e,f,v),h(f,n,v),_&&_.m(f,v),h(f,s,v),A(o,f,v),h(f,i,v),A(r,f,v),u=!0},p(f,v){const j={};!t&&v&64&&(t=!0,j.style=f[6],se(()=>t=!1)),e.$set(j),f[2]?_?(_.p(f,v),v&4&&O(_,1)):(_=Ke(f),_.c(),O(_,1),_.m(s.parentNode,s)):_&&($(),S(_,1,1,()=>{_=null}),ee());const I={};v&1&&(I.data=f[0]),v&67109256&&(I.$$scope={dirty:v,ctx:f}),o.$set(I);const g={};v&2&&(g.data=f[1]),v&67109e3&&(g.$$scope={dirty:v,ctx:f}),r.$set(g)},i(f){u||(O(e.$$.fragment,f),O(_),O(o.$$.fragment,f),O(r.$$.fragment,f),u=!0)},o(f){S(e.$$.fragment,f),S(_),S(o.$$.fragment,f),S(r.$$.fragment,f),u=!1},d(f){f&&(p(n),p(s),p(i)),R(e,f),_&&_.d(f),R(o,f),R(r,f)}}}function Yt(l){let e,t,n,s;function o(r){l[19](r)}let i={style:l[6],standardControls:!0,hash:!0,$$slots:{default:[Xt]},$$scope:{ctx:l}};return l[5]!==void 0&&(i.map=l[5]),t=new pt({props:i}),x.push(()=>oe(t,"map",o)),t.$on("error",l[20]),{c(){e=C("div"),W(t.$$.fragment),G(e,"slot","main"),J(e,"position","relative"),J(e,"width","100%"),J(e,"height","100vh")},m(r,u){h(r,e,u),A(t,e,null),s=!0},p(r,u){const c={};u&64&&(c.style=r[6]),u&67109343&&(c.$$scope={dirty:u,ctx:r}),!n&&u&32&&(n=!0,c.map=r[5],se(()=>n=!1)),t.$set(c)},i(r){s||(O(t.$$.fragment,r),s=!0)},o(r){S(t.$$.fragment,r),s=!1},d(r){r&&p(e),R(t)}}}function xt(l){let e,t,n,s;return e=new gt({props:{$$slots:{main:[Yt],left:[Wt]},$$scope:{ctx:l}}}),{c(){W(e.$$.fragment)},m(o,i){A(e,o,i),t=!0,n||(s=q(Ft,"keydown",l[12]),n=!0)},p(o,[i]){const r={};i&67109375&&(r.$$scope={dirty:i,ctx:o}),e.$set(r)},i(o){t||(O(e.$$.fragment,o),t=!0)},o(o){S(e.$$.fragment,o),t=!1},d(o){R(e,o),n=!1,s()}}}function $t(l,e,t){let n,s,o,i=bt["Maptiler Dataviz"],r=ke(),u=ke(),c=!1,d=!1,_=null;Ze(async()=>{await vt();try{let a=window.localStorage.getItem(ve);if(a){let Q=JSON.parse(a);t(0,[r,u]=Q,r,t(1,u)),t(2,c=!0),console.log(`Restored data from local storage ${ve}`)}}catch(a){console.log(`Couldn't restore data from local storage: ${a}`)}});function f(){let a={type:"FeatureCollection",features:[...r.features,...u.features]};o==null||o.fitBounds(He(a),{animate:!1,padding:10})}function v(a){if(_==null)throw new Error("impossible");t(1,u.features[_].properties.reviewed=a,u),t(1,u),t(3,_=null)}function j(){for(let a of u.features)if(a.properties.reviewed=="unreviewed"){o==null||o.fitBounds(He(a),{duration:600,padding:200}),t(3,_=a.id);return}}function I(a){a.target.tagName=="INPUT"||!c||a.key=="n"&&j()}function g(){kt("reviewed_targets.geojson",JSON.stringify(u))}function D(){window.confirm("Do you want to discard this review and start over?")&&(t(0,r=ke()),t(1,u=ke()),t(2,c=!1),t(3,_=null),t(7,d=!1),window.localStorage.removeItem(ve))}function M(a){c&&t(3,_=a.detail.features[0].id)}function z(a){if(!c||_==null)return;let Q=a.detail.features[0].id,U=u.features[_].properties;U.matching_sources.includes(Q)?U.matching_sources=U.matching_sources.filter(re=>re!=Q):U.matching_sources.push(Q),t(1,u)}function B(a){i=a,t(6,i)}const y=()=>t(3,_=null);function k(a){o=a,t(5,o)}const b=a=>{console.log(a.detail.error)};function Z(a){r=a,t(0,r)}function E(a){u=a,t(1,u)}function K(a){c=a,t(2,c)}function F(){d=this.checked,t(7,d)}return l.$$.update=()=>{l.$$.dirty&10&&t(8,n=_==null?[]:u.features[_].properties.matching_sources),l.$$.dirty&2&&t(4,s=u.features.filter(a=>a.properties.reviewed!="unreviewed").length),l.$$.dirty&23&&c&&(console.log(`Autosaving with ${s} reviewed targets`),window.localStorage.setItem(ve,JSON.stringify([r,u])))},[r,u,c,_,s,o,i,d,n,f,v,j,I,g,D,M,z,B,y,k,b,Z,E,K,F]}class en extends de{constructor(e){super(),_e(this,e,$t,xt,ge,{})}}new en({target:document.getElementById("app")});
