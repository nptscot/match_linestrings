import{S as ae,i as ce,s as me,k as _,t as G,e as C,n as Y,q as x,r as b,P as ke,Q as Ye,R as xe,T as $e,U as ge,o as Ue,V as et,W as se,X as tt,w as v,A as te,Y as nt,Z as lt,$ as ot,a0 as st,a1 as it,a2 as ne,a3 as rt,D as B,z as S,J as K,u as g,x as E,y as H,I as Ce,a4 as oe,v as R,a5 as ut,E as ft,H as at,B as ue,d as W,C as fe,g as q,h as U,L as ct,j as _e,M as mt,a6 as dt,G as pt,K as Te,N as Ke,O as Ne,a7 as be,_ as gt,F as De}from"./Settings-BJe39ZDU.js";function Ee(l){return(l==null?void 0:l.length)!==void 0?l:Array.from(l)}const _t=l=>({features:l[0]&16,data:l[0]&16,map:l[0]&4,close:l[0]&1}),Ie=l=>{var t;return{features:l[4],data:((t=l[4])==null?void 0:t[0])??null,map:l[2],close:l[31]}};function Pe(l){var o;let t,e,n=(((o=l[4])==null?void 0:o.length)||l[3]instanceof se.Marker)&&He(l);return{c(){t=v("div"),n&&n.c()},m(i,r){b(i,t,r),n&&n.m(t,null),l[32](t),e=!0},p(i,r){var s;(s=i[4])!=null&&s.length||i[3]instanceof se.Marker?n?(n.p(i,r),r[0]&24&&C(n,1)):(n=He(i),n.c(),C(n,1),n.m(t,null)):n&&(Y(),G(n,1,1,()=>{n=null}),x())},i(i){e||(C(n),e=!0)},o(i){G(n),e=!1},d(i){i&&_(t),n&&n.d(),l[32](null)}}}function He(l){let t;const e=l[30].default,n=nt(e,l,l[29],Ie);return{c(){n&&n.c()},m(o,i){n&&n.m(o,i),t=!0},p(o,i){n&&n.p&&(!t||i[0]&536870933)&&lt(n,e,o,o[29],t?st(e,o[29],i,_t):ot(o[29]),Ie)},i(o){t||(C(n,o),t=!0)},o(o){G(n,o),t=!1},d(o){n&&n.d(o)}}}function bt(l){let t,e,n=l[9].default&&Pe(l);return{c(){n&&n.c(),t=ke()},m(o,i){n&&n.m(o,i),b(o,t,i),e=!0},p(o,i){o[9].default?n?(n.p(o,i),i[0]&512&&C(n,1)):(n=Pe(o),n.c(),C(n,1),n.m(t.parentNode,t)):n&&(Y(),G(n,1,1,()=>{n=null}),x())},i(o){e||(C(n),e=!0)},o(o){G(n),e=!1},d(o){o&&_(t),n&&n.d(o)}}}function ht(l,t,e){let n,o,i,r,s,u,{$$slots:f={},$$scope:c}=t;const w=Ye(f);let{closeButton:m=void 0}=t,{closeOnClickOutside:y=!0}=t,{closeOnClickInside:T=!1}=t,{closeOnMove:I=!1}=t,{openOn:d="click"}=t,{openIfTopMost:P=!0}=t,{focusAfterOpen:O=!0}=t,{anchor:D=void 0}=t,{offset:F=void 0}=t,{popupClass:h=void 0}=t,{maxWidth:p=void 0}=t,{lngLat:L=void 0}=t,{html:k=void 0}=t,{open:M=!1}=t;const z=xe(),{map:Q,popupTarget:A,layerEvent:V,layer:ie,eventTopMost:N,markerClickManager:J}=$e();ge(l,Q,a=>e(2,i=a)),ge(l,A,a=>e(3,s=a)),ge(l,V,a=>e(28,r=a)),ge(l,ie,a=>e(35,u=a));const Ze=["click","dblclick","contextmenu"];let j,de=!1,X;function Qe(){if(!j)return;let a=j.getElement();!a||a===X||(X=a,d==="hover"&&(X.style.pointerEvents="none"),X.addEventListener("mouseenter",()=>{e(24,de=!0)},{passive:!0}),X.addEventListener("mouseleave",()=>{e(24,de=!1)},{passive:!0}),X.addEventListener("click",()=>{T&&e(0,M=!1)},{passive:!0}))}Ue(()=>{if(i)return i.on("click",pe),i.on("contextmenu",pe),J.add(Ge),typeof s=="string"&&(i.on("click",s,ee),i.on("dblclick",s,ee),i.on("contextmenu",s,ee),i.on("mousemove",s,Se),i.on("mouseleave",s,Me),i.on("touchstart",s,je),i.on("touchend",s,Le)),()=>{i!=null&&i.loaded()&&(j==null||j.remove(),i.off("click",pe),i.off("contextmenu",pe),J.remove(Ge),s instanceof se.Marker?s.getPopup()===j&&s.setPopup(void 0):typeof s=="string"&&(i.off("click",s,ee),i.off("dblclick",s,ee),i.off("contextmenu",s,ee),i.off("mousemove",s,Se),i.off("mouseleave",s,Me),i.off("touchstart",s,je),i.off("touchend",s,Le)))}});function ye(a){return P?!("marker"in a)&&!it(a)&&N(a)!==u:!1}let $=null,Z="normal";function Oe(a){"layerType"in a&&a.layerType==="deckgl"?(e(10,L=a.coordinate),e(4,$=a.object?[a.object]:null)):(e(10,L=a.lngLat),e(4,$=a.features??[]))}function ee(a){a.type!==d||ye(a)||(Oe(a),setTimeout(()=>e(0,M=!0)))}let le=null;function je(a){le=a.point}function Le(a){if(!le||d!=="hover")return;let we=le.dist(a.point);le=null,we<3&&(e(10,L=a.lngLat),e(4,$=a.features??[]),j.isOpen()?e(25,Z="justOpened"):(e(25,Z="opening"),e(0,M=!0)))}function Me(a){d!=="hover"||le||Z!=="normal"||(e(0,M=!1),e(4,$=null))}function Se(a){if(!(d!=="hover"||le||Z!=="normal")){if(ye(a)){e(0,M=!1),e(4,$=null);return}e(0,M=!0),e(4,$=a.features??[]),e(10,L=a.lngLat)}}function pe(a){if(Z==="justOpened"){e(25,Z="normal");return}if(!y)return;let we=[X,s instanceof se.Marker?s==null?void 0:s.getElement():null];M&&j.isOpen()&&!we.some(ve=>ve==null?void 0:ve.contains(a.originalEvent.target))&&(a.type==="contextmenu"&&d==="contextmenu"||a.type!=="contextmenu")&&e(0,M=!1)}function Ge(a){y&&M&&j.isOpen()&&a.marker!==s&&e(0,M=!1)}et(()=>{i&&(j!=null&&j.isOpen())&&j.remove()});let re;const Ve=()=>e(0,M=!1);function Xe(a){te[a?"unshift":"push"](()=>{re=a,e(1,re)})}return l.$$set=a=>{"closeButton"in a&&e(11,m=a.closeButton),"closeOnClickOutside"in a&&e(12,y=a.closeOnClickOutside),"closeOnClickInside"in a&&e(13,T=a.closeOnClickInside),"closeOnMove"in a&&e(14,I=a.closeOnMove),"openOn"in a&&e(15,d=a.openOn),"openIfTopMost"in a&&e(16,P=a.openIfTopMost),"focusAfterOpen"in a&&e(17,O=a.focusAfterOpen),"anchor"in a&&e(18,D=a.anchor),"offset"in a&&e(19,F=a.offset),"popupClass"in a&&e(20,h=a.popupClass),"maxWidth"in a&&e(21,p=a.maxWidth),"lngLat"in a&&e(10,L=a.lngLat),"html"in a&&e(22,k=a.html),"open"in a&&e(0,M=a.open),"$$scope"in a&&e(29,c=a.$$scope)},l.$$.update=()=>{if(l.$$.dirty[0]&14336&&e(27,n=m??(!y&&!T)),l.$$.dirty[0]&146685952&&(j||(e(23,j=new se.Popup({closeButton:n,closeOnClick:!1,closeOnMove:I,focusAfterOpen:O,maxWidth:p,className:h,anchor:D,offset:F})),X=j.getElement(),j.on("open",()=>{e(0,M=!0),Qe(),z("open",j)}),j.on("close",()=>{e(0,M=!1),z("close",j)}),j.on("hover",()=>{z("hover",j)}))),l.$$.dirty[0]&8421384&&j&&s instanceof se.Marker&&(d==="click"?s.setPopup(j):s.getPopup()===j&&s.setPopup(void 0)),l.$$.dirty[0]&268468224&&Ze.includes(d)&&(r==null?void 0:r.type)===d&&(ee(r),tt(V,r=null,r)),l.$$.dirty[0]&268468224&&e(26,o=d==="hover"&&((r==null?void 0:r.type)==="mousemove"||(r==null?void 0:r.type)==="mouseenter")),l.$$.dirty[0]&352354304&&d==="hover"&&V&&(o&&r&&Oe(r),e(0,M=(o||de)??!1)),l.$$.dirty[0]&12582914&&(re?j.setDOMContent(re):k&&j.setHTML(k)),l.$$.dirty[0]&8389632&&L&&j.setLngLat(L),l.$$.dirty[0]&41943045&&i){let a=j.isOpen();M&&!a?(j.addTo(i),Z==="opening"&&e(25,Z="justOpened")):!M&&a&&j.remove()}},[M,re,i,s,$,Q,A,V,ie,w,L,m,y,T,I,d,P,O,D,F,h,p,k,j,de,Z,o,n,r,c,f,Ve,Xe]}class kt extends ae{constructor(t){super(),ce(this,t,ht,bt,me,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function Je(l,t,e){const n=l.slice();return n[4]=t[e][0],n[5]=t[e][1],n}function Be(l){let t,e,n,o,i=l[4]+"",r,s;return{c(){t=v("div"),e=v("span"),o=E(),r=H(i),s=E(),S(e,"class",n="color-swatch "+l[1]+" svelte-1enycr6"),B(e,"background",l[5]),B(t,"display","flex"),B(t,"align-items","center"),B(t,"gap","6px")},m(u,f){b(u,t,f),g(t,e),g(t,o),g(t,r),g(t,s)},p(u,f){f&2&&n!==(n="color-swatch "+u[1]+" svelte-1enycr6")&&S(e,"class",n),f&1&&B(e,"background",u[5]),f&1&&i!==(i=u[4]+"")&&K(r,i)},d(u){u&&_(t)}}}function wt(l){let t,e=Ee(Object.entries(l[0])),n=[];for(let o=0;o<e.length;o+=1)n[o]=Be(Je(l,e,o));return{c(){t=v("div");for(let o=0;o<n.length;o+=1)n[o].c();B(t,"display","grid"),B(t,"grid-template-columns","repeat(auto-fill, calc("+l[2]+" - 10px))"),B(t,"gap","10px")},m(o,i){b(o,t,i);for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(t,null)},p(o,[i]){if(i&3){e=Ee(Object.entries(o[0]));let r;for(r=0;r<e.length;r+=1){const s=Je(o,e,r);n[r]?n[r].p(s,i):(n[r]=Be(s),n[r].c(),n[r].m(t,null))}for(;r<n.length;r+=1)n[r].d(1);n.length=e.length}i&4&&B(t,"grid-template-columns","repeat(auto-fill, calc("+o[2]+" - 10px))")},i:ne,o:ne,d(o){o&&_(t),rt(n,o)}}}function vt(l,t,e){let n,{labelColors:o}=t,{swatchClass:i="rectangle"}=t,{itemsPerRow:r=2}=t;return l.$$set=s=>{"labelColors"in s&&e(0,o=s.labelColors),"swatchClass"in s&&e(1,i=s.swatchClass),"itemsPerRow"in s&&e(3,r=s.itemsPerRow)},l.$$.update=()=>{l.$$.dirty&8&&e(2,n=`${100/r}%`)},[o,i,n,r]}class Ct extends ae{constructor(t){super(),ce(this,t,vt,wt,me,{labelColors:0,swatchClass:1,itemsPerRow:3})}}let he="match-linestrings-review";function yt(l){let t,e,n,o,i,r=JSON.stringify(l[1].features[l[0]].properties.matching_sources)+"",s,u,f,c,w,m,y,T,I,d,P,O,D,F;return{c(){t=v("div"),e=v("h3"),n=H("Target "),o=H(l[0]),i=H(": "),s=H(r),u=E(),f=v("button"),f.innerHTML=`<kbd>Escape</kbd>
    - Back`,c=E(),w=v("h6"),w.textContent="Click sources to add or remove",m=E(),y=v("div"),T=v("button"),T.innerHTML=`<kbd>1</kbd>
    - Unreviewed`,I=E(),d=v("button"),d.innerHTML=`<kbd>2</kbd>
    - Not sure`,P=E(),O=v("button"),O.innerHTML=`<kbd>3</kbd>
    - Confirm correct`,S(f,"class","btn btn-secondary"),B(t,"display","flex"),B(t,"justify-content","space-between"),S(T,"class","btn btn-danger svelte-1tzb8bs"),oe(T,"current",l[4]=="unreviewed"),S(d,"class","btn btn-warning svelte-1tzb8bs"),oe(d,"current",l[4]=="not sure"),S(O,"class","btn btn-success svelte-1tzb8bs"),oe(O,"current",l[4]=="confirmed"),B(y,"display","flex"),B(y,"justify-content","space-between")},m(h,p){b(h,t,p),g(t,e),g(e,n),g(e,o),g(e,i),g(e,s),g(t,u),g(t,f),b(h,c,p),b(h,w,p),b(h,m,p),b(h,y,p),g(y,T),g(y,I),g(y,d),g(y,P),g(y,O),D||(F=[R(window,"keydown",l[5]),R(f,"click",function(){ut(l[3])&&l[3].apply(this,arguments)}),R(T,"click",l[6]),R(d,"click",l[7]),R(O,"click",l[8])],D=!0)},p(h,[p]){l=h,p&1&&K(o,l[0]),p&3&&r!==(r=JSON.stringify(l[1].features[l[0]].properties.matching_sources)+"")&&K(s,r),p&16&&oe(T,"current",l[4]=="unreviewed"),p&16&&oe(d,"current",l[4]=="not sure"),p&16&&oe(O,"current",l[4]=="confirmed")},i:ne,o:ne,d(h){h&&(_(t),_(c),_(w),_(m),_(y)),D=!1,Ce(F)}}}function Ot(l,t,e){let n,{clickedTarget:o}=t,{targetGj:i}=t,{onConfirm:r}=t,{onCancel:s}=t;function u(m){m.target.tagName!="INPUT"&&(m.key=="1"?r("unreviewed"):m.key=="2"?r("not sure"):m.key=="3"?r("confirmed"):m.key=="Escape"&&s())}const f=()=>r("unreviewed"),c=()=>r("not sure"),w=()=>r("confirmed");return l.$$set=m=>{"clickedTarget"in m&&e(0,o=m.clickedTarget),"targetGj"in m&&e(1,i=m.targetGj),"onConfirm"in m&&e(2,r=m.onConfirm),"onCancel"in m&&e(3,s=m.onCancel)},l.$$.update=()=>{l.$$.dirty&3&&e(4,n=i.features[o].properties.reviewed)},[o,i,r,s,n,u,f,c,w]}class jt extends ae{constructor(t){super(),ce(this,t,Ot,yt,me,{clickedTarget:0,targetGj:1,onConfirm:2,onCancel:3})}}function Fe(l){let t,e,n,o,i=l[0].features.length+"",r,s,u=l[1].features.length+"",f,c,w=l[1].features.filter(Ae).length+"",m,y,T,I,d,P,O,D,F,h=!l[3]&&Re(l);return{c(){t=v("button"),e=H("Swap"),n=E(),o=v("p"),r=H(i),s=H(` sources and
    `),f=H(u),c=H(" targets , with "),m=H(w),y=H(" matching a source"),T=E(),I=v("button"),I.textContent="Start review",d=E(),h&&h.c(),P=ke(),S(t,"class","btn btn-secondary"),t.disabled=l[3],S(I,"class","btn btn-primary mb-5")},m(p,L){b(p,t,L),g(t,e),b(p,n,L),b(p,o,L),g(o,r),g(o,s),g(o,f),g(o,c),g(o,m),g(o,y),b(p,T,L),b(p,I,L),b(p,d,L),h&&h.m(p,L),b(p,P,L),O=!0,D||(F=[R(t,"click",l[8]),R(I,"click",l[11])],D=!0)},p(p,L){(!O||L&8)&&(t.disabled=p[3]),(!O||L&1)&&i!==(i=p[0].features.length+"")&&K(r,i),(!O||L&2)&&u!==(u=p[1].features.length+"")&&K(f,u),(!O||L&2)&&w!==(w=p[1].features.filter(Ae).length+"")&&K(m,w),p[3]?h&&(Y(),G(h,1,1,()=>{h=null}),x()):h?(h.p(p,L),L&8&&C(h,1)):(h=Re(p),h.c(),C(h,1),h.m(P.parentNode,P))},i(p){O||(C(h),O=!0)},o(p){G(h),O=!1},d(p){p&&(_(t),_(n),_(o),_(T),_(I),_(d),_(P)),h&&h.d(p),D=!1,Ce(F)}}}function Re(l){let t,e,n;function o(r){l[12](r)}let i={onChange:l[6]};return l[4]!==void 0&&(i.options=l[4]),t=new at({props:i}),te.push(()=>ue(t,"options",o)),{c(){U(t.$$.fragment)},m(r,s){q(t,r,s),n=!0},p(r,s){const u={};!e&&s&16&&(e=!0,u.options=r[4],fe(()=>e=!1)),t.$set(u)},i(r){n||(C(t.$$.fragment,r),n=!0)},o(r){G(t.$$.fragment,r),n=!1},d(r){W(t,r)}}}function Lt(l){let t,e,n,o,i,r,s,u,f=l[0].features.length>0&&Fe(l);return{c(){t=v("label"),e=H(`Load two .geojson files
  `),n=v("input"),o=E(),f&&f.c(),i=ke(),S(n,"class","form-control"),S(n,"type","file"),n.multiple=!0,S(t,"class","form-label")},m(c,w){b(c,t,w),g(t,e),g(t,n),l[10](n),b(c,o,w),f&&f.m(c,w),b(c,i,w),r=!0,s||(u=R(n,"change",l[7]),s=!0)},p(c,[w]){c[0].features.length>0?f?(f.p(c,w),w&1&&C(f,1)):(f=Fe(c),f.c(),C(f,1),f.m(i.parentNode,i)):f&&(Y(),G(f,1,1,()=>{f=null}),x())},i(c){r||(C(f),r=!0)},o(c){G(f),r=!1},d(c){c&&(_(t),_(o),_(i)),l[10](null),f&&f.d(c),s=!1,u()}}}function ze(l){let t=0;for(let e of l.features)e.id=t++,e.properties??(e.properties={});return l}const Ae=l=>l.properties.matching_sources.length>0;function Mt(l,t,e){let{sourceGj:n}=t,{targetGj:o}=t,{setupDone:i}=t,{zoomFit:r}=t,s=!1,u={buffer_meters:20,angle_diff_threshold:10,length_ratio_threshold:1.1,midpt_dist_threshold:15};function f(){var d;if(!s)try{let P=JSON.parse(ft(JSON.stringify(n),JSON.stringify(o),u));for(let[O,D]of o.features.entries())D.properties.matching_sources=P[O].matching_sources,(d=D.properties).reviewed??(d.reviewed="unreviewed");e(1,o)}catch(P){window.alert(`Bug: ${P}`)}}let c;async function w(d){if(!c.files)return;if(c.files.length!=2){window.alert("Select two GeoJSON files");return}try{let O=await c.files[0].text(),D=await c.files[1].text();e(0,n=ze(JSON.parse(O))),e(1,o=ze(JSON.parse(D))),"matching_sources"in o.features[0].properties?e(3,s=!0):"matching_sources"in n.features[0].properties&&(e(3,s=!0),e(0,[n,o]=[o,n],n,e(1,o))),r(),f()}catch(O){window.alert(`Bad input file: ${O}`)}}function m(){e(0,[n,o]=[o,n],n,e(1,o)),f()}function y(d){te[d?"unshift":"push"](()=>{c=d,e(5,c)})}const T=()=>e(2,i=!0);function I(d){u=d,e(4,u)}return l.$$set=d=>{"sourceGj"in d&&e(0,n=d.sourceGj),"targetGj"in d&&e(1,o=d.targetGj),"setupDone"in d&&e(2,i=d.setupDone),"zoomFit"in d&&e(9,r=d.zoomFit)},[n,o,i,s,u,c,f,w,m,r,y,T,I]}class St extends ae{constructor(t){super(),ce(this,t,Mt,Lt,me,{sourceGj:0,targetGj:1,setupDone:2,zoomFit:9})}}const{window:Gt}=dt;function Tt(l){let t,e,n,o,i,r,s,u,f,c,w,m,y,T,I=l[1].features.length+"",d,P,O,D,F,h,p,L,k,M,z,Q,A,V,ie;return M=new Ct({props:{itemsPerRow:1,labelColors:{Confirmed:"green","Not sure":"orange",Unreviewed:"red",Source:"grey"}}}),{c(){t=v("div"),e=v("button"),e.textContent="Start over",n=E(),o=v("button"),o.textContent="Zoom to fit",i=E(),r=v("br"),s=E(),u=v("div"),f=v("div"),w=E(),m=v("p"),y=H(l[4]),T=H(" / "),d=H(I),P=H(" targets reviewed"),O=E(),D=v("button"),D.textContent="Download reviews",F=E(),h=v("div"),p=v("div"),L=v("h5"),L.textContent="Legend",k=E(),U(M.$$.fragment),z=E(),Q=v("p"),Q.textContent="Thinner lines have a match, thicker are off-road",S(e,"class","btn btn-outline-danger"),S(o,"class","btn btn-outline-secondary"),B(t,"display","flex"),B(t,"justify-content","space-between"),S(f,"class","progress-bar"),B(f,"width",`${100*l[4]/l[1].features.length}%`),S(u,"class","progress"),S(u,"role","progressbar"),S(u,"aria-valuenow",l[4]),S(u,"aria-valuemin","0"),S(u,"aria-valuemax",c=l[1].features.length),S(D,"class","btn btn-outline-success"),S(L,"class","card-title"),S(p,"class","card-body"),S(h,"class","card mt-5")},m(N,J){b(N,t,J),g(t,e),g(t,n),g(t,o),b(N,i,J),b(N,r,J),b(N,s,J),b(N,u,J),g(u,f),b(N,w,J),b(N,m,J),g(m,y),g(m,T),g(m,d),g(m,P),b(N,O,J),b(N,D,J),b(N,F,J),b(N,h,J),g(h,p),g(p,L),g(p,k),q(M,p,null),g(p,z),g(p,Q),A=!0,V||(ie=[R(e,"click",l[12]),R(o,"click",l[7]),R(D,"click",l[11])],V=!0)},p(N,J){J&18&&B(f,"width",`${100*N[4]/N[1].features.length}%`),(!A||J&16)&&S(u,"aria-valuenow",N[4]),(!A||J&2&&c!==(c=N[1].features.length))&&S(u,"aria-valuemax",c),(!A||J&16)&&K(y,N[4]),(!A||J&2)&&I!==(I=N[1].features.length+"")&&K(d,I)},i(N){A||(C(M.$$.fragment,N),A=!0)},o(N){G(M.$$.fragment,N),A=!1},d(N){N&&(_(t),_(i),_(r),_(s),_(u),_(w),_(m),_(O),_(D),_(F),_(h)),W(M),V=!1,Ce(ie)}}}function Nt(l){let t,e,n,o,i;function r(c){l[18](c)}function s(c){l[19](c)}function u(c){l[20](c)}let f={zoomFit:l[7]};return l[0]!==void 0&&(f.sourceGj=l[0]),l[1]!==void 0&&(f.targetGj=l[1]),l[2]!==void 0&&(f.setupDone=l[2]),t=new St({props:f}),te.push(()=>ue(t,"sourceGj",r)),te.push(()=>ue(t,"targetGj",s)),te.push(()=>ue(t,"setupDone",u)),{c(){U(t.$$.fragment)},m(c,w){q(t,c,w),i=!0},p(c,w){const m={};!e&&w&1&&(e=!0,m.sourceGj=c[0],fe(()=>e=!1)),!n&&w&2&&(n=!0,m.targetGj=c[1],fe(()=>n=!1)),!o&&w&4&&(o=!0,m.setupDone=c[2],fe(()=>o=!1)),t.$set(m)},i(c){i||(C(t.$$.fragment,c),i=!0)},o(c){G(t.$$.fragment,c),i=!1},d(c){W(t,c)}}}function Dt(l){let t,e,n,o,i,r,s,u;const f=[Nt,Tt],c=[];function w(m,y){return m[2]?1:0}return r=w(l),s=c[r]=f[r](l),{c(){t=v("div"),e=v("h1"),e.textContent="Manually specify LineString matchings for test cases",n=E(),o=v("div"),o.innerHTML='<a class="icon-link mb-3" href="https://github.com/nptscot/match_linestrings/blob/main/tests/README.md" target="_blank">About <i class="fa-solid fa-arrow-up-right-from-square"></i></a>',i=E(),s.c(),S(t,"slot","left")},m(m,y){b(m,t,y),g(t,e),g(t,n),g(t,o),g(t,i),c[r].m(t,null),u=!0},p(m,y){let T=r;r=w(m),r===T?c[r].p(m,y):(Y(),G(c[T],1,1,()=>{c[T]=null}),x(),s=c[r],s?s.p(m,y):(s=c[r]=f[r](m),s.c()),C(s,1),s.m(t,null))},i(m){u||(C(s),u=!0)},o(m){G(s),u=!1},d(m){m&&_(t),c[r].d()}}}function We(l){let t,e,n,o;const i=[It,Et],r=[];function s(u,f){return u[3]==null?0:1}return e=s(l),n=r[e]=i[e](l),{c(){t=v("div"),n.c(),S(t,"class","map-panel svelte-hr6p1s")},m(u,f){b(u,t,f),r[e].m(t,null),o=!0},p(u,f){let c=e;e=s(u),e===c?r[e].p(u,f):(Y(),G(r[c],1,1,()=>{r[c]=null}),x(),n=r[e],n?n.p(u,f):(n=r[e]=i[e](u),n.c()),C(n,1),n.m(t,null))},i(u){o||(C(n),o=!0)},o(u){G(n),o=!1},d(u){u&&_(t),r[e].d()}}}function Et(l){let t,e;return t=new jt({props:{clickedTarget:l[3],targetGj:l[1],onConfirm:l[8],onCancel:l[15]}}),{c(){U(t.$$.fragment)},m(n,o){q(t,n,o),e=!0},p(n,o){const i={};o&8&&(i.clickedTarget=n[3]),o&2&&(i.targetGj=n[1]),o&8&&(i.onCancel=n[15]),t.$set(i)},i(n){e||(C(t.$$.fragment,n),e=!0)},o(n){G(t.$$.fragment,n),e=!1},d(n){W(t,n)}}}function It(l){let t,e,n;return{c(){t=v("button"),t.innerHTML=`Goto <kbd>n</kbd>
              ext unreviewed`,S(t,"class","btn btn-primary")},m(o,i){b(o,t,i),e||(n=R(t,"click",l[9]),e=!0)},p:ne,i:ne,o:ne,d(o){o&&_(t),e=!1,n()}}}function qe(l){let t,e;return t=new kt({props:{openOn:"hover",$$slots:{default:[Pt,({data:n})=>({21:n}),({data:n})=>n?2097152:0]},$$scope:{ctx:l}}}),{c(){U(t.$$.fragment)},m(n,o){q(t,n,o),e=!0},p(n,o){const i={};o&6291520&&(i.$$scope={dirty:o,ctx:n}),t.$set(i)},i(n){e||(C(t.$$.fragment,n),e=!0)},o(n){G(t.$$.fragment,n),e=!1},d(n){W(t,n)}}}function Pt(l){let t,e=be(l[21]).id+"",n,o,i=l[6].includes(be(l[21]).id)?"remove":"add",r;return{c(){t=H("Source "),n=H(e),o=H(" -- click to "),r=H(i)},m(s,u){b(s,t,u),b(s,n,u),b(s,o,u),b(s,r,u)},p(s,u){u&2097152&&e!==(e=be(s[21]).id+"")&&K(n,e),u&2097216&&i!==(i=s[6].includes(be(s[21]).id)?"remove":"add")&&K(r,i)},d(s){s&&(_(t),_(n),_(o),_(r))}}}function Ht(l){let t,e,n=l[3]!=null&&qe(l);return{c(){n&&n.c(),t=ke()},m(o,i){n&&n.m(o,i),b(o,t,i),e=!0},p(o,i){o[3]!=null?n?(n.p(o,i),i&8&&C(n,1)):(n=qe(o),n.c(),C(n,1),n.m(t.parentNode,t)):n&&(Y(),G(n,1,1,()=>{n=null}),x())},i(o){e||(C(n),e=!0)},o(o){G(n),e=!1},d(o){o&&_(t),n&&n.d(o)}}}function Jt(l){let t,e;return t=new Ke({props:{manageHoverState:!0,paint:{"line-color":["case",["in",["id"],["literal",l[6]]],"blue","black"],"line-width":8,"line-opacity":Ne(.5,1)},hoverCursor:l[3]==null?void 0:"pointer",$$slots:{default:[Ht]},$$scope:{ctx:l}}}),t.$on("click",l[14]),{c(){U(t.$$.fragment)},m(n,o){q(t,n,o),e=!0},p(n,o){const i={};o&64&&(i.paint={"line-color":["case",["in",["id"],["literal",n[6]]],"blue","black"],"line-width":8,"line-opacity":Ne(.5,1)}),o&8&&(i.hoverCursor=n[3]==null?void 0:"pointer"),o&4194376&&(i.$$scope={dirty:o,ctx:n}),t.$set(i)},i(n){e||(C(t.$$.fragment,n),e=!0)},o(n){G(t.$$.fragment,n),e=!1},d(n){W(t,n)}}}function Bt(l){let t,e;return t=new Ke({props:{manageHoverState:!0,paint:{"line-width":["case",[">",["length",["get","matching_sources"]],0],8,16],"line-color":["match",["get","reviewed"],"unreviewed","red","not sure","orange","green"],"line-opacity":["case",["==",["id"],l[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,.3]},hoverCursor:"pointer"}}),t.$on("click",l[13]),{c(){U(t.$$.fragment)},m(n,o){q(t,n,o),e=!0},p(n,o){const i={};o&8&&(i.paint={"line-width":["case",[">",["length",["get","matching_sources"]],0],8,16],"line-color":["match",["get","reviewed"],"unreviewed","red","not sure","orange","green"],"line-opacity":["case",["==",["id"],n[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,.3]}),t.$set(i)},i(n){e||(C(t.$$.fragment,n),e=!0)},o(n){G(t.$$.fragment,n),e=!1},d(n){W(t,n)}}}function Ft(l){let t,e,n,o,i,r=l[2]&&We(l);return e=new Te({props:{data:l[0],$$slots:{default:[Jt]},$$scope:{ctx:l}}}),o=new Te({props:{data:l[1],$$slots:{default:[Bt]},$$scope:{ctx:l}}}),{c(){r&&r.c(),t=E(),U(e.$$.fragment),n=E(),U(o.$$.fragment)},m(s,u){r&&r.m(s,u),b(s,t,u),q(e,s,u),b(s,n,u),q(o,s,u),i=!0},p(s,u){s[2]?r?(r.p(s,u),u&4&&C(r,1)):(r=We(s),r.c(),C(r,1),r.m(t.parentNode,t)):r&&(Y(),G(r,1,1,()=>{r=null}),x());const f={};u&1&&(f.data=s[0]),u&4194376&&(f.$$scope={dirty:u,ctx:s}),e.$set(f);const c={};u&2&&(c.data=s[1]),u&4194312&&(c.$$scope={dirty:u,ctx:s}),o.$set(c)},i(s){i||(C(r),C(e.$$.fragment,s),C(o.$$.fragment,s),i=!0)},o(s){G(r),G(e.$$.fragment,s),G(o.$$.fragment,s),i=!1},d(s){s&&(_(t),_(n)),r&&r.d(s),W(e,s),W(o,s)}}}function Rt(l){let t,e,n,o;function i(s){l[16](s)}let r={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Ft]},$$scope:{ctx:l}};return l[5]!==void 0&&(r.map=l[5]),e=new mt({props:r}),te.push(()=>ue(e,"map",i)),e.$on("error",l[17]),{c(){t=v("div"),U(e.$$.fragment),S(t,"slot","main"),B(t,"position","relative"),B(t,"width","100%"),B(t,"height","100vh")},m(s,u){b(s,t,u),q(e,t,null),o=!0},p(s,u){const f={};u&4194383&&(f.$$scope={dirty:u,ctx:s}),!n&&u&32&&(n=!0,f.map=s[5],fe(()=>n=!1)),e.$set(f)},i(s){o||(C(e.$$.fragment,s),o=!0)},o(s){G(e.$$.fragment,s),o=!1},d(s){s&&_(t),W(e)}}}function zt(l){let t,e,n,o;return t=new ct({props:{$$slots:{main:[Rt],left:[Dt]},$$scope:{ctx:l}}}),{c(){U(t.$$.fragment)},m(i,r){q(t,i,r),e=!0,n||(o=R(Gt,"keydown",l[10]),n=!0)},p(i,[r]){const s={};r&4194431&&(s.$$scope={dirty:r,ctx:i}),t.$set(s)},i(i){e||(C(t.$$.fragment,i),e=!0)},o(i){G(t.$$.fragment,i),e=!1},d(i){W(t,i),n=!1,o()}}}function At(l,t,e){let n,o,i,r=_e(),s=_e(),u=!1,f=null;Ue(async()=>{await gt();try{let k=window.localStorage.getItem(he);if(k){let M=JSON.parse(k);e(0,[r,s]=M,r,e(1,s)),e(2,u=!0),console.log(`Restored data from local storage ${he}`)}}catch(k){console.log(`Couldn't restore data from local storage: ${k}`)}});function c(){let k={type:"FeatureCollection",features:[...r.features,...s.features]};i==null||i.fitBounds(De(k),{animate:!1,padding:10})}function w(k){if(f==null)throw new Error("impossible");e(1,s.features[f].properties.reviewed=k,s),e(1,s),e(3,f=null)}function m(){for(let k of s.features)if(k.properties.reviewed=="unreviewed"){i==null||i.fitBounds(De(k),{duration:600,padding:200}),e(3,f=k.id);return}}function y(k){k.target.tagName=="INPUT"||!u||k.key=="n"&&m()}function T(){pt("reviewed_targets.geojson",JSON.stringify(s))}function I(){window.confirm("Do you want to discard this review and start over?")&&(e(0,r=_e()),e(1,s=_e()),e(2,u=!1),e(3,f=null),window.localStorage.removeItem(he))}function d(k){u&&e(3,f=k.detail.features[0].id)}function P(k){if(!u||f==null)return;let M=k.detail.features[0].id,z=s.features[f].properties;z.matching_sources.includes(M)?z.matching_sources=z.matching_sources.filter(Q=>Q!=M):z.matching_sources.push(M),e(1,s)}const O=()=>e(3,f=null);function D(k){i=k,e(5,i)}const F=k=>{console.log(k.detail.error)};function h(k){r=k,e(0,r)}function p(k){s=k,e(1,s)}function L(k){u=k,e(2,u)}return l.$$.update=()=>{l.$$.dirty&10&&e(6,n=f==null?[]:s.features[f].properties.matching_sources),l.$$.dirty&2&&e(4,o=s.features.filter(k=>k.properties.reviewed!="unreviewed").length),l.$$.dirty&23&&u&&(console.log(`Autosaving with ${o} reviewed targets`),window.localStorage.setItem(he,JSON.stringify([r,s])))},[r,s,u,f,o,i,n,c,w,m,y,T,I,d,P,O,D,F,h,p,L]}class Wt extends ae{constructor(t){super(),ce(this,t,At,zt,me,{})}}new Wt({target:document.getElementById("app")});
