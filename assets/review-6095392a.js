import{S as ae,i as ce,s as me,P as ke,r as b,t as y,w as Y,g as L,x,y as h,Q as Ye,R as xe,T as $e,U as ge,o as Ue,V as se,W as et,X as tt,j as w,Y as nt,Z as lt,$ as ot,a0 as st,a1 as it,z as te,B as J,a2 as ne,a3 as rt,k as I,n as P,q as M,u as _,I as K,a4 as oe,v as R,a5 as ut,J as Ce,H as ft,A as ue,d as W,e as q,C as fe,h as U,E as at,L as ct,a6 as mt,M as dt,D as _e,_ as pt,G as gt,F as Te,K as Ne,N as Ke,O as De,a7 as be}from"./Settings-31db2d77.js";function Ee(l){return(l==null?void 0:l.length)!==void 0?l:Array.from(l)}const _t=l=>({features:l[0]&16,data:l[0]&16,map:l[0]&4,close:l[0]&1}),Ie=l=>{var t;return{features:l[4],data:((t=l[4])==null?void 0:t[0])??null,map:l[2],close:l[31]}};function Pe(l){var o;let t,e,n=(((o=l[4])==null?void 0:o.length)||l[3]instanceof se.Marker)&&He(l);return{c(){t=w("div"),n&&n.c()},m(i,r){b(i,t,r),n&&n.m(t,null),l[32](t),e=!0},p(i,r){var s;(s=i[4])!=null&&s.length||i[3]instanceof se.Marker?n?(n.p(i,r),r[0]&24&&y(n,1)):(n=He(i),n.c(),y(n,1),n.m(t,null)):n&&(Y(),L(n,1,1,()=>{n=null}),x())},i(i){e||(y(n),e=!0)},o(i){L(n),e=!1},d(i){i&&h(t),n&&n.d(),l[32](null)}}}function He(l){let t;const e=l[30].default,n=nt(e,l,l[29],Ie);return{c(){n&&n.c()},m(o,i){n&&n.m(o,i),t=!0},p(o,i){n&&n.p&&(!t||i[0]&536870933)&&lt(n,e,o,o[29],t?st(e,o[29],i,_t):ot(o[29]),Ie)},i(o){t||(y(n,o),t=!0)},o(o){L(n,o),t=!1},d(o){n&&n.d(o)}}}function bt(l){let t,e,n=l[9].default&&Pe(l);return{c(){n&&n.c(),t=ke()},m(o,i){n&&n.m(o,i),b(o,t,i),e=!0},p(o,i){o[9].default?n?(n.p(o,i),i[0]&512&&y(n,1)):(n=Pe(o),n.c(),y(n,1),n.m(t.parentNode,t)):n&&(Y(),L(n,1,1,()=>{n=null}),x())},i(o){e||(y(n),e=!0)},o(o){L(n),e=!1},d(o){o&&h(t),n&&n.d(o)}}}function ht(l,t,e){let n,o,i,r,s,u,{$$slots:f={},$$scope:c}=t;const k=Ye(f);let{closeButton:d=void 0}=t,{closeOnClickOutside:v=!0}=t,{closeOnClickInside:S=!1}=t,{closeOnMove:F=!1}=t,{openOn:p="click"}=t,{openIfTopMost:E=!0}=t,{focusAfterOpen:G=!0}=t,{anchor:T=void 0}=t,{offset:H=void 0}=t,{popupClass:D=void 0}=t,{maxWidth:j=void 0}=t,{lngLat:C=void 0}=t,{html:m=void 0}=t,{open:g=!1}=t;const z=xe(),{map:Q,popupTarget:A,layerEvent:V,layer:ie,eventTopMost:N,markerClickManager:B}=$e();ge(l,Q,a=>e(2,i=a)),ge(l,A,a=>e(3,s=a)),ge(l,V,a=>e(28,r=a)),ge(l,ie,a=>e(35,u=a));const Ze=["click","dblclick","contextmenu"];let O,de=!1,X;function Qe(){if(!O)return;let a=O.getElement();!a||a===X||(X=a,p==="hover"&&(X.style.pointerEvents="none"),X.addEventListener("mouseenter",()=>{e(24,de=!0)},{passive:!0}),X.addEventListener("mouseleave",()=>{e(24,de=!1)},{passive:!0}),X.addEventListener("click",()=>{S&&e(0,g=!1)},{passive:!0}))}Ue(()=>{if(i)return i.on("click",pe),i.on("contextmenu",pe),B.add(Ge),typeof s=="string"&&(i.on("click",s,ee),i.on("dblclick",s,ee),i.on("contextmenu",s,ee),i.on("mousemove",s,Se),i.on("mouseleave",s,Le),i.on("touchstart",s,je),i.on("touchend",s,Me)),()=>{i!=null&&i.loaded()&&(O==null||O.remove(),i.off("click",pe),i.off("contextmenu",pe),B.remove(Ge),s instanceof se.Marker?s.getPopup()===O&&s.setPopup(void 0):typeof s=="string"&&(i.off("click",s,ee),i.off("dblclick",s,ee),i.off("contextmenu",s,ee),i.off("mousemove",s,Se),i.off("mouseleave",s,Le),i.off("touchstart",s,je),i.off("touchend",s,Me)))}});function ye(a){return E?!("marker"in a)&&!it(a)&&N(a)!==u:!1}let $=null,Z="normal";function Oe(a){"layerType"in a&&a.layerType==="deckgl"?(e(10,C=a.coordinate),e(4,$=a.object?[a.object]:null)):(e(10,C=a.lngLat),e(4,$=a.features??[]))}function ee(a){a.type!==p||ye(a)||(Oe(a),setTimeout(()=>e(0,g=!0)))}let le=null;function je(a){le=a.point}function Me(a){if(!le||p!=="hover")return;let we=le.dist(a.point);le=null,we<3&&(e(10,C=a.lngLat),e(4,$=a.features??[]),O.isOpen()?e(25,Z="justOpened"):(e(25,Z="opening"),e(0,g=!0)))}function Le(a){p!=="hover"||le||Z!=="normal"||(e(0,g=!1),e(4,$=null))}function Se(a){if(!(p!=="hover"||le||Z!=="normal")){if(ye(a)){e(0,g=!1),e(4,$=null);return}e(0,g=!0),e(4,$=a.features??[]),e(10,C=a.lngLat)}}function pe(a){if(Z==="justOpened"){e(25,Z="normal");return}if(!v)return;let we=[X,s instanceof se.Marker?s==null?void 0:s.getElement():null];g&&O.isOpen()&&!we.some(ve=>ve==null?void 0:ve.contains(a.originalEvent.target))&&(a.type==="contextmenu"&&p==="contextmenu"||a.type!=="contextmenu")&&e(0,g=!1)}function Ge(a){v&&g&&O.isOpen()&&a.marker!==s&&e(0,g=!1)}et(()=>{i&&(O!=null&&O.isOpen())&&O.remove()});let re;const Ve=()=>e(0,g=!1);function Xe(a){te[a?"unshift":"push"](()=>{re=a,e(1,re)})}return l.$$set=a=>{"closeButton"in a&&e(11,d=a.closeButton),"closeOnClickOutside"in a&&e(12,v=a.closeOnClickOutside),"closeOnClickInside"in a&&e(13,S=a.closeOnClickInside),"closeOnMove"in a&&e(14,F=a.closeOnMove),"openOn"in a&&e(15,p=a.openOn),"openIfTopMost"in a&&e(16,E=a.openIfTopMost),"focusAfterOpen"in a&&e(17,G=a.focusAfterOpen),"anchor"in a&&e(18,T=a.anchor),"offset"in a&&e(19,H=a.offset),"popupClass"in a&&e(20,D=a.popupClass),"maxWidth"in a&&e(21,j=a.maxWidth),"lngLat"in a&&e(10,C=a.lngLat),"html"in a&&e(22,m=a.html),"open"in a&&e(0,g=a.open),"$$scope"in a&&e(29,c=a.$$scope)},l.$$.update=()=>{if(l.$$.dirty[0]&14336&&e(27,n=d??(!v&&!S)),l.$$.dirty[0]&146685952&&(O||(e(23,O=new se.Popup({closeButton:n,closeOnClick:!1,closeOnMove:F,focusAfterOpen:G,maxWidth:j,className:D,anchor:T,offset:H})),X=O.getElement(),O.on("open",()=>{e(0,g=!0),Qe(),z("open",O)}),O.on("close",()=>{e(0,g=!1),z("close",O)}),O.on("hover",()=>{z("hover",O)}))),l.$$.dirty[0]&8421384&&O&&s instanceof se.Marker&&(p==="click"?s.setPopup(O):s.getPopup()===O&&s.setPopup(void 0)),l.$$.dirty[0]&268468224&&Ze.includes(p)&&(r==null?void 0:r.type)===p&&(ee(r),tt(V,r=null,r)),l.$$.dirty[0]&268468224&&e(26,o=p==="hover"&&((r==null?void 0:r.type)==="mousemove"||(r==null?void 0:r.type)==="mouseenter")),l.$$.dirty[0]&352354304&&p==="hover"&&V&&(o&&r&&Oe(r),e(0,g=(o||de)??!1)),l.$$.dirty[0]&12582914&&(re?O.setDOMContent(re):m&&O.setHTML(m)),l.$$.dirty[0]&8389632&&C&&O.setLngLat(C),l.$$.dirty[0]&41943045&&i){let a=O.isOpen();g&&!a?(O.addTo(i),Z==="opening"&&e(25,Z="justOpened")):!g&&a&&O.remove()}},[g,re,i,s,$,Q,A,V,ie,k,C,d,v,S,F,p,E,G,T,H,D,j,m,O,de,Z,o,n,r,c,f,Ve,Xe]}class kt extends ae{constructor(t){super(),ce(this,t,ht,bt,me,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function Je(l,t,e){const n=l.slice();return n[4]=t[e][0],n[5]=t[e][1],n}function Be(l){let t,e,n,o,i=l[4]+"",r,s;return{c(){t=w("div"),e=w("span"),o=I(),r=P(i),s=I(),M(e,"class",n="color-swatch "+l[1]+" svelte-1enycr6"),J(e,"background",l[5]),J(t,"display","flex"),J(t,"align-items","center"),J(t,"gap","6px")},m(u,f){b(u,t,f),_(t,e),_(t,o),_(t,r),_(t,s)},p(u,f){f&2&&n!==(n="color-swatch "+u[1]+" svelte-1enycr6")&&M(e,"class",n),f&1&&J(e,"background",u[5]),f&1&&i!==(i=u[4]+"")&&K(r,i)},d(u){u&&h(t)}}}function wt(l){let t,e=Ee(Object.entries(l[0])),n=[];for(let o=0;o<e.length;o+=1)n[o]=Be(Je(l,e,o));return{c(){t=w("div");for(let o=0;o<n.length;o+=1)n[o].c();J(t,"display","grid"),J(t,"grid-template-columns","repeat(auto-fill, calc("+l[2]+" - 10px))"),J(t,"gap","10px")},m(o,i){b(o,t,i);for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(t,null)},p(o,[i]){if(i&3){e=Ee(Object.entries(o[0]));let r;for(r=0;r<e.length;r+=1){const s=Je(o,e,r);n[r]?n[r].p(s,i):(n[r]=Be(s),n[r].c(),n[r].m(t,null))}for(;r<n.length;r+=1)n[r].d(1);n.length=e.length}i&4&&J(t,"grid-template-columns","repeat(auto-fill, calc("+o[2]+" - 10px))")},i:ne,o:ne,d(o){o&&h(t),rt(n,o)}}}function vt(l,t,e){let n,{labelColors:o}=t,{swatchClass:i="rectangle"}=t,{itemsPerRow:r=2}=t;return l.$$set=s=>{"labelColors"in s&&e(0,o=s.labelColors),"swatchClass"in s&&e(1,i=s.swatchClass),"itemsPerRow"in s&&e(3,r=s.itemsPerRow)},l.$$.update=()=>{l.$$.dirty&8&&e(2,n=`${100/r}%`)},[o,i,n,r]}class Ct extends ae{constructor(t){super(),ce(this,t,vt,wt,me,{labelColors:0,swatchClass:1,itemsPerRow:3})}}let he="match-linestrings-review";function yt(l){let t,e,n,o,i,r=JSON.stringify(l[1].features[l[0]].properties.matching_sources)+"",s,u,f,c,k,d,v,S,F,p,E,G,T,H;return{c(){t=w("div"),e=w("h3"),n=P("Target "),o=P(l[0]),i=P(": "),s=P(r),u=I(),f=w("button"),f.innerHTML=`<kbd>Escape</kbd>
    - Back`,c=I(),k=w("h6"),k.textContent="Click sources to add or remove",d=I(),v=w("div"),S=w("button"),S.innerHTML=`<kbd>1</kbd>
    - Unreviewed`,F=I(),p=w("button"),p.innerHTML=`<kbd>2</kbd>
    - Not sure`,E=I(),G=w("button"),G.innerHTML=`<kbd>3</kbd>
    - Confirm correct`,M(f,"class","btn btn-secondary"),J(t,"display","flex"),J(t,"justify-content","space-between"),M(S,"class","btn btn-danger svelte-1tzb8bs"),oe(S,"current",l[4]=="unreviewed"),M(p,"class","btn btn-warning svelte-1tzb8bs"),oe(p,"current",l[4]=="not sure"),M(G,"class","btn btn-success svelte-1tzb8bs"),oe(G,"current",l[4]=="confirmed"),J(v,"display","flex"),J(v,"justify-content","space-between")},m(D,j){b(D,t,j),_(t,e),_(e,n),_(e,o),_(e,i),_(e,s),_(t,u),_(t,f),b(D,c,j),b(D,k,j),b(D,d,j),b(D,v,j),_(v,S),_(v,F),_(v,p),_(v,E),_(v,G),T||(H=[R(window,"keydown",l[5]),R(f,"click",function(){ut(l[3])&&l[3].apply(this,arguments)}),R(S,"click",l[6]),R(p,"click",l[7]),R(G,"click",l[8])],T=!0)},p(D,[j]){l=D,j&1&&K(o,l[0]),j&3&&r!==(r=JSON.stringify(l[1].features[l[0]].properties.matching_sources)+"")&&K(s,r),j&16&&oe(S,"current",l[4]=="unreviewed"),j&16&&oe(p,"current",l[4]=="not sure"),j&16&&oe(G,"current",l[4]=="confirmed")},i:ne,o:ne,d(D){D&&(h(t),h(c),h(k),h(d),h(v)),T=!1,Ce(H)}}}function Ot(l,t,e){let n,{clickedTarget:o}=t,{targetGj:i}=t,{onConfirm:r}=t,{onCancel:s}=t;function u(d){d.target.tagName!="INPUT"&&(d.key=="1"?r("unreviewed"):d.key=="2"?r("not sure"):d.key=="3"?r("confirmed"):d.key=="Escape"&&s())}const f=()=>r("unreviewed"),c=()=>r("not sure"),k=()=>r("confirmed");return l.$$set=d=>{"clickedTarget"in d&&e(0,o=d.clickedTarget),"targetGj"in d&&e(1,i=d.targetGj),"onConfirm"in d&&e(2,r=d.onConfirm),"onCancel"in d&&e(3,s=d.onCancel)},l.$$.update=()=>{l.$$.dirty&3&&e(4,n=i.features[o].properties.reviewed)},[o,i,r,s,n,u,f,c,k]}class jt extends ae{constructor(t){super(),ce(this,t,Ot,yt,me,{clickedTarget:0,targetGj:1,onConfirm:2,onCancel:3})}}function Fe(l){let t,e,n,o,i=l[0].features.length+"",r,s,u,f=l[1].features.length+"",c,k,d,v=l[1].features.filter(Ae).length+"",S,F,p,E,G,T,H,D,j,C=!l[3]&&Re(l);return{c(){t=w("button"),e=P("Swap"),n=I(),o=w("p"),r=P(i),s=P(` sources and
    `),u=w("span"),c=P(f),k=P(" targets"),d=P(`
    , with `),S=P(v),F=P(" matching a source"),p=I(),E=w("button"),E.textContent="Start review",G=I(),C&&C.c(),T=ke(),M(t,"class","btn btn-secondary"),t.disabled=l[3],J(u,"color","red"),M(E,"class","btn btn-primary mb-5")},m(m,g){b(m,t,g),_(t,e),b(m,n,g),b(m,o,g),_(o,r),_(o,s),_(o,u),_(u,c),_(u,k),_(o,d),_(o,S),_(o,F),b(m,p,g),b(m,E,g),b(m,G,g),C&&C.m(m,g),b(m,T,g),H=!0,D||(j=[R(t,"click",l[8]),R(E,"click",l[11])],D=!0)},p(m,g){(!H||g&8)&&(t.disabled=m[3]),(!H||g&1)&&i!==(i=m[0].features.length+"")&&K(r,i),(!H||g&2)&&f!==(f=m[1].features.length+"")&&K(c,f),(!H||g&2)&&v!==(v=m[1].features.filter(Ae).length+"")&&K(S,v),m[3]?C&&(Y(),L(C,1,1,()=>{C=null}),x()):C?(C.p(m,g),g&8&&y(C,1)):(C=Re(m),C.c(),y(C,1),C.m(T.parentNode,T))},i(m){H||(y(C),H=!0)},o(m){L(C),H=!1},d(m){m&&(h(t),h(n),h(o),h(p),h(E),h(G),h(T)),C&&C.d(m),D=!1,Ce(j)}}}function Re(l){let t,e,n;function o(r){l[12](r)}let i={onChange:l[6]};return l[4]!==void 0&&(i.options=l[4]),t=new ft({props:i}),te.push(()=>ue(t,"options",o)),{c(){W(t.$$.fragment)},m(r,s){q(t,r,s),n=!0},p(r,s){const u={};!e&&s&16&&(e=!0,u.options=r[4],fe(()=>e=!1)),t.$set(u)},i(r){n||(y(t.$$.fragment,r),n=!0)},o(r){L(t.$$.fragment,r),n=!1},d(r){U(t,r)}}}function Mt(l){let t,e,n,o,i,r,s,u,f=l[0].features.length>0&&Fe(l);return{c(){t=w("label"),e=P(`Load two .geojson files
  `),n=w("input"),o=I(),f&&f.c(),i=ke(),M(n,"class","form-control"),M(n,"type","file"),n.multiple=!0,M(t,"class","form-label")},m(c,k){b(c,t,k),_(t,e),_(t,n),l[10](n),b(c,o,k),f&&f.m(c,k),b(c,i,k),r=!0,s||(u=R(n,"change",l[7]),s=!0)},p(c,[k]){c[0].features.length>0?f?(f.p(c,k),k&1&&y(f,1)):(f=Fe(c),f.c(),y(f,1),f.m(i.parentNode,i)):f&&(Y(),L(f,1,1,()=>{f=null}),x())},i(c){r||(y(f),r=!0)},o(c){L(f),r=!1},d(c){c&&(h(t),h(o),h(i)),l[10](null),f&&f.d(c),s=!1,u()}}}function ze(l){let t=0;for(let e of l.features)e.id=t++,e.properties??(e.properties={});return l}const Ae=l=>l.properties.matching_sources.length>0;function Lt(l,t,e){let{sourceGj:n}=t,{targetGj:o}=t,{setupDone:i}=t,{zoomFit:r}=t,s=!1,u={buffer_meters:20,angle_diff_threshold:10,length_ratio_threshold:1.1,midpt_dist_threshold:15};function f(){var p;if(!s)try{let E=JSON.parse(at(JSON.stringify(n),JSON.stringify(o),u));for(let[G,T]of o.features.entries())T.properties.matching_sources=E[G].matching_sources,(p=T.properties).reviewed??(p.reviewed="unreviewed");e(1,o)}catch(E){window.alert(`Bug: ${E}`)}}let c;async function k(p){if(!c.files)return;if(c.files.length!=2){window.alert("Select two GeoJSON files");return}try{let G=await c.files[0].text(),T=await c.files[1].text();e(0,n=ze(JSON.parse(G))),e(1,o=ze(JSON.parse(T))),"matching_sources"in o.features[0].properties?e(3,s=!0):"matching_sources"in n.features[0].properties&&(e(3,s=!0),e(0,[n,o]=[o,n],n,e(1,o))),r(),f()}catch(G){window.alert(`Bad input file: ${G}`)}}function d(){e(0,[n,o]=[o,n],n,e(1,o)),f()}function v(p){te[p?"unshift":"push"](()=>{c=p,e(5,c)})}const S=()=>e(2,i=!0);function F(p){u=p,e(4,u)}return l.$$set=p=>{"sourceGj"in p&&e(0,n=p.sourceGj),"targetGj"in p&&e(1,o=p.targetGj),"setupDone"in p&&e(2,i=p.setupDone),"zoomFit"in p&&e(9,r=p.zoomFit)},[n,o,i,s,u,c,f,k,d,r,v,S,F]}class St extends ae{constructor(t){super(),ce(this,t,Lt,Mt,me,{sourceGj:0,targetGj:1,setupDone:2,zoomFit:9})}}const{window:Gt}=mt;function Tt(l){let t,e,n,o,i,r,s,u,f,c,k,d,v,S,F=l[1].features.length+"",p,E,G,T,H,D,j,C,m,g,z,Q,A,V,ie;return g=new Ct({props:{itemsPerRow:1,labelColors:{Confirmed:"green","Not sure":"orange",Unreviewed:"red",Source:"grey"}}}),{c(){t=w("div"),e=w("button"),e.textContent="Start over",n=I(),o=w("button"),o.textContent="Zoom to fit",i=I(),r=w("br"),s=I(),u=w("div"),f=w("div"),k=I(),d=w("p"),v=P(l[4]),S=P(" / "),p=P(F),E=P(" targets reviewed"),G=I(),T=w("button"),T.textContent="Download reviews",H=I(),D=w("div"),j=w("div"),C=w("h5"),C.textContent="Legend",m=I(),W(g.$$.fragment),z=I(),Q=w("p"),Q.textContent="Thinner lines have a match, thicker are off-road",M(e,"class","btn btn-outline-danger"),M(o,"class","btn btn-outline-secondary"),J(t,"display","flex"),J(t,"justify-content","space-between"),M(f,"class","progress-bar"),J(f,"width",`${100*l[4]/l[1].features.length}%`),M(u,"class","progress"),M(u,"role","progressbar"),M(u,"aria-valuenow",l[4]),M(u,"aria-valuemin","0"),M(u,"aria-valuemax",c=l[1].features.length),M(T,"class","btn btn-outline-success"),M(C,"class","card-title"),M(j,"class","card-body"),M(D,"class","card mt-5")},m(N,B){b(N,t,B),_(t,e),_(t,n),_(t,o),b(N,i,B),b(N,r,B),b(N,s,B),b(N,u,B),_(u,f),b(N,k,B),b(N,d,B),_(d,v),_(d,S),_(d,p),_(d,E),b(N,G,B),b(N,T,B),b(N,H,B),b(N,D,B),_(D,j),_(j,C),_(j,m),q(g,j,null),_(j,z),_(j,Q),A=!0,V||(ie=[R(e,"click",l[12]),R(o,"click",l[7]),R(T,"click",l[11])],V=!0)},p(N,B){B&18&&J(f,"width",`${100*N[4]/N[1].features.length}%`),(!A||B&16)&&M(u,"aria-valuenow",N[4]),(!A||B&2&&c!==(c=N[1].features.length))&&M(u,"aria-valuemax",c),(!A||B&16)&&K(v,N[4]),(!A||B&2)&&F!==(F=N[1].features.length+"")&&K(p,F)},i(N){A||(y(g.$$.fragment,N),A=!0)},o(N){L(g.$$.fragment,N),A=!1},d(N){N&&(h(t),h(i),h(r),h(s),h(u),h(k),h(d),h(G),h(T),h(H),h(D)),U(g),V=!1,Ce(ie)}}}function Nt(l){let t,e,n,o,i;function r(c){l[18](c)}function s(c){l[19](c)}function u(c){l[20](c)}let f={zoomFit:l[7]};return l[0]!==void 0&&(f.sourceGj=l[0]),l[1]!==void 0&&(f.targetGj=l[1]),l[2]!==void 0&&(f.setupDone=l[2]),t=new St({props:f}),te.push(()=>ue(t,"sourceGj",r)),te.push(()=>ue(t,"targetGj",s)),te.push(()=>ue(t,"setupDone",u)),{c(){W(t.$$.fragment)},m(c,k){q(t,c,k),i=!0},p(c,k){const d={};!e&&k&1&&(e=!0,d.sourceGj=c[0],fe(()=>e=!1)),!n&&k&2&&(n=!0,d.targetGj=c[1],fe(()=>n=!1)),!o&&k&4&&(o=!0,d.setupDone=c[2],fe(()=>o=!1)),t.$set(d)},i(c){i||(y(t.$$.fragment,c),i=!0)},o(c){L(t.$$.fragment,c),i=!1},d(c){U(t,c)}}}function Dt(l){let t,e,n,o,i,r,s,u;const f=[Nt,Tt],c=[];function k(d,v){return d[2]?1:0}return r=k(l),s=c[r]=f[r](l),{c(){t=w("div"),e=w("h1"),e.textContent="Manually specify LineString matchings for test cases",n=I(),o=w("div"),o.innerHTML='<a class="icon-link mb-3" href="https://github.com/nptscot/match_linestrings/blob/main/tests/README.md" target="_blank">About <i class="fa-solid fa-arrow-up-right-from-square"></i></a>',i=I(),s.c(),M(t,"slot","left")},m(d,v){b(d,t,v),_(t,e),_(t,n),_(t,o),_(t,i),c[r].m(t,null),u=!0},p(d,v){let S=r;r=k(d),r===S?c[r].p(d,v):(Y(),L(c[S],1,1,()=>{c[S]=null}),x(),s=c[r],s?s.p(d,v):(s=c[r]=f[r](d),s.c()),y(s,1),s.m(t,null))},i(d){u||(y(s),u=!0)},o(d){L(s),u=!1},d(d){d&&h(t),c[r].d()}}}function We(l){let t,e,n,o;const i=[It,Et],r=[];function s(u,f){return u[3]==null?0:1}return e=s(l),n=r[e]=i[e](l),{c(){t=w("div"),n.c(),M(t,"class","map-panel svelte-hr6p1s")},m(u,f){b(u,t,f),r[e].m(t,null),o=!0},p(u,f){let c=e;e=s(u),e===c?r[e].p(u,f):(Y(),L(r[c],1,1,()=>{r[c]=null}),x(),n=r[e],n?n.p(u,f):(n=r[e]=i[e](u),n.c()),y(n,1),n.m(t,null))},i(u){o||(y(n),o=!0)},o(u){L(n),o=!1},d(u){u&&h(t),r[e].d()}}}function Et(l){let t,e;return t=new jt({props:{clickedTarget:l[3],targetGj:l[1],onConfirm:l[8],onCancel:l[15]}}),{c(){W(t.$$.fragment)},m(n,o){q(t,n,o),e=!0},p(n,o){const i={};o&8&&(i.clickedTarget=n[3]),o&2&&(i.targetGj=n[1]),o&8&&(i.onCancel=n[15]),t.$set(i)},i(n){e||(y(t.$$.fragment,n),e=!0)},o(n){L(t.$$.fragment,n),e=!1},d(n){U(t,n)}}}function It(l){let t,e,n;return{c(){t=w("button"),t.innerHTML=`Goto <kbd>n</kbd>
              ext unreviewed`,M(t,"class","btn btn-primary")},m(o,i){b(o,t,i),e||(n=R(t,"click",l[9]),e=!0)},p:ne,i:ne,o:ne,d(o){o&&h(t),e=!1,n()}}}function qe(l){let t,e;return t=new kt({props:{openOn:"hover",$$slots:{default:[Pt,({data:n})=>({21:n}),({data:n})=>n?2097152:0]},$$scope:{ctx:l}}}),{c(){W(t.$$.fragment)},m(n,o){q(t,n,o),e=!0},p(n,o){const i={};o&6291520&&(i.$$scope={dirty:o,ctx:n}),t.$set(i)},i(n){e||(y(t.$$.fragment,n),e=!0)},o(n){L(t.$$.fragment,n),e=!1},d(n){U(t,n)}}}function Pt(l){let t,e=be(l[21]).id+"",n,o,i=l[6].includes(be(l[21]).id)?"remove":"add",r;return{c(){t=P("Source "),n=P(e),o=P(" -- click to "),r=P(i)},m(s,u){b(s,t,u),b(s,n,u),b(s,o,u),b(s,r,u)},p(s,u){u&2097152&&e!==(e=be(s[21]).id+"")&&K(n,e),u&2097216&&i!==(i=s[6].includes(be(s[21]).id)?"remove":"add")&&K(r,i)},d(s){s&&(h(t),h(n),h(o),h(r))}}}function Ht(l){let t,e,n=l[3]!=null&&qe(l);return{c(){n&&n.c(),t=ke()},m(o,i){n&&n.m(o,i),b(o,t,i),e=!0},p(o,i){o[3]!=null?n?(n.p(o,i),i&8&&y(n,1)):(n=qe(o),n.c(),y(n,1),n.m(t.parentNode,t)):n&&(Y(),L(n,1,1,()=>{n=null}),x())},i(o){e||(y(n),e=!0)},o(o){L(n),e=!1},d(o){o&&h(t),n&&n.d(o)}}}function Jt(l){let t,e;return t=new Ke({props:{manageHoverState:!0,paint:{"line-color":["case",["in",["id"],["literal",l[6]]],"blue","black"],"line-width":8,"line-opacity":De(.5,1)},hoverCursor:l[3]==null?void 0:"pointer",$$slots:{default:[Ht]},$$scope:{ctx:l}}}),t.$on("click",l[14]),{c(){W(t.$$.fragment)},m(n,o){q(t,n,o),e=!0},p(n,o){const i={};o&64&&(i.paint={"line-color":["case",["in",["id"],["literal",n[6]]],"blue","black"],"line-width":8,"line-opacity":De(.5,1)}),o&8&&(i.hoverCursor=n[3]==null?void 0:"pointer"),o&4194376&&(i.$$scope={dirty:o,ctx:n}),t.$set(i)},i(n){e||(y(t.$$.fragment,n),e=!0)},o(n){L(t.$$.fragment,n),e=!1},d(n){U(t,n)}}}function Bt(l){let t,e;return t=new Ke({props:{manageHoverState:!0,paint:{"line-width":["case",[">",["length",["get","matching_sources"]],0],8,16],"line-color":["match",["get","reviewed"],"unreviewed","red","not sure","orange","green"],"line-opacity":["case",["==",["id"],l[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,.3]},hoverCursor:"pointer"}}),t.$on("click",l[13]),{c(){W(t.$$.fragment)},m(n,o){q(t,n,o),e=!0},p(n,o){const i={};o&8&&(i.paint={"line-width":["case",[">",["length",["get","matching_sources"]],0],8,16],"line-color":["match",["get","reviewed"],"unreviewed","red","not sure","orange","green"],"line-opacity":["case",["==",["id"],n[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,.3]}),t.$set(i)},i(n){e||(y(t.$$.fragment,n),e=!0)},o(n){L(t.$$.fragment,n),e=!1},d(n){U(t,n)}}}function Ft(l){let t,e,n,o,i,r=l[2]&&We(l);return e=new Ne({props:{data:l[0],$$slots:{default:[Jt]},$$scope:{ctx:l}}}),o=new Ne({props:{data:l[1],$$slots:{default:[Bt]},$$scope:{ctx:l}}}),{c(){r&&r.c(),t=I(),W(e.$$.fragment),n=I(),W(o.$$.fragment)},m(s,u){r&&r.m(s,u),b(s,t,u),q(e,s,u),b(s,n,u),q(o,s,u),i=!0},p(s,u){s[2]?r?(r.p(s,u),u&4&&y(r,1)):(r=We(s),r.c(),y(r,1),r.m(t.parentNode,t)):r&&(Y(),L(r,1,1,()=>{r=null}),x());const f={};u&1&&(f.data=s[0]),u&4194376&&(f.$$scope={dirty:u,ctx:s}),e.$set(f);const c={};u&2&&(c.data=s[1]),u&4194312&&(c.$$scope={dirty:u,ctx:s}),o.$set(c)},i(s){i||(y(r),y(e.$$.fragment,s),y(o.$$.fragment,s),i=!0)},o(s){L(r),L(e.$$.fragment,s),L(o.$$.fragment,s),i=!1},d(s){s&&(h(t),h(n)),r&&r.d(s),U(e,s),U(o,s)}}}function Rt(l){let t,e,n,o;function i(s){l[16](s)}let r={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Ft]},$$scope:{ctx:l}};return l[5]!==void 0&&(r.map=l[5]),e=new dt({props:r}),te.push(()=>ue(e,"map",i)),e.$on("error",l[17]),{c(){t=w("div"),W(e.$$.fragment),M(t,"slot","main"),J(t,"position","relative"),J(t,"width","100%"),J(t,"height","100vh")},m(s,u){b(s,t,u),q(e,t,null),o=!0},p(s,u){const f={};u&4194383&&(f.$$scope={dirty:u,ctx:s}),!n&&u&32&&(n=!0,f.map=s[5],fe(()=>n=!1)),e.$set(f)},i(s){o||(y(e.$$.fragment,s),o=!0)},o(s){L(e.$$.fragment,s),o=!1},d(s){s&&h(t),U(e)}}}function zt(l){let t,e,n,o;return t=new ct({props:{$$slots:{main:[Rt],left:[Dt]},$$scope:{ctx:l}}}),{c(){W(t.$$.fragment)},m(i,r){q(t,i,r),e=!0,n||(o=R(Gt,"keydown",l[10]),n=!0)},p(i,[r]){const s={};r&4194431&&(s.$$scope={dirty:r,ctx:i}),t.$set(s)},i(i){e||(y(t.$$.fragment,i),e=!0)},o(i){L(t.$$.fragment,i),e=!1},d(i){U(t,i),n=!1,o()}}}function At(l,t,e){let n,o,i,r=_e(),s=_e(),u=!1,f=null;Ue(async()=>{await pt();try{let m=window.localStorage.getItem(he);if(m){let g=JSON.parse(m);e(0,[r,s]=g,r,e(1,s)),e(2,u=!0),console.log(`Restored data from local storage ${he}`)}}catch(m){console.log(`Couldn't restore data from local storage: ${m}`)}});function c(){let m={type:"FeatureCollection",features:[...r.features,...s.features]};i==null||i.fitBounds(Te(m),{animate:!1,padding:10})}function k(m){if(f==null)throw new Error("impossible");e(1,s.features[f].properties.reviewed=m,s),e(1,s),e(3,f=null)}function d(){for(let m of s.features)if(m.properties.reviewed=="unreviewed"){i==null||i.fitBounds(Te(m),{duration:600,padding:200}),e(3,f=m.id);return}}function v(m){m.target.tagName=="INPUT"||!u||m.key=="n"&&d()}function S(){gt("reviewed_targets.geojson",JSON.stringify(s))}function F(){window.confirm("Do you want to discard this review and start over?")&&(e(0,r=_e()),e(1,s=_e()),e(2,u=!1),e(3,f=null),window.localStorage.removeItem(he))}function p(m){u&&e(3,f=m.detail.features[0].id)}function E(m){if(!u||f==null)return;let g=m.detail.features[0].id,z=s.features[f].properties;z.matching_sources.includes(g)?z.matching_sources=z.matching_sources.filter(Q=>Q!=g):z.matching_sources.push(g),e(1,s)}const G=()=>e(3,f=null);function T(m){i=m,e(5,i)}const H=m=>{console.log(m.detail.error)};function D(m){r=m,e(0,r)}function j(m){s=m,e(1,s)}function C(m){u=m,e(2,u)}return l.$$.update=()=>{l.$$.dirty&10&&e(6,n=f==null?[]:s.features[f].properties.matching_sources),l.$$.dirty&2&&e(4,o=s.features.filter(m=>m.properties.reviewed!="unreviewed").length),l.$$.dirty&23&&u&&(console.log(`Autosaving with ${o} reviewed targets`),window.localStorage.setItem(he,JSON.stringify([r,s])))},[r,s,u,f,o,i,n,c,k,d,v,S,F,p,E,G,T,H,D,j,C]}class Wt extends ae{constructor(t){super(),ce(this,t,At,zt,me,{})}}new Wt({target:document.getElementById("app")});
