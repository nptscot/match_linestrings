import{S as me,i as de,s as pe,P as _e,r as h,t as C,w as U,g as S,x as Z,y as k,Q as Ve,R as Qe,T as Xe,U as ue,o as Ae,V as ee,W as Ye,X as xe,j,Y as $e,Z as et,$ as tt,a0 as nt,a1 as ot,z as X,n as I,k as J,q as T,B as F,a2 as $,u as v,v as B,a3 as lt,I as W,a4 as Y,J as he,H as st,A as ne,d as P,e as z,C as oe,h as A,E as rt,L as it,a5 as ut,M as ft,D as fe,_ as at,G as ct,F as Se,K as Te,N as Re,O as Ne,a6 as ae}from"./Settings-098cbd8c.js";const mt=o=>({features:o[0]&16,data:o[0]&16,map:o[0]&4,close:o[0]&1}),De=o=>{var t;return{features:o[4],data:((t=o[4])==null?void 0:t[0])??null,map:o[2],close:o[31]}};function Ee(o){var l;let t,e,n=(((l=o[4])==null?void 0:l.length)||o[3]instanceof ee.Marker)&&Ie(o);return{c(){t=j("div"),n&&n.c()},m(r,i){h(r,t,i),n&&n.m(t,null),o[32](t),e=!0},p(r,i){var s;(s=r[4])!=null&&s.length||r[3]instanceof ee.Marker?n?(n.p(r,i),i[0]&24&&C(n,1)):(n=Ie(r),n.c(),C(n,1),n.m(t,null)):n&&(U(),S(n,1,1,()=>{n=null}),Z())},i(r){e||(C(n),e=!0)},o(r){S(n),e=!1},d(r){r&&k(t),n&&n.d(),o[32](null)}}}function Ie(o){let t;const e=o[30].default,n=$e(e,o,o[29],De);return{c(){n&&n.c()},m(l,r){n&&n.m(l,r),t=!0},p(l,r){n&&n.p&&(!t||r[0]&536870933)&&et(n,e,l,l[29],t?nt(e,l[29],r,mt):tt(l[29]),De)},i(l){t||(C(n,l),t=!0)},o(l){S(n,l),t=!1},d(l){n&&n.d(l)}}}function dt(o){let t,e,n=o[9].default&&Ee(o);return{c(){n&&n.c(),t=_e()},m(l,r){n&&n.m(l,r),h(l,t,r),e=!0},p(l,r){l[9].default?n?(n.p(l,r),r[0]&512&&C(n,1)):(n=Ee(l),n.c(),C(n,1),n.m(t.parentNode,t)):n&&(U(),S(n,1,1,()=>{n=null}),Z())},i(l){e||(C(n),e=!0)},o(l){S(n),e=!1},d(l){l&&k(t),n&&n.d(l)}}}function pt(o,t,e){let n,l,r,i,s,u,{$$slots:a={},$$scope:c}=t;const w=Ve(a);let{closeButton:d=void 0}=t,{closeOnClickOutside:y=!0}=t,{closeOnClickInside:M=!1}=t,{closeOnMove:H=!1}=t,{openOn:p="click"}=t,{openIfTopMost:N=!0}=t,{focusAfterOpen:G=!0}=t,{anchor:L=void 0}=t,{offset:E=void 0}=t,{popupClass:D=void 0}=t,{maxWidth:b=void 0}=t,{lngLat:_=void 0}=t,{html:m=void 0}=t,{open:g=!1}=t;const q=Qe(),{map:le,popupTarget:ke,layerEvent:se,layer:we,eventTopMost:We,markerClickManager:ye}=Xe();ue(o,le,f=>e(2,r=f)),ue(o,ke,f=>e(3,s=f)),ue(o,se,f=>e(28,i=f)),ue(o,we,f=>e(35,u=f));const qe=["click","dblclick","contextmenu"];let O,re=!1,K;function Ke(){if(!O)return;let f=O.getElement();!f||f===K||(K=f,p==="hover"&&(K.style.pointerEvents="none"),K.addEventListener("mouseenter",()=>{e(24,re=!0)},{passive:!0}),K.addEventListener("mouseleave",()=>{e(24,re=!1)},{passive:!0}),K.addEventListener("click",()=>{M&&e(0,g=!1)},{passive:!0}))}Ae(()=>{if(r)return r.on("click",ie),r.on("contextmenu",ie),ye.add(Le),typeof s=="string"&&(r.on("click",s,Q),r.on("dblclick",s,Q),r.on("contextmenu",s,Q),r.on("mousemove",s,Ge),r.on("mouseleave",s,Me),r.on("touchstart",s,Oe),r.on("touchend",s,je)),()=>{r!=null&&r.loaded()&&(O==null||O.remove(),r.off("click",ie),r.off("contextmenu",ie),ye.remove(Le),s instanceof ee.Marker?s.getPopup()===O&&s.setPopup(void 0):typeof s=="string"&&(r.off("click",s,Q),r.off("dblclick",s,Q),r.off("contextmenu",s,Q),r.off("mousemove",s,Ge),r.off("mouseleave",s,Me),r.off("touchstart",s,Oe),r.off("touchend",s,je)))}});function ve(f){return N?!("marker"in f)&&!ot(f)&&We(f)!==u:!1}let V=null,R="normal";function Ce(f){"layerType"in f&&f.layerType==="deckgl"?(e(10,_=f.coordinate),e(4,V=f.object?[f.object]:null)):(e(10,_=f.lngLat),e(4,V=f.features??[]))}function Q(f){f.type!==p||ve(f)||(Ce(f),setTimeout(()=>e(0,g=!0)))}let x=null;function Oe(f){x=f.point}function je(f){if(!x||p!=="hover")return;let ge=x.dist(f.point);x=null,ge<3&&(e(10,_=f.lngLat),e(4,V=f.features??[]),O.isOpen()?e(25,R="justOpened"):(e(25,R="opening"),e(0,g=!0)))}function Me(f){p!=="hover"||x||R!=="normal"||(e(0,g=!1),e(4,V=null))}function Ge(f){if(!(p!=="hover"||x||R!=="normal")){if(ve(f)){e(0,g=!1),e(4,V=null);return}e(0,g=!0),e(4,V=f.features??[]),e(10,_=f.lngLat)}}function ie(f){if(R==="justOpened"){e(25,R="normal");return}if(!y)return;let ge=[K,s instanceof ee.Marker?s==null?void 0:s.getElement():null];g&&O.isOpen()&&!ge.some(be=>be==null?void 0:be.contains(f.originalEvent.target))&&(f.type==="contextmenu"&&p==="contextmenu"||f.type!=="contextmenu")&&e(0,g=!1)}function Le(f){y&&g&&O.isOpen()&&f.marker!==s&&e(0,g=!1)}Ye(()=>{r&&(O!=null&&O.isOpen())&&O.remove()});let te;const Ue=()=>e(0,g=!1);function Ze(f){X[f?"unshift":"push"](()=>{te=f,e(1,te)})}return o.$$set=f=>{"closeButton"in f&&e(11,d=f.closeButton),"closeOnClickOutside"in f&&e(12,y=f.closeOnClickOutside),"closeOnClickInside"in f&&e(13,M=f.closeOnClickInside),"closeOnMove"in f&&e(14,H=f.closeOnMove),"openOn"in f&&e(15,p=f.openOn),"openIfTopMost"in f&&e(16,N=f.openIfTopMost),"focusAfterOpen"in f&&e(17,G=f.focusAfterOpen),"anchor"in f&&e(18,L=f.anchor),"offset"in f&&e(19,E=f.offset),"popupClass"in f&&e(20,D=f.popupClass),"maxWidth"in f&&e(21,b=f.maxWidth),"lngLat"in f&&e(10,_=f.lngLat),"html"in f&&e(22,m=f.html),"open"in f&&e(0,g=f.open),"$$scope"in f&&e(29,c=f.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&14336&&e(27,n=d??(!y&&!M)),o.$$.dirty[0]&146685952&&(O||(e(23,O=new ee.Popup({closeButton:n,closeOnClick:!1,closeOnMove:H,focusAfterOpen:G,maxWidth:b,className:D,anchor:L,offset:E})),K=O.getElement(),O.on("open",()=>{e(0,g=!0),Ke(),q("open",O)}),O.on("close",()=>{e(0,g=!1),q("close",O)}),O.on("hover",()=>{q("hover",O)}))),o.$$.dirty[0]&8421384&&O&&s instanceof ee.Marker&&(p==="click"?s.setPopup(O):s.getPopup()===O&&s.setPopup(void 0)),o.$$.dirty[0]&268468224&&qe.includes(p)&&(i==null?void 0:i.type)===p&&(Q(i),xe(se,i=null,i)),o.$$.dirty[0]&268468224&&e(26,l=p==="hover"&&((i==null?void 0:i.type)==="mousemove"||(i==null?void 0:i.type)==="mouseenter")),o.$$.dirty[0]&352354304&&p==="hover"&&se&&(l&&i&&Ce(i),e(0,g=(l||re)??!1)),o.$$.dirty[0]&12582914&&(te?O.setDOMContent(te):m&&O.setHTML(m)),o.$$.dirty[0]&8389632&&_&&O.setLngLat(_),o.$$.dirty[0]&41943045&&r){let f=O.isOpen();g&&!f?(O.addTo(r),R==="opening"&&e(25,R="justOpened")):!g&&f&&O.remove()}},[g,te,r,s,V,le,ke,se,we,w,_,d,y,M,H,p,N,G,L,E,D,b,m,O,re,R,l,n,i,c,a,Ue,Ze]}class _t extends me{constructor(t){super(),de(this,t,pt,dt,pe,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}let ce="match-linestrings-review";function gt(o){let t,e,n,l,r,i=JSON.stringify(o[1].features[o[0]].properties.matching_sources)+"",s,u,a,c,w,d,y,M,H,p,N,G,L,E;return{c(){t=j("div"),e=j("h3"),n=I("Target "),l=I(o[0]),r=I(": "),s=I(i),u=J(),a=j("button"),a.innerHTML=`<kbd>Escape</kbd>
     - Back`,c=J(),w=j("h6"),w.textContent="Click sources to add or remove",d=J(),y=j("div"),M=j("button"),M.innerHTML=`<kbd>1</kbd>
    - Unreviewed`,H=J(),p=j("button"),p.innerHTML=`<kbd>2</kbd>
    - Not sure`,N=J(),G=j("button"),G.innerHTML=`<kbd>3</kbd>
    - Confirm correct`,T(a,"class","btn btn-secondary"),F(t,"display","flex"),F(t,"justify-content","space-between"),T(M,"class","btn btn-danger svelte-1tzb8bs"),$(M,"current",o[4]=="unreviewed"),T(p,"class","btn btn-warning svelte-1tzb8bs"),$(p,"current",o[4]=="not sure"),T(G,"class","btn btn-success svelte-1tzb8bs"),$(G,"current",o[4]=="confirmed"),F(y,"display","flex"),F(y,"justify-content","space-between")},m(D,b){h(D,t,b),v(t,e),v(e,n),v(e,l),v(e,r),v(e,s),v(t,u),v(t,a),h(D,c,b),h(D,w,b),h(D,d,b),h(D,y,b),v(y,M),v(y,H),v(y,p),v(y,N),v(y,G),L||(E=[B(window,"keydown",o[5]),B(a,"click",function(){lt(o[3])&&o[3].apply(this,arguments)}),B(M,"click",o[6]),B(p,"click",o[7]),B(G,"click",o[8])],L=!0)},p(D,[b]){o=D,b&1&&W(l,o[0]),b&3&&i!==(i=JSON.stringify(o[1].features[o[0]].properties.matching_sources)+"")&&W(s,i),b&16&&$(M,"current",o[4]=="unreviewed"),b&16&&$(p,"current",o[4]=="not sure"),b&16&&$(G,"current",o[4]=="confirmed")},i:Y,o:Y,d(D){D&&(k(t),k(c),k(w),k(d),k(y)),L=!1,he(E)}}}function bt(o,t,e){let n,{clickedTarget:l}=t,{targetGj:r}=t,{onConfirm:i}=t,{onCancel:s}=t;function u(d){d.target.tagName!="INPUT"&&(d.key=="1"?i("unreviewed"):d.key=="2"?i("not sure"):d.key=="3"?i("confirmed"):d.key=="Escape"&&s())}const a=()=>i("unreviewed"),c=()=>i("not sure"),w=()=>i("confirmed");return o.$$set=d=>{"clickedTarget"in d&&e(0,l=d.clickedTarget),"targetGj"in d&&e(1,r=d.targetGj),"onConfirm"in d&&e(2,i=d.onConfirm),"onCancel"in d&&e(3,s=d.onCancel)},o.$$.update=()=>{o.$$.dirty&3&&e(4,n=r.features[l].properties.reviewed)},[l,r,i,s,n,u,a,c,w]}class ht extends me{constructor(t){super(),de(this,t,bt,gt,pe,{clickedTarget:0,targetGj:1,onConfirm:2,onCancel:3})}}function He(o){let t,e,n,l,r=o[0].features.length+"",i,s,u,a=o[1].features.length+"",c,w,d,y=o[1].features.filter(Fe).length+"",M,H,p,N,G,L,E,D,b,_=!o[3]&&Je(o);return{c(){t=j("button"),e=I("Swap"),n=J(),l=j("p"),i=I(r),s=I(` sources and
    `),u=j("span"),c=I(a),w=I(" targets"),d=I(`
    , with `),M=I(y),H=I(" matching a source"),p=J(),N=j("button"),N.textContent="Start review",G=J(),_&&_.c(),L=_e(),T(t,"class","btn btn-secondary"),t.disabled=o[3],F(u,"color","red"),T(N,"class","btn btn-primary mb-5")},m(m,g){h(m,t,g),v(t,e),h(m,n,g),h(m,l,g),v(l,i),v(l,s),v(l,u),v(u,c),v(u,w),v(l,d),v(l,M),v(l,H),h(m,p,g),h(m,N,g),h(m,G,g),_&&_.m(m,g),h(m,L,g),E=!0,D||(b=[B(t,"click",o[8]),B(N,"click",o[11])],D=!0)},p(m,g){(!E||g&8)&&(t.disabled=m[3]),(!E||g&1)&&r!==(r=m[0].features.length+"")&&W(i,r),(!E||g&2)&&a!==(a=m[1].features.length+"")&&W(c,a),(!E||g&2)&&y!==(y=m[1].features.filter(Fe).length+"")&&W(M,y),m[3]?_&&(U(),S(_,1,1,()=>{_=null}),Z()):_?(_.p(m,g),g&8&&C(_,1)):(_=Je(m),_.c(),C(_,1),_.m(L.parentNode,L))},i(m){E||(C(_),E=!0)},o(m){S(_),E=!1},d(m){m&&(k(t),k(n),k(l),k(p),k(N),k(G),k(L)),_&&_.d(m),D=!1,he(b)}}}function Je(o){let t,e,n;function l(i){o[12](i)}let r={onChange:o[6]};return o[4]!==void 0&&(r.options=o[4]),t=new st({props:r}),X.push(()=>ne(t,"options",l)),{c(){P(t.$$.fragment)},m(i,s){z(t,i,s),n=!0},p(i,s){const u={};!e&&s&16&&(e=!0,u.options=i[4],oe(()=>e=!1)),t.$set(u)},i(i){n||(C(t.$$.fragment,i),n=!0)},o(i){S(t.$$.fragment,i),n=!1},d(i){A(t,i)}}}function kt(o){let t,e,n,l,r,i,s,u,a=o[0].features.length>0&&He(o);return{c(){t=j("label"),e=I(`Load two .geojson files
  `),n=j("input"),l=J(),a&&a.c(),r=_e(),T(n,"class","form-control"),T(n,"type","file"),n.multiple=!0,T(t,"class","form-label")},m(c,w){h(c,t,w),v(t,e),v(t,n),o[10](n),h(c,l,w),a&&a.m(c,w),h(c,r,w),i=!0,s||(u=B(n,"change",o[7]),s=!0)},p(c,[w]){c[0].features.length>0?a?(a.p(c,w),w&1&&C(a,1)):(a=He(c),a.c(),C(a,1),a.m(r.parentNode,r)):a&&(U(),S(a,1,1,()=>{a=null}),Z())},i(c){i||(C(a),i=!0)},o(c){S(a),i=!1},d(c){c&&(k(t),k(l),k(r)),o[10](null),a&&a.d(c),s=!1,u()}}}function Be(o){let t=0;for(let e of o.features)e.id=t++,e.properties??(e.properties={});return o}const Fe=o=>o.properties.matching_sources.length>0;function wt(o,t,e){let{sourceGj:n}=t,{targetGj:l}=t,{setupDone:r}=t,{zoomFit:i}=t,s=!1,u={buffer_meters:20,angle_diff_threshold:10,length_ratio_threshold:1.1,midpt_dist_threshold:15};function a(){var p;if(!s)try{let N=JSON.parse(rt(JSON.stringify(n),JSON.stringify(l),u));for(let[G,L]of l.features.entries())L.properties.matching_sources=N[G].matching_sources,(p=L.properties).reviewed??(p.reviewed="unreviewed");e(1,l)}catch(N){window.alert(`Bug: ${N}`)}}let c;async function w(p){if(!c.files)return;if(c.files.length!=2){window.alert("Select two GeoJSON files");return}try{let G=await c.files[0].text(),L=await c.files[1].text();e(0,n=Be(JSON.parse(G))),e(1,l=Be(JSON.parse(L))),"matching_sources"in l.features[0].properties?e(3,s=!0):"matching_sources"in n.features[0].properties&&(e(3,s=!0),e(0,[n,l]=[l,n],n,e(1,l))),i(),a()}catch(G){window.alert(`Bad input file: ${G}`)}}function d(){e(0,[n,l]=[l,n],n,e(1,l)),a()}function y(p){X[p?"unshift":"push"](()=>{c=p,e(5,c)})}const M=()=>e(2,r=!0);function H(p){u=p,e(4,u)}return o.$$set=p=>{"sourceGj"in p&&e(0,n=p.sourceGj),"targetGj"in p&&e(1,l=p.targetGj),"setupDone"in p&&e(2,r=p.setupDone),"zoomFit"in p&&e(9,i=p.zoomFit)},[n,l,r,s,u,c,a,w,d,i,y,M,H]}class yt extends me{constructor(t){super(),de(this,t,wt,kt,pe,{sourceGj:0,targetGj:1,setupDone:2,zoomFit:9})}}const{window:vt}=ut;function Ct(o){let t,e,n,l,r,i,s,u,a,c,w,d,y,M,H=o[1].features.length+"",p,N,G,L,E,D;return{c(){t=j("div"),e=j("button"),e.textContent="Start over",n=J(),l=j("button"),l.textContent="Zoom to fit",r=J(),i=j("br"),s=J(),u=j("div"),a=j("div"),w=J(),d=j("p"),y=I(o[4]),M=I(" / "),p=I(H),N=I(" targets reviewed"),G=J(),L=j("button"),L.textContent="Download reviews",T(e,"class","btn btn-outline-danger"),T(l,"class","btn btn-outline-secondary"),F(t,"display","flex"),F(t,"justify-content","space-between"),T(a,"class","progress-bar"),F(a,"width",`${100*o[4]/o[1].features.length}%`),T(u,"class","progress"),T(u,"role","progressbar"),T(u,"aria-valuenow",o[4]),T(u,"aria-valuemin","0"),T(u,"aria-valuemax",c=o[1].features.length),T(L,"class","btn btn-outline-success")},m(b,_){h(b,t,_),v(t,e),v(t,n),v(t,l),h(b,r,_),h(b,i,_),h(b,s,_),h(b,u,_),v(u,a),h(b,w,_),h(b,d,_),v(d,y),v(d,M),v(d,p),v(d,N),h(b,G,_),h(b,L,_),E||(D=[B(e,"click",o[12]),B(l,"click",o[7]),B(L,"click",o[11])],E=!0)},p(b,_){_&18&&F(a,"width",`${100*b[4]/b[1].features.length}%`),_&16&&T(u,"aria-valuenow",b[4]),_&2&&c!==(c=b[1].features.length)&&T(u,"aria-valuemax",c),_&16&&W(y,b[4]),_&2&&H!==(H=b[1].features.length+"")&&W(p,H)},i:Y,o:Y,d(b){b&&(k(t),k(r),k(i),k(s),k(u),k(w),k(d),k(G),k(L)),E=!1,he(D)}}}function Ot(o){let t,e,n,l,r;function i(c){o[18](c)}function s(c){o[19](c)}function u(c){o[20](c)}let a={zoomFit:o[7]};return o[0]!==void 0&&(a.sourceGj=o[0]),o[1]!==void 0&&(a.targetGj=o[1]),o[2]!==void 0&&(a.setupDone=o[2]),t=new yt({props:a}),X.push(()=>ne(t,"sourceGj",i)),X.push(()=>ne(t,"targetGj",s)),X.push(()=>ne(t,"setupDone",u)),{c(){P(t.$$.fragment)},m(c,w){z(t,c,w),r=!0},p(c,w){const d={};!e&&w&1&&(e=!0,d.sourceGj=c[0],oe(()=>e=!1)),!n&&w&2&&(n=!0,d.targetGj=c[1],oe(()=>n=!1)),!l&&w&4&&(l=!0,d.setupDone=c[2],oe(()=>l=!1)),t.$set(d)},i(c){r||(C(t.$$.fragment,c),r=!0)},o(c){S(t.$$.fragment,c),r=!1},d(c){A(t,c)}}}function jt(o){let t,e,n,l,r,i,s,u;const a=[Ot,Ct],c=[];function w(d,y){return d[2]?1:0}return i=w(o),s=c[i]=a[i](o),{c(){t=j("div"),e=j("h1"),e.textContent="Manually specify LineString matchings for test cases",n=J(),l=j("div"),l.innerHTML='<a class="icon-link mb-3" href="https://github.com/nptscot/match_linestrings/blob/main/tests/README.md" target="_blank">About <i class="fa-solid fa-arrow-up-right-from-square"></i></a>',r=J(),s.c(),T(t,"slot","left")},m(d,y){h(d,t,y),v(t,e),v(t,n),v(t,l),v(t,r),c[i].m(t,null),u=!0},p(d,y){let M=i;i=w(d),i===M?c[i].p(d,y):(U(),S(c[M],1,1,()=>{c[M]=null}),Z(),s=c[i],s?s.p(d,y):(s=c[i]=a[i](d),s.c()),C(s,1),s.m(t,null))},i(d){u||(C(s),u=!0)},o(d){S(s),u=!1},d(d){d&&k(t),c[i].d()}}}function Pe(o){let t,e,n,l;const r=[Gt,Mt],i=[];function s(u,a){return u[3]==null?0:1}return e=s(o),n=i[e]=r[e](o),{c(){t=j("div"),n.c(),T(t,"class","map-panel svelte-hr6p1s")},m(u,a){h(u,t,a),i[e].m(t,null),l=!0},p(u,a){let c=e;e=s(u),e===c?i[e].p(u,a):(U(),S(i[c],1,1,()=>{i[c]=null}),Z(),n=i[e],n?n.p(u,a):(n=i[e]=r[e](u),n.c()),C(n,1),n.m(t,null))},i(u){l||(C(n),l=!0)},o(u){S(n),l=!1},d(u){u&&k(t),i[e].d()}}}function Mt(o){let t,e;return t=new ht({props:{clickedTarget:o[3],targetGj:o[1],onConfirm:o[8],onCancel:o[15]}}),{c(){P(t.$$.fragment)},m(n,l){z(t,n,l),e=!0},p(n,l){const r={};l&8&&(r.clickedTarget=n[3]),l&2&&(r.targetGj=n[1]),l&8&&(r.onCancel=n[15]),t.$set(r)},i(n){e||(C(t.$$.fragment,n),e=!0)},o(n){S(t.$$.fragment,n),e=!1},d(n){A(t,n)}}}function Gt(o){let t,e,n;return{c(){t=j("button"),t.innerHTML=`Goto <kbd>n</kbd>
              ext unreviewed`,T(t,"class","btn btn-primary")},m(l,r){h(l,t,r),e||(n=B(t,"click",o[9]),e=!0)},p:Y,i:Y,o:Y,d(l){l&&k(t),e=!1,n()}}}function ze(o){let t,e;return t=new _t({props:{openOn:"hover",$$slots:{default:[Lt,({data:n})=>({21:n}),({data:n})=>n?2097152:0]},$$scope:{ctx:o}}}),{c(){P(t.$$.fragment)},m(n,l){z(t,n,l),e=!0},p(n,l){const r={};l&6291520&&(r.$$scope={dirty:l,ctx:n}),t.$set(r)},i(n){e||(C(t.$$.fragment,n),e=!0)},o(n){S(t.$$.fragment,n),e=!1},d(n){A(t,n)}}}function Lt(o){let t,e=ae(o[21]).id+"",n,l,r=o[6].includes(ae(o[21]).id)?"remove":"add",i;return{c(){t=I("Source "),n=I(e),l=I(" -- click to "),i=I(r)},m(s,u){h(s,t,u),h(s,n,u),h(s,l,u),h(s,i,u)},p(s,u){u&2097152&&e!==(e=ae(s[21]).id+"")&&W(n,e),u&2097216&&r!==(r=s[6].includes(ae(s[21]).id)?"remove":"add")&&W(i,r)},d(s){s&&(k(t),k(n),k(l),k(i))}}}function St(o){let t,e,n=o[3]!=null&&ze(o);return{c(){n&&n.c(),t=_e()},m(l,r){n&&n.m(l,r),h(l,t,r),e=!0},p(l,r){l[3]!=null?n?(n.p(l,r),r&8&&C(n,1)):(n=ze(l),n.c(),C(n,1),n.m(t.parentNode,t)):n&&(U(),S(n,1,1,()=>{n=null}),Z())},i(l){e||(C(n),e=!0)},o(l){S(n),e=!1},d(l){l&&k(t),n&&n.d(l)}}}function Tt(o){let t,e;return t=new Re({props:{manageHoverState:!0,paint:{"line-color":["case",["in",["id"],["literal",o[6]]],"blue","black"],"line-width":8,"line-opacity":Ne(.5,1)},hoverCursor:o[3]==null?void 0:"pointer",$$slots:{default:[St]},$$scope:{ctx:o}}}),t.$on("click",o[14]),{c(){P(t.$$.fragment)},m(n,l){z(t,n,l),e=!0},p(n,l){const r={};l&64&&(r.paint={"line-color":["case",["in",["id"],["literal",n[6]]],"blue","black"],"line-width":8,"line-opacity":Ne(.5,1)}),l&8&&(r.hoverCursor=n[3]==null?void 0:"pointer"),l&4194376&&(r.$$scope={dirty:l,ctx:n}),t.$set(r)},i(n){e||(C(t.$$.fragment,n),e=!0)},o(n){S(t.$$.fragment,n),e=!1},d(n){A(t,n)}}}function Nt(o){let t,e;return t=new Re({props:{manageHoverState:!0,paint:{"line-width":["case",[">",["length",["get","matching_sources"]],0],8,16],"line-color":["match",["get","reviewed"],"unreviewed","red","not sure","orange","green"],"line-opacity":["case",["==",["id"],o[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,.3]},hoverCursor:"pointer"}}),t.$on("click",o[13]),{c(){P(t.$$.fragment)},m(n,l){z(t,n,l),e=!0},p(n,l){const r={};l&8&&(r.paint={"line-width":["case",[">",["length",["get","matching_sources"]],0],8,16],"line-color":["match",["get","reviewed"],"unreviewed","red","not sure","orange","green"],"line-opacity":["case",["==",["id"],n[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,.3]}),t.$set(r)},i(n){e||(C(t.$$.fragment,n),e=!0)},o(n){S(t.$$.fragment,n),e=!1},d(n){A(t,n)}}}function Dt(o){let t,e,n,l,r,i=o[2]&&Pe(o);return e=new Te({props:{data:o[0],$$slots:{default:[Tt]},$$scope:{ctx:o}}}),l=new Te({props:{data:o[1],$$slots:{default:[Nt]},$$scope:{ctx:o}}}),{c(){i&&i.c(),t=J(),P(e.$$.fragment),n=J(),P(l.$$.fragment)},m(s,u){i&&i.m(s,u),h(s,t,u),z(e,s,u),h(s,n,u),z(l,s,u),r=!0},p(s,u){s[2]?i?(i.p(s,u),u&4&&C(i,1)):(i=Pe(s),i.c(),C(i,1),i.m(t.parentNode,t)):i&&(U(),S(i,1,1,()=>{i=null}),Z());const a={};u&1&&(a.data=s[0]),u&4194376&&(a.$$scope={dirty:u,ctx:s}),e.$set(a);const c={};u&2&&(c.data=s[1]),u&4194312&&(c.$$scope={dirty:u,ctx:s}),l.$set(c)},i(s){r||(C(i),C(e.$$.fragment,s),C(l.$$.fragment,s),r=!0)},o(s){S(i),S(e.$$.fragment,s),S(l.$$.fragment,s),r=!1},d(s){s&&(k(t),k(n)),i&&i.d(s),A(e,s),A(l,s)}}}function Et(o){let t,e,n,l;function r(s){o[16](s)}let i={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Dt]},$$scope:{ctx:o}};return o[5]!==void 0&&(i.map=o[5]),e=new ft({props:i}),X.push(()=>ne(e,"map",r)),e.$on("error",o[17]),{c(){t=j("div"),P(e.$$.fragment),T(t,"slot","main"),F(t,"position","relative"),F(t,"width","100%"),F(t,"height","100vh")},m(s,u){h(s,t,u),z(e,t,null),l=!0},p(s,u){const a={};u&4194383&&(a.$$scope={dirty:u,ctx:s}),!n&&u&32&&(n=!0,a.map=s[5],oe(()=>n=!1)),e.$set(a)},i(s){l||(C(e.$$.fragment,s),l=!0)},o(s){S(e.$$.fragment,s),l=!1},d(s){s&&k(t),A(e)}}}function It(o){let t,e,n,l;return t=new it({props:{$$slots:{main:[Et],left:[jt]},$$scope:{ctx:o}}}),{c(){P(t.$$.fragment)},m(r,i){z(t,r,i),e=!0,n||(l=B(vt,"keydown",o[10]),n=!0)},p(r,[i]){const s={};i&4194431&&(s.$$scope={dirty:i,ctx:r}),t.$set(s)},i(r){e||(C(t.$$.fragment,r),e=!0)},o(r){S(t.$$.fragment,r),e=!1},d(r){A(t,r),n=!1,l()}}}function Ht(o,t,e){let n,l,r,i=fe(),s=fe(),u=!1,a=null;Ae(async()=>{await at();try{let m=window.localStorage.getItem(ce);if(m){let g=JSON.parse(m);e(0,[i,s]=g,i,e(1,s)),e(2,u=!0),console.log(`Restored data from local storage ${ce}`)}}catch(m){console.log(`Couldn't restore data from local storage: ${m}`)}});function c(){let m={type:"FeatureCollection",features:[...i.features,...s.features]};r==null||r.fitBounds(Se(m),{animate:!1,padding:10})}function w(m){if(a==null)throw new Error("impossible");e(1,s.features[a].properties.reviewed=m,s),e(1,s),e(3,a=null)}function d(){for(let m of s.features)if(m.properties.reviewed=="unreviewed"){r==null||r.fitBounds(Se(m),{duration:600,padding:200}),e(3,a=m.id);return}}function y(m){m.target.tagName=="INPUT"||!u||m.key=="n"&&d()}function M(){ct("reviewed_targets.geojson",JSON.stringify(s))}function H(){window.confirm("Do you want to discard this review and start over?")&&(e(0,i=fe()),e(1,s=fe()),e(2,u=!1),e(3,a=null),window.localStorage.removeItem(ce))}function p(m){u&&e(3,a=m.detail.features[0].id)}function N(m){if(!u||a==null)return;let g=m.detail.features[0].id,q=s.features[a].properties;q.matching_sources.includes(g)?q.matching_sources=q.matching_sources.filter(le=>le!=g):q.matching_sources.push(g),e(1,s)}const G=()=>e(3,a=null);function L(m){r=m,e(5,r)}const E=m=>{console.log(m.detail.error)};function D(m){i=m,e(0,i)}function b(m){s=m,e(1,s)}function _(m){u=m,e(2,u)}return o.$$.update=()=>{o.$$.dirty&10&&e(6,n=a==null?[]:s.features[a].properties.matching_sources),o.$$.dirty&2&&e(4,l=s.features.filter(m=>m.properties.reviewed!="unreviewed").length),o.$$.dirty&23&&u&&(console.log(`Autosaving with ${l} reviewed targets`),window.localStorage.setItem(ce,JSON.stringify([i,s])))},[i,s,u,a,l,r,n,c,w,d,y,M,H,p,N,G,L,E,D,b,_]}class Jt extends me{constructor(t){super(),de(this,t,Ht,It,pe,{})}}new Jt({target:document.getElementById("app")});
