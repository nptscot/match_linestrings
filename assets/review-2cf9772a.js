import{S as ce,i as ae,s as me,P as ge,r as h,t as y,w as X,g as G,x as Y,y as k,Q as qe,R as Ze,T as Qe,U as re,o as Pe,V as $,W as Ve,X as Xe,j as v,Y as Ye,Z as xe,$ as $e,a0 as et,a1 as tt,z as Q,n as N,k as J,B as U,u as C,v as F,I as W,a2 as V,J as he,q as A,H as nt,A as ne,d as H,e as P,C as oe,h as z,E as ot,L as lt,a3 as st,M as it,D as ue,_ as rt,G as ut,F as Se,K as Le,N as ze,O as Te,a4 as fe}from"./Settings-e8a97dfe.js";const ft=s=>({features:s[0]&16,data:s[0]&16,map:s[0]&4,close:s[0]&1}),Ne=s=>{var n;return{features:s[4],data:((n=s[4])==null?void 0:n[0])??null,map:s[2],close:s[31]}};function De(s){var l;let n,e,t=(((l=s[4])==null?void 0:l.length)||s[3]instanceof $.Marker)&&Ee(s);return{c(){n=v("div"),t&&t.c()},m(o,r){h(o,n,r),t&&t.m(n,null),s[32](n),e=!0},p(o,r){var i;(i=o[4])!=null&&i.length||o[3]instanceof $.Marker?t?(t.p(o,r),r[0]&24&&y(t,1)):(t=Ee(o),t.c(),y(t,1),t.m(n,null)):t&&(X(),G(t,1,1,()=>{t=null}),Y())},i(o){e||(y(t),e=!0)},o(o){G(t),e=!1},d(o){o&&k(n),t&&t.d(),s[32](null)}}}function Ee(s){let n;const e=s[30].default,t=Ye(e,s,s[29],Ne);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),n=!0},p(l,o){t&&t.p&&(!n||o[0]&536870933)&&xe(t,e,l,l[29],n?et(e,l[29],o,ft):$e(l[29]),Ne)},i(l){n||(y(t,l),n=!0)},o(l){G(t,l),n=!1},d(l){t&&t.d(l)}}}function ct(s){let n,e,t=s[9].default&&De(s);return{c(){t&&t.c(),n=ge()},m(l,o){t&&t.m(l,o),h(l,n,o),e=!0},p(l,o){l[9].default?t?(t.p(l,o),o[0]&512&&y(t,1)):(t=De(l),t.c(),y(t,1),t.m(n.parentNode,n)):t&&(X(),G(t,1,1,()=>{t=null}),Y())},i(l){e||(y(t),e=!0)},o(l){G(t),e=!1},d(l){l&&k(n),t&&t.d(l)}}}function at(s,n,e){let t,l,o,r,i,u,{$$slots:a={},$$scope:f}=n;const d=qe(a);let{closeButton:O=void 0}=n,{closeOnClickOutside:T=!0}=n,{closeOnClickInside:D=!1}=n,{closeOnMove:_=!1}=n,{openOn:g="click"}=n,{openIfTopMost:L=!0}=n,{focusAfterOpen:b=!0}=n,{anchor:M=void 0}=n,{offset:I=void 0}=n,{popupClass:j=void 0}=n,{maxWidth:S=void 0}=n,{lngLat:p=void 0}=n,{html:B=void 0}=n,{open:m=!1}=n;const E=Ze(),{map:ee,popupTarget:ke,layerEvent:le,layer:be,eventTopMost:Re,markerClickManager:we}=Qe();re(s,ee,c=>e(2,o=c)),re(s,ke,c=>e(3,i=c)),re(s,le,c=>e(28,r=c)),re(s,be,c=>e(35,u=c));const Ae=["click","dblclick","contextmenu"];let w,se=!1,K;function We(){if(!w)return;let c=w.getElement();!c||c===K||(K=c,g==="hover"&&(K.style.pointerEvents="none"),K.addEventListener("mouseenter",()=>{e(24,se=!0)},{passive:!0}),K.addEventListener("mouseleave",()=>{e(24,se=!1)},{passive:!0}),K.addEventListener("click",()=>{D&&e(0,m=!1)},{passive:!0}))}Pe(()=>{if(o)return o.on("click",ie),o.on("contextmenu",ie),we.add(Me),typeof i=="string"&&(o.on("click",i,Z),o.on("dblclick",i,Z),o.on("contextmenu",i,Z),o.on("mousemove",i,Ge),o.on("mouseleave",i,ve),o.on("touchstart",i,Ce),o.on("touchend",i,je)),()=>{o!=null&&o.loaded()&&(w==null||w.remove(),o.off("click",ie),o.off("contextmenu",ie),we.remove(Me),i instanceof $.Marker?i.getPopup()===w&&i.setPopup(void 0):typeof i=="string"&&(o.off("click",i,Z),o.off("dblclick",i,Z),o.off("contextmenu",i,Z),o.off("mousemove",i,Ge),o.off("mouseleave",i,ve),o.off("touchstart",i,Ce),o.off("touchend",i,je)))}});function ye(c){return L?!("marker"in c)&&!tt(c)&&Re(c)!==u:!1}let q=null,R="normal";function Oe(c){"layerType"in c&&c.layerType==="deckgl"?(e(10,p=c.coordinate),e(4,q=c.object?[c.object]:null)):(e(10,p=c.lngLat),e(4,q=c.features??[]))}function Z(c){c.type!==g||ye(c)||(Oe(c),setTimeout(()=>e(0,m=!0)))}let x=null;function Ce(c){x=c.point}function je(c){if(!x||g!=="hover")return;let pe=x.dist(c.point);x=null,pe<3&&(e(10,p=c.lngLat),e(4,q=c.features??[]),w.isOpen()?e(25,R="justOpened"):(e(25,R="opening"),e(0,m=!0)))}function ve(c){g!=="hover"||x||R!=="normal"||(e(0,m=!1),e(4,q=null))}function Ge(c){if(!(g!=="hover"||x||R!=="normal")){if(ye(c)){e(0,m=!1),e(4,q=null);return}e(0,m=!0),e(4,q=c.features??[]),e(10,p=c.lngLat)}}function ie(c){if(R==="justOpened"){e(25,R="normal");return}if(!T)return;let pe=[K,i instanceof $.Marker?i==null?void 0:i.getElement():null];m&&w.isOpen()&&!pe.some(de=>de==null?void 0:de.contains(c.originalEvent.target))&&(c.type==="contextmenu"&&g==="contextmenu"||c.type!=="contextmenu")&&e(0,m=!1)}function Me(c){T&&m&&w.isOpen()&&c.marker!==i&&e(0,m=!1)}Ve(()=>{o&&(w!=null&&w.isOpen())&&w.remove()});let te;const Ke=()=>e(0,m=!1);function Ue(c){Q[c?"unshift":"push"](()=>{te=c,e(1,te)})}return s.$$set=c=>{"closeButton"in c&&e(11,O=c.closeButton),"closeOnClickOutside"in c&&e(12,T=c.closeOnClickOutside),"closeOnClickInside"in c&&e(13,D=c.closeOnClickInside),"closeOnMove"in c&&e(14,_=c.closeOnMove),"openOn"in c&&e(15,g=c.openOn),"openIfTopMost"in c&&e(16,L=c.openIfTopMost),"focusAfterOpen"in c&&e(17,b=c.focusAfterOpen),"anchor"in c&&e(18,M=c.anchor),"offset"in c&&e(19,I=c.offset),"popupClass"in c&&e(20,j=c.popupClass),"maxWidth"in c&&e(21,S=c.maxWidth),"lngLat"in c&&e(10,p=c.lngLat),"html"in c&&e(22,B=c.html),"open"in c&&e(0,m=c.open),"$$scope"in c&&e(29,f=c.$$scope)},s.$$.update=()=>{if(s.$$.dirty[0]&14336&&e(27,t=O??(!T&&!D)),s.$$.dirty[0]&146685952&&(w||(e(23,w=new $.Popup({closeButton:t,closeOnClick:!1,closeOnMove:_,focusAfterOpen:b,maxWidth:S,className:j,anchor:M,offset:I})),K=w.getElement(),w.on("open",()=>{e(0,m=!0),We(),E("open",w)}),w.on("close",()=>{e(0,m=!1),E("close",w)}),w.on("hover",()=>{E("hover",w)}))),s.$$.dirty[0]&8421384&&w&&i instanceof $.Marker&&(g==="click"?i.setPopup(w):i.getPopup()===w&&i.setPopup(void 0)),s.$$.dirty[0]&268468224&&Ae.includes(g)&&(r==null?void 0:r.type)===g&&(Z(r),Xe(le,r=null,r)),s.$$.dirty[0]&268468224&&e(26,l=g==="hover"&&((r==null?void 0:r.type)==="mousemove"||(r==null?void 0:r.type)==="mouseenter")),s.$$.dirty[0]&352354304&&g==="hover"&&le&&(l&&r&&Oe(r),e(0,m=(l||se)??!1)),s.$$.dirty[0]&12582914&&(te?w.setDOMContent(te):B&&w.setHTML(B)),s.$$.dirty[0]&8389632&&p&&w.setLngLat(p),s.$$.dirty[0]&41943045&&o){let c=w.isOpen();m&&!c?(w.addTo(o),R==="opening"&&e(25,R="justOpened")):!m&&c&&w.remove()}},[m,te,o,i,q,ee,ke,le,be,d,p,O,T,D,_,g,L,b,M,I,j,S,B,w,se,R,l,t,r,f,a,Ke,Ue]}class mt extends ce{constructor(n){super(),ae(this,n,at,ct,me,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}let _e="match-linestrings-review";function pt(s){let n,e,t,l,o=JSON.stringify(s[1].features[s[0]].properties.matching_sources)+"",r,i,u,a,f,d,O,T,D,_,g,L;return{c(){n=v("h3"),e=N("Target "),t=N(s[0]),l=N(": "),r=N(o),i=J(),u=v("p"),u.textContent="Click sources to add or remove",a=J(),f=v("div"),d=v("button"),d.innerHTML=`<kbd>1</kbd>
    - Unreviewed`,O=J(),T=v("button"),T.innerHTML=`<kbd>2</kbd>
    - Not sure`,D=J(),_=v("button"),_.innerHTML=`<kbd>3</kbd>
    - Confirm correct`,U(f,"display","flex"),U(f,"justify-content","space-between")},m(b,M){h(b,n,M),C(n,e),C(n,t),C(n,l),C(n,r),h(b,i,M),h(b,u,M),h(b,a,M),h(b,f,M),C(f,d),C(f,O),C(f,T),C(f,D),C(f,_),g||(L=[F(window,"keydown",s[3]),F(d,"click",s[4]),F(T,"click",s[5]),F(_,"click",s[6])],g=!0)},p(b,[M]){M&1&&W(t,b[0]),M&3&&o!==(o=JSON.stringify(b[1].features[b[0]].properties.matching_sources)+"")&&W(r,o)},i:V,o:V,d(b){b&&(k(n),k(i),k(u),k(a),k(f)),g=!1,he(L)}}}function dt(s,n,e){let{clickedTarget:t}=n,{targetGj:l}=n,{onConfirm:o}=n;function r(f){f.target.tagName!="INPUT"&&(f.key=="1"?o("unreviewed"):f.key=="2"?o("not sure"):f.key=="3"&&o("confirmed"))}const i=()=>o("unreviewed"),u=()=>o("not sure"),a=()=>o("confirmed");return s.$$set=f=>{"clickedTarget"in f&&e(0,t=f.clickedTarget),"targetGj"in f&&e(1,l=f.targetGj),"onConfirm"in f&&e(2,o=f.onConfirm)},[t,l,o,r,i,u,a]}class _t extends ce{constructor(n){super(),ae(this,n,dt,pt,me,{clickedTarget:0,targetGj:1,onConfirm:2})}}function Ie(s){let n,e,t,l=s[0].features.length+"",o,r,i,u=s[1].features.length+"",a,f,d,O=s[1].features.filter(Be).length+"",T,D,_,g,L,b,M,I,j,S;function p(m){s[10](m)}let B={onChange:s[5]};return s[3]!==void 0&&(B.options=s[3]),g=new nt({props:B}),Q.push(()=>ne(g,"options",p)),{c(){n=v("button"),n.textContent="Swap",e=J(),t=v("p"),o=N(l),r=N(` sources and
    `),i=v("span"),a=N(u),f=N(" targets"),d=N(`
    , with `),T=N(O),D=N(" matching a source"),_=J(),H(g.$$.fragment),b=J(),M=v("button"),M.textContent="Start review",A(n,"class","secondary"),U(i,"color","red")},m(m,E){h(m,n,E),h(m,e,E),h(m,t,E),C(t,o),C(t,r),C(t,i),C(i,a),C(i,f),C(t,d),C(t,T),C(t,D),h(m,_,E),P(g,m,E),h(m,b,E),h(m,M,E),I=!0,j||(S=[F(n,"click",s[7]),F(M,"click",s[11])],j=!0)},p(m,E){(!I||E&1)&&l!==(l=m[0].features.length+"")&&W(o,l),(!I||E&2)&&u!==(u=m[1].features.length+"")&&W(a,u),(!I||E&2)&&O!==(O=m[1].features.filter(Be).length+"")&&W(T,O);const ee={};!L&&E&8&&(L=!0,ee.options=m[3],oe(()=>L=!1)),g.$set(ee)},i(m){I||(y(g.$$.fragment,m),I=!0)},o(m){G(g.$$.fragment,m),I=!1},d(m){m&&(k(n),k(e),k(t),k(_),k(b),k(M)),z(g,m),j=!1,he(S)}}}function gt(s){let n,e,t,l,o,r,i,u,a=s[0].features.length>0&&Ie(s);return{c(){n=v("label"),e=N(`Load two .geojson files
  `),t=v("input"),l=J(),a&&a.c(),o=ge(),A(t,"type","file"),t.multiple=!0},m(f,d){h(f,n,d),C(n,e),C(n,t),s[9](t),h(f,l,d),a&&a.m(f,d),h(f,o,d),r=!0,i||(u=F(t,"change",s[6]),i=!0)},p(f,[d]){f[0].features.length>0?a?(a.p(f,d),d&1&&y(a,1)):(a=Ie(f),a.c(),y(a,1),a.m(o.parentNode,o)):a&&(X(),G(a,1,1,()=>{a=null}),Y())},i(f){r||(y(a),r=!0)},o(f){G(a),r=!1},d(f){f&&(k(n),k(l),k(o)),s[9](null),a&&a.d(f),i=!1,u()}}}function Je(s){let n=0;for(let e of s.features)e.id=n++,e.properties??(e.properties={});return s}const Be=s=>s.properties.matching_sources.length>0;function ht(s,n,e){let{sourceGj:t}=n,{targetGj:l}=n,{setupDone:o}=n,{zoomFit:r}=n,i={buffer_meters:20,angle_diff_threshold:10,length_ratio_threshold:1.1,midpt_dist_threshold:15};function u(){var _;try{let g=JSON.parse(ot(JSON.stringify(t),JSON.stringify(l),i));for(let[L,b]of l.features.entries())b.properties.matching_sources=g[L].matching_sources,(_=b.properties).reviewed??(_.reviewed="unreviewed");e(1,l)}catch(g){window.alert(`Bug: ${g}`)}}let a;async function f(_){if(!a.files)return;if(a.files.length!=2){window.alert("Select two GeoJSON files");return}try{let L=await a.files[0].text(),b=await a.files[1].text();e(0,t=Je(JSON.parse(L))),e(1,l=Je(JSON.parse(b))),r(),u()}catch(L){window.alert(`Bad input file: ${L}`)}}function d(){e(0,[t,l]=[l,t],t,e(1,l)),u()}function O(_){Q[_?"unshift":"push"](()=>{a=_,e(4,a)})}function T(_){i=_,e(3,i)}const D=()=>e(2,o=!0);return s.$$set=_=>{"sourceGj"in _&&e(0,t=_.sourceGj),"targetGj"in _&&e(1,l=_.targetGj),"setupDone"in _&&e(2,o=_.setupDone),"zoomFit"in _&&e(8,r=_.zoomFit)},[t,l,o,i,a,u,f,d,r,O,T,D]}class kt extends ce{constructor(n){super(),ae(this,n,ht,gt,me,{sourceGj:0,targetGj:1,setupDone:2,zoomFit:8})}}const{window:bt}=st;function wt(s){let n,e,t,l,o,r,i,u,a,f,d,O,T,D=s[1].features.length+"",_,g,L,b,M,I;return{c(){n=v("div"),e=v("button"),e.textContent="Start over",t=J(),l=v("button"),l.textContent="Zoom to fit",o=J(),r=v("br"),i=J(),u=v("progress"),f=J(),d=v("p"),O=N(s[4]),T=N(" / "),_=N(D),g=N(" targets reviewed"),L=J(),b=v("button"),b.textContent="Download reviews",A(e,"class","secondary"),A(l,"class","secondary"),U(n,"display","flex"),U(n,"justify-content","space-between"),u.value=s[4],A(u,"max",a=s[1].features.length)},m(j,S){h(j,n,S),C(n,e),C(n,t),C(n,l),h(j,o,S),h(j,r,S),h(j,i,S),h(j,u,S),h(j,f,S),h(j,d,S),C(d,O),C(d,T),C(d,_),C(d,g),h(j,L,S),h(j,b,S),M||(I=[F(e,"click",s[12]),F(l,"click",s[7]),F(b,"click",s[11])],M=!0)},p(j,S){S&16&&(u.value=j[4]),S&2&&a!==(a=j[1].features.length)&&A(u,"max",a),S&16&&W(O,j[4]),S&2&&D!==(D=j[1].features.length+"")&&W(_,D)},i:V,o:V,d(j){j&&(k(n),k(o),k(r),k(i),k(u),k(f),k(d),k(L),k(b)),M=!1,he(I)}}}function yt(s){let n,e,t,l,o;function r(f){s[17](f)}function i(f){s[18](f)}function u(f){s[19](f)}let a={zoomFit:s[7]};return s[0]!==void 0&&(a.sourceGj=s[0]),s[1]!==void 0&&(a.targetGj=s[1]),s[2]!==void 0&&(a.setupDone=s[2]),n=new kt({props:a}),Q.push(()=>ne(n,"sourceGj",r)),Q.push(()=>ne(n,"targetGj",i)),Q.push(()=>ne(n,"setupDone",u)),{c(){H(n.$$.fragment)},m(f,d){P(n,f,d),o=!0},p(f,d){const O={};!e&&d&1&&(e=!0,O.sourceGj=f[0],oe(()=>e=!1)),!t&&d&2&&(t=!0,O.targetGj=f[1],oe(()=>t=!1)),!l&&d&4&&(l=!0,O.setupDone=f[2],oe(()=>l=!1)),n.$set(O)},i(f){o||(y(n.$$.fragment,f),o=!0)},o(f){G(n.$$.fragment,f),o=!1},d(f){z(n,f)}}}function Ot(s){let n,e,t,l,o,r;const i=[yt,wt],u=[];function a(f,d){return f[2]?1:0}return l=a(s),o=u[l]=i[l](s),{c(){n=v("div"),e=v("h1"),e.textContent="Match LineStrings - review results to make test cases",t=J(),o.c(),A(n,"slot","left")},m(f,d){h(f,n,d),C(n,e),C(n,t),u[l].m(n,null),r=!0},p(f,d){let O=l;l=a(f),l===O?u[l].p(f,d):(X(),G(u[O],1,1,()=>{u[O]=null}),Y(),o=u[l],o?o.p(f,d):(o=u[l]=i[l](f),o.c()),y(o,1),o.m(n,null))},i(f){r||(y(o),r=!0)},o(f){G(o),r=!1},d(f){f&&k(n),u[l].d()}}}function Fe(s){let n,e,t,l;const o=[jt,Ct],r=[];function i(u,a){return u[3]==null?0:1}return e=i(s),t=r[e]=o[e](s),{c(){n=v("div"),t.c(),A(n,"class","map-panel svelte-1lu903l")},m(u,a){h(u,n,a),r[e].m(n,null),l=!0},p(u,a){let f=e;e=i(u),e===f?r[e].p(u,a):(X(),G(r[f],1,1,()=>{r[f]=null}),Y(),t=r[e],t?t.p(u,a):(t=r[e]=o[e](u),t.c()),y(t,1),t.m(n,null))},i(u){l||(y(t),l=!0)},o(u){G(t),l=!1},d(u){u&&k(n),r[e].d()}}}function Ct(s){let n,e;return n=new _t({props:{clickedTarget:s[3],targetGj:s[1],onConfirm:s[8]}}),{c(){H(n.$$.fragment)},m(t,l){P(n,t,l),e=!0},p(t,l){const o={};l&8&&(o.clickedTarget=t[3]),l&2&&(o.targetGj=t[1]),n.$set(o)},i(t){e||(y(n.$$.fragment,t),e=!0)},o(t){G(n.$$.fragment,t),e=!1},d(t){z(n,t)}}}function jt(s){let n,e,t;return{c(){n=v("button"),n.innerHTML=`Goto <kbd>n</kbd>
              ext unreviewed`},m(l,o){h(l,n,o),e||(t=F(n,"click",s[9]),e=!0)},p:V,i:V,o:V,d(l){l&&k(n),e=!1,t()}}}function He(s){let n,e;return n=new mt({props:{openOn:"hover",$$slots:{default:[vt,({data:t})=>({20:t}),({data:t})=>t?1048576:0]},$$scope:{ctx:s}}}),{c(){H(n.$$.fragment)},m(t,l){P(n,t,l),e=!0},p(t,l){const o={};l&3145792&&(o.$$scope={dirty:l,ctx:t}),n.$set(o)},i(t){e||(y(n.$$.fragment,t),e=!0)},o(t){G(n.$$.fragment,t),e=!1},d(t){z(n,t)}}}function vt(s){let n,e=fe(s[20]).id+"",t,l,o=s[6].includes(fe(s[20]).id)?"remove":"add",r;return{c(){n=N("Source "),t=N(e),l=N(" -- click to "),r=N(o)},m(i,u){h(i,n,u),h(i,t,u),h(i,l,u),h(i,r,u)},p(i,u){u&1048576&&e!==(e=fe(i[20]).id+"")&&W(t,e),u&1048640&&o!==(o=i[6].includes(fe(i[20]).id)?"remove":"add")&&W(r,o)},d(i){i&&(k(n),k(t),k(l),k(r))}}}function Gt(s){let n,e,t=s[3]!=null&&He(s);return{c(){t&&t.c(),n=ge()},m(l,o){t&&t.m(l,o),h(l,n,o),e=!0},p(l,o){l[3]!=null?t?(t.p(l,o),o&8&&y(t,1)):(t=He(l),t.c(),y(t,1),t.m(n.parentNode,n)):t&&(X(),G(t,1,1,()=>{t=null}),Y())},i(l){e||(y(t),e=!0)},o(l){G(t),e=!1},d(l){l&&k(n),t&&t.d(l)}}}function Mt(s){let n,e;return n=new ze({props:{manageHoverState:!0,paint:{"line-width":["case",["in",["id"],["literal",s[6]]],8,5],"line-color":"black","line-opacity":Te(.5,1)},hoverCursor:s[3]==null?void 0:"pointer",$$slots:{default:[Gt]},$$scope:{ctx:s}}}),n.$on("click",s[14]),{c(){H(n.$$.fragment)},m(t,l){P(n,t,l),e=!0},p(t,l){const o={};l&64&&(o.paint={"line-width":["case",["in",["id"],["literal",t[6]]],8,5],"line-color":"black","line-opacity":Te(.5,1)}),l&8&&(o.hoverCursor=t[3]==null?void 0:"pointer"),l&2097224&&(o.$$scope={dirty:l,ctx:t}),n.$set(o)},i(t){e||(y(n.$$.fragment,t),e=!0)},o(t){G(n.$$.fragment,t),e=!1},d(t){z(n,t)}}}function St(s){let n,e;return n=new ze({props:{manageHoverState:!0,paint:{"line-width":8,"line-color":["match",["get","reviewed"],"unreviewed","red","blue"],"line-opacity":["case",["==",["id"],s[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,[">",["length",["get","matching_sources"]],0],.5,.2]},hoverCursor:"pointer"}}),n.$on("click",s[13]),{c(){H(n.$$.fragment)},m(t,l){P(n,t,l),e=!0},p(t,l){const o={};l&8&&(o.paint={"line-width":8,"line-color":["match",["get","reviewed"],"unreviewed","red","blue"],"line-opacity":["case",["==",["id"],t[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,[">",["length",["get","matching_sources"]],0],.5,.2]}),n.$set(o)},i(t){e||(y(n.$$.fragment,t),e=!0)},o(t){G(n.$$.fragment,t),e=!1},d(t){z(n,t)}}}function Lt(s){let n,e,t,l,o,r=s[2]&&Fe(s);return e=new Le({props:{data:s[0],$$slots:{default:[Mt]},$$scope:{ctx:s}}}),l=new Le({props:{data:s[1],$$slots:{default:[St]},$$scope:{ctx:s}}}),{c(){r&&r.c(),n=J(),H(e.$$.fragment),t=J(),H(l.$$.fragment)},m(i,u){r&&r.m(i,u),h(i,n,u),P(e,i,u),h(i,t,u),P(l,i,u),o=!0},p(i,u){i[2]?r?(r.p(i,u),u&4&&y(r,1)):(r=Fe(i),r.c(),y(r,1),r.m(n.parentNode,n)):r&&(X(),G(r,1,1,()=>{r=null}),Y());const a={};u&1&&(a.data=i[0]),u&2097224&&(a.$$scope={dirty:u,ctx:i}),e.$set(a);const f={};u&2&&(f.data=i[1]),u&2097160&&(f.$$scope={dirty:u,ctx:i}),l.$set(f)},i(i){o||(y(r),y(e.$$.fragment,i),y(l.$$.fragment,i),o=!0)},o(i){G(r),G(e.$$.fragment,i),G(l.$$.fragment,i),o=!1},d(i){i&&(k(n),k(t)),r&&r.d(i),z(e,i),z(l,i)}}}function Tt(s){let n,e,t,l;function o(i){s[15](i)}let r={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Lt]},$$scope:{ctx:s}};return s[5]!==void 0&&(r.map=s[5]),e=new it({props:r}),Q.push(()=>ne(e,"map",o)),e.$on("error",s[16]),{c(){n=v("div"),H(e.$$.fragment),A(n,"slot","main"),U(n,"position","relative"),U(n,"width","100%"),U(n,"height","100vh")},m(i,u){h(i,n,u),P(e,n,null),l=!0},p(i,u){const a={};u&2097231&&(a.$$scope={dirty:u,ctx:i}),!t&&u&32&&(t=!0,a.map=i[5],oe(()=>t=!1)),e.$set(a)},i(i){l||(y(e.$$.fragment,i),l=!0)},o(i){G(e.$$.fragment,i),l=!1},d(i){i&&k(n),z(e)}}}function Nt(s){let n,e,t,l;return n=new lt({props:{$$slots:{main:[Tt],left:[Ot]},$$scope:{ctx:s}}}),{c(){H(n.$$.fragment)},m(o,r){P(n,o,r),e=!0,t||(l=F(bt,"keydown",s[10]),t=!0)},p(o,[r]){const i={};r&2097279&&(i.$$scope={dirty:r,ctx:o}),n.$set(i)},i(o){e||(y(n.$$.fragment,o),e=!0)},o(o){G(n.$$.fragment,o),e=!1},d(o){z(n,o),t=!1,l()}}}function Dt(s,n,e){let t,l,o,r=ue(),i=ue(),u=!1,a=null;Pe(async()=>{await rt();try{let p=window.localStorage.getItem(_e);if(p){let B=JSON.parse(p);e(0,[r,i]=B,r,e(1,i)),e(2,u=!0),console.log(`Restored data from local storage ${_e}`)}}catch(p){console.log(`Couldn't restore data from local storage: ${p}`)}});function f(){let p={type:"FeatureCollection",features:[...r.features,...i.features]};o==null||o.fitBounds(Se(p),{animate:!1,padding:10})}function d(p){if(a==null)throw new Error("impossible");e(1,i.features[a].properties.reviewed=p,i),e(1,i),e(3,a=null)}function O(){for(let p of i.features)if(p.properties.reviewed=="unreviewed"){o==null||o.fitBounds(Se(p),{duration:600,padding:200}),e(3,a=p.id);return}}function T(p){p.target.tagName=="INPUT"||!u||p.key=="n"&&O()}function D(){ut("reviewed_targets.geojson",JSON.stringify(i))}function _(){window.confirm("Do you want to discard this review and start over?")&&(e(0,r=ue()),e(1,i=ue()),e(2,u=!1),e(3,a=null))}function g(p){u&&e(3,a=p.detail.features[0].id)}function L(p){if(!u||a==null)return;let B=p.detail.features[0].id,m=i.features[a].properties;m.matching_sources.includes(B)?m.matching_sources=m.matching_sources.filter(E=>E!=B):m.matching_sources.push(B),e(1,i)}function b(p){o=p,e(5,o)}const M=p=>{console.log(p.detail.error)};function I(p){r=p,e(0,r)}function j(p){i=p,e(1,i)}function S(p){u=p,e(2,u)}return s.$$.update=()=>{s.$$.dirty&10&&e(6,t=a==null?[]:i.features[a].properties.matching_sources),s.$$.dirty&2&&e(4,l=i.features.filter(p=>p.properties.reviewed!="unreviewed").length),s.$$.dirty&23&&u&&(console.log(`Autosaving with ${l} reviewed targets`),window.localStorage.setItem(_e,JSON.stringify([r,i])))},[r,i,u,a,l,o,t,f,d,O,T,D,_,g,L,b,M,I,j,S]}class Et extends ce{constructor(n){super(),ae(this,n,Dt,Nt,me,{})}}new Et({target:document.getElementById("app")});
