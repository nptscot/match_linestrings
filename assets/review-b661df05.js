import{S as ce,i as ae,s as pe,P as ge,r as w,t as C,w as X,g as L,x as Y,y,Q as Ve,R as Qe,T as Xe,U as re,o as Ae,V as $,W as Ye,X as xe,j as G,Y as $e,Z as et,$ as tt,a0 as nt,a1 as ot,z as V,n as N,k as J,q as F,B as W,u as b,a2 as Le,v as H,I as U,a3 as Q,J as he,a4 as ze,H as lt,A as ne,d as P,e as A,C as oe,h as z,E as st,L as it,M as rt,D as ue,_ as ut,G as ft,F as Se,K as Te,N as Re,O as Ne,a5 as fe}from"./Settings-52815a8f.js";const ct=i=>({features:i[0]&16,data:i[0]&16,map:i[0]&4,close:i[0]&1}),De=i=>{var n;return{features:i[4],data:((n=i[4])==null?void 0:n[0])??null,map:i[2],close:i[31]}};function Ee(i){var l;let n,e,t=(((l=i[4])==null?void 0:l.length)||i[3]instanceof $.Marker)&&Ie(i);return{c(){n=G("div"),t&&t.c()},m(o,r){w(o,n,r),t&&t.m(n,null),i[32](n),e=!0},p(o,r){var s;(s=o[4])!=null&&s.length||o[3]instanceof $.Marker?t?(t.p(o,r),r[0]&24&&C(t,1)):(t=Ie(o),t.c(),C(t,1),t.m(n,null)):t&&(X(),L(t,1,1,()=>{t=null}),Y())},i(o){e||(C(t),e=!0)},o(o){L(t),e=!1},d(o){o&&y(n),t&&t.d(),i[32](null)}}}function Ie(i){let n;const e=i[30].default,t=$e(e,i,i[29],De);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),n=!0},p(l,o){t&&t.p&&(!n||o[0]&536870933)&&et(t,e,l,l[29],n?nt(e,l[29],o,ct):tt(l[29]),De)},i(l){n||(C(t,l),n=!0)},o(l){L(t,l),n=!1},d(l){t&&t.d(l)}}}function at(i){let n,e,t=i[9].default&&Ee(i);return{c(){t&&t.c(),n=ge()},m(l,o){t&&t.m(l,o),w(l,n,o),e=!0},p(l,o){l[9].default?t?(t.p(l,o),o[0]&512&&C(t,1)):(t=Ee(l),t.c(),C(t,1),t.m(n.parentNode,n)):t&&(X(),L(t,1,1,()=>{t=null}),Y())},i(l){e||(C(t),e=!0)},o(l){L(t),e=!1},d(l){l&&y(n),t&&t.d(l)}}}function pt(i,n,e){let t,l,o,r,s,u,{$$slots:c={},$$scope:a}=n;const m=Ve(c);let{closeButton:O=void 0}=n,{closeOnClickOutside:T=!0}=n,{closeOnClickInside:_=!1}=n,{closeOnMove:k=!1}=n,{openOn:g="click"}=n,{openIfTopMost:S=!0}=n,{focusAfterOpen:M=!0}=n,{anchor:D=void 0}=n,{offset:E=void 0}=n,{popupClass:h=void 0}=n,{maxWidth:j=void 0}=n,{lngLat:d=void 0}=n,{html:B=void 0}=n,{open:p=!1}=n;const I=Qe(),{map:ee,popupTarget:ke,layerEvent:le,layer:be,eventTopMost:We,markerClickManager:we}=Xe();re(i,ee,f=>e(2,o=f)),re(i,ke,f=>e(3,s=f)),re(i,le,f=>e(28,r=f)),re(i,be,f=>e(35,u=f));const Ke=["click","dblclick","contextmenu"];let v,se=!1,K;function Ue(){if(!v)return;let f=v.getElement();!f||f===K||(K=f,g==="hover"&&(K.style.pointerEvents="none"),K.addEventListener("mouseenter",()=>{e(24,se=!0)},{passive:!0}),K.addEventListener("mouseleave",()=>{e(24,se=!1)},{passive:!0}),K.addEventListener("click",()=>{_&&e(0,p=!1)},{passive:!0}))}Ae(()=>{if(o)return o.on("click",ie),o.on("contextmenu",ie),we.add(Ge),typeof s=="string"&&(o.on("click",s,Z),o.on("dblclick",s,Z),o.on("contextmenu",s,Z),o.on("mousemove",s,Me),o.on("mouseleave",s,Ce),o.on("touchstart",s,ve),o.on("touchend",s,je)),()=>{o!=null&&o.loaded()&&(v==null||v.remove(),o.off("click",ie),o.off("contextmenu",ie),we.remove(Ge),s instanceof $.Marker?s.getPopup()===v&&s.setPopup(void 0):typeof s=="string"&&(o.off("click",s,Z),o.off("dblclick",s,Z),o.off("contextmenu",s,Z),o.off("mousemove",s,Me),o.off("mouseleave",s,Ce),o.off("touchstart",s,ve),o.off("touchend",s,je)))}});function ye(f){return S?!("marker"in f)&&!ot(f)&&We(f)!==u:!1}let q=null,R="normal";function Oe(f){"layerType"in f&&f.layerType==="deckgl"?(e(10,d=f.coordinate),e(4,q=f.object?[f.object]:null)):(e(10,d=f.lngLat),e(4,q=f.features??[]))}function Z(f){f.type!==g||ye(f)||(Oe(f),setTimeout(()=>e(0,p=!0)))}let x=null;function ve(f){x=f.point}function je(f){if(!x||g!=="hover")return;let de=x.dist(f.point);x=null,de<3&&(e(10,d=f.lngLat),e(4,q=f.features??[]),v.isOpen()?e(25,R="justOpened"):(e(25,R="opening"),e(0,p=!0)))}function Ce(f){g!=="hover"||x||R!=="normal"||(e(0,p=!1),e(4,q=null))}function Me(f){if(!(g!=="hover"||x||R!=="normal")){if(ye(f)){e(0,p=!1),e(4,q=null);return}e(0,p=!0),e(4,q=f.features??[]),e(10,d=f.lngLat)}}function ie(f){if(R==="justOpened"){e(25,R="normal");return}if(!T)return;let de=[K,s instanceof $.Marker?s==null?void 0:s.getElement():null];p&&v.isOpen()&&!de.some(me=>me==null?void 0:me.contains(f.originalEvent.target))&&(f.type==="contextmenu"&&g==="contextmenu"||f.type!=="contextmenu")&&e(0,p=!1)}function Ge(f){T&&p&&v.isOpen()&&f.marker!==s&&e(0,p=!1)}Ye(()=>{o&&(v!=null&&v.isOpen())&&v.remove()});let te;const qe=()=>e(0,p=!1);function Ze(f){V[f?"unshift":"push"](()=>{te=f,e(1,te)})}return i.$$set=f=>{"closeButton"in f&&e(11,O=f.closeButton),"closeOnClickOutside"in f&&e(12,T=f.closeOnClickOutside),"closeOnClickInside"in f&&e(13,_=f.closeOnClickInside),"closeOnMove"in f&&e(14,k=f.closeOnMove),"openOn"in f&&e(15,g=f.openOn),"openIfTopMost"in f&&e(16,S=f.openIfTopMost),"focusAfterOpen"in f&&e(17,M=f.focusAfterOpen),"anchor"in f&&e(18,D=f.anchor),"offset"in f&&e(19,E=f.offset),"popupClass"in f&&e(20,h=f.popupClass),"maxWidth"in f&&e(21,j=f.maxWidth),"lngLat"in f&&e(10,d=f.lngLat),"html"in f&&e(22,B=f.html),"open"in f&&e(0,p=f.open),"$$scope"in f&&e(29,a=f.$$scope)},i.$$.update=()=>{if(i.$$.dirty[0]&14336&&e(27,t=O??(!T&&!_)),i.$$.dirty[0]&146685952&&(v||(e(23,v=new $.Popup({closeButton:t,closeOnClick:!1,closeOnMove:k,focusAfterOpen:M,maxWidth:j,className:h,anchor:D,offset:E})),K=v.getElement(),v.on("open",()=>{e(0,p=!0),Ue(),I("open",v)}),v.on("close",()=>{e(0,p=!1),I("close",v)}),v.on("hover",()=>{I("hover",v)}))),i.$$.dirty[0]&8421384&&v&&s instanceof $.Marker&&(g==="click"?s.setPopup(v):s.getPopup()===v&&s.setPopup(void 0)),i.$$.dirty[0]&268468224&&Ke.includes(g)&&(r==null?void 0:r.type)===g&&(Z(r),xe(le,r=null,r)),i.$$.dirty[0]&268468224&&e(26,l=g==="hover"&&((r==null?void 0:r.type)==="mousemove"||(r==null?void 0:r.type)==="mouseenter")),i.$$.dirty[0]&352354304&&g==="hover"&&le&&(l&&r&&Oe(r),e(0,p=(l||se)??!1)),i.$$.dirty[0]&12582914&&(te?v.setDOMContent(te):B&&v.setHTML(B)),i.$$.dirty[0]&8389632&&d&&v.setLngLat(d),i.$$.dirty[0]&41943045&&o){let f=v.isOpen();p&&!f?(v.addTo(o),R==="opening"&&e(25,R="justOpened")):!p&&f&&v.remove()}},[p,te,o,s,q,ee,ke,le,be,m,d,O,T,_,k,g,S,M,D,E,h,j,B,v,se,R,l,t,r,a,c,qe,Ze]}class dt extends ce{constructor(n){super(),ae(this,n,pt,at,pe,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}let _e="match-linestrings-review";const{window:mt}=ze;function _t(i){let n,e,t,l,o,r,s,u,c,a,m,O,T,_,k,g,S,M,D,E;return{c(){n=G("h3"),e=N("Target "),t=N(i[0]),l=N(": "),o=N(i[3]),r=J(),s=G("div"),u=G("button"),u.innerHTML=`<kbd>1</kbd>
    - Unreviewed`,c=J(),a=G("button"),a.innerHTML=`<kbd>2</kbd>
    - Not sure`,m=J(),O=G("button"),O.innerHTML=`<kbd>3</kbd>
    - No matches`,T=J(),_=G("div"),k=G("div"),g=G("button"),g.innerHTML=`<kbd>4</kbd>
        - These sources`,S=J(),M=G("input"),F(M,"type","text"),W(M,"width","50%"),W(s,"display","flex"),W(s,"justify-content","space-between")},m(h,j){w(h,n,j),b(n,e),b(n,t),b(n,l),b(n,o),w(h,r,j),w(h,s,j),b(s,u),b(s,c),b(s,a),b(s,m),b(s,O),b(s,T),b(s,_),b(_,k),b(k,g),b(_,S),b(_,M),Le(M,i[2]),D||(E=[H(mt,"keydown",i[5]),H(u,"click",i[7]),H(a,"click",i[8]),H(O,"click",i[9]),H(g,"click",i[4]),H(M,"input",i[10])],D=!0)},p(h,[j]){j&1&&U(t,h[0]),j&4&&M.value!==h[2]&&Le(M,h[2])},i:Q,o:Q,d(h){h&&(y(n),y(r),y(s)),D=!1,he(E)}}}function gt(i,n,e){let{clickedTarget:t}=n,{targetGj:l}=n,{onConfirm:o}=n,r=l.features[t].properties.reviewed,s=Array.isArray(r)?JSON.stringify(r):JSON.stringify(l.features[t].properties.matching_sources);function u(){try{let _=JSON.parse(s);if(!Array.isArray(_))throw new Error("Not an array");o(_)}catch{window.alert("Not a list of source IDs")}}function c(_){_.target.tagName!="INPUT"&&(_.key=="1"?o("unreviewed"):_.key=="2"?o("not sure"):_.key=="3"?o([]):_.key=="4"&&u())}const a=()=>o("unreviewed"),m=()=>o("not sure"),O=()=>o([]);function T(){s=this.value,e(2,s)}return i.$$set=_=>{"clickedTarget"in _&&e(0,t=_.clickedTarget),"targetGj"in _&&e(6,l=_.targetGj),"onConfirm"in _&&e(1,o=_.onConfirm)},[t,o,s,r,u,c,l,a,m,O,T]}class ht extends ce{constructor(n){super(),ae(this,n,gt,_t,pe,{clickedTarget:0,targetGj:6,onConfirm:1})}}function Je(i){let n,e,t,l=i[0].features.length+"",o,r,s,u=i[1].features.length+"",c,a,m,O=i[1].features.filter(Be).length+"",T,_,k,g,S,M,D,E,h,j;function d(p){i[10](p)}let B={onChange:i[5]};return i[3]!==void 0&&(B.options=i[3]),g=new lt({props:B}),V.push(()=>ne(g,"options",d)),{c(){n=G("button"),n.textContent="Swap",e=J(),t=G("p"),o=N(l),r=N(` sources and
    `),s=G("span"),c=N(u),a=N(" targets"),m=N(`
    , with `),T=N(O),_=N(" matching a source"),k=J(),P(g.$$.fragment),M=J(),D=G("button"),D.textContent="Start review",F(n,"class","secondary"),W(s,"color","red")},m(p,I){w(p,n,I),w(p,e,I),w(p,t,I),b(t,o),b(t,r),b(t,s),b(s,c),b(s,a),b(t,m),b(t,T),b(t,_),w(p,k,I),A(g,p,I),w(p,M,I),w(p,D,I),E=!0,h||(j=[H(n,"click",i[7]),H(D,"click",i[11])],h=!0)},p(p,I){(!E||I&1)&&l!==(l=p[0].features.length+"")&&U(o,l),(!E||I&2)&&u!==(u=p[1].features.length+"")&&U(c,u),(!E||I&2)&&O!==(O=p[1].features.filter(Be).length+"")&&U(T,O);const ee={};!S&&I&8&&(S=!0,ee.options=p[3],oe(()=>S=!1)),g.$set(ee)},i(p){E||(C(g.$$.fragment,p),E=!0)},o(p){L(g.$$.fragment,p),E=!1},d(p){p&&(y(n),y(e),y(t),y(k),y(M),y(D)),z(g,p),h=!1,he(j)}}}function kt(i){let n,e,t,l,o,r,s,u,c=i[0].features.length>0&&Je(i);return{c(){n=G("label"),e=N(`Load two .geojson files
  `),t=G("input"),l=J(),c&&c.c(),o=ge(),F(t,"type","file"),t.multiple=!0},m(a,m){w(a,n,m),b(n,e),b(n,t),i[9](t),w(a,l,m),c&&c.m(a,m),w(a,o,m),r=!0,s||(u=H(t,"change",i[6]),s=!0)},p(a,[m]){a[0].features.length>0?c?(c.p(a,m),m&1&&C(c,1)):(c=Je(a),c.c(),C(c,1),c.m(o.parentNode,o)):c&&(X(),L(c,1,1,()=>{c=null}),Y())},i(a){r||(C(c),r=!0)},o(a){L(c),r=!1},d(a){a&&(y(n),y(l),y(o)),i[9](null),c&&c.d(a),s=!1,u()}}}function He(i){let n=0;for(let e of i.features)e.id=n++,e.properties??(e.properties={});return i}const Be=i=>i.properties.matching_sources.length>0;function bt(i,n,e){let{sourceGj:t}=n,{targetGj:l}=n,{setupDone:o}=n,{zoomFit:r}=n,s={buffer_meters:20,angle_diff_threshold:10,length_ratio_threshold:1.1,midpt_dist_threshold:15};function u(){var k;try{let g=JSON.parse(st(JSON.stringify(t),JSON.stringify(l),s));for(let[S,M]of l.features.entries())M.properties.matching_sources=g[S].matching_sources,(k=M.properties).reviewed??(k.reviewed="unreviewed");e(1,l)}catch(g){window.alert(`Bug: ${g}`)}}let c;async function a(k){if(!c.files)return;if(c.files.length!=2){window.alert("Select two GeoJSON files");return}try{let S=await c.files[0].text(),M=await c.files[1].text();e(0,t=He(JSON.parse(S))),e(1,l=He(JSON.parse(M))),r(),u()}catch(S){window.alert(`Bad input file: ${S}`)}}function m(){e(0,[t,l]=[l,t],t,e(1,l)),u()}function O(k){V[k?"unshift":"push"](()=>{c=k,e(4,c)})}function T(k){s=k,e(3,s)}const _=()=>e(2,o=!0);return i.$$set=k=>{"sourceGj"in k&&e(0,t=k.sourceGj),"targetGj"in k&&e(1,l=k.targetGj),"setupDone"in k&&e(2,o=k.setupDone),"zoomFit"in k&&e(8,r=k.zoomFit)},[t,l,o,s,c,u,a,m,r,O,T,_]}class wt extends ce{constructor(n){super(),ae(this,n,bt,kt,pe,{sourceGj:0,targetGj:1,setupDone:2,zoomFit:8})}}const{window:yt}=ze;function Ot(i){let n,e,t,l,o,r,s,u,c,a,m,O,T,_=i[1].features.length+"",k,g,S,M,D,E;return{c(){n=G("div"),e=G("button"),e.textContent="Start over",t=J(),l=G("button"),l.textContent="Zoom to fit",o=J(),r=G("br"),s=J(),u=G("progress"),a=J(),m=G("p"),O=N(i[4]),T=N(" / "),k=N(_),g=N(" targets reviewed"),S=J(),M=G("button"),M.textContent="Download reviews",F(e,"class","secondary"),F(l,"class","secondary"),W(n,"display","flex"),W(n,"justify-content","space-between"),u.value=i[4],F(u,"max",c=i[1].features.length)},m(h,j){w(h,n,j),b(n,e),b(n,t),b(n,l),w(h,o,j),w(h,r,j),w(h,s,j),w(h,u,j),w(h,a,j),w(h,m,j),b(m,O),b(m,T),b(m,k),b(m,g),w(h,S,j),w(h,M,j),D||(E=[H(e,"click",i[12]),H(l,"click",i[7]),H(M,"click",i[11])],D=!0)},p(h,j){j&16&&(u.value=h[4]),j&2&&c!==(c=h[1].features.length)&&F(u,"max",c),j&16&&U(O,h[4]),j&2&&_!==(_=h[1].features.length+"")&&U(k,_)},i:Q,o:Q,d(h){h&&(y(n),y(o),y(r),y(s),y(u),y(a),y(m),y(S),y(M)),D=!1,he(E)}}}function vt(i){let n,e,t,l,o;function r(a){i[17](a)}function s(a){i[18](a)}function u(a){i[19](a)}let c={zoomFit:i[7]};return i[0]!==void 0&&(c.sourceGj=i[0]),i[1]!==void 0&&(c.targetGj=i[1]),i[2]!==void 0&&(c.setupDone=i[2]),n=new wt({props:c}),V.push(()=>ne(n,"sourceGj",r)),V.push(()=>ne(n,"targetGj",s)),V.push(()=>ne(n,"setupDone",u)),{c(){P(n.$$.fragment)},m(a,m){A(n,a,m),o=!0},p(a,m){const O={};!e&&m&1&&(e=!0,O.sourceGj=a[0],oe(()=>e=!1)),!t&&m&2&&(t=!0,O.targetGj=a[1],oe(()=>t=!1)),!l&&m&4&&(l=!0,O.setupDone=a[2],oe(()=>l=!1)),n.$set(O)},i(a){o||(C(n.$$.fragment,a),o=!0)},o(a){L(n.$$.fragment,a),o=!1},d(a){z(n,a)}}}function jt(i){let n,e,t,l,o,r;const s=[vt,Ot],u=[];function c(a,m){return a[2]?1:0}return l=c(i),o=u[l]=s[l](i),{c(){n=G("div"),e=G("h1"),e.textContent="Match LineStrings - review results to make test cases",t=J(),o.c(),F(n,"slot","left")},m(a,m){w(a,n,m),b(n,e),b(n,t),u[l].m(n,null),r=!0},p(a,m){let O=l;l=c(a),l===O?u[l].p(a,m):(X(),L(u[O],1,1,()=>{u[O]=null}),Y(),o=u[l],o?o.p(a,m):(o=u[l]=s[l](a),o.c()),C(o,1),o.m(n,null))},i(a){r||(C(o),r=!0)},o(a){L(o),r=!1},d(a){a&&y(n),u[l].d()}}}function Fe(i){let n,e,t,l;const o=[Mt,Ct],r=[];function s(u,c){return u[3]==null?0:1}return e=s(i),t=r[e]=o[e](i),{c(){n=G("div"),t.c(),F(n,"class","map-panel svelte-1lu903l")},m(u,c){w(u,n,c),r[e].m(n,null),l=!0},p(u,c){let a=e;e=s(u),e===a?r[e].p(u,c):(X(),L(r[a],1,1,()=>{r[a]=null}),Y(),t=r[e],t?t.p(u,c):(t=r[e]=o[e](u),t.c()),C(t,1),t.m(n,null))},i(u){l||(C(t),l=!0)},o(u){L(t),l=!1},d(u){u&&y(n),r[e].d()}}}function Ct(i){let n,e;return n=new ht({props:{clickedTarget:i[3],targetGj:i[1],onConfirm:i[8]}}),{c(){P(n.$$.fragment)},m(t,l){A(n,t,l),e=!0},p(t,l){const o={};l&8&&(o.clickedTarget=t[3]),l&2&&(o.targetGj=t[1]),n.$set(o)},i(t){e||(C(n.$$.fragment,t),e=!0)},o(t){L(n.$$.fragment,t),e=!1},d(t){z(n,t)}}}function Mt(i){let n,e,t;return{c(){n=G("button"),n.innerHTML=`Goto <kbd>n</kbd>
              ext unreviewed`},m(l,o){w(l,n,o),e||(t=H(n,"click",i[9]),e=!0)},p:Q,i:Q,o:Q,d(l){l&&y(n),e=!1,t()}}}function Pe(i){let n,e;return n=new dt({props:{openOn:"hover",$$slots:{default:[Gt,({data:t})=>({20:t}),({data:t})=>t?1048576:0]},$$scope:{ctx:i}}}),{c(){P(n.$$.fragment)},m(t,l){A(n,t,l),e=!0},p(t,l){const o={};l&3145792&&(o.$$scope={dirty:l,ctx:t}),n.$set(o)},i(t){e||(C(n.$$.fragment,t),e=!0)},o(t){L(n.$$.fragment,t),e=!1},d(t){z(n,t)}}}function Gt(i){let n,e=fe(i[20]).id+"",t,l,o=i[6].includes(fe(i[20]).id)?"remove":"add",r;return{c(){n=N("Source "),t=N(e),l=N(" -- click to "),r=N(o)},m(s,u){w(s,n,u),w(s,t,u),w(s,l,u),w(s,r,u)},p(s,u){u&1048576&&e!==(e=fe(s[20]).id+"")&&U(t,e),u&1048640&&o!==(o=s[6].includes(fe(s[20]).id)?"remove":"add")&&U(r,o)},d(s){s&&(y(n),y(t),y(l),y(r))}}}function Lt(i){let n,e,t=i[3]!=null&&Pe(i);return{c(){t&&t.c(),n=ge()},m(l,o){t&&t.m(l,o),w(l,n,o),e=!0},p(l,o){l[3]!=null?t?(t.p(l,o),o&8&&C(t,1)):(t=Pe(l),t.c(),C(t,1),t.m(n.parentNode,n)):t&&(X(),L(t,1,1,()=>{t=null}),Y())},i(l){e||(C(t),e=!0)},o(l){L(t),e=!1},d(l){l&&y(n),t&&t.d(l)}}}function St(i){let n,e;return n=new Re({props:{manageHoverState:!0,paint:{"line-width":["case",["in",["id"],["literal",i[6]]],8,5],"line-color":"black","line-opacity":Ne(.5,1)},hoverCursor:i[3]==null?void 0:"pointer",$$slots:{default:[Lt]},$$scope:{ctx:i}}}),n.$on("click",i[14]),{c(){P(n.$$.fragment)},m(t,l){A(n,t,l),e=!0},p(t,l){const o={};l&64&&(o.paint={"line-width":["case",["in",["id"],["literal",t[6]]],8,5],"line-color":"black","line-opacity":Ne(.5,1)}),l&8&&(o.hoverCursor=t[3]==null?void 0:"pointer"),l&2097224&&(o.$$scope={dirty:l,ctx:t}),n.$set(o)},i(t){e||(C(n.$$.fragment,t),e=!0)},o(t){L(n.$$.fragment,t),e=!1},d(t){z(n,t)}}}function Tt(i){let n,e;return n=new Re({props:{manageHoverState:!0,paint:{"line-width":8,"line-color":["match",["get","reviewed"],"unreviewed","red","blue"],"line-opacity":["case",["==",["id"],i[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,[">",["length",["get","matching_sources"]],0],.5,.2]},hoverCursor:"pointer"}}),n.$on("click",i[13]),{c(){P(n.$$.fragment)},m(t,l){A(n,t,l),e=!0},p(t,l){const o={};l&8&&(o.paint={"line-width":8,"line-color":["match",["get","reviewed"],"unreviewed","red","blue"],"line-opacity":["case",["==",["id"],t[3]??-1],1,["boolean",["feature-state","hover"],!1],.6,[">",["length",["get","matching_sources"]],0],.5,.2]}),n.$set(o)},i(t){e||(C(n.$$.fragment,t),e=!0)},o(t){L(n.$$.fragment,t),e=!1},d(t){z(n,t)}}}function Nt(i){let n,e,t,l,o,r=i[2]&&Fe(i);return e=new Te({props:{data:i[0],$$slots:{default:[St]},$$scope:{ctx:i}}}),l=new Te({props:{data:i[1],$$slots:{default:[Tt]},$$scope:{ctx:i}}}),{c(){r&&r.c(),n=J(),P(e.$$.fragment),t=J(),P(l.$$.fragment)},m(s,u){r&&r.m(s,u),w(s,n,u),A(e,s,u),w(s,t,u),A(l,s,u),o=!0},p(s,u){s[2]?r?(r.p(s,u),u&4&&C(r,1)):(r=Fe(s),r.c(),C(r,1),r.m(n.parentNode,n)):r&&(X(),L(r,1,1,()=>{r=null}),Y());const c={};u&1&&(c.data=s[0]),u&2097224&&(c.$$scope={dirty:u,ctx:s}),e.$set(c);const a={};u&2&&(a.data=s[1]),u&2097160&&(a.$$scope={dirty:u,ctx:s}),l.$set(a)},i(s){o||(C(r),C(e.$$.fragment,s),C(l.$$.fragment,s),o=!0)},o(s){L(r),L(e.$$.fragment,s),L(l.$$.fragment,s),o=!1},d(s){s&&(y(n),y(t)),r&&r.d(s),z(e,s),z(l,s)}}}function Dt(i){let n,e,t,l;function o(s){i[15](s)}let r={style:"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo",standardControls:!0,hash:!0,$$slots:{default:[Nt]},$$scope:{ctx:i}};return i[5]!==void 0&&(r.map=i[5]),e=new rt({props:r}),V.push(()=>ne(e,"map",o)),e.$on("error",i[16]),{c(){n=G("div"),P(e.$$.fragment),F(n,"slot","main"),W(n,"position","relative"),W(n,"width","100%"),W(n,"height","100vh")},m(s,u){w(s,n,u),A(e,n,null),l=!0},p(s,u){const c={};u&2097231&&(c.$$scope={dirty:u,ctx:s}),!t&&u&32&&(t=!0,c.map=s[5],oe(()=>t=!1)),e.$set(c)},i(s){l||(C(e.$$.fragment,s),l=!0)},o(s){L(e.$$.fragment,s),l=!1},d(s){s&&y(n),z(e)}}}function Et(i){let n,e,t,l;return n=new it({props:{$$slots:{main:[Dt],left:[jt]},$$scope:{ctx:i}}}),{c(){P(n.$$.fragment)},m(o,r){A(n,o,r),e=!0,t||(l=H(yt,"keydown",i[10]),t=!0)},p(o,[r]){const s={};r&2097279&&(s.$$scope={dirty:r,ctx:o}),n.$set(s)},i(o){e||(C(n.$$.fragment,o),e=!0)},o(o){L(n.$$.fragment,o),e=!1},d(o){z(n,o),t=!1,l()}}}function It(i,n,e){let t,l,o,r=ue(),s=ue(),u=!1,c=null;Ae(async()=>{await ut();try{let d=window.localStorage.getItem(_e);if(d){let B=JSON.parse(d);e(0,[r,s]=B,r,e(1,s)),e(2,u=!0),console.log(`Restored data from local storage ${_e}`)}}catch(d){console.log(`Couldn't restore data from local storage: ${d}`)}});function a(){let d={type:"FeatureCollection",features:[...r.features,...s.features]};o==null||o.fitBounds(Se(d),{animate:!1,padding:10})}function m(d){if(c==null)throw new Error("impossible");e(1,s.features[c].properties.reviewed=d,s),e(1,s),e(3,c=null)}function O(){for(let d of s.features)if(d.properties.reviewed=="unreviewed"){o==null||o.fitBounds(Se(d),{duration:600,padding:200}),e(3,c=d.id);return}}function T(d){d.target.tagName=="INPUT"||!u||d.key=="n"&&O()}function _(){ft("reviewed_targets.geojson",JSON.stringify(s))}function k(){window.confirm("Do you want to discard this review and start over?")&&(e(0,r=ue()),e(1,s=ue()),e(2,u=!1),e(3,c=null))}function g(d){u&&e(3,c=d.detail.features[0].id)}function S(d){if(!u||c==null)return;let B=d.detail.features[0].id,p=s.features[c].properties;p.matching_sources.includes(B)?p.matching_sources=p.matching_sources.filter(I=>I!=B):p.matching_sources.push(B),e(1,s)}function M(d){o=d,e(5,o)}const D=d=>{console.log(d.detail.error)};function E(d){r=d,e(0,r)}function h(d){s=d,e(1,s)}function j(d){u=d,e(2,u)}return i.$$.update=()=>{i.$$.dirty&10&&e(6,t=c==null?[]:s.features[c].properties.matching_sources),i.$$.dirty&2&&e(4,l=s.features.filter(d=>d.properties.reviewed!="unreviewed").length),i.$$.dirty&23&&u&&(console.log(`Autosaving with ${l} reviewed targets`),window.localStorage.setItem(_e,JSON.stringify([r,s])))},[r,s,u,c,l,o,t,a,m,O,T,_,k,g,S,M,D,E,h,j]}class Jt extends ce{constructor(n){super(),ae(this,n,It,Et,pe,{})}}new Jt({target:document.getElementById("app")});
